define(["exports","./c_tslib","./e_ui_page_files_router"],(function(i,n,e){"use strict";function t(i,n,e,t){const a={path:n,mode:i?{".tag":"overwrite"}:{".tag":"add"},autorename:!0};return e.ns("files").upload("upload",a,t,{})}function a(i){return"function"==typeof i.arrayBuffer?i.arrayBuffer():new Promise(((n,e)=>{let t=new FileReader;t.onload=()=>{t.result instanceof ArrayBuffer?n(t.result):e(new Error("Result is not ArrayBuffer"))};try{t.readAsArrayBuffer(i)}catch(i){e(i)}}))}i.copyExif=function(i,n){return i&&n?new Blob([i.slice(0,2),n,i.slice(2)],{type:i.type}):i},i.fetchFile=(i,e)=>n.__awaiter(void 0,void 0,void 0,(function*(){if(i&&e){const n={dangerouslyFetchUserContent:!0};return i.ns("files").download("download",{path:e},{},n)}throw new Error(`apiClient, or path is missing. apiClient: ${i}, path: ${e}`)})),i.fetchSharedLinkFile=(i,e)=>n.__awaiter(void 0,void 0,void 0,(function*(){if(i&&e){const n={dangerouslyFetchUserContent:!0};return i.ns("sharing").download("get_shared_link_file",{url:e},{},n)}throw new Error(`apiClient, or url is missing. apiClient: ${i}, url: ${e}`)})),i.getPreviewMetadata=(i,e)=>n.__awaiter(void 0,void 0,void 0,(function*(){return yield i.ns("previews").rpc("get_preview_data_batch",{files:[{file_id:e}],include_dimensions:!0},{})})),i.retrieveExifWithoutOrientation=function(i){return n.__awaiter(this,void 0,void 0,(function*(){const n=yield a(i),e=new DataView(n);let t=0;if(65496!==e.getUint16(t))return new Error("not a valid JPEG");for(t+=2;;){const i=e.getUint16(t);if(65498===i)break;const a=e.getUint16(t+2);if(65505===i&&1165519206===e.getUint32(t+4)){const i=t+10;let r;switch(e.getUint16(i)){case 18761:r=!0;break;case 19789:r=!1;break;default:return new Error("TIFF header contains invalid endian")}if(42!==e.getUint16(i+2,r))return new Error("TIFF header contains invalid version");const o=e.getUint32(i+4,r);let c=i+o+2+12*e.getUint16(i+o,r);for(let n=i+o+2;n<c;n+=12){if(274==e.getUint16(n)){if(3!==e.getUint16(n+2,r))return new Error("Orientation data type is invalid");if(1!==e.getUint32(n+4,r))return new Error("Orientation data count is invalid");e.setUint16(n+8,1,r);break}}return n.slice(t,t+2+a)}t+=2+a}return new Blob}))},i.saveCopy=(i,a,r,o)=>n.__awaiter(void 0,void 0,void 0,(function*(){if(!i||!a)throw e.Snackbar.close("save-sync-notification"),e.Snackbar.fail(o.snackbarFailed,"save-fail-notification"),new Error("UploadPath or ApiClient is missing. UploadPath: "+i+" apiClient: "+a);e.Snackbar.sync(o.snackbarSync,!0,"save-sync-notification");try{const n=yield t(!1,i,a,r);return e.Snackbar.close("save-sync-notification"),e.Snackbar.complete(o.snackbarComplete,"save-complete-notification"),n}catch(i){throw e.Snackbar.close("save-sync-notification"),e.Snackbar.fail(o.snackbarFailed,"save-fail-notification"),i}})),i.saveReplace=(i,a,r,o)=>n.__awaiter(void 0,void 0,void 0,(function*(){if(!i||!a)throw e.Snackbar.close("save-sync-notification"),e.Snackbar.fail(o.snackbarFailed,"save-fail-notification"),new Error("Fileid or ApiClient is missing. Fileid: "+i+" apiClient: "+a);e.Snackbar.sync(o.snackbarSync,!0,"save-sync-notification");try{const n=yield t(!0,i,a,r);return e.Snackbar.close("save-sync-notification"),e.Snackbar.complete(o.snackbarComplete,"save-complete-notification"),n}catch(i){throw e.Snackbar.close("save-sync-notification"),e.Snackbar.fail(o.snackbarFailed,"save-fail-notification"),i}})),i.toArrayBuffer=a}));
//# sourceMappingURL=c_src_preview-photo-editor_exif.js-vflj9nVk5.map
