define(["require","exports","./e_ui_page_files_router","./e_edison","./c_lodash-es_lodash","./c_spectrum_media_table_skeleton","./c_spectrum_media_table_media_cell","./c_tslib","./c_spectrum_dimensions","./c_core_browser_detection","./c_core_i18n","./c_spectrum_vertically_fixed","./c_campaigns_campaigns_element_id_enum","./c_src_table","./c_combinations_index","./c_files_view_keyboard_shortcuts","metaserver/static/js/modules/constants/web_experience_constants","./c_files_view_files_view_logging","./c_spectrum_util_raf_throttle","./c_starred_actions","./c_starred_constants","./c_starred_star","metaserver/static/js/modules/constants/files_spa","./c_ui_selectable_list","./c_filename_highlights","./c_browse_interface","./c_ui_title_bubble","./c_ui_overlay","./c_src_highlighted-truncated-string_index","./c_files_view_file_thumbnail","./c_tagging_components_tags_container","./c_sync_everything_utils_deep_link_utils","./e_core_exception","./c_core_exception_info","./c_react_query_api_helpers_queries_search_experiments","./c_extensions_split_share_button","./c_vault_constants","./c_icon_file_folder_icon","./c_resize-observer-polyfill_dist_ResizeObserver","./c_spectrum_culled_list","./c_icon_file_icon","./c_aspect_ratio_index","./c_src_common_file","./c_truncate_index","./c_pap-events_filesystem_item_actions_unstar_file","./c_core_notify"],(function(e,t,i,s,a,n,o,l,r,c,d,h,u,p,m,g,f,S,b,E,_,T,w,C,R,F,v,I,N,D,y,M,L,O,x,k,A,$,P,H,W,V,B,z,U,G){"use strict";function K(e,t,s){const a=e.map((e=>e.sortField)).indexOf(t),n=e.map((e=>e.sortField)).indexOf(s);if(a===n||-1===a||-1===n)return e;const o=e[a],l=e[n];return i.splice(i.splice(e,a,1,l),n,1,o)}const q={columnResizingEnabled:!1,columnSizes:i.COLUMN_DEFAULT_WIDTHS,resizeColumn:function(e,t){},resizeColumnToDefault:function(e){}},j=s.React$1.createContext(q);function Y(e,t){const s=i.COLUMN_MIN_WIDTHS[t],a=i.COLUMN_MAX_WIDTHS[t];return Math.min(Math.max(e,s),a)}function X(e){return a.mapValues(e,((e,t)=>Y(e,t)))}const J=a.debounce((function(e,t){window.localStorage.setItem(e,JSON.stringify(t))})),Z={type:"no_storage"},Q=e=>{const t=s.React$1.useRef(e);return t.current=e,t},ee=({children:e,storageSetting:t,columnResizingEnabled:n,scrollContainerWidth:o,visibleColumns:l,visibleColumnsViewChange:r,isSearchMode:d})=>{const[h,u]=s.React$1.useState((()=>{switch(t.type){case"no_storage":return i.COLUMN_DEFAULT_WIDTHS;case"local_storage":return function(e){try{const t=window.localStorage.getItem(e),s=JSON.parse(t);return a.mapValues(i.COLUMN_DEFAULT_WIDTHS,((e,t)=>{const i=s[t];return"number"==typeof i?i:e}))}catch(e){return i.COLUMN_DEFAULT_WIDTHS}}(t.localStorageKey)}})),p=Q(h),m=Q(o),g=s.React$1.useRef("UNFROZEN"),f=s.React$1.useRef(c.safari);s.React$1.useEffect((()=>{if(n&&o&&o>0){if(f.current&&!d)return void(f.current=!1);const e=S(h),t="UNFROZEN"===g.current||"OVERFLOW"===g.current&&o>e||"UNDERFLOW"===g.current&&o<e;e>0&&o!==e&&t&&b(i.SortField.FILENAME,o-(e-h[i.SortField.FILENAME]),"DYNAMIC")}}),[o,r]);const S=e=>{let t=0;return l.map((e=>e.sortField)).forEach((i=>{t+=e[i]})),t},b=s.React$1.useCallback(((e,i,s="MANUAL")=>{if(p.current[e]!==i){const a=Object.assign(Object.assign({},p.current),{[e]:Y(i,e)});u(a),"local_storage"===t.type&&J(t.localStorageKey,a),"MANUAL"===s&&m.current?g.current=S(a)>m.current?"OVERFLOW":"UNDERFLOW":"DYNAMIC"===s&&(g.current="UNFROZEN")}}),[t,p,m]),E=s.React$1.useCallback((e=>{const t=i.COLUMN_DEFAULT_WIDTHS[e];b(e,t)}),[b]),_=s.React$1.useMemo((()=>({columnSizes:X(h),resizeColumn:b,resizeColumnToDefault:E,columnResizingEnabled:n})),[h,b,E,n]);return s.React$1.createElement(j.Provider,{value:_},e)};ee.displayName="ColumnResizingProvider",ee.displayName="ColumnResizingProvider";const te=e=>{var{responsiveContainer:t}=e,i=l.__rest(e,["responsiveContainer"]);return(i.isMatchedLarge||i.isMatchedMedium)&&t?s.React$1.createElement(r.Dimensions,null,(({width:e})=>{const t=Object.assign({},i);return e&&(t.isMatchedLarge=e>824,t.isMatchedMedium=!t.isMatchedLarge&&e>588),s.React$1.createElement(ie,Object.assign({},t,{containerWidth:e}))})):s.React$1.createElement(ie,Object.assign({},i))};te.displayName="ColumnManager";const ie=e=>{const[t,n]=s.React$1.useState((()=>e.preferredColumns?p(e):function(e){return e.columns.slice(0,S(e))}(e))),[o,l]=s.React$1.useState(e.viewType),[r,c]=s.React$1.useState((()=>b(t))),d=s.React$1.useRef(),h=s.React$1.useRef(),u=i.usePrevious(e);function p(e){const{currentSort:t,viewType:s,preferredColumns:a}=e;let n=a;if(s===i.ViewType.Grid||s===i.ViewType.LargeGrid){const e=n.find((e=>e.sortField===t.sortField));n=[e||n[0]]}else n=n.slice(0,S(e));return n}function m(t,i=!1){const s=b(t);n(t),c(s),i?d.current=setTimeout((()=>{g(),e.onCanDisplayFolderSizesChanged(s)})):e.onCanDisplayFolderSizesChanged(s)}s.React$1.useEffect((()=>{if(!u)return void e.onCanDisplayFolderSizesChanged(r);if(e.viewType!==u.viewType&&l(e.viewType),e.preferredColumns){const i=p(e);return void(a.isEqual(i,t)||m(i,!0))}const{columns:s,currentSort:o}=e,d=S(u),g=S(e);if(a.isEqual(e.columns,u.columns)&&e.viewType===u.viewType){if(g<d)m(t.slice(0,g),!0);else if(g>d){const e=g-t.length,i=a.filter(s,(e=>!a.find(t,(t=>t.sortField===e.sortField)))).slice(0,e);m([...t,...i],!0)}}else if(1===g&&s.length&&o){const{viewType:t,viewTypeColumns:a}=e,l=a?a[i.ViewType.Grid]:void 0;switch(t){case i.ViewType.List:case i.ViewType.CondensedList:m([s[0]],!0);break;case i.ViewType.Grid:case i.ViewType.LargeGrid:if(l){const i=s.find((e=>e.sortField===o.sortField))||s[0];!function(t,i,s){f();const a=b(t);n(t),c(a),h.current=setTimeout((()=>{f(),e.onColumnsChanged({columns:i,viewType:s,canDisplayFolderSizes:a})}))}([i],K(l,l[0].sortField,i.sortField),t)}}}else m(s.slice(0,g),!0)}),[e.columns,e.viewType,e.isMatchedLarge,e.isMatchedMedium,e.numVisibleColumns,e.preferredColumns]);const g=()=>{d.current&&(clearTimeout(d.current),d.current=void 0)};function f(){h.current&&(clearTimeout(h.current),h.current=void 0)}function S(e){const{isMatchedLarge:t,isMatchedMedium:s,viewType:a,numVisibleColumns:n,isMoreColumnsEnabled:o,isSearchMode:l}=e;switch(a){case i.ViewType.Grid:case i.ViewType.LargeGrid:return 1;case i.ViewType.List:case i.ViewType.CondensedList:default:return o?l?3:n||3:t?3:s?2:1}}function b(e){return e.some((e=>e.sortField===i.SortField.SIZE))}const{children:E,containerWidth:_}=e;if(!E)return null;let T=E;return"function"==typeof E&&(T=E({visibleColumns:t,canDisplayFolderSizes:r,handleSelection:function(s,a){const{isMoreColumnsEnabled:n,preferredColumns:o,viewType:l}=e;n&&o&&(l===i.ViewType.List||l===i.ViewType.CondensedList)?function(s,a,n){const{onColumnsChanged:o,viewType:l}=e,r=t.indexOf(s),c=t.includes(a)?t.indexOf(a):t.length-1,d=r>=0?i.splice(t,r,1):i.splice(t,c+1,0,s);m(d),o({columns:[...d,...n.filter((e=>!d.includes(e)))],viewType:l,canDisplayFolderSizes:b(d),numVisibleColumns:d.length})}(s,a,o):function(s,a){const{viewType:n,onColumnsChanged:o,viewTypeColumns:l,preferredColumns:r}=e,c=r||(l?l[i.ViewType.List]:void 0),d=l?l[i.ViewType.Grid]:void 0;if(c&&d){const e=t.indexOf(a);if(-1===e||t.includes(s))m(t);else{const l=i.splice(t,e,1,s);m(l);const h=b(l);n===i.ViewType.List||n===i.ViewType.CondensedList?o({columns:K(c,a.sortField,s.sortField),viewType:i.ViewType.List,canDisplayFolderSizes:h}):(r||o({columns:K(d,a.sortField,s.sortField),viewType:n,canDisplayFolderSizes:h}),s.sortField!==i.SortField.FILENAME&&o({columns:K(c,c[1].sortField,s.sortField),viewType:i.ViewType.List,canDisplayFolderSizes:h}))}}}(s,a)},handleReorder:function(s,a){const{preferredColumns:n,onColumnsChanged:o,viewType:l}=e;if(!n||!t[s]||!t[a])return;const r=i.splice(i.splice(t,a,1),s,0,t[a]);m(r),o({columns:[...r,...n.filter((e=>!r.includes(e)))],viewType:l,canDisplayFolderSizes:b(r),numVisibleColumns:r.length})},containerWidth:_})),s.React$1.createElement(ee,{storageSetting:e.columnResizeStorageSetting||Z,columnResizingEnabled:!!e.isMoreColumnsEnabled,scrollContainerWidth:e.scrollContainerWidth,visibleColumns:t,visibleColumnsViewChange:o,isSearchMode:e.isSearchMode},T)},se=s.React$1.createContext({draggedIndex:null,setDraggedIndex:()=>{},onReorder:()=>{}}),ae=({onReorder:e,children:t})=>{const[i,a]=s.reactExports.useState(null);return s.React$1.createElement(se.Provider,{value:{draggedIndex:i,setDraggedIndex:a,onReorder:e}},t)};ae.displayName="DraggableReorderProvider",ae.displayName="DraggableReorderProvider";function ne(e){return e===i.SortDirection.ASCENDING?"ascending":e===i.SortDirection.DESCENDING?"descending":"none"}const oe=(e,t)=>i=>{i.getModifierState("Alt")&&"ArrowLeft"===i.key&&e(),i.getModifierState("Alt")&&"ArrowRight"===i.key&&t()},le=({column:e,sortDirection:t,setSort:a,onDecreaseSize:n,onIncreaseSize:o})=>{const{columnResizingEnabled:l}=s.React$1.useContext(j);return e.isSortDisabled||e.isSortOrderOptionDisabled?s.React$1.createElement(i.Text,{variant:"label",isBold:void 0!==t,className:i.cx("files-view-column-header-unclickable","files-view-column-header-text",{"column-resizing-enabled":l}),tabIndex:l?0:void 0,onKeyDown:oe(n,o)},e.label):s.React$1.createElement(i.Button$1,{variant:"transparent",hasNoUnderline:!0,onClick:()=>a(e.sortField,t===i.SortDirection.ASCENDING?i.SortDirection.DESCENDING:i.SortDirection.ASCENDING),className:i.cx("files-view-column-header-text",{"column-resizing-enabled":l}),onKeyDown:oe(n,o)},s.React$1.createElement(i.Text,{variant:"label",isBold:void 0!==t},e.label),t&&s.React$1.createElement(i.UIIcon,{src:t===i.SortDirection.ASCENDING?i.ArrowUpLine:i.ArrowDownLine,size:"small",className:"files-view-column-header-sort-button"}))};le.displayName="ColumnHeaderCellContent",le.displayName="ColumnHeaderCellContent";const re=e=>{var{index:t,className:a}=e,n=l.__rest(e,["index","className"]);const r=(e=>{const{draggedIndex:t,setDraggedIndex:a,onReorder:n}=s.reactExports.useContext(se),[o,l]=s.reactExports.useState(!1),r=s.reactExports.useRef(null),c=t===e,d=null!==t&&!c;return{draggable:!0,onDragStart:s.reactExports.useCallback((t=>{t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.dropEffect="move"),a(e)}),[e]),onDragEnd:s.reactExports.useCallback((e=>{e.preventDefault(),e.stopPropagation(),a(null)}),[]),onDragEnter:s.reactExports.useCallback((e=>{d&&(e.preventDefault(),e.stopPropagation(),l(!0),r.current=e.target)}),[d]),onDragLeave:s.reactExports.useCallback((e=>{e.target===r.current&&(e.preventDefault(),e.stopPropagation(),l(!1))}),[]),onDrop:s.reactExports.useCallback((i=>{d&&null!==t&&(i.preventDefault(),i.stopPropagation(),a(null),l(!1),n(e,t))}),[e,d,t,n]),className:i.cx("draggable-reorder",{"draggable-reorder--dragging":c,"draggable-reorder--dragged-over-from-right":o&&null!==t&&t-e>0,"draggable-reorder--dragged-over-from-left":o&&null!==t&&t-e<0})}})(t),{className:c}=r,d=l.__rest(r,["className"]);return s.React$1.createElement(o.TableHeadCell,Object.assign({className:i.cx(a,c)},n,d))};re.displayName="DraggableTableHeadCell";const ce=({children:e,column:t,index:i,role:a,setSort:n,sortDirection:l,canMove:r,onDecreaseSize:c,onIncreaseSize:d})=>{const h=s.React$1.useContext(j);let u;h.columnResizingEnabled&&(u=h.columnSizes[t.sortField]);const p=void 0===u?{}:{width:u,minWidth:u,maxWidth:u},m={key:i,role:a,scope:"col","aria-sort":ne(l),className:"files-view-column-header-table-cell",style:p,children:s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(le,{column:t,sortDirection:l,setSort:n,onDecreaseSize:c,onIncreaseSize:d}),e)};return r?s.React$1.createElement(re,Object.assign({index:i},m)):s.React$1.createElement(o.TableHeadCell,Object.assign({},m))};var de;ce.displayName="ColumnHeaderCell",ce.displayName="ColumnHeaderCell",function(e){e.TAGS_COLUMN_TOOLTIP_SEEN="tags_column_tooltip_seen"}(de||(de={}));class he extends i.GrowthUserActionTracker{constructor(){super(...arguments),this.project="manual_tagging"}}const ue=s.React$1.memo((({showTooltip:e,setShowTooltip:t,triggerRef:a})=>{const[n,o]=s.React$1.useState("bottom"),r=d.useIntl(),{columnSizes:c}=s.React$1.useContext(j),h=s.React$1.useRef(null),u=c[i.SortField.FILENAME];s.React$1.useEffect((()=>{var e;null===(e=null==h?void 0:h.current)||void 0===e||e.update()}),[u]),s.React$1.useEffect((()=>{(function(){var e;return l.__awaiter(this,void 0,void 0,(function*(){const t=i.Viewer.get_viewer(),s=null!==(e=t.work_user)&&void 0!==e?e:t.personal_user;if(!s)return!0;const a=new i.DefaultUserApiV2Client(s),n=new he(s.id);return(yield a.ns("growth").rpc("performed_user_action",{project:n.project,action:de.TAGS_COLUMN_TOOLTIP_SEEN},{})).has_performed}))})().then((e=>t(!e)))}),[t]);const p=()=>{t(!1),o("bottom")};return s.React$1.createElement(i.ClickOutside,{isActive:e,onClickOutside:p},s.React$1.createElement(i.Tooltip.Control,{variant:"rich",open:e,ref:h,triggerRef:a,auto:!0,placement:n,onChangePlacement:e=>o(e),onDisplayed:()=>{!function(){var e;l.__awaiter(this,void 0,void 0,(function*(){const t=i.Viewer.get_viewer(),s=null!==(e=t.work_user)&&void 0!==e?e:t.personal_user;if(s)return new he(s.id).track(de.TAGS_COLUMN_TOOLTIP_SEEN)}))}()}},s.React$1.createElement(i.Title,{size:"standard",inverse:!0},r.formatMessage({id:"+NJwpB",defaultMessage:"Show tags here"})),s.React$1.createElement(i.Text,{tagName:"p",color:"standard",inverse:!0},r.formatMessage({id:"7uh+Vn",defaultMessage:"To see all these files’ tags at a glance, just click the arrow and choose “tags” from the list."})),s.React$1.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",marginTop:"var(--spacing__unit--2)"}},s.React$1.createElement(i.Button$1,{variant:"outline",inverse:!0,onClick:p,autoFocus:!0},r.formatMessage({id:"5LJHki",defaultMessage:"Got it"})))))}));ue.displayName="TagsColumnTooltip";var pe;!function(e){e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.BOTH=3]="BOTH"}(pe||(pe={}));const me=({columns:e,index:t,onSelection:a,onMenuOpen:n,selectedColumns:o,title:l,allowUnchecking:r,availableMoves:c,isSearchMode:h})=>{const u=[pe.BOTH,pe.LEFT].includes(c),p=[pe.BOTH,pe.RIGHT].includes(c),m=u||p,[g,f]=s.React$1.useState(!1),S=i.useSelector(i.manualTaggingVariant$1),b=0===t&&!h&&i.isTagsColumnOnBrowseEnabled(S);return s.React$1.createElement(i.Menu.Wrapper,{onSelection:e=>a(t,e),onToggle:({isOpen:e})=>e&&n(t,o[t].popoverTriggerLabel)},(({getContentProps:t,getTriggerProps:a,triggerRef:n})=>s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(i.IconButton,Object.assign({},a(),{variant:"transparent",size:"small","aria-label":d.intl.formatMessage({id:"+D26UW",defaultMessage:"Change column"}),className:i.cx("files-view-column-header-menu-button",{"files-view-column-header-menu-open":t().open||g}),"data-testid":"files-view-column-header-menu-trigger"}),s.React$1.createElement(i.UIIcon,{src:i.ChevronDownLine,size:"small"})),s.React$1.createElement(i.Menu.Content,Object.assign({},t(),{placement:"bottom-end"}),s.React$1.createElement(i.Menu.Segment,{withLabel:l},e.map((e=>s.React$1.createElement(i.Menu.SelectItem,{"aria-label":e.popoverTriggerLabel,key:e.popoverTriggerLabel,value:{type:"ColumnSelection",payload:e},selected:o.includes(e),disabled:e.isLocked||!r&&o.includes(e)},e.label)))),m&&s.React$1.createElement(i.Menu.Segment,{withLabel:d.intl.formatMessage({id:"Yzabjr",defaultMessage:"Adjust"})},s.React$1.createElement(i.Menu.Submenu,{withTriggerContent:d.intl.formatMessage({id:"qKy/7I",defaultMessage:"Column order"})},s.React$1.createElement(i.Menu.Segment,null,s.React$1.createElement(i.Menu.ActionItem,{value:{type:"ColumnOrderSelection",payload:"left"},disabled:!u},d.intl.formatMessage({id:"obFNpg",defaultMessage:"Move left"})),s.React$1.createElement(i.Menu.ActionItem,{value:{type:"ColumnOrderSelection",payload:"right"},disabled:!p},d.intl.formatMessage({id:"7QBrxY",defaultMessage:"Move right"})))))),b&&s.React$1.createElement(ue,{showTooltip:g,setShowTooltip:f,triggerRef:n}))))};me.displayName="ColumnHeaderMenu";const ge=()=>s.React$1.createElement("span",{"aria-hidden":!0},"--");function fe(e){switch(i.isFile(e)?i.split_filename(e.fq_path).ext:e.ext.slice(1)){case i.PaperFileTypes.PAPER:case i.PaperFileTypes.PAPER_TEMPLATE:return!0;default:return!1}}const Se=s.React$1.lazy((()=>l.__awaiter(void 0,void 0,void 0,(function*(){return{default:(yield new Promise((function(t,i){e(["./c_rows_cells_folder_size"],t,i)}))).FolderSizeCell}})))),be=e=>{const{file:t}=e;return t.is_dir?s.React$1.createElement(s.React$1.Suspense,{fallback:s.React$1.createElement(ge,null)},s.React$1.createElement(Se,{file:t},s.React$1.createElement(ge,null))):t.is_cloud_doc&&fe(t)?s.React$1.createElement(ge,null):s.React$1.createElement("span",null,t.size)},Ee=e=>14*new i.Emstring(e).length,_e=({items:e,onResize:t,onResizeToDefault:a,onColumnResizeEnd:n,sortField:o})=>{const l=s.React$1.useRef({type:"not_resizing"}),[r,c]=s.React$1.useState();s.React$1.useRef(t).current=t;const d=s.React$1.useCallback((e=>{if("resizing"===l.current.type){const{startingPageX:i,startingWidth:s}=l.current,a=s-(i-e.pageX);a!==s&&t(a)}}),[]),h=s.React$1.useCallback((e=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",h),l.current={type:"not_resizing"},c(void 0),n()}),[]),u=e=>{e.preventDefault(),window.document.removeEventListener("click",u,!0)},p=()=>{let t=0;const s="--";null==e||e.forEach((e=>{if(e instanceof i.File)switch(o){case i.SortField.CATEGORY:t=Math.max(Ee(i.File.getCategoryDescription(e)),t);break;case i.SortField.EXTENSION:t=Math.max(Ee(i.File.getExtension(e)),t);break;case i.SortField.FILENAME:t=Math.max(Ee(i.getFilename(e)),t);break;case i.SortField.MODIFIED:case i.SortField.RELEVANCE:t=Math.max(Ee(e.is_dir?s:e.ago),t);break;case i.SortField.SIZE:t=Math.max(Ee(e.is_dir?s:e.size),t)}else if(e instanceof i.FileSharedWithMe)switch(o){case i.SortField.FILENAME:t=Math.max(Ee(i.getFilename(e)),t);break;case i.SortField.MODIFIED:case i.SortField.RELEVANCE:t=Math.max(Ee(e.agoFromLastActionByUserTs||e.ago),t);break;case i.SortField.SIZE:t=Math.max(Ee(e.is_cloud_doc&&fe(e)?s:e.size),t)}}));let a=30;return o===i.SortField.FILENAME&&(a=110),t>0?t+a:0};return s.React$1.createElement("div",{className:"resize-drag-handle",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),window.addEventListener("mousemove",d),window.addEventListener("mouseup",h);const t=window.innerHeight-e.currentTarget.getBoundingClientRect().top-4-16;l.current={type:"resizing",startingWidth:e.currentTarget.parentElement.getBoundingClientRect().width,startingPageX:e.pageX},c(t),window.document.addEventListener("click",u,!0)},onDoubleClick:()=>{if(o===i.SortField.SHARED_WITH)a();else{const e=p();e>0?t(e):a()}},"data-testid":"resize-handle"},void 0!==r&&s.React$1.createElement("div",{className:"resize-vertical-focus-line",style:{height:`${r}px`}}))};_e.displayName="ResizeHandle",_e.displayName="ResizeHandle";const Te=e=>{var{children:t,offsetHeight:i,style:a={}}=e,n=l.__rest(e,["children","offsetHeight","style"]);const r=void 0===i?a:Object.assign({flexBasis:i},a);return s.React$1.createElement("thead",Object.assign({className:"mc-table-head mc-table-head-fixed brws-column-header",style:r},n),s.React$1.createElement(h.VerticallyFixed,{tag:({style:e})=>s.React$1.createElement(o.TableRow,{className:"mc-table-head-row mc-table-head-row-fixed",style:Object.assign({height:i},e),role:"presentation"},t)}))};function we(e){const t=e.className,a={top:e.containerOffsetTop,position:"sticky"},n=i.cx("native-sticky",t);return s.React$1.createElement("div",{style:a,className:n},"function"==typeof e.children?e.children():e.children)}function Ce(e){const t=((e,t)=>s.React$1.Children.map(e,(e=>e&&e.type===we?s.React$1.cloneElement(e,t):e)))(e.children,{nativeSupport:!0,containerOffsetTop:e.offsetTop,hasParent:!0}),a={position:"relative"};return e.stickHeight&&(a.height=e.stickHeight),s.React$1.createElement("div",{className:i.cx("native-sticky-container",e.className),style:a,key:e.id},t)}const Re=e=>{var{children:t,columnFlex:i,offsetHeight:a,offsetTop:n}=e,c=l.__rest(e,["children","columnFlex","offsetHeight","offsetTop"]);const d=s.React$1.createElement(r.Dimensions,{tagName:"tr"},(({width:e})=>s.React$1.createElement("td",{className:"brws-sticky-table-cell"},s.React$1.createElement(Ce,{offsetTop:n},s.React$1.createElement(we,null,s.React$1.createElement(o.Table,{columnFlex:i,style:{width:e}},s.React$1.createElement(o.TableHead,Object.assign({},c),t)))))));return s.React$1.createElement("thead",{className:"brws-sticky-table-head"},d)};const Fe=(e,t)=>{switch(e){case i.ViewType.Grid:case i.ViewType.LargeGrid:return d.intl.formatMessage({id:"iWzO4p",defaultMessage:"Group by"});case i.ViewType.List:default:return t?d.intl.formatMessage({id:"t3Jo9w",defaultMessage:"Sort by"}):d.intl.formatMessage({id:"IUsgJf",defaultMessage:"Show"})}},ve=({columnFlex:e,items:t,isCompactMode:a,isSelectMode:n,currentSort:l,selectAllCheckboxState:r="unchecked",showSelectAllCheckbox:c=!0,stickyOffsetHeight:h,stickyOffsetTop:p,columns:m,visibleColumns:g,viewType:f,isSearchMode:S,presentationOnly:b,variant:E="fixed",onMenuOpen:_,onSelectAll:T,onDeselectAll:w,onReorder:C,onSort:R,onSelection:F,isMoreColumnsEnabled:v,disableResizing:I})=>{const{resizeColumn:N,resizeColumnToDefault:D,columnSizes:y,columnResizingEnabled:M}=s.React$1.useContext(j),L=M&&!I,[O,x]=s.React$1.useState(!1),[k,A]=s.React$1.useState(!1),$={onMouseEnter:()=>A(!0),onMouseLeave:()=>A(!1)},P=S?i.SEARCH_LIST_VIEW_TOP_RIGHT_SORT_COLUMNS:m,H=P.filter((e=>!e.isLocked)),W=!n&&!k&&!a,V=(e,t)=>{if("ColumnSelection"===t.type&&function(e){return"string"==typeof(null==e?void 0:e.popoverTriggerLabel)}(t.payload)){const s=g[e],a=t.payload;F(a,s,e),S?R(a.sortField,i.SortDirection.DESCENDING):v?g.includes(a)&&(null==l?void 0:l.sortField)===a.sortField&&R(g[0].sortField,i.SortDirection.ASCENDING):(null==l?void 0:l.sortField)===s.sortField&&(a.isSortOrderOptionDisabled?R(g[0].sortField,i.SortDirection.ASCENDING):R(a.sortField,l.sortDirection||i.SortDirection.ASCENDING))}else"ColumnOrderSelection"===t.type&&("right"===t.payload&&e<g.length-1?C(e+1,e):"left"===t.payload&&e>1&&C(e-1,e))},B=g.map(((e,i)=>{const a=(e=>{if(!v)return pe.NONE;const t=g[e];if(!t||t.isLocked)return pe.NONE;const i=0!==e&&!g[e-1].isLocked,s=e!==g.length-1&&!g[e+1].isLocked;return i&&s?pe.BOTH:i?pe.LEFT:s?pe.RIGHT:pe.NONE})(i),n=S,o=v||!(e.isLocked||e.isSortDisabled);return s.React$1.createElement(ce,{key:e.popoverTriggerLabel,column:e,index:i,setSort:R,role:b?"presentation":"columnheader",sortDirection:n||(null==l?void 0:l.sortField)!==e.sortField?void 0:l.sortDirection,canMove:a!==pe.NONE,onIncreaseSize:()=>N(e.sortField,y[e.sortField]+4),onDecreaseSize:()=>N(e.sortField,y[e.sortField]-4)},!n&&o&&s.React$1.createElement(me,{columns:v?P:H,index:i,onMenuOpen:_,onSelection:V,selectedColumns:g,title:Fe(f,!!S),allowUnchecking:v,availableMoves:a,isSearchMode:S}),L&&void 0!==N&&void 0!==D&&void 0!==l&&s.React$1.createElement(_e,{onResize:t=>{x(!0),N(e.sortField,t)},onResizeToDefault:()=>D(e.sortField),onColumnResizeEnd:()=>x(!1),sortField:e.sortField,items:t}))})),z=s.React$1.createElement(ae,{onReorder:C},s.React$1.createElement(o.TableHeadCell,{className:"files-view-column-header-table-cell brws-checkbox-cell",key:"checkbox-cell",role:b?"presentation":"columnheader",scope:"col"},s.React$1.createElement("div",{className:"brws-vertically-center"},c&&!W?s.React$1.createElement(i.Checkbox,{className:i.cx("brws-checkbox",{"brws-checkbox-checked":"checked"===r}),checked:"checked"===r,isIndeterminate:"mixed"===r,onChange:e=>{"unchecked"===r?T():w()},"aria-label":d.intl.formatMessage({id:"YzMs/g",defaultMessage:"Select all"}),"data-testid":"brws-select-all-checkbox"}):null)),B),U={"data-campaigns-element-id":u.CampaignsElementIdEnum.BROWSE_VIEW_LIST_HEAD};return"default"===E?s.React$1.createElement(o.TableHead,Object.assign({className:i.cx("brws-column-header",{"header-column-resize":L,"column-header-is-resizing":O})},$,{"data-testid":"table-head"},U),z):"fixed"===E?s.React$1.createElement(Te,Object.assign({offsetHeight:h},$,{"data-testid":"fixed-table-head"},U),z):"sticky-native"===E?s.React$1.createElement(o.TableHead,Object.assign({className:i.cx("brws-column-header brws-column-header--sticky",{"header-column-resize":L,"column-header-is-resizing":O}),style:{top:p}},$,{"data-testid":"sticky-native-table-head"},U),z):s.React$1.createElement(Re,Object.assign({columnFlex:e,offsetHeight:h,offsetTop:p,className:i.cx("brws-column-header",{"header-column-resize":L,"column-header-is-resizing":O})},$,{"data-testid":"sticky-table-head"},U),z)};ve.displayName="ColumnHeader",ve.displayName="ColumnHeader";const Ie=new i.ScopedEventHandlers(document);function Ne(e,t,i,s,a,n,o){Ie.add(e,"dragenter",(e=>{(t()||i())&&!e.target.closest(a)&&n()&&(o(null),s())}))}function De(e){Ie.remove(e,"dragenter")}const ye="EmptyFolderTable",Me=({subtitle:e,subtitleLink:t,subtitleOnClick:n,numRowsAbove:o=2,totalRows:l=14,title:r,onTTI:c,onFocusSearchBar:d=a.noop,onNavigateToParentFolder:h=a.noop,onOpenKeyboardShortcutModal:u=a.noop,onPasteFromClipboard:S=a.noop})=>{const b=s.React$1.useRef(null);s.React$1.useEffect((()=>(null==c||c(),g.setupFilesViewKeyboardShortcuts({viewType:i.ViewType.List,getIsGlobalEvent:g.generateGetIsGlobalEventForRef(b),getIsItemEvent:()=>!1,getSelectedFiles:()=>i.immutableExports.OrderedMap(),isCurrentPathWriteable:()=>!1,selectAllAction:a.noop,deselectAllAction:a.noop,onCopyToClipboard:a.noop,onCutToClipboard:a.noop,onDelete:a.noop,onFocusSearchBar:d,onNavigateToFileOrFolder:a.noop,onNavigateToParentFolder:h,onPasteFromClipboard:S,onShowRename:a.noop,scope:ye,onShowHelpMenu:()=>u()}),()=>{g.resetFilesViewKeyboardShortcuts(ye)})),[]);const E=[];for(let e=0;e<o;e++)E.push(s.React$1.createElement(p.Table.Row,{key:-e-1},s.React$1.createElement(p.Table.Cell,null)));const _=[],T=Math.max(l-o-1,0);for(let e=0;e<T;e++)_.push(s.React$1.createElement(p.Table.Row,{key:e+1},s.React$1.createElement(p.Table.Cell,null)));const w=s.React$1.createElement("h3",{className:"u-font-strong empty-folder-table-title"},r);return"V1"===f.DEFAULT_DRAG_AND_DROP||"V2"===f.DEFAULT_DRAG_AND_DROP?null:s.React$1.createElement("div",{className:"empty-folder-container"},s.React$1.createElement(p.Table,{"aria-atomic":"true","aria-live":"polite"},s.React$1.createElement(p.Table.Header,null),s.React$1.createElement(p.Table.Body,null,E,s.React$1.createElement(p.Table.Row,{key:0},s.React$1.createElement(p.Table.Cell,null,s.React$1.createElement(m.LabelGroup,{withText:w,withSubtext:e&&t?s.React$1.createElement("a",{className:"empty-folder-table-subtitle empty-folder-table-link",href:t,onClick:n},e):e?s.React$1.createElement("span",{className:"empty-folder-table-subtitle"},e):void 0}))),_)))};Me.displayName="EmptyFolderTable";const Le=e=>{var{scrollContainer:t}=e,a=l.__rest(e,["scrollContainer"]);const n=s.React$1.useMemo((()=>(null==t?void 0:t.current)?i.createFakeWindow(t.current):null),[null==t?void 0:t.current]);return t?t.current&&n?s.React$1.createElement(Oe,Object.assign({},a,{shouldUseWindowAsScrollContainer:!0,window:n})):null:s.React$1.createElement(Oe,Object.assign({},a))};Le.displayName="CulledTableBodyWithScrollContainer",Le.displayName="CulledTableBodyWithScrollContainer";class Oe extends s.React$1.PureComponent{constructor(e){super(e),this.updateOffsetCache()}componentDidMount(){this.updateScroll(!0)}componentDidUpdate(e){e.listItemHeight!==this.props.listItemHeight&&this.updateOffsetCache(),e.scrollToRow!==this.props.scrollToRow&&this.updateScroll(void 0===e.scrollToRow||e.scrollToRow<0)}updateOffsetCache({listItemHeight:e}=this.props){this.offsetCache=Array.isArray(e)?ke(e):void 0}updateScroll(e){const{scrollToRow:t,listItemHeight:i,viewportTopOffset:s=0,scrollPositionOffset:a=0,window:n}=this.props;if(void 0!==t&&t>=0){const o=(Array.isArray(i)?this.offsetCache[t]:(t+1)*i)+a,l=Array.isArray(i)?i[t]:i;xe([o-l,o],s,n,e)}}render(){const e=this.props,{viewportTopOffset:t,scrollToRow:i}=e,a=l.__rest(e,["viewportTopOffset","scrollToRow"]);return s.React$1.createElement(o.CulledTableBody,Object.assign({viewportHeight:window.innerHeight-t},a))}}Oe.defaultProps={viewportTopOffset:0},Oe.displayName="CulledTableBodyWithScrollToRow";const xe=([e,t],i=0,s=window,a)=>{const n=s.innerHeight-i,o=((e=window)=>"scrollingElement"in e.document&&e.document.scrollingElement?e.document.scrollingElement.scrollTop:e.document.documentElement.scrollTop)(s),l=o+n;e<o?s.scrollTo(0,e):t>l&&(a&&t-e<n/2?s.scrollTo(0,t-n/2):s.scrollTo(0,t-n))},ke=e=>e.reduce(((e,t)=>(e.push(t+(e[e.length-1]||0)),e)),[]);function Ae({file:e,dropTargetHighlightMode:t}){if(t===i.DropTargetHighlightMode.NONE)return!1;if(!e.is_dir)return!1;if(i.File.isReadOnlySharedFolder(e))return!1;if(e.isDeleted)return!1;switch(t){case i.DropTargetHighlightMode.ALL_FOLDERS:return!0;case i.DropTargetHighlightMode.NONSHARED_FOLDERS:return e.type!==i.FileTypes.SHARED_FOLDER;case i.DropTargetHighlightMode.NONSHARED_NONTEAM_FOLDERS:return![i.FileTypes.SHARED_FOLDER,i.FileTypes.TEAM_SHARED_FOLDER].includes(e.type)}return!1}function $e({context:e,file:t,user:s,expVaultEnableViewOnlySharing:a=!1}){const n=t.per_node_metadata,o=!!((null==n?void 0:n.link_node)||(null==n?void 0:n.suppress_ns_partition)||(null==n?void 0:n.suppress_shared_link));return t.isDeleted||i.File.isTeamMemberFolder(t)||!i.File.canViewFileMembers(t,e)||e.isInsideVaultFolder&&!a||t.type===i.FileTypes.VAULT_FOLDER||t.type===i.FileTypes.SANDBOX||o}const Pe=(e,t)=>{const s=i.selectMainItems(e,t),a=!!i.selectDisabledMultiselect(e,t),n=i.selectViewType(e,t)===i.ViewType.CondensedList,o=i.selectIsActionBarEnabled(e,t);return Ve(Object.assign(Object.assign({},t),{isCheckboxDisabled:a,isCondensedListView:n,items:s,isActionBarEnabled:o}))},He=i.createSelector(Pe,(e=>e.map((({height:e})=>e)))),We=(e,t)=>i.selectViewType(e,t)===i.ViewType.CondensedList?20:void 0,Ve=i.createSelectorCreator(i.defaultMemoize,((e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every((i=>t.hasOwnProperty(i)&&e[i]===t[i]))))((({activeDropTarget:e,canDisplayFolderSizes:t,context:i,createNewFolderState:s,dropTargetHighlightMode:a,fileRename:n,focusedFileIndex:o,isCheckboxDisabled:l,isCompactMode:r,isSearchMode:c,isSelectMode:d,items:h,selection:u,sharingServiceInfo:p,user:m,visibleColumns:g,responsive:f,containerWidth:S,highDensity:b,isCondensedListView:E,fileToId:_,renderSharedWithController:T,expVaultEnableViewOnlySharing:w,isActionBarEnabled:C,expManualTagging:R,defaultListviewIconSize:F,isBoldFileNamesEnabled:v})=>({activeDropTarget:e,canDisplayFolderSizes:t,context:i,createNewFolderState:s,dropTargetHighlightMode:a,fileRename:n,focusedFileIndex:o,isCheckboxDisabled:l,isCompactMode:r,isSearchMode:c,isSelectMode:d,items:h,selection:u,sharingServiceInfo:p,user:m,visibleColumns:g,responsive:f,containerWidth:S,highDensity:b,isCondensedListView:E,fileToId:_,renderSharedWithController:T,expVaultEnableViewOnlySharing:w,isActionBarEnabled:C,expManualTagging:R,defaultListviewIconSize:F,isBoldFileNamesEnabled:v})),(e=>{const{activeDropTarget:t,context:s,createNewFolderState:a,dropTargetHighlightMode:n,items:o,fileRename:r,focusedFileIndex:c,selection:d,user:h,visibleColumns:u,responsive:p,containerWidth:m,highDensity:g,fileToId:f,isCondensedListView:S,isActionBarEnabled:b,defaultListviewIconSize:E,isSearchMode:_,isBoldFileNamesEnabled:T}=e,w=l.__rest(e,["activeDropTarget","context","createNewFolderState","dropTargetHighlightMode","items","fileRename","focusedFileIndex","selection","user","visibleColumns","responsive","containerWidth","highDensity","fileToId","isCondensedListView","isActionBarEnabled","defaultListviewIconSize","isSearchMode","isBoldFileNamesEnabled"]),C=!!e.expVaultEnableViewOnlySharing,R=i.isTaggingEnabled(e.expManualTagging);let F=i.DEFAULT_ROW_HEIGHT;S?F=i.DEFAULT_ROW_HEIGHT_CONDENSED_LIST:g&&(F=i.DEFAULT_ROW_HEIGHT_DENSE);const v=S?32:E,I=o.toArray().map(((e,a)=>{if(e instanceof i.UserDefinedItem)return{type:"UserDefinedItemRow",props:{userDefinedItem:e},height:F};const o=m?m*i.FILE_NAME_CELL_SEARCH_FLEX_BASIS[u.length]/100:void 0,l=ze({file:e,responsive:p}),E=Ke({snippets:e.snippets,fileNameCellWidth:o}),I=Ue({file:e,showSnippets:l,snippetRows:E,highDensity:g,isCondensedListView:S,showTags:R,fileNameCellWidth:o});if(e instanceof i.Paper)return{type:"PaperRow",props:{isSearchMode:_,paper:e,visibleColumns:u,showSnippets:l,snippetRows:E,height:I,showStar:!i.isMobileMode(p),isBoldFileNamesEnabled:T},height:I};const N="fq_path"in e?f(e):e.file_id,D=d.selected.has(N);if(e instanceof i.FileSharedWithMe)return{type:"FileSharedWithMeRow",props:{file:e,visibleColumns:u,showSnippets:l,snippetRows:E,height:I,isSelected:D,isSelectMode:w.isSelectMode,isFocused:a===c,iconSize:v},height:I};const y=Ae({file:e,dropTargetHighlightMode:n});return{type:"FileRow",key:`file:${encodeURIComponent(e.file_id)}:${encodeURIComponent(e.fq_path)}`,itemIndex:a,props:Object.assign(Object.assign({},w),{file:e,iconSize:v,isActionBarEnabled:b,isActiveDropTarget:y&&t===e,isAvailableDropTarget:y,isFocused:a===c,isSelected:D,isExtensionsMenuDisabled:!0,isSharingDisabled:$e({context:s,file:e,user:h,expVaultEnableViewOnlySharing:C}),renameState:r&&r.file.fq_path===e.fq_path?r.state:void 0,visibleColumns:u,height:I,containerWidth:m,isCondensedListView:S,responsive:p,isSearchMode:_}),height:I}}));return a&&"CREATE_FOLDER_INACTIVE"!==a&&I.unshift({type:"NewFolderRow",props:{createNewFolderState:a,isInsideMyTeamFolderTree:s.isInsideTeamFolderTree,iconSize:v},height:F}),I})),Be=e=>e.find((({highlight_spans:e})=>!!e&&e.length>0)),ze=({file:{snippets:e},responsive:t})=>!!e&&!!Be(e)&&(t.isMatchedLarge||t.isMatchedMedium),Ue=({file:e,showSnippets:t,snippetRows:s,highDensity:a,isCondensedListView:n,showTags:o,fileNameCellWidth:l})=>{const r=o&&i.isFile(e)&&e.tags&&e.tags.length>0?i.TAGS_HEIGHT:0,c=Ge({file:e,fileNameCellWidth:l});if(e.snippets&&t){if(!s)return i.DEFAULT_ROW_HEIGHT_WITH_SNIPPETS+r+c;return i.ROW_VERTICAL_PADDING+i.ROW_TITLE_HEIGHT+i.ROW_SUBTITLE_HEIGHT+i.ROW_SNIPPET_VERTICAL_MARGIN+i.SNIPPET_HEIGHT_PER_ROW*s+r+c}return n?i.DEFAULT_ROW_HEIGHT_CONDENSED_LIST:a?i.DEFAULT_ROW_HEIGHT_DENSE+r+c:i.DEFAULT_ROW_HEIGHT+r+c},Ge=({file:e,fileNameCellWidth:t})=>{var s,a,n,o;const l=i.isFile(e)&&!!(null===(a=null===(s=e.media_data)||void 0===s?void 0:s.data)||void 0===a?void 0:a.date_taken);if(i.isFile(e)){const s=(null!==(o=null===(n=e.media_data)||void 0===n?void 0:n.display_info)&&void 0!==o?o:[]).map((e=>Ke({snippets:[{highlight_spans:e.highlights}],fileNameCellWidth:t}))).reduce(((e,t)=>e+t),0),a=l?s+1:s;return Math.min(a,3)*i.MEDIA_INFO_ITEM_HEIGHT}return 0},Ke=({snippets:e,fileNameCellWidth:t})=>{if(!e)return 0;const s=Be(e);if(!s||!s.highlight_spans)return 0;if(!t)return 3;const a=s.highlight_spans.map((e=>e.highlight_str)).join().length,n=Math.max(t-i.MEDIA_CELL_ICON_WIDTH-i.SNIPPET_HORIZONTAL_PADDING,1),o=6*a;return Math.min(Math.ceil(o/n),3)},qe=(e,t)=>{const a=i.selectMainItems(e,t),n=a&&a.get(t.itemIndex);return s.assert(!!n,`Item undefined at index: ${t.itemIndex}`),n},je=(e,t)=>{const a=qe(e,t);return s.assert(a instanceof i.File||a instanceof i.FileSharedWithMe,`item must be File or FileSharedWithMe at index: ${t.itemIndex}`),a},Ye=(e,t)=>{const s=je(e,t);return s instanceof i.File?t.fileToId(s):s.file_id},Xe=(e,t)=>i.selectSelection(e,t).selected.has(Ye(e,t)),Je=(e,t)=>t.isHovered||i.selectHasItemsSelected(e,t)||i.selectIsCompactMode(e,t),Ze=(e,t)=>{const{rowIndex:s}=t;return 0===s||i.selectUser(e,t).is_cdm_member&&(2===t.rowIndex||1===t.rowIndex)},Qe=(e,t)=>Ze(e,t)?"FileNameLabel-"+t.rowIndex:void 0,et=(e,t)=>{const s=i.selectFileRename(e,t),a=qe(e,t);if(s&&a instanceof i.File)return s.file.fq_path===a.fq_path?s.state:void 0},tt=(e,t)=>!et(e,t)&&i.selectViewType(e,t)!==i.ViewType.CondensedList,it=(e,t)=>!(((e,t)=>{const s=qe(e,t);return s instanceof i.File&&i.File.isNoAccessSharedFolder(s)})(e,t)||i.selectContext(e,t).isInsideVaultFolder||i.selectIsMobileMode(e,t)||((e,t)=>{const s=qe(e,t);return s instanceof i.File&&void 0!==s.legacyPaperName})(e,t)),st=(e,t)=>{const s=qe(e,t);return s instanceof i.File&&i.File.isTeamMemberFolder(s)},at=(e,t)=>{const s=((e,t)=>{const s=qe(e,t);if(s instanceof i.Paper||s instanceof i.File||s instanceof i.FileSharedWithMe)return s.snippets})(e,t);return s&&s.find((({highlight_spans:e})=>!!e&&e.length>0))},nt=(e,t)=>Boolean(!i.selectIsMobileMode(e,t)&&at(e,t)),ot=(e,t)=>{const s=nt(e,t),a=i.selectHighDensity(e,t),n=i.selectViewType(e,t),o=((e,t)=>{const s=qe(e,t),a=i.selectExpManualTagging(e,t);return i.isTaggingEnabled(a)&&s instanceof i.File&&s.tags&&s.tags.length>0})(e,t);if(s){const s=lt(e,t);if(!s)return o?i.DEFAULT_ROW_HEIGHT_WITH_SNIPPETS+i.TAGS_HEIGHT:i.DEFAULT_ROW_HEIGHT_WITH_SNIPPETS;const a=i.ROW_VERTICAL_PADDING+i.ROW_TITLE_HEIGHT+i.ROW_SUBTITLE_HEIGHT+i.ROW_SNIPPET_VERTICAL_MARGIN+i.SNIPPET_HEIGHT_PER_ROW*s;return o?a+i.TAGS_HEIGHT:a}return n===i.ViewType.CondensedList?i.DEFAULT_ROW_HEIGHT_CONDENSED_LIST:a?o?i.DEFAULT_ROW_HEIGHT_DENSE+i.TAGS_HEIGHT:i.DEFAULT_ROW_HEIGHT_DENSE:o?i.DEFAULT_ROW_HEIGHT+i.TAGS_HEIGHT:i.DEFAULT_ROW_HEIGHT},lt=(e,t)=>{const s=at(e,t);if(!s||!s.highlight_spans)return 0;const{containerWidth:a,numVisibleColumns:n}=t,o=a?a*i.FILE_NAME_CELL_SEARCH_FLEX_BASIS[n]/100:void 0;if(!o)return 3;const l=s.highlight_spans.map((e=>e.highlight_str)).join().length,r=Math.max(o-i.MEDIA_CELL_ICON_WIDTH-i.SNIPPET_HORIZONTAL_PADDING,1),c=6*l;return Math.min(Math.ceil(c/r),3)},rt=(e,t)=>Boolean(i.selectEligibleForFirstTaskSubtitle(e,t)&&ct(e,t)),ct=(e,t)=>{const s=i.selectContext(e,t),a=qe(e,t),n=i.selectUser(e,t);return a instanceof i.File&&(s.isInsideMyTeamFolderTree&&s.isCurrentlyInRoot&&a.fq_path===n.cdm_tmf_path)},dt=(e,t,s)=>i.selectViewType(e,t)===i.ViewType.CondensedList?32:s,ht=(e,t)=>{const s=i.selectCutItems(e,t),a=qe(e,t);return i.isCutToClipboard(a,s)},ut=s.reactExports.createContext(void 0),pt=({props:{onDelete:e,onShowRename:t,onNewFolderSubmit:i,onNewFolderCancel:a,onRenameSubmit:n,onRenameCancel:o,onSetClipboard:l,onPasteFromClipboard:r,onSwitchViewType:c,onColumnsChanged:d,onCanDisplayFolderSizesChanged:h,onAddFileJumpKeyCode:u,onResetFileJump:p,onShowShare:m,onLocationLinkClick:g,onNavigateToFileOrFolder:f,onNavigateToParentFolder:S,onOpenFileSharedWithMe:b,onOpenPaper:E,onSelectionChange:_,onSortChange:T,onStarClick:w,onComponentTTI:C,onFocusSearchBar:R},children:F})=>{const v=s.reactExports.useMemo((()=>({onDelete:e,onShowRename:t,onNewFolderSubmit:i,onNewFolderCancel:a,onRenameSubmit:n,onRenameCancel:o,onSetClipboard:l,onPasteFromClipboard:r,onSwitchViewType:c,onColumnsChanged:d,onCanDisplayFolderSizesChanged:h,onAddFileJumpKeyCode:u,onResetFileJump:p,onShowShare:m,onLocationLinkClick:g,onNavigateToFileOrFolder:f,onNavigateToParentFolder:S,onOpenFileSharedWithMe:b,onOpenPaper:E,onSelectionChange:_,onSortChange:T,onStarClick:w,onComponentTTI:C,onFocusSearchBar:R})),[e,t,i,a,n,o,l,r,c,d,h,u,p,m,g,f,S,b,E,_,T,w,C,R]);return s.reactExports.createElement(ut.Provider,{value:v},F)};pt.displayName="FilesViewCallbackContextProvider";let mt=w.TTVC_SYNTHETIC_RENDER;const gt=new URL(window.location.href).searchParams;function ft(){return!mt||"OFF"===mt}gt.has("ttvctest")&&(mt=gt.get("ttvctest")||w.TTVC_SYNTHETIC_RENDER);const St=({item:e,user:t,className:a,isReadOnly:n,tabIndex:o,starButtonClassName:l,alwaysShowUnstarred:r})=>{const{id:c,type:d}=i.idTypePairFromStarrableItem(e),h=i.itemNameFromStarrableItem(e),{onStarClick:u}=s.React$1.useContext(ut)||{};return ft()||!(null==mt?void 0:mt.includes("F"))?s.React$1.createElement("div",{className:a},s.React$1.createElement(T.Star,{id:c,key:"star",idType:d,isDir:Boolean(e.is_dir),user:t,onStarClick:t=>{e instanceof i.File&&(null==u||u(e,t))},source:_.StarredSource.BROWSE,isReadOnly:n,tabIndex:o,starButtonClassName:l,alwaysShowUnstarred:r,itemName:h})):null};class bt extends s.React$1.PureComponent{render(){const{snippets:e,lineClamp:t,isMakeSnippetsOneLineEnabled:a}=this.props,n={maxHeight:i.SNIPPET_HEIGHT_PER_ROW*t,WebkitLineClamp:t},o=Be(e);if(!o)return null;let l;return a&&o.highlight_spans&&(l=o.highlight_spans.filter((e=>"\n"!==e.highlight_str)).reduce(((e,t)=>e+t.highlight_str),"")),s.React$1.createElement("span",{className:i.cx("brws-file-snippets",{"brws-file-snippets-one-line":a}),style:n,title:l},s.React$1.createElement(Et,{snippet:o}))}}bt.defaultProps={lineClamp:3},bt.displayName="FileSnippets";const Et=({snippet:e})=>R.highlightReactFromAllHighlightSpans(e.highlight_spans||[]);Et.displayName="FileSnippet";const _t=()=>{};class Tt extends s.React$1.PureComponent{constructor(){super(...arguments),this.inputRef=s.React$1.createRef(),this.contentTileInputStyle={width:"100%"},this.handleDragStart=e=>{e.stopPropagation()},this.handleSubmit=e=>{e.preventDefault(),this.submitIfChanged(i.NameInputActionSource.SUBMIT)},this.handleKeyDown=e=>{e.key===i.Key_enum.Key.Escape?(e.preventDefault(),this.props.onCancel({source:i.NameInputActionSource.ESC})):e.key===i.Key_enum.Key.Enter&&this.handleSubmit(e)},this.handleBlur=e=>{this.submitIfChanged(i.NameInputActionSource.BLUR)},this.handleClick=e=>{e.preventDefault(),this.props.onClick(e)}}componentDidMount(){this.inputRef.current&&this.inputRef.current.focus(),window.requestAnimationFrame((()=>{if(!this.inputRef.current)return;const e=this.inputRef.current.value;let t=this.props.ignoreFileExtension?e.length:e.lastIndexOf(".");t<0&&(t=e.length),this.inputRef.current.setSelectionRange(0,t)}))}submitIfChanged(e){if(this.inputRef.current){const t=this.inputRef.current.value.trim();t===this.props.defaultValue?this.props.onCancel({source:e}):this.props.onSubmit(t)}}render(){return s.React$1.createElement("form",{style:"ON"!==f.CONTENT_TILES||this.props.isSearchMode&&"ON"!==f.CONTENT_TILES_SEARCH?void 0:this.contentTileInputStyle,className:"u-pad-right-xs",onSubmit:this.handleSubmit},s.React$1.createElement(i.TextInput,{ref:this.inputRef,defaultValue:this.props.defaultValue,className:this.props.className,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onDragStart:this.handleDragStart,"aria-label":this.props.label,onClick:this.handleClick}))}}Tt.defaultProps={className:"",onCancel:_t,onClick:_t,onSubmit:_t,idDir:null},Tt.displayName="NameInput";const wt="…";function Ct(e,t,s,a){if(a&&a>32){const n=(a-32)/t,o=Math.max(s,n-s);return i.Emstring.em_snippet(e,Math.floor(o),.5)}return e}function Rt(e,t){const a=i.getFilename(t),n=function(e,t){let i=0;for(;i<e.length&&e.charAt(i)===t.charAt(i);)++i;return i===e.length||e.charAt(i)!==wt?[e]:[e.substring(0,i),e.substring(i+1)]}(e,a);if(1===n.length)return i.isFile(t)&&!t.highlight_spans?R.highlightMatchReact(e,t.filename_highlights):R.highlightReactFromHighlightSpans(e,t.highlight_spans);let o,l;return i.isFile(t)&&!t.highlight_spans?(o=R.highlightMatchReact(a,t.filename_highlights,0,n[0].length),l=R.highlightMatchReact(a,t.filename_highlights,a.lastIndexOf(n[1]))):(o=R.highlightReactFromHighlightSpans(a,t.highlight_spans,0,n[0].length),l=R.highlightReactFromHighlightSpans(a,t.highlight_spans,a.lastIndexOf(n[1]))),s.React$1.createElement("span",null,o,wt,l)}function Ft(e,t){if(i.isFile(t)||(e=>e instanceof i.FileSharedWithMe)(t)){if(t.highlight_spans)return t.highlight_spans.map((e=>({string:e.highlight_str,isHighlighted:e.is_highlighted})));if(i.isFile(t)&&t.filename_highlights){return R.highlightMatchSections(e,t.filename_highlights).map((e=>({string:e.text,isHighlighted:e.isHighlighted})))}}}const vt=({file:e,renderAsLink:t=!0,user:a,containerWidth:n,onClick:o,focusable:l,isInsideBackupFolder:r,backupInfo:c,isFilteredView:h})=>{const u={notAddedYetString:e=>d.intl.formatMessage({id:"hY0d5Z",defaultMessage:"not added yet, in {location}"},{location:e}),sharedWithYouString:d.intl.formatMessage({id:"FWJkxz",defaultMessage:"Shared with you"}),formattedLocationText:e=>d.intl.formatMessage({id:"yR1l4z",defaultMessage:"in {location}"},{location:e})};if(!i.isFile(e))return s.React$1.createElement(s.React$1.Fragment,null,u.sharedWithYouString);const p=i.parent_dir(e.fq_path);let m="/"===p?F.get_browse_root_name(a):p.slice(1);if(e.is_in_backup_folder){const e=(null==c?void 0:c.displayName)?p.replace(c.name,c.displayName):p;m="/"===p?F.get_browse_root_name(a):e.slice(1)}else h&&(m=i.File.getParentDirName(e));if(e.is_unmounted)return h?null:s.React$1.createElement(s.React$1.Fragment,null,u.notAddedYetString(m));if(h&&"/"===p)return null;const g=Ct(u.formattedLocationText(m),12,6,n);if(!t||e.isDeleted)return s.React$1.createElement(s.React$1.Fragment,null,g);const f=i.browse_uri_for_fq_path(a,p,void 0,{isBackup:r});return s.React$1.createElement("a",{className:"brws-file-name-cell-location",href:f.toString(),onClick:o,tabIndex:l?0:-1},h?s.React$1.createElement(i.Text,{color:"faint",size:"small"},g):g)};vt.displayName="FileSubtitle",vt.displayName="FileSubtitle";const It=e=>e instanceof i.FileSharedWithMe,Nt=({file:e,user:t,hrefForFile:a,showHighlights:n,showUserEducationEffects:o,userEducationEffectName:l,isSelected:r,containerWidth:c,onNameClick:d,isTooltipEnabled:h,backupInfo:u,isFilteredView:p})=>{var m;const g=e.file_id&&(null==u?void 0:u.id)===e.file_id,f=e instanceof i.File&&e.is_dir?g?null!==(m=u.displayName)&&void 0!==m?m:u.name:i.getDisplayedFilename(i.getFilename(e)):i.getFilename(e),S=s.React$1.useRef(null),b=s.React$1.useMemo((()=>((e,t,s)=>{if(!t||It(e)||!s.current)return!1;const a=s.current,n=i.filename(e.fq_path),o=a.offsetWidth<a.scrollWidth,l=a.textContent!==n;return o||l})(e,h,S)),[e,h]),E=s.React$1.useContext(D.FilesViewOverrideContext);let _,T;if(c)_=s.React$1.createElement(N.HighlightedTruncatedString,{text:f,className:"brws-file-name-element",fontSize:14,availableWidth:c,highlightSpans:Ft(f,e),cellBuffer:3,isBold:E.isBoldFileNamesEnabled});else{const t=Ct(f,14,3,c);_=n&&(e.highlight_spans||i.isFile(e)&&e.filename_highlights)?Rt(t,e):s.React$1.createElement("span",null,t),_=s.React$1.createElement("div",{className:"brws-file-name-element",ref:S},_)}if(b){const e=f.length<=i.FILE_NAME_TOOLTIP_MAX_LINE_LENGTH?f:s.React$1.createElement("div",{className:"brws-file-name-cell-tooltip"},f);_=s.React$1.createElement(v.TitleBubble,{content:e,position:I.StickyPosition.BOTTOM,className:"list-label__title-bubble"},_)}return It(e)?T=e.href:e.is_unmounted||e.isDeleted?p&&e.is_unmounted&&(T=e.href):T=null==a?void 0:a(t,e),void 0!==T&&(_=s.React$1.createElement("a",{className:"brws-file-name-cell-filename",href:T,onClick:d,onAuxClick:d,tabIndex:r?0:-1},_)),o&&(_=s.React$1.createElement(i.UserEducationEffect,{containerName:"FileNameLabel",name:l||"FileNameLabel",useSpan:!0},_)),_};Nt.displayName="FileNameTitle",Nt.displayName="FileNameTitle";const Dt=({file:e,isSelected:t})=>{const a=[];return i.isFile(e)&&e.isDeleted&&a.push(d.intl.formatMessage({id:"RBvabN",defaultMessage:"Deleted"})),t&&a.push(d.intl.formatMessage({id:"mpdvwi",defaultMessage:"Selected"})),i.isFile(e)&&e.is_dir&&(e.type===i.FileTypes.SHARED_FOLDER?i.File.isReadOnlySharedFolder(e)?a.push(d.intl.formatMessage({id:"513aYe",defaultMessage:"Read-only shared folder"})):a.push(d.intl.formatMessage({id:"r6q13e",defaultMessage:"Shared folder"})):e.type===i.FileTypes.TEAM_SHARED_FOLDER?i.File.isReadOnlySharedFolder(e)?a.push(d.intl.formatMessage({id:"dNfvWF",defaultMessage:"Read-only team shared folder"})):a.push(d.intl.formatMessage({id:"8zuxGM",defaultMessage:"Team shared folder"})):a.push(d.intl.formatMessage({id:"MLqiSW",defaultMessage:"Folder"}))),a.length>0?s.React$1.createElement("span",{className:"ax-visually-hidden"},`${a.join(" ")}`):null};Dt.displayName="FileNameAudioDescription";const yt=i.Loadable({loader:()=>l.__awaiter(void 0,void 0,void 0,(function*(){yield i.waitForTTI();const{MediaSearchSnippet:t}=yield new Promise((function(t,i){e(["./c_media_filters_media_search_snippet"],t,i)}));return t}))}),Mt=e=>s.React$1.createElement(yt,Object.assign({},e));Mt.displayName="AsyncMediaSearchSnippet";const Lt=e=>{null==e||e.stopPropagation()},Ot=({file:t,renameState:a,showLocation:n,showSnippets:r,shouldShowSubtitle:c,snippetRows:d,user:h,onNameClick:u,isSelected:p,showUserEducationEffects:m,showHighlights:g,hrefForFile:f,userEducationEffectName:S,isTooltipEnabled:b,showFirstTaskSubtitle:E,renderFilenameSubtitleAsLink:_,onRenameCancel:T,onRenameSubmit:w,isHovered:C,onLocationLinkClick:R,width:F,shouldShowTags:v,backupNewLocationHintEnabled:I,isInsideBackupFolder:N,ggToCdmMigrationVariant:L,backupInfo:O,isFilteredView:x})=>{var k;const A=xt(),$=((e,t)=>s=>{const a=!i.shouldHandleClick(s);a||(s.preventDefault(),s.stopPropagation()),i.isFile(e)&&(null==t||t(e,a))})(t,R),P=()=>{i.isFile(t)&&(null==T||T(t))},H=e=>{i.isFile(t)&&(null==w||w(t,e))},W=s.React$1.useContext(D.FilesViewOverrideContext),V=W.isMoveFilePathBelowSnippetEnabled,B=L&&"OFF"!==L?s.React$1.lazy((()=>l.__awaiter(void 0,void 0,void 0,(function*(){const{MigrationTooltip:t,MigrationTooltipStep:i}=yield new Promise((function(t,i){e(["./c_gg_to_cdm_migration_migration_tooltip"],t,i)}));return{default:e=>s.React$1.createElement(t,Object.assign({},e,{step:i.Two}))}})))):void 0,z=L&&"OFF"!==L?s.React$1.lazy((()=>l.__awaiter(void 0,void 0,void 0,(function*(){const{MigrationTooltip:t,MigrationTooltipStep:i}=yield new Promise((function(t,i){e(["./c_gg_to_cdm_migration_migration_tooltip"],t,i)}));return{default:e=>s.React$1.createElement(t,Object.assign({},e,{step:i.Four}))}})))):void 0,U=s.React$1.useRef(null),G=s.React$1.useMemo((()=>B?s.React$1.createElement(B,{triggerRef:U,ggToCdmMigrationVariant:L,user:h}):void 0),[U,L]),K=s.React$1.useMemo((()=>z?s.React$1.createElement(z,{triggerRef:U,ggToCdmMigrationVariant:L,user:h}):void 0),[U,L]);if(i.isFile(t)&&a===i.RenameState.PENDING_INPUT)return s.React$1.createElement(Tt,{defaultValue:i.filename(t.fq_path),label:t.is_dir?A.renameDirStr:A.renameFileStr,onClick:Lt,onSubmit:H,onCancel:P,ignoreFileExtension:t.is_dir});let q;q=a===i.RenameState.SAVING_INPUT?s.React$1.createElement(s.React$1.Fragment,null,A.renamingStr):s.React$1.createElement(Nt,{file:t,user:h,containerWidth:F,isSelected:p,onNameClick:u,hrefForFile:f,showHighlights:g,isTooltipEnabled:b,showUserEducationEffects:m,userEducationEffectName:S,backupInfo:O,isFilteredView:x}),t instanceof i.File&&i.File.isTeamMemberFolder(t)&&G&&K&&(q=s.React$1.createElement("span",{ref:U},q,s.React$1.createElement(s.React$1.Suspense,{fallback:s.React$1.createElement(s.React$1.Fragment,null)},G,K))),x&&C&&(q=s.React$1.createElement(s.React$1.Fragment,null,q,s.React$1.createElement("span",{style:{marginLeft:"8px"}},s.React$1.createElement(vt,{containerWidth:F,file:t,onClick:$,renderAsLink:_,user:h,focusable:p,isInsideBackupFolder:!1,backupInfo:O,isFilteredView:!0}))));let j=null;E?j=s.React$1.createElement("span",{className:"first-task-content-subtitle"},A.filesMovedString):n&&(j=s.React$1.createElement(vt,{containerWidth:F,file:t,onClick:$,renderAsLink:_,user:h,focusable:p,isInsideBackupFolder:N,backupInfo:O}));const Y=s.React$1.createElement(o.MediaCellText,{key:"subtitle",variant:"subtitle"},j),X=F?{width:F}:void 0,J=i.isFile(t)&&t.media_data,Z=r||v&&i.isFile(t)||J,Q=i.isFile(t)&&t.tags?t.tags.filter((e=>i.isTagUserGenerated(e.value))):[],ee=null===(k=null==O?void 0:O.anchorFolders)||void 0===k?void 0:k.filter((e=>"broken"===e.folder_state[".tag"]&&e.folder_name===i.getFilename(t)));return s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.MediaCellText,{key:"title",highlight:C},s.React$1.createElement("div",{className:"brws-file-name-cell-title-container"},q,s.React$1.createElement(Dt,{file:t,isSelected:p}),I&&i.isBackupFolderIcon(t)&&!i.isBackupBrowse()&&s.React$1.createElement(i.Tooltip,{title:A.backupNewLocationTooltipStr,placement:"right"},s.React$1.createElement(i.Button$1,{className:"brws-file-name-cell-backup-new-location",variant:"transparent",size:"small",withIconLeft:s.React$1.createElement(i.UIIcon,{src:i.OpenLine,size:"small"}),onClick:t=>{new Promise((function(t,i){e(["./e_ui_page_files_router"],t,i)})).then((function(e){return e.constants_esnext})).then((({getBackupUrl:e})=>i.open_tab(e("browse_row")))),t.stopPropagation()}},A.backupNewLocationButtonStr)),i.isBackupBrowse()&&1===(null==O?void 0:O.nestLevel)&&void 0!==ee&&(null==ee?void 0:ee.length)>0&&s.React$1.createElement(i.Button$1,{className:"brws-file-name-cell-backup-finish-setup",variant:"transparent",size:"small",withIconLeft:s.React$1.createElement(i.UIIcon,{src:i.WarningLine,size:"small"}),onClick:e=>{M.launchBackupOnDesktop({hostId:null==O?void 0:O.deviceId,action:i.BackupAppDeepLinkAction.CHANGE_DEVICE_FOLDERS}),e.stopPropagation()}},A.backupFinishSetup))),c&&!V&&Y,Z&&s.React$1.createElement(o.MediaCellText,{key:"snippets_tags",variant:"subtitle",style:X},s.React$1.createElement("div",{className:"brws-file-snippets-tags-container"},J&&s.React$1.createElement("span",{className:"brws-file-snippets-media-search",style:X},s.React$1.createElement(Mt,{mediaData:t.media_data})),r&&s.React$1.createElement(bt,{snippets:t.snippets,lineClamp:d,isMakeSnippetsOneLineEnabled:W.isMakeSnippetsOneLineEnabled}),v&&Q.length>0&&s.React$1.createElement("span",{className:"brws-file-snippets",style:X},s.React$1.createElement(y.TagsContainer,{tags:Q.map((e=>e.value)),highlightedIndexes:Q.map(((e,t)=>e.highlighted?t:void 0)).filter((e=>void 0!==e)),onTagClick:(e,s)=>{if(s){!i.shouldHandleClick(s)||(s.preventDefault(),s.stopPropagation())}i.isFile(t)&&(i.logTagClick(h,[t],"center_pane",e),i.redirectToSearchByTag(h,e.tag_text))},containerClassName:"brws-file-tags-container",chipClassName:"brws-file-tag",showMoreClassName:"brws-file-tags-show-more",chipSize:"xsmall",containerMaxRows:1,expandable:!1,showMoreWidth:100})))),c&&V&&Y)};Ot.displayName="FileNameCellContents";const xt=()=>({filesMovedString:d.intl.formatMessage({id:"WYezR2",defaultMessage:"Your existing files moved here."}),renameFileStr:d.intl.formatMessage({id:"44Ky+Q",defaultMessage:"Rename file"}),renameDirStr:d.intl.formatMessage({id:"YApL4x",defaultMessage:"Rename directory"}),renamingStr:d.intl.formatMessage({id:"KvygQC",defaultMessage:"Renaming…"}),backupNewLocationButtonStr:d.intl.formatMessage({id:"wX0e+1",defaultMessage:"New location"}),backupNewLocationTooltipStr:d.intl.formatMessage({id:"Pn0YTw",defaultMessage:"Backups have a new home"}),backupFinishSetup:d.intl.formatMessage({id:"n2sso0",defaultMessage:"Finish setup"})}),{lazy:kt,Suspense:At}=s.React,$t=kt((()=>l.__awaiter(void 0,void 0,void 0,(function*(){const{FlowsFolderBadge:t}=yield new Promise((function(t,i){e(["./c_flows_components_badge"],t,i)}));return{default:t}})))),Pt=({isFolderFocused:e,folderFqPath:t})=>s.reactExports.createElement(At,{fallback:s.reactExports.createElement("div",null)},s.reactExports.createElement($t,{isFolderFocused:e,folderFqPath:t}));Pt.displayName="AsyncBadgeComponent";const Ht=({mediaActions:e,fileNameCellWidth:t,draggable:a,shouldTruncateMiddleFilename:n,renameState:o,showStar:l,file:r,user:c,isMobileMode:d,isSelected:h,showLocation:u,showSnippets:p,shouldShowSubtitle:m,snippetRows:g,onNameClick:f,showUserEducationEffects:S,showHighlights:b,hrefForFile:E,userEducationEffectName:_,isTooltipEnabled:T,showFirstTaskSubtitle:w,renderFilenameSubtitleAsLink:R,onRenameCancel:F,onRenameSubmit:v,isHovered:I,onLocationLinkClick:N,onSelect:D,onDragStart:y,showTags:M,preventSelectionOnDrag:L,backupNewLocationHintEnabled:O,isInsideBackupFolder:x,ggToCdmMigrationVariant:k,backupInfo:A,isFilteredView:$})=>{const P=i.cx("brws-file-name-cell-text","brws-vertically-center",{"brws-file-name-cell-text-rename":!!o}),H=i.cx("brws-file-name-container",{"brws-file-name-container--action-ui-inline-star":!0}),W=i=>{let s;return n&&(s=t||i,void 0!==s&&void 0!==e&&(s-=48)),s},V=e=>{y&&(L||h||!D||D(C.SelectOptions.DEFAULT,i.ActionSourceValue.ROW_SINGLE_CLICK),y(e))},B=n&&void 0===t,z=s.React$1.useRef(null);return s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(Wt,{className:H,shouldWrap:B},(e=>s.React$1.createElement("div",{className:H},s.React$1.createElement("div",{className:P,draggable:a&&o!==i.RenameState.PENDING_INPUT,onDragStart:V,ref:z},s.React$1.createElement(Ot,{file:r,renameState:o,showLocation:u,showSnippets:p,shouldShowSubtitle:m,snippetRows:g,user:c,onNameClick:f,isSelected:h,showUserEducationEffects:S,showHighlights:b,hrefForFile:E,userEducationEffectName:_,isTooltipEnabled:T,showFirstTaskSubtitle:w,renderFilenameSubtitleAsLink:R,onRenameCancel:F,onRenameSubmit:v,isHovered:I,onLocationLinkClick:N,width:W(e),shouldShowTags:M,backupNewLocationHintEnabled:O,isInsideBackupFolder:x,ggToCdmMigrationVariant:k,backupInfo:A,isFilteredView:$})),r instanceof i.File&&r.is_dir&&s.React$1.createElement(Pt,{isFolderFocused:h,folderFqPath:r.fq_path}),!o&&l&&s.React$1.createElement(St,{item:r,user:c,className:"brws-file-name-cell-star",isReadOnly:d,tabIndex:h?0:-1,starButtonClassName:"brws-file-name-star-button",alwaysShowUnstarred:!0})))),e)};Ht.displayName="FileNameCellComponent";const Wt=({children:e,className:t,shouldWrap:i})=>i?s.React$1.createElement(r.Dimensions,{className:t},(({width:t})=>e(t))):e();Wt.displayName="ConditionalDimensions";const Vt=i.connect(((e,t)=>{const s=je(e,t),a=i.BROWSE_NAMESPACE_KEY in e&&"fq_path"in s?i.isInsideBackupFolderByFile(e)(s):void 0,n=i.BROWSE_NAMESPACE_KEY in e&&"fq_path"in s?i.folderBackupInfoByFile(e)(s):void 0,o=i.BROWSE_NAMESPACE_KEY in e&&i.selectedFilter(e)!==i.BrowseFilterType.NONE;return{file:s,isSelectMode:i.selectHasItemsSelected(e,t),isSelected:Xe(e,t),renameState:et(e,t),renderFilenameSubtitleAsLink:i.selectRenderFilenameSubtitleAsLink(e,t),isMobileMode:i.selectIsMobileMode(e,t),showHighlights:i.selectShouldShowFileNameHighlights(e,t),showLocation:i.selectShouldShowFileNameLocation(e,t),showStar:it(e,t),showUserEducationEffects:Ze(e,t),userEducationEffectName:Qe(e,t),isTooltipEnabled:!0,user:i.selectUser(e,t),shouldTruncateMiddleFilename:!0,showSnippets:nt(e,t),snippetRows:lt(e,Object.assign(Object.assign({},t),{numVisibleColumns:t.visibleColumns.length})),showFirstTaskSubtitle:rt(e,t),shouldShowSubtitle:tt(e,t),backupNewLocationHintEnabled:i.backupNewLocationHintEnabled(e),isInsideBackupFolder:a,ggToCdmMigrationVariant:i.ggToCdmMigrationVariant(e),backupInfo:n,isFilteredView:o}}))(Ht);class Bt extends s.React$1.PureComponent{constructor(){super(...arguments),this.lastClickTimestamp=0,this.onClick=e=>{const{onDoubleClick:t,onClick:i,threshold:s}=this.props;if(t){const a=(new Date).getTime();a-this.lastClickTimestamp<s?(t(e),this.lastClickTimestamp=0):(this.lastClickTimestamp=a,i(e))}else i(e)}}render(){return this.props.children({onClick:this.onClick})}}Bt.defaultProps={onClick:()=>{},threshold:500},Bt.displayName="WithDoubleClick";const zt=({className:e,isSelected:t,isDeleted:a,isDraggable:n,isActiveDropTarget:l,rowIndex:r,ariaLabel:c,filename:d,children:h,onDragEnter:p,isSelectMode:m,onDragStart:g,onDragEnd:f,onNavigateToItem:S,onSelect:b,onDeselect:E,topOffset:_=0,isRightClickEnabled:T})=>{const w=e=>{T&&(e.defaultPrevented||(e.preventDefault(),e.shiftKey?b(C.SelectOptions.EXTEND,i.ActionSourceValue.ROW_SINGLE_CLICK):e.ctrlKey||e.metaKey?b(C.SelectOptions.DEFAULT,i.ActionSourceValue.ROW_SINGLE_CLICK):t||b(C.SelectOptions.ONLY,i.ActionSourceValue.ROW_SINGLE_CLICK)))},R=(e,t)=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),S({openInNewTab:Boolean(i.hasModifierKey(e)),actionSource:t}))};return s.React$1.createElement(Bt,{onClick:e=>{e.defaultPrevented||(e.preventDefault(),e.shiftKey?b(C.SelectOptions.EXTEND,i.ActionSourceValue.ROW_SINGLE_CLICK):e.ctrlKey||e.metaKey?t?E(!1,i.ActionSourceValue.ROW_SINGLE_CLICK):b(C.SelectOptions.DEFAULT,i.ActionSourceValue.ROW_SINGLE_CLICK):b(C.SelectOptions.ONLY,i.ActionSourceValue.ROW_SINGLE_CLICK))},onDoubleClick:e=>{e.defaultPrevented||R(e,i.ActionSourceValue.ROW_DOUBLE_CLICK)}},(({onClick:S})=>s.React$1.createElement(o.CulledMediaRow,{className:i.cx(e,{"brws-file-row-selected":t,"brws-file-row-deleted":a,"brws-file-row-dragover":l,"brws-row-click-selection-method":!0}),variant:(l?"dragover":t&&"selected")||"default",onClick:S,onContextMenu:w,draggable:n,topOffset:_,onDragEnter:p,onDragStart:t?g:void 0,onDragEnd:f,"aria-rowindex":(r||0)+1,"aria-label":c,"data-filename":d,tabIndex:m?-1:0===r?0:-1,"data-campaigns-element-id":u.CampaignsElementIdEnum.BROWSE_VIEW_LIST_FILE},h)))};zt.displayName="FilesViewRowUnmemoed";const Ut=s.React$1.memo(zt);Ut.displayName="FilesViewRow";const Gt=e=>{var{height:t,width:i,children:a}=e,n=l.__rest(e,["height","width","children"]);const r=void 0===i?{}:{width:i,minWidth:i,maxWidth:i};return s.React$1.createElement(o.MediaCell,{icon:s.React$1.createElement(D.FileThumbnail,Object.assign({},n)),style:Object.assign({minHeight:t-1},r),children:a})};Gt.displayName="ThumbnailMediaCell",Gt.displayName="ThumbnailMediaCell";const Kt=()=>s.React$1.createElement("span",{"aria-hidden":!0},"--"),qt=e=>void 0===e?{}:{width:e,minWidth:e,maxWidth:e},jt=({file:e})=>e.is_cloud_doc&&fe(e)?s.React$1.createElement(Kt,null):s.React$1.createElement("span",null,e.size);class Yt extends s.React$1.PureComponent{constructor(e){super(e),this.setRef=e=>{this.brwsFilenameContainerDiv=e},this.checkboxRef=null,this.handleWindowResize=()=>{this.throttledWindowResize.request()},this.handleResize=()=>{if(this.brwsFilenameContainerDiv){const{brwsFilenameContainerDivWidth:e}=this.state,t=this.brwsFilenameContainerDiv.getBoundingClientRect().width;t&&t!==e&&this.setState({brwsFilenameContainerDivWidth:t})}},this.handleTitleClick=e=>this.handleOpenNewTabOrNavigate(e,i.ActionSourceValue.ROW_TITLE),this.handleOpenNewTabOrNavigate=(e,t)=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),this.onNavigateToItem({openInNewTab:i.hasModifierKey(e),actionSource:t}))},this.onSelect=(e,t)=>{this.props.onSelect&&this.props.onSelect(this.props.file.file_id,e,t)},this.onDeselect=(e,t)=>{this.props.onDeselect&&this.props.onDeselect(this.props.file.file_id,e,t)},this.onNavigateToItem=({openInNewTab:e,actionSource:t})=>{e?i.open_tab(this.props.file.href):this.props.onOpenFileSharedWithMe(this.props.file,{actionSource:t})},this.getCheckboxNode=()=>this.checkboxRef&&s.reactDomExports.findDOMNode(this.checkboxRef),this.isCheckboxNode=e=>{const t=this.getCheckboxNode();return!!t&&t.contains(e)},this.handleCheckboxChange=e=>{},this.handleCheckboxClick=e=>{e.stopPropagation();const{onSelect:t,onDeselect:s,file:a}=this.props;t&&s&&(e.currentTarget.checked?t(a.file_id,e.shiftKey?C.SelectOptions.EXTEND:C.SelectOptions.DEFAULT,i.ActionSourceValue.SINGLE_CHECKBOX):s(a.file_id,e.shiftKey,i.ActionSourceValue.SINGLE_CHECKBOX))},this.setCheckboxRef=e=>{this.checkboxRef=e},this.handleCheckboxTouchTargetClick=e=>{if(this.shouldHandleClick(e)){if(!this.props.isCheckboxDisabled&&this.props.onDeselect&&this.props.onSelect){e.preventDefault();const t=this.props.file.file_id;this.props.isSelected?this.props.onDeselect(t,e.shiftKey,i.ActionSourceValue.SINGLE_CHECKBOX):this.props.onSelect(t,e.shiftKey?C.SelectOptions.EXTEND:C.SelectOptions.DEFAULT,i.ActionSourceValue.SINGLE_CHECKBOX)}}else e.preventDefault()},this.renderCheckbox=e=>{const{isCompactMode:t,isSelectMode:a,isSelected:n,showUserEducationEffects:o}=this.props;let l=null;return l=!(e||n||a||t)?null:s.React$1.createElement(i.Checkbox,{disabled:this.props.isCheckboxDisabled,checked:!!n,className:i.cx("brws-checkbox",{"brws-checkbox-checked":n}),onChange:this.handleCheckboxChange,onClick:this.handleCheckboxClick,ref:this.setCheckboxRef,"aria-label":d.intl.formatMessage({id:"sJRsRx",defaultMessage:"Select item"}),tabIndex:n?0:-1}),o&&(l=s.React$1.createElement(i.UserEducationEffect,{containerName:"FileSharedWithMeRow",name:"FirstFileSelectCheckbox",useSpan:!0},l||s.React$1.createElement("div",{style:{width:20,height:20}}))),l},this.state={brwsFilenameContainerDivWidth:void 0},this.throttledWindowResize=new b.RafThrottle((()=>this.handleResize()))}componentDidMount(){this.handleWindowResize(),window.addEventListener("resize",this.handleWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize)}componentDidUpdate(e){(this.props.isFocused&&!e.isFocused||this.props.isFocused&&this.props.isSelected&&!e.isSelected)&&this.checkboxRef&&Promise.resolve().then((()=>{const e=this.getCheckboxNode();e&&e.focus()}))}renderModifiedCell(e,t,a,n){const l=a&&e.agoFromLastActionByUserTs,r=l?e.agoFromLastActionByUserTs:e.ago;let c;if(r&&this.props.isUseNaturalLanguageTimeDeltasEnabled){const e=new Date(r);c=isNaN(e.getTime())?s.React$1.createElement("span",{"aria-hidden":!0},"--"):i.agoFromDate(e,Date.now(),!1)}const h=l?a:e.last_modified_name||void 0,u=h?d.intl.formatMessage({id:"ACVnV9",defaultMessage:"by {modified_by}"},{modified_by:h}):d.intl.formatMessage({id:"5794tP",defaultMessage:"by you"});return s.React$1.createElement(o.MediaCell,{className:"brws-file-modified-at-cell",key:"modifiedAt",subtitle:u,title:c||r||s.React$1.createElement(Kt,null),style:qt(n)},t)}renderCell({isHovered:e,isKeyboardFocused:t,sortField:a,isLastCell:n}){const{file:l,isSelectMode:r,isSelected:c,responsive:d,user:h,showSnippets:u,snippetRows:p,height:m,filteredContactName:g,iconSize:f,columnSizes:S}=this.props,b=void 0,E=null==S?void 0:S[a];switch(a){case i.SortField.FILENAME:const t={file:l,isHovered:e,isSelectMode:!!r,isSelected:!!c,isMobileMode:!d.isMatchedLarge&&!d.isMatchedMedium,user:h,mediaActions:b,shouldTruncateMiddleFilename:!0,showHighlights:true,showLocation:true,showStar:!1,showSnippets:!!u,snippetRows:p,onNameClick:this.handleTitleClick,renameState:void 0,renderFilenameSubtitleAsLink:!1,showUserEducationEffects:!1,userEducationEffectName:"",isTooltipEnabled:!1,showFirstTaskSubtitle:!1,shouldShowSubtitle:!0,draggable:!1,backupNewLocationHintEnabled:!1,isInsideBackupFolder:!1,ggToCdmMigrationVariant:"OFF",backupInfo:void 0,isFilteredView:!1},{brwsFilenameContainerDivWidth:n}=this.state;return s.React$1.createElement("div",{className:i.cx("brws-file-name-container",{"brws-file-name-container-resizing-enabled":void 0!==E}),ref:this.setRef},s.React$1.createElement(Gt,{file:l,height:m,iconSize:f,width:E},s.React$1.createElement(Ht,Object.assign({},t,{fileNameCellWidth:n?n-64:void 0}))));case i.SortField.RELEVANCE:case i.SortField.MODIFIED:return this.renderModifiedCell(l,b,g,E);case i.SortField.SIZE:return s.React$1.createElement(o.MediaCell,{className:"brws-file-size-cell",key:"size",title:s.React$1.createElement(jt,{file:l}),style:qt(E)},b);default:case i.SortField.CATEGORY:case i.SortField.EXTENSION:case i.SortField.SHARED_WITH:return L.reportException({err:new Error("FileSharedWithMe.renderCell is not implemented for "+a),severity:O.SEVERITY.NONCRITICAL,tags:["js:search"]}),s.React$1.createElement(o.MediaCell,{key:a,title:s.React$1.createElement(Kt,null),style:qt(E)})}}shouldHandleClick(e){return!e.defaultPrevented&&!this.isCheckboxNode(e.target)}render(){const{rowIndex:e,topOffset:t,isSelected:i,isSelectMode:a,visibleColumns:n}=this.props;return s.React$1.createElement(Ut,{className:"brws-filesharedwithme-row",isSelected:i,topOffset:t,rowIndex:e,isSelectMode:a,onSelect:this.onSelect,onDeselect:this.onDeselect,onNavigateToItem:this.onNavigateToItem},(({isHovered:e,isKeyboardFocused:t})=>[s.React$1.createElement(o.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"},s.React$1.createElement("div",{className:"brws-vertically-center brws-file-row-checkbox-target",onClick:this.handleCheckboxTouchTargetClick},this.renderCheckbox(e))),...n.map(((i,s)=>this.renderCell({isHovered:e,isKeyboardFocused:t,sortField:i.sortField,isLastCell:s===n.length-1})))]))}}Yt.displayName="FileSharedWithMeRow";const Xt=e=>{const{createNewFolderState:t,isInsideMyTeamFolderTree:i=!1,onCancel:a,onSubmit:n,rowIndex:l,topOffset:r,iconSize:c}=e;let h;h="SAVING_INPUT"===t?s.React$1.createElement("p",{className:"brws-new-folder-row-status",role:"status","aria-live":"polite"},d.intl.formatMessage({id:"p58M12",defaultMessage:"Creating new folder…"})):s.React$1.createElement(Tt,{defaultValue:"",label:d.intl.formatMessage({id:"ss4CO0",defaultMessage:"Folder name"}),onSubmit:n,onCancel:a});const u=s.React$1.createElement(Jt,{isInsideMyTeamFolderTree:i,iconSize:c});return s.React$1.createElement(o.CulledMediaRow,{"aria-rowindex":void 0!==l?l+1:void 0,className:"brws-new-folder-row",topOffset:r},s.React$1.createElement(o.TableCell,{className:"brws-checkbox-cell"}),s.React$1.createElement(o.MediaCell,{icon:u},s.React$1.createElement("div",{className:"brws-new-folder-row-content brws-vertically-center"},h)),s.React$1.createElement(o.TableCell,null),s.React$1.createElement(o.TableCell,null))},Jt=e=>{const{isInsideMyTeamFolderTree:t,iconSize:a}=e,n=e.className||"",o=a?{width:a,height:a}:{};return s.React$1.createElement(i.IconContent,Object.assign({className:n,name:t?"folder_team-small":"folder-small"},o))},Zt="‍";let Qt;function ei(e){const t=function(){Qt||(Qt=/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]\ufe0f?|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g);return Qt}();t.lastIndex=0;const i=t.exec(e);if(i&&0===i.index){const s=i[0];if(e[s.length]===Zt)return"";const a=t.exec(e);return a&&a.index===s.length?"":s||""}return""}function ti(e,t,a,n){let{title:o,highlight_spans:l,title_highlights:r}=e;const c=l&&l.length>0,d=ei(o);if(d)if(o=o.substr(d.length),c){const e={highlight_str:l[0].highlight_str.substr(d.length),is_highlighted:l[0].is_highlighted};l=[e,...l.slice(1)]}else if(r){const e=d.length/2;r=r.slice().map((t=>({pos:t.pos-e,len:t.string.length,string:t.string})))}let h;h=c?R.highlightReactFromHighlightSpans(o,l):R.highlightMatchReact(o,r);const u=function(e,t,a,n){return e?s.React$1.createElement("div",{className:"mc-media-cell-icon brws-file-name-icon-emoji-container"},s.React$1.createElement(i.IconContent,{name:n?"blank-large":"blank-small",className:t}),s.React$1.createElement("span",{className:a},e)):s.React$1.createElement(i.IconContent,{name:n?"paper-large":"paper-small",className:t})}(d,t,a,n);return{title:o,highlightedTitle:h,icon:u}}function ii(){}const si=e=>void 0===e?{}:{width:e,minWidth:e,maxWidth:e};class ai extends s.React$1.PureComponent{constructor(e){super(e),this.setRef=e=>{this.brwsFilenameContainerDiv=e},this.handleWindowResize=()=>{this.throttledWindowResize.request()},this.handleResize=()=>{if(this.brwsFilenameContainerDiv){const{brwsFilenameContainerDivWidth:e}=this.state,t=this.brwsFilenameContainerDiv.getBoundingClientRect().width;t&&t!==e&&this.setState({brwsFilenameContainerDivWidth:t})}},this.handleOpenNewTabOrNavigate=e=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),this.handleNavigate({openInNewTab:i.hasModifierKey(e)}))},this.handleNavigate=({openInNewTab:e})=>{const{paper:t,onOpenPaper:s}=this.props;e?i.open_tab(t.url):s(t)},this.throttledWindowResize=new b.RafThrottle((()=>this.handleResize())),this.state=this.calcState(e)}UNSAFE_componentWillReceiveProps(e){if(this.props.paper.title!==e.paper.title||this.props.paper.highlight_spans!==e.paper.highlight_spans){const t=this.calcState(e);this.setState(t)}}componentDidMount(){this.handleResize(),window.addEventListener("resize",this.handleWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize)}componentDidUpdate(e){var t,s;(null===(t=e.columnSizes)||void 0===t?void 0:t[i.SortField.FILENAME])!==(null===(s=this.props.columnSizes)||void 0===s?void 0:s[i.SortField.FILENAME])&&this.handleResize()}calcState(e){return{titleParts:ti(e.paper,"brws-file-name-cell-icon","brws-file-name-cell-icon-emoji")}}getHighlightedSpansForHighlightedTruncatedString(e){let{title:t,highlight_spans:i,title_highlights:s}=e;const a=i&&i.length>0,n=ei(t);if(a){if(n){const e={highlight_str:i[0].highlight_str.substr(n.length),is_highlighted:i[0].is_highlighted};i=[e,...i.slice(1)]}return i.map((e=>({string:e.highlight_str,isHighlighted:e.is_highlighted})))}if(s){if(n){t=t.substr(n.length);const e=n.length/2;s=s.slice().map((t=>({pos:t.pos-e,len:t.string.length,string:t.string})))}return R.highlightMatchSections(t,s).map((e=>({string:e.text,isHighlighted:e.isHighlighted})))}}renderTitleElement(e){const{paper:t,showHighlights:a}=this.props,{title:n,highlightedTitle:o}=this.state.titleParts;if(e){const o=s.React$1.createElement(N.HighlightedTruncatedString,{text:n,className:"brws-file-name-element",fontSize:14,highlightSpans:this.getHighlightedSpansForHighlightedTruncatedString(t),cellBuffer:3,availableWidth:e});return s.React$1.createElement("a",{className:i.cx("brws-paper-doc-name-cell-title",{"brws-paper-doc-name-cell-title-bold":this.props.isBoldFileNamesEnabled}),href:t.url,onClick:this.handleOpenNewTabOrNavigate},a?o:s.React$1.createElement("span",null,n))}return s.React$1.createElement("a",{className:i.cx("brws-paper-doc-name-cell-title",{"brws-paper-doc-name-cell-title-bold":this.props.isBoldFileNamesEnabled}),href:t.url,onClick:this.handleOpenNewTabOrNavigate},a?o:s.React$1.createElement("span",null,n))}renderPaperCellContent(e,t){const{paper:i,user:a,showSnippets:n,snippetRows:l,showStar:r}=this.props;return s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement("div",{className:"brws-paper-doc-name-cell-content brws-vertically-center"},s.React$1.createElement("div",{className:"brws-paper-doc-name-cell-title-container"},s.React$1.createElement(o.MediaCellText,{highlight:e,className:"brws-paper-doc-cell-name"},this.renderTitleElement(t))),s.React$1.createElement(o.MediaCellText,{variant:"subtitle"},d.intl.formatMessage({id:"mvOTrD",defaultMessage:"in Paper"})),n&&s.React$1.createElement(o.MediaCellText,{key:"snippets",variant:"subtitle"},s.React$1.createElement("div",{className:"brws-file-snippets-tags-container"},s.React$1.createElement(bt,{snippets:i.snippets,lineClamp:l})))),r&&s.React$1.createElement(St,{item:i,user:a,key:"paperStar",className:"brws-file-name-cell-star",starButtonClassName:"brws-file-name-star-button",alwaysShowUnstarred:!0}))}renderDocName(e,t){const{height:a}=this.props,{icon:n}=this.state.titleParts,l={highlight:e,icon:n,style:Object.assign({minHeight:a-1},si(t))},r=i.cx("brws-file-name-container",{"brws-file-name-container--action-ui-inline-star":!0}),{brwsFilenameContainerDivWidth:c}=this.state;return s.React$1.createElement(o.MediaCell,Object.assign({key:"docName"},l),s.React$1.createElement("div",{className:r,ref:this.setRef},this.renderPaperCellContent(e,c)))}renderDocInfo(e){const{paper:t}=this.props;let a;if(this.props.isUseNaturalLanguageTimeDeltasEnabled){const e=new Date(t.last_modified_date);a=isNaN(e.getTime())?s.React$1.createElement("span",{"aria-hidden":!0},"--"):i.agoFromDate(e,Date.now(),!1)}const n=t.last_modified_date||"",l=t.last_editor_name?d.intl.formatMessage({id:"ACVnV9",defaultMessage:"by {modified_by}"},{modified_by:t.last_editor_name}):d.intl.formatMessage({id:"5794tP",defaultMessage:"by you"});return s.React$1.createElement(o.MediaCell,{key:"docInfo",subtitle:l,title:a||n,style:si(e)})}renderCell({isHovered:e,sortField:t}){var a;const n=null===(a=this.props.columnSizes)||void 0===a?void 0:a[t];switch(t){case i.SortField.FILENAME:return this.renderDocName(e,n);case i.SortField.RELEVANCE:case i.SortField.MODIFIED:return this.renderDocInfo(n);default:return s.React$1.createElement(o.MediaCell,{key:t,title:s.React$1.createElement("span",{"aria-hidden":!0},"--"),style:si(n)})}}render(){const{rowIndex:e,topOffset:t,visibleColumns:i,paper:a}=this.props;return s.React$1.createElement(Ut,{className:"brws-paper-row",topOffset:t,rowIndex:e,filename:a.title,ariaLabel:a.title,onSelect:ii,onDeselect:ii,onNavigateToItem:this.handleNavigate},(({isHovered:e})=>[s.React$1.createElement(o.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"}),...i.map((t=>this.renderCell({isHovered:e,sortField:t.sortField})))]))}}ai.defaultProps={showHighlights:!0},ai.displayName="PaperRow";const ni="files:search_v2",oi="files:search/continue_v2",li=i.createDefaultApiv2InfiniteQueryFn(ni,oi),ri=i.createApiv2InfiniteQuery({requestMethod:ni,continueRequestMethod:oi,queryFn:(...e)=>(...t)=>{const s=performance.now();return x.reportExceptionIfRequestFails((()=>l.__awaiter(void 0,void 0,void 0,(function*(){const i=yield li(...e)(...t),a=performance.now()-s;return Object.assign(Object.assign({},i),{pkgData:{requestLatencyMs:a}})}))),["search_view","search_view_search_results","search_react_query"],(e=>{var t,a,n,o;const l=performance.now()-s,r=null!==(o=null===(n=null===(a=null===(t=e.raw)||void 0===t?void 0:t.status)||void 0===a?void 0:a.toString)||void 0===n?void 0:n.call(a))&&void 0!==o?o:"";i.logQueryFailed(l,r,i.SearchOriginPathway.WEB)}))},optionsFn:e=>Object.assign({cacheTime:0,staleTime:0,getNextPageParam:(e,t)=>{var i,s;return{continueArg:{apiArg:{cursor:null!==(s=null===(i=e.apiData)||void 0===i?void 0:i.cursor)&&void 0!==s?s:""}}}}},e)}),ci=(e,t)=>{const s=i.searchSessionManager.getSearchSessionId({searchSessionExtensionType:"PASSIVE"}),a=Object.assign(Object.assign({},t),{query:e,searchSessionId:s,maxResults:i.SEARCH_ADDITIONAL_PAGE_SIZE,start:0,includeBrowseContext:!0}),n=x.useSearchResultsExperiments(),o={expSearchEnableMSOfficeThumbnails:n.expSearchEnableMSOfficeThumbnails,manualTaggingVariant:n.expManualTagging,searchDocClassification:n.searchDocClassification},l=i.prepareSearchExperimentsData(a,o);return i.prepareSearchApiRequestData(l)},di=e=>{const t=e.length>0?e[0]:void 0;if(!t||!t.apiData.request_id)return{matches:[],has_more:!1};let i=[];for(const t of e)i=i.concat(t.apiData.matches);const s=e[e.length-1];return Object.assign(Object.assign({},s.apiData),{matches:i,request_id:t.apiData.request_id})},hi=e=>{var t;const s=e.request_id?i.getRequestId(e.request_id):void 0;let a;e.spell_correction&&s&&(a={query:e.spell_correction.query,score:0,isCorrected:e.spell_correction.is_corrected,requestId:s});return{requestId:s,results:s?i.extractSearchV2ResultsList(e.matches,0,s):[],hasMore:e.has_more,cursor:e.cursor,spellCorrection:a,flexibleQuery:e.flexible_query||{},newUiFiltersFromFql:i.getNewUiFiltersFromFql(e.flexible_query),query:null!==(t=e.query)&&void 0!==t?t:""}};function ui(e){e.stopPropagation()}function pi(e){const{FilesViewInlineActionBar:t,file:a,highlighted:n,onHoverLocked:o,isMobile:l,searchActionBarExperiments:r,requestId:d,resultList:h,hasMoreResults:u}=e;s.React$1.useEffect((()=>{l||s.cancel()}),[l]);const p=i.cx("brws-file-row-inline-action-bar",{"brws-file-row-inline-action-bar--safari":c.safari});return t?s.React$1.createElement("td",{onClick:ui,className:"brws-file-row-inline-action-bar--container"},s.React$1.createElement(t,{className:p,file:a,highlighted:n,onHoverLocked:o,isMobile:l,searchActionBarExperiments:r,requestId:d,resultList:h,hasMoreResults:u})):null}const mi=(e,t)=>({FilesViewInlineActionBar:i.selectInlineActionBar(e,t)}),gi=i.connect(mi)((e=>{var t,a;const n=x.useSearchActionBarExperiments(),o=i.resultQuery(i.getStoreForSearch().getState()),l=i.apiCommonFields(i.getStoreForSearch().getState()),{filteredAccountId:r,flexibleQuery:c}=l,d=ci(o,l),h=ri.useInfiniteQuery({apiArg:d},{cacheTime:1/0,staleTime:1/0,enabled:!i.isSearchArgsInvalid({query:o,filteredAccountId:r,flexibleQuery:c})}),u=di(null!==(a=null===(t=h.data)||void 0===t?void 0:t.pages)&&void 0!==a?a:[]),p=hi(u),m=i.immutableExports.List(p.results),g=p.requestId,f=p.hasMore;return s.React$1.createElement(pi,Object.assign({},e,{searchActionBarExperiments:n,requestId:g,resultList:m,hasMoreResults:f}))})),fi=i.connect(mi)(pi),Si=i.shouldUseReactQueryForSearchView()?gi:fi,bi=i.Loadable({loader:()=>new Promise((function(t,i){e(["./c_files_view_mobile_overflow_menu"],t,i)})).then((({FilesViewMobileOverflowMenu:e})=>e))});var Ei;!function(e){e[e.Normal=0]="Normal",e[e.Small=1]="Small"}(Ei||(Ei={}));class _i extends s.React$1.Component{constructor(e){super(e),this.handleSelection=e=>{e.performAction()},this.handleMenuToggle=({isOpen:e})=>{if(e&&this.props.onMenuOpen&&this.props.onMenuOpen(),_i.isDynamicProps(this.props)&&e){const e=this.props.getOverflowMenuActions(this.props.file,!!this.props.canDisplayFolderSizes);this.setState({actionSection:e})}},this.handlePreventMouseDown=e=>{e.preventDefault(),e.stopPropagation()},this.handleMobileMenuOpen=e=>t=>{this.handlePreventMouseDown(t),this.handleMenuToggle({isOpen:!0}),e()},this.handleClick=e=>t=>{this.handlePreventMouseDown(t),e({})},this.state={actionSection:_i.isDynamicProps(e)?[]:e.actionSection}}render(){const{isResponsive:e,size:t,showBorders:a,ariaHidden:n}=this.props,{file:o}=_i.isDynamicProps(this.props)?this.props:{},l=e&&c.is_mobile_or_tablet(),r=t===Ei.Small?"small":"standard";return s.React$1.createElement("div",{"aria-hidden":n?"true":void 0,className:"browse-overflow-menu","data-testid":"browse-overflow-menu"},l?s.React$1.createElement(bi,{trigger:({openMobileMenu:e})=>s.React$1.createElement(Ti,{onClick:this.handleMobileMenuOpen(e),showBorders:a,size:r}),file:o,actionSection:this.state.actionSection}):s.React$1.createElement(i.Menu.Wrapper,{onSelection:this.handleSelection,onToggle:this.handleMenuToggle,onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown,isPortaled:!1},(({getTriggerProps:e,getContentProps:t,openMenu:o})=>s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(Ti,{triggerProps:e(),onClick:this.handleClick(o),showBorders:a,size:r,tabIndex:n?-1:0}),s.React$1.createElement(i.Menu.Content,Object.assign({placement:"bottom-end"},t(),{className:"browse-overflow-menu-content"}),this.state.actionSection.map(((e,t)=>s.React$1.createElement(i.Menu.Segment,{key:`action-group-${t}`},e.map(((e,t)=>s.React$1.createElement(i.Menu.ActionItem,{key:`${t}-${e.label}`,value:e,disabled:e.disabled,className:i.cx("browse-overflow-menu-item",e.className)},e.label)))))))))))}}_i.isDynamicProps=e=>"file"in e,_i.defaultProps={onMenuToggle:()=>{},isResponsive:!0},_i.displayName="FilesViewOverflowMenu";const Ti=({size:e,showBorders:t,onClick:a,tabIndex:n,triggerProps:o})=>{const l=d.intl.formatMessage({id:"oeNPkV",defaultMessage:"More actions"});return s.React$1.createElement(i.IconButton,Object.assign({},o,{"aria-label":l,onClick:a,size:e,variant:t?"outline":"transparent",tabIndex:n}),s.React$1.createElement(i.UIIcon,{src:i.MoreHorizontalLine,size:e}))};Ti.displayName="MenuTrigger";class wi extends s.React$1.PureComponent{constructor(){super(...arguments),this.state={isActionDropdownOpen:!1},this.onSplitShareDropdownOpen=()=>{this.onActionDropdownOpen()},this.onActionDropdownOpen=()=>{this.setState({isActionDropdownOpen:!0})},this.onActionDropdownClose=()=>{this.setState({isActionDropdownOpen:!1})},this.logSplitShareButton=t=>{i.UserSurvey.trackEvent("share_item","browse"),i.isFile(this.props.file)&&this.props.file.is_in_vault_folder&&function(t){l.__awaiter(this,void 0,void 0,(function*(){const{logProductAnalyticsEvent:i}=yield new Promise((function(t,i){e(["./c_vault_lib_api"],t,i)})).then((function(e){return e.api_esnext})),{AnalyticsEventAction:s,AnalyticsEventObject:a,AnalyticsEventActionSurface:n}=yield new Promise((function(t,i){e(["./c_src_common_logging-types"],t,i)}));i({eventAction:s.SELECT,eventObject:t?a.SHARE_FOLDER:a.SHARE_FILE,actionSurface:n.VAULT_HOME})}))}(this.props.file.is_dir)}}render(){const{canDisplayFolderSizes:e,file:t,getOverflowMenuActions:i,isCompactMode:a,isHovered:n,isSelectMode:l,isSharingDisabled:r,shareButtonLabel:c,showShareButton:d,showBorders:h,user:u,viewportTopOffset:p}=this.props,m=this.props.onShowShare||(()=>{});return l?null:s.React$1.createElement(o.MediaActions,null,!r&&!1!==d&&s.React$1.createElement(k.SplitShareButton,{shareButtonLabel:c,onShowShare:m,logShareButtonClick:this.logSplitShareButton,isVisible:n&&!a||this.state.isActionDropdownOpen,user:u,files:[t],onDropdownOpen:this.onSplitShareDropdownOpen,onDropdownClose:this.onActionDropdownClose,variant:"opacity",shouldUsePortalPopover:!0}),s.React$1.createElement(_i,{canDisplayFolderSizes:e,file:t,getOverflowMenuActions:i,showBorders:n||!!h,viewportTopOffset:p,ariaHidden:!0}))}}wi.displayName="FileMediaActions";const Ci=({isSelected:e,isDisabled:t,shouldShowUserEducationEffects:a,isCheckboxVisible:n,onSelect:o,onDeselect:l,selectionId:r,isFocused:c})=>{const h={selectItem:d.intl.formatMessage({id:"MkD8+F",defaultMessage:"Select item"})},u=s.React$1.useRef(null),p=()=>{var e,t;null===(t=null===(e=u.current)||void 0===e?void 0:e.querySelector("input"))||void 0===t||t.focus()};s.React$1.useEffect((()=>{c&&p()}),[c]),s.React$1.useEffect((()=>{e&&c&&p()}),[e,c]);const m=s=>{o&&l&&!t&&(s.stopPropagation(),e?l(r,s.shiftKey,i.ActionSourceValue.SINGLE_CHECKBOX):o(r,s.shiftKey?C.SelectOptions.EXTEND:C.SelectOptions.DEFAULT,i.ActionSourceValue.SINGLE_CHECKBOX))};let g=null;return n&&(g=s.React$1.createElement(i.Checkbox,{disabled:t,checked:e,onClick:m,"aria-label":h.selectItem,tabIndex:e?0:-1,readOnly:!0})),a&&(g=s.React$1.createElement(i.UserEducationEffect,{containerName:"FileItemRow",name:"FirstFileSelectCheckbox",useSpan:!0},g||s.React$1.createElement("div",{style:{width:20,height:20}}))),s.React$1.createElement("div",{className:i.cx("brws-vertically-center","brws-file-row-checkbox-target",{"brws-file-row-checkbox-background":n}),onClick:m,ref:u,"data-testid":"brws-file-row-checkbox"},g)};Ci.displayName="FileRowCheckboxComponent",Ci.displayName="FileRowCheckboxComponent";const Ri=i.connect(((e,t)=>({isCheckboxDisabled:i.selectDisabledMultiselect(e,t),isCheckboxVisible:Je(e,t),isSelected:Xe(e,t),shouldShowUserEducationEffects:Ze(e,t),isDisabled:i.selectDisabledMultiselect(e,t),selectionId:Ye(e,t)})))(Ci),Fi=()=>s.React$1.createElement("span",{"aria-hidden":!0},"--"),vi=({file:e})=>{if(!e.recentsInfo||!e.recentsInfo.recent_event_type||!e.recentsInfo.activity_timestamp_ms)return s.React$1.createElement(Fi,null);const t=function(e){switch(e[".tag"]){case"file_shared_view":case"file_private_view":case"paper_view":return d.intl.formatMessage({id:"9V+0Zh",defaultMessage:"Opened"});case"file_edit":case"paper_edit":return d.intl.formatMessage({id:"zA0VWC",defaultMessage:"Edited"});default:return d.intl.formatMessage({id:"1EfErT",defaultMessage:"Added"})}}(e.recentsInfo.recent_event_type);return s.React$1.createElement("span",null,t+" ",i.agoFromDate(e.recentsInfo.activity_timestamp_ms,Date.now(),!1))};const Ii=({file:e,mediaActions:t,filteredContactName:a,isSearchMode:n,shouldBubbleSubtitle:l,width:r})=>{const c=a&&e.agoFromLastActionByUserTs,h=e.is_dir&&!n?void 0:c?e.agoFromLastActionByUserTs:e.ago,u=c?a:e.last_modified_name||void 0,p=u?d.intl.formatMessage({id:"ACVnV9",defaultMessage:"by {modified_by}"},{modified_by:u}):e.is_dir?void 0:d.intl.formatMessage({id:"5794tP",defaultMessage:"by you"}),m=s.React$1.useContext(D.FilesViewOverrideContext),{isUseNaturalLanguageTimeDeltasEnabled:g}=m;let f;if(h&&g){const e=new Date(h);f=isNaN(e.getTime())?s.React$1.createElement("span",{"aria-hidden":!0},"--"):i.agoFromDate(e,Date.now(),!1)}const S=h||s.React$1.createElement("span",{"aria-hidden":!0},"--"),b=void 0===r?{}:{width:r,minWidth:r,maxWidth:r},E=l&&p?s.React$1.createElement(i.Tooltip,{title:p},s.React$1.createElement("span",null,S)):S;return s.React$1.createElement(o.MediaCell,{className:"brws-file-modified-at-cell",subtitle:l?void 0:p,title:f||E,style:b},t)};Ii.displayName="ModifiedCell",Ii.displayName="ModifiedCell";const Ni=()=>s.React$1.createElement("span",{"aria-hidden":!0},"--");class Di extends s.React$1.Component{constructor(){super(...arguments),this.state={isHoverLocked:!1,rowIsDragging:!1},this.handleOpenFileClick=e=>this.handleOpenNewTabOrNavigate(e,i.ActionSourceValue.ROW_PREVIEW_ICON),this.handleTitleClick=e=>this.handleOpenNewTabOrNavigate(e,i.ActionSourceValue.ROW_TITLE),this.handleOpenNewTabOrNavigate=(e,t)=>{if(0===e.button||1===e.button){if(i.hasModifierKey(e)&&"A"===e.currentTarget.tagName)return void e.stopPropagation();e.preventDefault(),e.stopPropagation();const s="A"===e.currentTarget.tagName?e.currentTarget.href:void 0;this.onNavigateToItem({openInNewTab:!1,actionSource:t,href:s,middleClick:1===e.button})}},this.onCheckboxSelect=(e,t,s)=>{var a,n;null===(n=(a=this.props).onSelect)||void 0===n||n.call(a,e,t,s);const o=this.props.file.fq_path;i.getStoreForSharedWith().dispatch(i.loadSharedLinkDataForPath(o))},this.onRowSelect=(e,t)=>{this.props.onSelect&&this.props.onSelect(this.props.fileToId(this.props.file),e,t);const s=this.props.file.fq_path;i.getStoreForSharedWith().dispatch(i.loadSharedLinkDataForPath(s))},this.onRowDeselect=(e,t)=>{this.props.onDeselect&&this.props.onDeselect(this.props.fileToId(this.props.file),e,t)},this.onNavigateToItem=({openInNewTab:e,actionSource:t,href:s,middleClick:a})=>{if(e){const{file:e,user:t,hrefForFile:s}=this.props;i.open_tab(s(t,e))}else this.props.onNavigateToFileOrFolder(this.props.file,{actionSource:t,href:s,middleClick:a})},this.onDragEnter=e=>{const{file:t,isSelected:i,isActiveDropTarget:s}=this.props;this.props.onDragEnter(e,t,!!i,!!s)},this.onDragStart=e=>{this.setState({rowIsDragging:!0});const{file:t,isSelected:i,onDragStart:s}=this.props;s&&(i?s(e):s(e,[t]))},this.onDragEnd=e=>{this.setState({rowIsDragging:!1});const{onDragEnd:t}=this.props;t&&t(e)},this.onShowShare=()=>{this.props.onShowShare(this.props.file,i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW)},this.handleHoverLocked=({isOpen:e})=>{this.setState({isHoverLocked:e})},this.getAriaLabelForColumn=(e,t)=>{var s;switch(e.sortField){case i.SortField.FILENAME:return e.label+" "+i.filename(t.fq_path);case i.SortField.MODIFIED:return e.label+" "+t.ago;case i.SortField.CATEGORY:return e.label+" "+i.File.getCategoryDescription(t);case i.SortField.EXTENSION:return e.label+" "+i.File.getExtension(t);case i.SortField.SIZE:return e.label+" "+t.size;case i.SortField.PARENT_FOLDER:return e.label+" "+i.File.getParentDirName(t);case i.SortField.RECENT_ACTIVITY:return e.label+" "+(null===(s=t.recentsInfo)||void 0===s?void 0:s.activity_timestamp_ms);case i.SortField.SHARED_WITH:default:return}},this.renderMediaActions=(e,t)=>{const{instanceId:i,canDisplayFolderSizes:a,file:n,getOverflowMenuActions:o,isCompactMode:l,responsive:r,isSelectMode:c,isSelected:d,isSharingDisabled:h,renameState:u,shareButtonLabel:p,showShareButton:m,user:g,viewportTopOffset:f,isActionBarEnabled:S}=this.props,b=!r.isMatchedLarge&&!r.isMatchedMedium;return!(b&&(u||c))?S?e||b?s.React$1.createElement(Si,{instanceId:i,file:n,highlighted:d,onHoverLocked:this.handleHoverLocked,isMobile:b}):void 0:s.React$1.createElement(wi,{canDisplayFolderSizes:a,file:n,getOverflowMenuActions:o,isCompactMode:!!l,isHovered:e,isSelectMode:!!c,isSharingDisabled:!!h,onOpenFileClick:this.handleOpenFileClick,onShowShare:this.onShowShare,shareButtonLabel:p,showShareButton:m,showBorders:t,user:g,viewportTopOffset:f}):void 0}}renderCell({isHovered:e,sortField:t,renderCell:a}){var n,l;const{instanceId:r,itemIndex:c,rowIndex:d,fileToId:h,visibleColumns:u,containerWidth:p,height:m,file:g,hrefForFile:f,isSearchMode:S,isSelectMode:b,onLocationLinkClick:E,onRenameCancel:_,onRenameSubmit:T,filteredContactName:w,showCDMUserEducationEffects:C,iconSize:R,isCondensedListView:F,columnSizes:v,renderSharedWithController:I,isSelected:N,expManualTagging:D,preventSelectionOnDrag:y}=this.props;if(a)return a({file:g});const M=null==v?void 0:v[t];switch(t){case i.SortField.FILENAME:return s.React$1.createElement(Gt,{key:"fileName",file:g,height:m,width:M,showCDMUserEducationEffects:C,iconSize:R},s.React$1.createElement(Vt,{instanceId:r,itemIndex:c,rowIndex:d,isHovered:e,fileToId:h,visibleColumns:u,containerWidth:p,onLocationLinkClick:E,onRenameCancel:_,onRenameSubmit:T,hrefForFile:f,onNameClick:this.handleTitleClick,onSelect:this.onRowSelect,onDragStart:this.onDragStart,draggable:!b,showTags:S&&i.isTaggingEnabled(D),preventSelectionOnDrag:y}));case i.SortField.RELEVANCE:case i.SortField.MODIFIED:return s.React$1.createElement(Ii,{key:"modified",file:g,filteredContactName:w,isSearchMode:Boolean(S),shouldBubbleSubtitle:F,width:M});case i.SortField.SHARED_WITH:case i.SortField.CATEGORY:case i.SortField.EXTENSION:case i.SortField.SIZE:case i.SortField.PARENT_FOLDER:case i.SortField.RECENT_ACTIVITY:case i.SortField.LOCKED_FILES:{const e=void 0===M?{}:{width:M,minWidth:M,maxWidth:M},a={[i.SortField.SHARED_WITH]:I(g,N?0:void 0),[i.SortField.CATEGORY]:null,[i.SortField.EXTENSION]:null,[i.SortField.SIZE]:null,[i.SortField.LOCKED_FILES]:null,[i.SortField.PARENT_FOLDER]:null,[i.SortField.RECENT_ACTIVITY]:null}[t],r={[i.SortField.SHARED_WITH]:void 0,[i.SortField.CATEGORY]:i.File.getCategoryDescription(g),[i.SortField.EXTENSION]:i.File.getExtension(g),[i.SortField.SIZE]:s.React$1.createElement(be,{file:g}),[i.SortField.LOCKED_FILES]:void 0,[i.SortField.PARENT_FOLDER]:i.File.getParentDirName(g)||s.React$1.createElement(Ni,null),[i.SortField.RECENT_ACTIVITY]:s.React$1.createElement(vi,{file:g})}[t],c={[i.SortField.SHARED_WITH]:"sharedWith",[i.SortField.CATEGORY]:"category",[i.SortField.EXTENSION]:"extension",[i.SortField.SIZE]:"size",[i.SortField.LOCKED_FILES]:"locked_files",[i.SortField.PARENT_FOLDER]:"folder",[i.SortField.RECENT_ACTIVITY]:"recentActivity"}[t],d={[i.SortField.SHARED_WITH]:"brws-file-shared-with-cell",[i.SortField.CATEGORY]:"brws-file-category-cell",[i.SortField.EXTENSION]:"brws-file-extension-cell",[i.SortField.SIZE]:"brws-file-size-cell",[i.SortField.LOCKED_FILES]:"brws-file-size-cell",[i.SortField.PARENT_FOLDER]:"brws-file-size-cell",[i.SortField.RECENT_ACTIVITY]:"brws-file-size-cell"}[t];let h;if(t===i.SortField.SIZE&&S){const e=null===(n=g.media_data)||void 0===n?void 0:n.data.image_width,t=null===(l=g.media_data)||void 0===l?void 0:l.data.image_height;h=e&&t?`${e}x${t} px`:"​"}return s.React$1.createElement(o.MediaCell,{className:d,subtitle:h,title:r,style:e,key:c},a)}default:return L.reportException({err:new Error("renderCell function for "+t+"is not implemented"),severity:O.SEVERITY.NONCRITICAL,tags:["js:browse"]}),s.React$1.createElement(Ni,null)}}render(){const{file:e,fileToId:t,instanceId:a,isActiveDropTarget:n,isSearchMode:l,isSelectMode:r,isSelected:c,itemIndex:d,renameState:h,rowIndex:u,topOffset:p,visibleColumns:m,isCutToClipboard:g,isFocused:f,isRightClickEnabled:S}=this.props,b=this.state.isHoverLocked;let E="";m.forEach((t=>{const i=this.getAriaLabelForColumn(t,e);i&&(E+=i+", ")}));const _=this.state.rowIsDragging&&!c,T=i.cx({"brws-file-row":!0,"brws-file-row-no-access":i.File.isNoAccessSharedFolder(e)||_,"brws-file-row-hover-forced":b,"brws-file-row-cut":g,"brws-file-row-dragging":_}),w=!(h||l||i.File.isTeamMemberFolder(e)||i.File.isReadOnlySharedFolder(e)||i.File.isNoAccessSharedFolder(e)||i.isBackupFolderIcon(e)||!c);return s.React$1.createElement(Ut,{className:T,isActiveDropTarget:n,isSelected:c,isDeleted:e.isDeleted,isDraggable:w,topOffset:p,rowIndex:u,isSelectMode:r,filename:String(e.fq_path.split("/").slice(-1)),ariaLabel:E,onSelect:this.onRowSelect,onDeselect:this.onRowDeselect,onNavigateToItem:this.onNavigateToItem,onDragEnter:this.onDragEnter,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,isRightClickEnabled:S},(({isHovered:e,isKeyboardFocused:i})=>(e=e||b,s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"},s.React$1.createElement(Ri,{instanceId:a,itemIndex:d,rowIndex:u,isHovered:e,isFocused:!!f,fileToId:t,onSelect:this.onCheckboxSelect,onDeselect:this.props.onDeselect})),...m.map(((t,i)=>this.renderCell({isHovered:e&&!_,sortField:t.sortField,renderCell:t.renderCell}))),this.renderMediaActions(e,i)))))}}Di.defaultProps={topOffset:0,controlsFocusable:!1,fileToId:e=>e.fq_path},Di.displayName="FileRow";const yi=s.React$1.memo((e=>s.React$1.createElement(j.Consumer,null,(({columnSizes:t,columnResizingEnabled:i})=>s.React$1.createElement(Di,Object.assign({},e,{columnSizes:i?t:void 0}))))));yi.displayName="RowContainerWithoutRedux";const Mi=i.connect(((e,t)=>({context:i.selectContext(e,t),isCheckboxDisabled:i.selectDisabledMultiselect(e,t),responsive:i.selectResponsive(e,t),showCDMUserEducationEffects:st(e,t),height:ot(e,Object.assign(Object.assign({},t),{numVisibleColumns:t.visibleColumns.length})),iconSize:dt(e,t,t.iconSize),isCutToClipboard:ht(e,t)})))(yi),Li=s.React$1.memo((({rowIndex:e,topOffset:t,userDefinedItem:i})=>i.renderUserDefinedItemRow({rowIndex:e,topOffset:t})));Li.displayName="UserDefinedItemRow";const Oi=()=>{},xi=e=>{const t=["menuitem","treeitem"];switch(e.key){case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":return!(e.target instanceof Element&&t.includes(e.target.getAttribute("role")||""));default:return!0}};class ki extends s.React$1.Component{constructor(){super(...arguments),this.getIsListEvent=e=>this.props.isSelectableListEvent()&&(!(e.target instanceof Element)||"BUTTON"!==e.target.tagName),this.getSelectedFiles=()=>this.props.selectedFiles,this.getActiveDropTarget=()=>this.props.activeDropTarget,this.getIsDraggingInternalFiles=()=>!!this.props.isDraggingInternalFiles,this.getIsDraggingExternalFiles=()=>!!this.props.isDraggingExternalFiles,this.renderRow=(e,t,a)=>{var n,o,l,r;if("NewFolderRow"===e.type)return s.React$1.createElement(Xt,{createNewFolderState:e.props.createNewFolderState,isInsideMyTeamFolderTree:e.props.isInsideMyTeamFolderTree,onCancel:this.props.onNewFolderCancel,onSubmit:this.props.onNewFolderSubmit,rowIndex:t,topOffset:a,iconSize:e.props.iconSize});if("PaperRow"===e.type)return s.React$1.createElement(D.FilesViewOverrideContext.Consumer,null,(({isUseNaturalLanguageTimeDeltasEnabled:i})=>s.React$1.createElement(j.Consumer,null,(({columnSizes:n,columnResizingEnabled:o})=>s.React$1.createElement(ai,{paper:e.props.paper,rowIndex:t,topOffset:a,user:this.props.user,visibleColumns:e.props.visibleColumns,onOpenPaper:this.props.onOpenPaper,showSnippets:e.props.showSnippets,snippetRows:e.props.snippetRows,height:e.props.height,showStar:e.props.showStar,columnSizes:o?n:void 0,isBoldFileNamesEnabled:e.props.isBoldFileNamesEnabled,isUseNaturalLanguageTimeDeltasEnabled:i})))));if("UserDefinedItemRow"===e.type)return s.React$1.createElement(Li,{userDefinedItem:e.props.userDefinedItem,rowIndex:t,topOffset:a});const{selection:c}=this.props,d=e.props.file instanceof i.File?c.selected.last()===this.props.fileToId(e.props.file):c.selected.last()===e.props.file.file_id;if("FileSharedWithMeRow"===e.type)return null===(o=(n=this.props).registerListItem)||void 0===o||o.call(n,e.props.file.file_id,{top:a,height:e.props.height,left:0}),s.React$1.createElement(D.FilesViewOverrideContext.Consumer,null,(({isUseNaturalLanguageTimeDeltasEnabled:i})=>s.React$1.createElement(j.Consumer,null,(({columnSizes:n,columnResizingEnabled:o})=>s.React$1.createElement(Yt,{file:e.props.file,visibleColumns:this.props.visibleColumns,isCompactMode:e.props.isCompactMode,getOverflowMenuActions:this.props.getOverflowMenuActions,onOpenFileSharedWithMe:this.props.onOpenFileSharedWithMe,rowIndex:t,controlsFocusable:d,topOffset:a,user:this.props.user,responsive:this.props.responsive,showSnippets:e.props.showSnippets,snippetRows:e.props.snippetRows,height:e.props.height,isSelectMode:e.props.isSelectMode,isSelected:e.props.isSelected,onSelect:this.props.onSelectFile,onDeselect:this.props.onDeselectFile,isFocused:e.props.isFocused,filteredContactName:this.props.filteredContactName,iconSize:e.props.iconSize,columnSizes:o?n:void 0,isUseNaturalLanguageTimeDeltasEnabled:i})))));null===(r=(l=this.props).registerListItem)||void 0===r||r.call(l,this.props.fileToId(e.props.file),{top:a,height:e.props.height,left:0});const h={key:e.key,instanceId:this.props.instanceId,itemIndex:e.itemIndex,containerWidth:e.props.containerWidth,file:e.props.file,getOverflowMenuActions:this.props.getOverflowMenuActions,hideViewFileButton:this.props.hideViewFileButton,isActiveDropTarget:e.props.isActiveDropTarget,isAvailableDropTarget:e.props.isAvailableDropTarget,isCompactMode:e.props.isCompactMode,responsive:e.props.responsive,isExtensionsMenuDisabled:e.props.isExtensionsMenuDisabled,isFocused:e.props.isFocused,isSearchMode:e.props.isSearchMode,isSelectMode:e.props.isSelectMode,isSelected:e.props.isSelected,isSharingDisabled:e.props.isSharingDisabled,onDeselect:this.props.onDeselectFile,onDragStart:this.props.onDragStart,onDragEnter:this.props.onDragEnter,onDragEnd:this.props.onDragEnd,onLocationLinkClick:this.props.onLocationLinkClick,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,onRenameCancel:this.props.onRenameCancel,onRenameSubmit:this.props.onRenameSubmit,onSelect:this.props.onSelectFile,renameState:e.props.renameState,rowIndex:t,controlsFocusable:d,topOffset:a,user:this.props.user,visibleColumns:this.props.visibleColumns,canDisplayFolderSizes:this.props.canDisplayFolderSizes,renderSharedWithController:this.props.renderSharedWithController,hrefForFile:this.props.hrefForFile,onShowShare:this.props.onShowShare,shareButtonLabel:this.props.shareButtonLabel,showShareButton:this.props.showShareButton,filteredContactName:this.props.filteredContactName,fileToId:this.props.fileToId,isCondensedListView:e.props.isCondensedListView,isActionBarEnabled:e.props.isActionBarEnabled,expManualTagging:this.props.expManualTagging,preventSelectionOnDrag:this.props.preventSelectionOnDrag,iconSize:e.props.iconSize,isRightClickEnabled:this.props.isRightClickEnabled};return s.React$1.createElement(Mi,Object.assign({},h))}}componentDidMount(){this.props.onTTI(),this.setupKeyboardShortcuts(),this.setupExternalDragHandler()}componentWillUnmount(){this.cleanupKeyboardShortcuts(),De(this.props.keyScope)}componentDidUpdate(e){e.isActive!==this.props.isActive&&(this.props.isActive?this.setupKeyboardShortcuts():this.cleanupKeyboardShortcuts())}cleanupKeyboardShortcuts(){g.resetFilesViewKeyboardShortcuts(this.props.keyScope),g.resetFileJumpKeyboardShortcuts(this.props.keyScope)}setupKeyboardShortcuts(){const{user:e,onDelete:t,onShowRename:s,getIsFileJumping:a,onAddFileJumpKeyCode:n,onResetFileJump:o,keyScope:l,onCopyToClipboard:r,onCutToClipboard:c,onNavigateToParentFolder:d,onPasteFromClipboard:h}=this.props;g.setupFileJumpKeyboardShortcuts({scope:l,getIsFileJumping:a,onAddFileJumpKeyCode:n,onResetFileJump:o}),g.setupFilesViewKeyboardShortcuts({user:e,viewType:i.ViewType.List,getIsGlobalEvent:this.getIsGlobalEvent(),getIsItemEvent:this.getIsListEvent,getSelectedFiles:this.getSelectedFiles,isCurrentPathWriteable:this.props.getIsCurrentPathWriteable,selectAllAction:Oi,deselectAllAction:Oi,onCopyToClipboard:r,onCutToClipboard:c,onDelete:t,onFocusSearchBar:this.props.onFocusSearchBar,onNavigateToFileOrFolder:e=>this.props.onNavigateToFileOrFolder(e,{actionSource:i.ActionSourceValue.KEYBOARD}),onNavigateToParentFolder:d,onPasteFromClipboard:h,onShowRename:s,scope:l,onShowHelpMenu:()=>this.props.onOpenKeyboardShortcutModal()})}setupExternalDragHandler(){Ne(this.props.keyScope,this.getIsDraggingInternalFiles,this.getIsDraggingExternalFiles,this.props.onSetFileUploaderPath,".brws-file-row",this.getActiveDropTarget,this.props.onSetDropTarget)}getIsGlobalEvent(){return xi}render(){const{scrollPositionOffset:e,viewportTopOffset:t,focusedFileIndex:i,onRangeInView:a,scrollContainer:n,listItems:o,heights:l,itemBuffer:r}=this.props;return s.React$1.createElement(Le,{items:o,listItemHeight:l,renderRow:this.renderRow,scrollPositionOffset:e,scrollToRow:i,shouldUseWindowAsScrollContainer:!0,viewportTopOffset:t,onRangeInView:a,scrollContainer:n,itemBuffer:r,id:"files-view-table-container"})}}ki.defaultProps={isFileViewerShown:()=>!1},ki.displayName="FilesViewListComponent";const Ai=i.connect(((e,t)=>({listItems:Pe(e,t),heights:He(e,t),itemBuffer:We(e,t),isActive:i.isActiveFilesView(e,t.instanceId),isCheckboxDisabled:i.selectDisabledMultiselect(e,t),cutItems:i.selectCutItems(e,t)})))(ki),$i=({scrollContainer:e,path:t,viewType:a})=>{const n=i.useSelector(i.currentScroll),o=t=>{e&&e.current?e.current.scrollTop=t:window.scrollTo(0,t)};return s.React$1.useEffect((()=>{(()=>{if(!n)return;const{scrollTop:e}=n;o(e)})()}),[n]),s.React$1.useEffect((()=>{o(0)}),[t,a]),null};function Pi(e){const t=i.cx("tile-label-input",e.className),a=e.defaultValue||"";return s.React$1.createElement(Tt,{className:t,defaultValue:a,label:e.label,onCancel:e.onCancel,onClick:e=>{e&&(e.stopPropagation(),e.preventDefault())},onSubmit:e.onSubmit,isSearchMode:e.isSearchMode})}class Hi{constructor(e,t,i,s){this.recordTileError=e=>{const t=Math.floor(e/this.numTilesPerPage);this.pagesWithThumbErrors.has(t)||this.pagesWithThumbErrors.add(t)},this.recordTileLoaded=(e,t,i)=>{if(i){if(this.thumbsLoaded.has(e))return;this.thumbsLoaded.add(e)}else{if(this.iconsLoaded.has(e))return;this.iconsLoaded.add(e)}let s=!1;s=this.numTiles%this.numTilesPerPage==0?e>=this.numTiles-this.numTilesPerPage:e>=this.numTiles-this.numTiles%this.numTilesPerPage;let a=this.numTilesPerPage;if(s){const e=this.numTiles%this.numTilesPerPage;0!==e&&(a=e)}const n=Math.floor(e/this.numTilesPerPage);if(i||!t){const e=this.numTilesFinalizedByPage[n]||0;this.numTilesFinalizedByPage[n]=e+1}if(0===n&&this.handleTTI){!(this.iconsLoaded.has(e)&&this.thumbsLoaded.has(e))&&(this.numTilesLoadedOnFirstPage++,this.numTilesLoadedOnFirstPage===a&&this.handleTTI())}i&&(this.pagesWithThumbs.has(n)||this.pagesWithThumbs.add(n),this.anyThumbLoadedTimeByPage.get(n)||this.anyThumbLoadedTimeByPage.set(n,this.getTimeNow()),this.numTilesFinalizedByPage[n]===a&&this.allThumbsLoadedTimeByPage.set(n,this.getTimeNow()))},this.pruneTrackedPages=()=>{this.startTimeByPage.forEach(((e,t)=>{!this.pagesToLog.has(t)&&!this.pagesCompletedLogging.has(t)&&this.getTimeNow()-e>2e3&&this.startTimeByPage.delete(t)}))},this.logCompletedPages=()=>{this.pagesToLog.forEach((e=>{const t=this.startTimeByPage.get(e),i=Math.max(this.allThumbsLoadedTimeByPage.get(e),t),s=Math.max(this.anyThumbLoadedTimeByPage.get(e),t);!i||this.pagesWithThumbs.has(e)?this.pagesWithThumbErrors.has(e)?this.handlePageCompletedLogging(e):t&&i&&s&&(this.logPerfStats(e,t,s,i),this.handlePageCompletedLogging(e)):this.handlePageCompletedLogging(e)}))},this.numTiles=e,this.numTilesPerPage=t,this.numTilesFinalizedByPage=[],this.numTilesLoadedOnFirstPage=0,this.iconsLoaded=new Set,this.thumbsLoaded=new Set,this.startTimeByPage=new Map,this.allThumbsLoadedTimeByPage=new Map,this.anyThumbLoadedTimeByPage=new Map,this.pagesWithThumbErrors=new Set,this.pagesWithThumbs=new Set,this.pagesCompletedLogging=new Set,this.pagesToLog=new Set,this.handleTTI=s}getTimeNow(){return window.performance.now()}updateNumTiles(e){this.numTiles>=e||(this.numTiles=e)}handlePageCompletedLogging(e){this.pagesCompletedLogging.add(e),this.pagesToLog.delete(e),this.startTimeByPage.delete(e),this.anyThumbLoadedTimeByPage.delete(e),this.allThumbsLoadedTimeByPage.delete(e)}static logThumbLoadError(){i.JSStopwatch.recordTrace("visual_browse_thumb_load_error",{stopwatchName:"infinite_tile_grid_logging",traceTime:0})}static logThumbRTT(e){i.JSStopwatch.recordTrace("visual_browse_thumb_rtt",{stopwatchName:"infinite_tile_grid_logging",traceTime:e})}logPerfStats(e,t,s,a){i.JSStopwatch.recordTrace(`loaded_any_thumbs_page_${e}`,{stopwatchName:"infinite_tile_grid_logging",traceTime:s-t}),i.JSStopwatch.recordTrace(`loaded_all_thumbs_page_${e}`,{stopwatchName:"infinite_tile_grid_logging",traceTime:a-t})}}const Wi=()=>null,Vi=({ariaLabel:e,children:t,onClick:i})=>{if(!t)return null;const a=s.React$1.createElement("div",{className:"tile-label","aria-hidden":"true"},t);return i?s.React$1.createElement("a",{onClick:i,tabIndex:-1,"aria-label":e},a):a};Vi.displayName="TileLabel";const Bi=({leftOffset:e,tileHeight:t,tileWidth:i,thumbNode:a,labelNode:n})=>s.React$1.createElement("div",{className:"tile",style:{left:e,height:t,width:i,pointerEvents:"none"}},s.React$1.createElement("div",{className:"tile__thumb-container",style:{height:i,width:i}},a||s.React$1.createElement("div",{className:"tile__preview--placeholder"})),s.React$1.createElement(Vi,null,n));Bi.displayName="TilePlaceholder";class zi extends s.React$1.PureComponent{constructor(e){super(e),this.thumbRequestId=null,this.animationRequestIds=[],this.handleThumbnailError=()=>{const{onThumbnailError:e,tileIndex:t}=this.props;this.setState({thumbLoaded:!1}),e&&e(t)},this.logTileInteractive=()=>{const e=!!this.props.thumbnailUrl,t=this.state.thumbLoaded;if(this.props.onThumbnailLoad){const i=window.requestAnimationFrame((()=>{const i=window.requestAnimationFrame((()=>{this.props.onThumbnailLoad(this.props.tileIndex,e,t)}));this.animationRequestIds.push(i)}));this.animationRequestIds.push(i)}},this.toggleSelect=e=>{e.stopPropagation(),this.props.handleToggleSelect(e)},this.handleKeyDown=e=>{const t=e.key;e.currentTarget!==e.target||" "!==t&&t!==i.Key_enum.Key.Enter||(e.preventDefault(),this.props.onClick(e))},this.handleCheckboxChange=()=>{},this.state=Object.assign({thumbLoaded:zi.isThumbLoaded(e)},this.calcPaperTitleState(e))}componentDidMount(){this.props.delayRenderFullTile?this.renderCompleteTileTimeout=setTimeout((()=>{this.renderCompleteTileTimeout=0,this.fetchThumbnail(this.props)}),100):this.fetchThumbnail(this.props),this.logTileInteractive()}componentDidUpdate(e,t){if(!e.isFocused&&this.props.isFocused){const e=this.refs.tileContainer;e&&e.focus()}}UNSAFE_componentWillReceiveProps(e){if(e.thumbnailUrl!==this.props.thumbnailUrl&&(this.unbindThumbnailIfNeeded(),this.fetchThumbnail(e)),zi.getPaperTitle(this.props)!==zi.getPaperTitle(e)){const t=this.calcPaperTitleState(e);this.setState(t)}}static getPaperTitle(e){return e.paper?e.paper.title:null}calcPaperTitleState(e){return e.paper?{paperTitleParts:ti(e.paper,"brws-file-name-grid-icon","brws-file-name-grid-icon-emoji",!0)}:{}}componentWillUnmount(){this.unbindThumbnailIfNeeded(),this.renderCompleteTileTimeout&&clearTimeout(this.renderCompleteTileTimeout),this.animationRequestIds.forEach((e=>{window.cancelAnimationFrame(e)})),this.animationRequestIds=[]}fetchThumbnail(e){const{thumbnailUrl:t,thumbStore:i}=e;if(t){const e=Date.now();this.thumbRequestId=i.bind_url(t,{onSuccess:()=>{this.setState({thumbLoaded:!0}),Hi.logThumbRTT(Date.now()-e)},onError:()=>{this.handleThumbnailError()}})}}unbindThumbnailIfNeeded(){const{thumbStore:e}=this.props;this.thumbRequestId&&(e.unbind_url(this.thumbRequestId),this.thumbRequestId=null),this.setState({thumbLoaded:!1})}static isThumbLoaded(e){const{thumbStore:t,thumbnailUrl:i}=e;return!(!i||!t.get_thumb(i))}renderCheckbox(){let e=s.React$1.createElement(i.Checkbox,{className:"tile-checkbox","aria-label":this.props.checkboxAriaText,onClick:this.toggleSelect,onChange:this.handleCheckboxChange,tabIndex:this.props.checkboxTabIndex,checked:this.props.isSelected});return 0===this.props.tileIndex&&(e=s.React$1.createElement(i.UserEducationEffect,{containerName:"FileItemRow",name:"FirstFileSelectCheckbox"},e)),s.React$1.createElement("div",{key:"tile-select-checkbox",className:"tile-select-checkbox"},e)}renderActionNode(){return s.React$1.createElement("div",{key:"tile-action-node",className:"tile__action-button"},this.props.actionNode)}renderThumbnail(){const{thumbnailUrl:e,thumbStore:t,height:i,width:a,isSelected:n}=this.props;if(this.state.thumbLoaded){const o=t.get_thumb(e);if(o){const e=n?a-24:a,t=i||e;return s.React$1.createElement(W.LockBadge,{file:this.props.file,variant:"preview-large"},s.React$1.createElement("img",{className:"tile__preview tile__preview--thumb",draggable:!1,src:o,style:{maxHeight:t,maxWidth:e},onError:this.handleThumbnailError,alt:""}))}}return this.renderFileIcon()}renderFileIcon(){const{file:e,paper:t}=this.props;return t?this.state.paperTitleParts.icon:e?s.React$1.createElement($.FileOrFolderIcon,Object.assign({className:"tile__preview tile__preview--icon brws-file-name-grid-icon",file:e,variant:"large",showPreview:!1},{"aria-hidden":!0})):s.React$1.createElement("div",{className:"tile__preview--placeholder"})}render(){const{altText:e,file:t,height:a,href:n,isActiveDropTarget:o,isAvailableDropTarget:l,isCutToClipboard:r,isDraggable:c,isFocused:d,isSelectable:h,isSelected:p,isViewOnly:m,labelHeight:g,labelNode:f,leftOffset:S,onClick:b,onRightClick:E,onDoubleClick:_,onLabelClick:T,onDragEnter:w,onDragStart:C,onDragEnd:R,overrideTabIndex:F,width:v,className:I}=this.props,N=a||v,D=N+g;if(m)return s.React$1.createElement(Bi,{leftOffset:S,tileHeight:D,tileWidth:v,thumbNode:this.renderThumbnail(),labelNode:f});const y={left:S,height:D,width:v},M={height:N,width:v},L={className:i.cx("tile",I,{"tile--is-selected":p,"tile--is-dragover":o,"tile--is-droppable":l&&!o,"tile--is-cut":r}),"data-filename":t&&t.name,"data-campaigns-element-id":u.CampaignsElementIdEnum.BROWSE_VIEW_LIST_FILE,style:y,draggable:c,href:n,onDragEnter:w,onDragStart:C,onDragEnd:R,"aria-label":t&&t.name,role:"gridcell"},O=s.React$1.createElement("div",{className:"tile__thumb-container",style:M},this.renderThumbnail());return s.React$1.createElement("div",{role:"row",ref:"tileContainer",className:"tile__container",onKeyDown:this.handleKeyDown,tabIndex:F||d?0:-1,"aria-label":e,"aria-selected":p},s.React$1.createElement(Bt,{onClick:b,onDoubleClick:_},(e=>s.React$1.createElement("div",Object.assign({},L,{onClick:e.onClick,onContextMenu:E}),O,h&&this.renderCheckbox(),this.renderActionNode(),s.React$1.createElement(Vi,{onClick:T,ariaLabel:t&&t.name},f)))))}}zi.defaultProps={checkboxAriaText:"",checkboxTabIndex:-1,delayRenderFullTile:!0,handleToggleSelect:Wi,isFocused:!1,isSelected:!1,isViewOnly:!1,onDragEnter:Wi,onDragStart:Wi,onClick:Wi,onRightClick:Wi},zi.displayName="TileElementComponentForTests";const Ui=D.withThumbStore(zi);i.injectInternalStyle("typescript/component_libraries/files_components/src/content-tile/content-tile.module.out.css",(e=>"._contentTile_rw5i9_1:hover{cursor:pointer}._contentTile_rw5i9_1._disabled_rw5i9_5{pointer-events:none}._contentTile_rw5i9_1._disabled_rw5i9_5:hover{cursor:default}._contentTileFocused_rw5i9_13{outline:3px solid var(--dig-color__utility__focus-ring)}"));const Gi="_contentTile_rw5i9_1",Ki="_disabled_rw5i9_5",qi="_contentTileFocused_rw5i9_13";i.injectInternalStyle("typescript/component_libraries/files_components/src/content-tile/selectable-overlay.module.out.css",(e=>"._checkboxContainer_14ute_1{left:var(--spacing__base_unit);position:absolute;top:var(--spacing__unit--2);z-index:0}._starContainer_14ute_8{background-blend-mode:multiply;border:none;outline:none;position:absolute;right:var(--spacing__base_unit);top:var(--spacing__base_unit);z-index:0}._durationContainer_14ute_18{bottom:var(--spacing__base_unit);left:var(--spacing__base_unit);position:absolute;z-index:0}._duration_14ute_18{align-items:center;background:var(--dig-color__utility__overlay);border-radius:2px;color:var(--dig-color__text__base);display:flex;justify-content:center;padding:1px 5px}"));const ji="_checkboxContainer_14ute_1",Yi="_starContainer_14ute_8",Xi="_durationContainer_14ute_18",Ji="_duration_14ute_18",Zi=s.reactExports.forwardRef(((e,t)=>{var{isMobile:a=!1,onClick:n,onKeyPress:o,isDisabled:r=!1,tabIndex:c=-1,showTooltip:h=!0,identifier:u,ariaLabelledBy:p,ariaHasPopup:m,inverse:g=!1,variant:f="transparent",triggerRef:S}=e,b=l.__rest(e,["isMobile","onClick","onKeyPress","isDisabled","tabIndex","showTooltip","identifier","ariaLabelledBy","ariaHasPopup","inverse","variant","triggerRef"]);const E=i.useUniqueId({prefix:"more-options-button"}),_=d.useIntl(),T=Qi(_,u);let w=s.reactExports.createElement(i.IconButton,Object.assign({ref:t,variant:f,role:"button","aria-label":T,"aria-haspopup":m,onClick:n,onKeyPress:o,disabled:r,tabIndex:c,"data-testid":"more-options-button",id:E,"aria-labelledby":i.cx(E,p),inverse:g},b),s.reactExports.createElement(i.UIIcon,{src:a?i.MoreHorizontalLine:i.MoreVerticalLine}));return h&&(w=s.reactExports.createElement(i.Tooltip,{title:T,placement:"top",triggerRef:S},w)),w}));Zi.displayName="MoreOptionsButton";const Qi=(e,t)=>e.formatMessage({id:"vtRg71",defaultMessage:"More options{identifier, select, undefined {} other { for {identifier}}}"},{identifier:t}),es=({selectable:e,selected:t=!1,onSelect:a,starrable:n=!1,starred:o=!1,setStarred:l,showOverlay:r=!1,showDuration:c=!1,duration:h,showMenuIcon:u=!1,isMobile:p=!1,onMenuClick:m,isDisabled:g=!1,text:f,actionNode:S,isItemFocused:b=!1,renameNode:E})=>{const _=d.useIntl(),T=B.formatSecondsDuration(h),w=!r;return s.React$1.createElement(V.CardNamespace.Scrim,{isVisible:r},e&&(r||t)&&s.React$1.createElement(V.CardNamespace.Actions,{className:ji},s.React$1.createElement(i.Checkbox,{inverse:!r,onClick:e=>{e.stopPropagation(),null==a||a(e)},checked:t,tabIndex:-1,"aria-label":((e,t)=>_.formatMessage({id:"7HMxP6",defaultMessage:"check to {isSelectedString} {fileName}"},{isSelectedString:e?"unselect":"select",fileName:t}))(t,f),onChange:()=>{}})),p&&!E?u&&s.React$1.createElement(V.CardNamespace.Actions,{className:Yi},S?s.React$1.createElement(s.React$1.Fragment,null,S):s.React$1.createElement(Zi,{onClick:e=>{e.stopPropagation(),null==m||m()},onKeyPress:e=>{e.stopPropagation(),null==m||m()},showTooltip:!0,isDisabled:g,inverse:!r,variant:r?"transparent":"filled",isMobile:p,identifier:f})):n&&!p&&(r||o||t&&b)&&s.React$1.createElement(V.CardNamespace.Actions,{className:Yi},s.React$1.createElement(B.StarButton,{isStarred:o,ariaLabelledBy:"",onClick:e=>{e.stopPropagation(),null==l||l(!o)},inverse:w,variant:"transparent",identifier:f,tabIndex:b?0:-1})),c&&T&&s.React$1.createElement(V.CardNamespace.Actions,{className:Xi},s.React$1.createElement("div",{className:Ji,"data-testid":"duration"},s.React$1.createElement(i.Text,{size:"xsmall"},T))))};i.injectInternalStyle("typescript/component_libraries/files_components/src/content-tile/content-tile-content.module.out.css",(e=>"._cardContent_1p417_1 svg{min-width:42px}._smallLine_1p417_5{font-size:12px}._titleButton_1p417_9{color:var(--dig-color__text__base)}._titleButton_1p417_9:hover{text-decoration:underline}._titleButton_1p417_9._disabled_1p417_17:hover{text-decoration:none}"));const ts="_cardContent_1p417_1",is="_titleButton_1p417_9",ss="_disabled_1p417_17",as=({text:e,subtext:t,showMenuIcon:a=!1,isMobile:n=!1,size:o="small",onMenuClick:l,isDisabled:r=!1,starrable:c=!1,starred:d=!1,setStarred:h,containerWidth:u,actionNode:p,onTitleClick:g,renameNode:f})=>{const S=n?48:64,b={display:"flex",alignItems:"center",justifyContent:f?"center":"space-between",columnGap:"var(--spacing__base_unit)",height:S,maxHeight:S,margin:0,marginLeft:8},E={auto:!0,placement:"bottom"},_=(()=>{if(!u)return;let e=u-16;return n?e-=c&&d?44:16:n||(e-=a?44:0),e})(),T=i.cx(is,{[ss]:r});return s.React$1.createElement(V.CardNamespace.Content,{paddingTop:"0",paddingBottom:"0"},s.React$1.createElement("div",{style:b,className:ts},f||s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(m.LabelGroup,{withText:s.React$1.createElement("a",{onClick:e=>{e.stopPropagation(),r||null==g||g(e)},className:T,tabIndex:-1,style:{width:_,display:"block"}},s.React$1.createElement(z.Truncate,{maxWidth:_,tooltipControlProps:E,location:.5},e)),withSubtext:s.React$1.createElement(z.Truncate,{maxWidth:_,tooltipControlProps:E,location:.5},t),size:o}),n?c&&d&&s.React$1.createElement(B.StarButton,{isStarred:d,ariaLabelledBy:"",onClick:e=>{e.stopPropagation(),null==h||h(!d)},identifier:e}):a?p?s.React$1.createElement(s.React$1.Fragment,null,p):s.React$1.createElement(Zi,{onClick:e=>{e.stopPropagation(),null==l||l()},onKeyPress:e=>{e.stopPropagation(),null==l||l()},showTooltip:!0,isDisabled:r,identifier:e,variant:"transparent"}):void 0)))},ns={"folder-large":i.FolderBaseDefaultLarge,"folder-small":i.FolderBaseDefaultSmall,"folder_app-large":i.FolderAppDefaultLarge,"folder_app-small":i.FolderAppDefaultSmall,"folder_camera_upload-large":i.FolderCameraUploadDefaultLarge,"folder_camera_upload-small":i.FolderCameraUploadDefaultSmall,"folder_confidential-large":i.FolderConfidentialDefaultLarge,"folder_confidential-small":i.FolderConfidentialDefaultSmall,"folder_confidential_admin_view-large":i.FolderConfidentialDefaultLarge,"folder_confidential_admin_view-small":i.FolderConfidentialDefaultSmall,"folder_dropbox-large":i.FolderDropboxDefaultLarge,"folder_dropbox-small":i.FolderDropboxDefaultSmall,"folder_dropdown-small":i.FolderBaseDefaultSmall,"folder_dropdown-large":i.FolderBaseDefaultLarge,"folder_project-small":i.FolderBaseDefaultSmall,"folder_project-large":i.FolderBaseDefaultLarge,"folder_se_mac-large":i.FeatureMacLarge,"folder_se_mac-small":i.FeatureMacSmall,"folder_shared-large":i.FolderSharedDefaultLarge,"folder_shared-small":i.FolderSharedDefaultSmall,"folder_shared_read_only-large":i.FolderSharedDefaultLarge,"folder_shared_read_only-small":i.FolderSharedDefaultSmall,"folder_space-large":i.FolderBaseDefaultLarge,"folder_space-small":i.FolderBaseDefaultSmall,"folder_space_read_only-large":i.FolderBaseDefaultLarge,"folder_space_read_only-small":i.FolderBaseDefaultSmall,"folder_team-large":i.FolderTeamDefaultLarge,"folder_team-small":i.FolderTeamDefaultSmall,"folder_team_locked-large":i.FolderTeamReadOnlyLarge,"folder_team_locked-small":i.FolderTeamReadOnlySmall,"folder_team_member-large":i.FolderTeamMemberDefaultLarge,"folder_team_member-small":i.FolderTeamMemberDefaultSmall,"folder_team_member_child-large":i.FolderBaseDefaultLarge,"folder_team_member_child-small":i.FolderBaseDefaultSmall,"folder_team_read_only-large":i.FolderTeamReadOnlyLarge,"folder_team_read_only-small":i.FolderTeamReadOnlySmall,"folder_user-large":i.FolderSharedDefaultLarge,"folder_user-small":i.FolderSharedDefaultSmall,"folder_user_locked-large":i.FolderSharedDefaultLarge,"folder_user_locked-small":i.FolderSharedDefaultSmall,"folder_user_no_access-large":i.FolderConfidentialDefaultLarge,"folder_user_no_access-small":i.FolderConfidentialDefaultSmall},os=e=>{const t=e.length,i=e.lastIndexOf("_",t);return parseInt(e.substring(i+1),10)?e.substring(0,i):e};i.injectInternalStyle("typescript/component_libraries/files_components/src/content-tile/thumbnail.module.out.css",(e=>"._background_1wmrh_1{background-color:var(--dig-color__opacity__surface)}._thumbnailCenter_1wmrh_5{align-items:center;display:flex;justify-content:center;padding:var(--spacing__unit--2)}._thumbnailLandscape_1wmrh_12{padding:var(--spacing__unit--4) var(--spacing__unit--2)}._thumbnailPortrait_1wmrh_16{padding:var(--spacing__unit--2) var(--spacing__unit--4)}._imgContain_1wmrh_20{max-height:100%;max-width:100%;object-fit:contain}"));const ls="_background_1wmrh_1",rs="_thumbnailCenter_1wmrh_5",cs="_thumbnailLandscape_1wmrh_12",ds="_thumbnailPortrait_1wmrh_16",hs="_imgContain_1wmrh_20";var us;!function(e){e.Landscape="landscape",e.Portrait="portrait",e.Square="square"}(us||(us={}));const ps=({imgSource:e,imgLabel:t,extension:a,icon:n,isLoading:o,isMobile:l})=>{let r,c=a;const[d,h]=s.reactExports.useState(void 0);if(""===a.trim()&&(null==n?void 0:n.startsWith("folder"))){const e=((e,t)=>{const s=`${os(e)}-${t}`;return s in ns?ns[s]:s.startsWith("folder")&&s.endsWith("large")?i.FolderBaseDefaultLarge:s.startsWith("folder")&&s.endsWith("small")?i.FolderBaseDefaultSmall:void 0})(n,"large");r=null==e?void 0:e({})}else if(a.startsWith(".")){const e=a.split(".");c=e[e.length-1]}const u=!!r,p=!o&&!!e&&!u,m=!o&&!e&&!u,g=i.cx(ls,rs,{[cs]:!l&&d===us.Landscape,[ds]:!l&&d===us.Portrait});return s.React$1.createElement("div",{className:g,"aria-hidden":!0},o?s.React$1.createElement(i.Spinner,{size:"medium","aria-hidden":!0}):s.React$1.createElement(s.React$1.Fragment,null,p&&s.React$1.createElement("img",{src:e,alt:t,className:hs,"aria-hidden":!0,onLoad:e=>{const{width:t,height:i}=e.currentTarget,s=((e,t)=>e>t?us.Landscape:e<t?us.Portrait:us.Square)(t,i);h(s)}}),u&&s.React$1.createElement(s.React$1.Fragment,null,r),m&&s.React$1.createElement(i.FileIcon$1,{extension:c,size:"large","aria-hidden":!0})))},ms=({extension:e="",text:t,icon:a,imgSource:n,imgLabel:o,duration:l,subtext:r,selectable:c,selected:d=!1,starrable:h=!1,starred:u=!1,setStarred:p,onMenuClick:m,isDisabled:g=!1,isLoading:f=!1,isMobile:S=!1,containerWidth:b,onSelect:E,actionNode:_,isContainerFocused:T=!1,isItemFocused:w=!1,onTitleClick:C,renameNode:R})=>{const[F,v]=s.reactExports.useState(!1);let I=e;if(""===e&&!(null==a?void 0:a.startsWith("folder"))){const e=t.split(".").pop();I=e||""}const N=g?void 0:e=>null==E?void 0:E(e),D=g?{isDisabled:!0}:{isSelected:!T&&d},y=s.reactExports.useRef(!1),M=i.cx(Gi,{[qi]:T,[Ki]:g});return s.React$1.createElement(V.CardNamespace,Object.assign({className:M,onFocusWithin:()=>{y.current=!0,v(!0)},onBlurWithin:()=>{y.current=!1,v(!1)},onMouseEnter:()=>{v(!0)},onMouseLeave:()=>{v(!1)},onTouchStart:()=>{v(!0)},onTouchEnd:()=>{v(!1)},isLink:!0,onClick:N},D),s.React$1.createElement(V.CardNamespace.Media,{ratio:4/3,withOverlay:!g&&s.React$1.createElement(es,{showOverlay:F,selectable:c,selected:d,onSelect:E,starred:u,setStarred:p,starrable:h,duration:l,showDuration:!!l,isMobile:S,showMenuIcon:!0,onMenuClick:m,isDisabled:g,text:t,actionNode:_,isItemFocused:w,renameNode:R})},s.React$1.createElement(ps,{imgSource:n,imgLabel:o,extension:I,icon:a,isLoading:f,isMobile:S})),s.React$1.createElement(as,{text:t,subtext:r,showMenuIcon:!0,onMenuClick:g?void 0:m,isDisabled:g,starrable:!g&&h,starred:u,setStarred:p,isMobile:S,containerWidth:b,actionNode:_,onTitleClick:g?void 0:C,renameNode:R}))};const gs=()=>null,fs=({ariaLabel:e,children:t,onClick:i})=>{if(!t)return null;const a=s.React$1.createElement("div",{className:"tile-label","aria-hidden":"true"},t);return i?s.React$1.createElement("a",{onClick:i,tabIndex:-1,"aria-label":e},a):a};fs.displayName="TileLabel";const Ss=({leftOffset:e,tileHeight:t,tileWidth:i,thumbNode:a,labelNode:n})=>s.React$1.createElement("div",{className:"tile",style:{left:e,height:t,width:i,pointerEvents:"none"}},s.React$1.createElement("div",{className:"tile__thumb-container",style:{height:i,width:i}},a||s.React$1.createElement("div",{className:"tile__preview--placeholder"})),s.React$1.createElement(fs,null,n));Ss.displayName="ContentTilePlaceholder";const bs=({file:e,paper:t,labelNode:a,altText:n,onClick:o,onRightClick:l,onDoubleClick:r,height:c,width:d,leftOffset:h,tileIndex:p,labelHeight:m,actionNode:g,isDraggable:f,onDragEnter:S,onDragStart:b,onDragEnd:E,isSelectable:_,isSelected:T,isFocused:w,isViewOnly:C,isActiveDropTarget:R,isAvailableDropTarget:F,handleToggleSelect:v,href:I,overrideTabIndex:N,isCutToClipboard:D,className:y,contentTileMetadata:M,thumbStore:L,isMobile:O=!1,onHeightChange:x,onThumbnailLoad:k,updateSelection:A,renameNode:$,isRenameInProgress:P})=>{const H=s.reactExports.useRef(null),[W,V]=s.reactExports.useState(!0),[B,z]=s.reactExports.useState(),G=s.reactExports.useRef(null),[K,q]=s.reactExports.useState(!1),j=s.reactExports.useRef(!0),Y=s.reactExports.useRef(null),{itemId:X="",type:J=i.HOME_RESOURCE_ID_TYPE.UNKNOWN,itemName:Z="",size:Q,isDir:ee,preview:te,thumbnailUrl:ie,icon:se,starrable:ae,extension:ne,isDisabled:oe}=null!=M?M:{},le=i.useSelector((e=>i.getIsStarred(e,X))),re=i.useDispatch(),ce=e=>{M&&(((e,t)=>{const s={actionSurface:"browse_screen",actionElement:"content_tile"};(null==e?void 0:e.isDir)?t?i.logEvent({class:"filesystem_item_actions",action:"star",object:"folder",properties:s}):i.logEvent((a=s,{class:"filesystem_item_actions",action:"unstar",object:"folder",properties:a})):t?i.logEvent(i.PAP_Star_File(s)):i.logEvent(U.PAP_Unstar_File(s));var a})(M,e),re(i.updateStarredStatus({id:X,idType:J,newStatus:e,itemName:Z,showSnackbar:!0})))};let de,he,ue;if(de=".web"===ne||".url"===ne?I:ee?void 0:i.format_bytes(null!=Q?Q:0),null==te?void 0:te.content){const e="video"===te.content[".tag"]||"audio"===te.content[".tag"]?te.content:void 0;e&&(he=e.duration,ue=e.transcode_url)}s.reactExports.useEffect((()=>()=>{pe(),j.current=!1}),[]),s.reactExports.useEffect((()=>{ie?G.current=L.bind_url(ie,{onSuccess:()=>{j.current&&(z(ie),V(!1),null==k||k())},onError:()=>{j.current&&(V(!1),null==k||k())}}):se&&!ie&&j.current&&(V(!1),null==k||k())}),[se,ie,L]),s.reactExports.useEffect((()=>{if(P)return;const t=H.current;if(t){q(!1),w&&t.focus({preventScroll:!0});const s=new MutationObserver((t=>{t.forEach((t=>{"attributes"===t.type&&"class"===t.attributeName&&t.target.classList.contains("focus-visible")&&t.target.ariaLabel===n&&(null==e?void 0:e.fq_path)?(0!==p||w||A([e.fq_path],i.ActionSourceValue.KEYBOARD,!0),q(!0)):q(!1)}))}));return s.observe(t,{attributes:!0,attributeFilter:["class"]}),()=>{s.disconnect()}}}),[w,p,n,e,A]),s.reactExports.useEffect((()=>{if(Y.current&&Y.current.firstElementChild){const e=Y.current.firstElementChild.clientHeight;x(e)}}),[x,d]);const pe=()=>{G.current&&(L.unbind_url(G.current),G.current=null)},me=(c||d)+m;if(C)return s.React$1.createElement(Ss,{leftOffset:h,tileHeight:me,tileWidth:d,labelNode:a});const ge={left:h,height:me,width:d},fe={className:i.cx("tile",y,{"tile--is-selected":T,"tile--is-dragover":R,"tile--is-droppable":F&&!R,"tile--is-cut":D}),"data-filename":e&&e.name,"data-campaigns-element-id":u.CampaignsElementIdEnum.BROWSE_VIEW_LIST_FILE,style:ge,draggable:f,href:I,onDragEnter:S,onDragStart:b,onDragEnd:E,"aria-label":e&&e.name,role:"gridcell"};return s.React$1.createElement("div",{role:"row",ref:H,className:"tile__container",onKeyDown:e=>{const t=e.key,s=H.current;"Tab"!==t&&s&&(s.classList.remove("focus-visible"),s.removeAttribute("data-focus-visible-added")),e.currentTarget!==e.target||" "!==t&&t!==i.Key_enum.Key.Enter||!r||(e.preventDefault(),r(e))},tabIndex:oe||!N&&!w?-1:0,"aria-label":n,"aria-selected":T,"data-testid":"content-tile-container"},s.React$1.createElement(Bt,{onClick:oe?void 0:o,onDoubleClick:oe?void 0:r},(t=>{var i;return s.React$1.createElement("div",Object.assign({},fe,{ref:e=>{Y.current=e},onClick:t.onClick,onContextMenu:oe?e=>{e.stopPropagation()}:l}),s.React$1.createElement(ms,{extension:null!=ne?ne:"",selectable:_,selected:T,onSelect:v,starred:le,setStarred:ce,starrable:ae,text:null!==(i=null==M?void 0:M.name)&&void 0!==i?i:"",containerWidth:d,subtext:de,isLoading:W,imgSource:B,videoSrc:ue,duration:he,icon:null==e?void 0:e.icon,isMobile:O,actionNode:g,isContainerFocused:!oe&&K,isItemFocused:!oe&&w,onTitleClick:r,isDisabled:oe,renameNode:$}))})))};bs.displayName="ContentTileElementComponentForTests",bs.defaultProps={handleToggleSelect:gs,isFocused:!1,isSelected:!1,isViewOnly:!1,onDragEnter:gs,onDragStart:gs,onClick:gs,onRightClick:gs};const Es=D.withThumbStore(bs);function _s({className:e,label:t}){return e=i.cx("tile-label__text",e),s.React$1.createElement("div",{className:e},t)}class Ts extends s.React$1.PureComponent{constructor(e){var t;if(super(e),this.tileIndexToRowIndex=[],this.rowHeights=[],this.ttiReported=!1,this.itemRangeByRow=[],this.tileLoadLogger=null,this.updateLayout=()=>{this.animationFrameRequestId=window.requestAnimationFrame((()=>{const e=this.getAndUpdateTileLayout();this.props.logTileLoading&&!this.tileLoadLogger&&this.setupTileLogging(this.getRowHeight(),e.tilesPerRow)}))},this.updateScroll=e=>{const{scrollToIndex:t,scrollIntoView:i,scrollPositionOffset:s}=this.props;if(void 0!==t&&i){const a=this.tileIndexToRowIndex[t],n=this.rowHeights.slice(0,a).reduce(((e,t)=>e+t),s);i({top:n,bottom:n+this.rowHeights[a]},e)}},this.handleContentTileHeightChange=e=>{this.setState({contentTileHeight:e})},this.getAndUpdateTileLayout=()=>{const e=this.props.maxTileWidth+this.props.tilePadding,t=s.reactDomExports.findDOMNode(this);if(!t||0===t.clientWidth)return{tileWidth:this.state.tileWidth,tilesPerRow:this.props.tilesPerRow};const a=t.clientWidth;let n=Math.max(1,Math.floor(a/e)),o=this.props.maxTileWidth;return a%e>1&&(n++,o=a/n-this.props.tilePadding,this.state.contentTilesOnOutOfSearchOrOverridden&&!this.props.isMobile&&(o=this.props.maxTileWidth===i.ContentTileConstants.SMALL_GRID_VIEW_MAX_WIDTH?Math.max(i.ContentTileConstants.SMALL_GRID_VIEW_MIN_WIDTH,o):Math.max(i.ContentTileConstants.LARGE_GRID_VIEW_MIN_WIDTH,o),o*n+this.props.tilePadding*(n-1)>a&&(n--,o=(a-this.props.tilePadding*(n-1))/n-this.props.tilePadding))),this.state.tileWidth!==o&&this.setState({tileWidth:o}),this.props.tilesPerRow!==n&&this.props.onTilesPerRowChange(n),{tileWidth:o,tilesPerRow:n}},this.handleTTI=()=>{this.ttiReported=!0;const{handleTTI:e}=this.props;e&&e()},this.setLastViewedPage=e=>{if(!this.tileLoadLogger)return;const t=document.documentElement.scrollTop||document.body.scrollTop,i=Math.round(t/e);if(this.tileLoadLogger.pruneTrackedPages(),this.tileLoadLogger.logCompletedPages(),!this.tileLoadLogger.pagesCompletedLogging.has(i)&&!this.tileLoadLogger.pagesToLog.has(i))if(i!==this.tileLoadLogger.lastViewedPage){if(this.tileLoadLogger.lastViewedPage=i,this.tileLoadLogger.pageChangeTime=this.tileLoadLogger.getTimeNow(),!this.tileLoadLogger.startTimeByPage.get(i)){const e=this.tileLoadLogger.getTimeNow();this.tileLoadLogger.startTimeByPage.set(i,e)}}else{this.tileLoadLogger.getTimeNow()-this.tileLoadLogger.pageChangeTime>1e3&&this.tileLoadLogger.pagesToLog.add(i)}},this.logTileError=e=>{this.tileLoadLogger&&this.tileLoadLogger.recordTileError(e),this.props.logTileLoading&&Hi.logThumbLoadError()},this.logTileLoaded=(e,t,i)=>{this.tileLoadLogger&&this.tileLoadLogger.recordTileLoaded(e,t,i)},this.renderTileElement=(e,t,a,n)=>{var o,l,r,c;if(e<0||e>this.props.totalNumItems)return null;const d=this.props.getTileItem(e,a);if(!d)return s.React$1.createElement(Bi,{leftOffset:t,tileHeight:this.state.tileWidth,tileWidth:this.state.tileWidth});const h=this.ttiReported&&this.props.delayRenderFullTile,u=d.isSelectable&&!!this.props.selectedIds&&this.props.selectedIds.has(d.id),p=d.file&&this.props.shouldFileBeHighlightedDropTarget(d.file,u),m=p&&d.file===this.props.activeDropTarget;let g,S="";d.fileSharedWithMe?(S=d.fileSharedWithMe.file_id,g={type:d.fileSharedWithMe.type,icon:d.fileSharedWithMe.icon,fq_path:`/${d.fileSharedWithMe.filename}`,thumbnail_url_tmpl:d.fileSharedWithMe.thumbnail_url_tmpl,name:d.fileSharedWithMe.filename}):d.file&&(S=d.file.fq_path,g={type:d.file.type,icon:d.file.icon,fq_path:d.file.fq_path,thumbnail_url_tmpl:d.file.thumbnail_url_tmpl,name:i.filename(d.file.fq_path),isDeleted:d.file.isDeleted,is_locked:d.file.is_locked,is_lockholder:d.file.is_lockholder,lockholder_name:d.file.lockholder_name,lock_info:d.file.lock_info});const b=d.labelNode?this.state.labelHeight:0;null===(l=(o=this.props).registerSelectableTile)||void 0===l||l.call(o,S,{top:n,left:t,width:this.state.tileWidth,height:b+this.state.tileWidth});const E=0===e&&this.props.selectedIds&&0===this.props.selectedIds.size;let _;if(this.state.contentTilesOnOutOfSearchOrOverridden){if(d.file){const e=!(d.file instanceof i.File)||i.File.isNoAccessSharedFolder(d.file);_={name:i.filename(d.file.fq_path),extension:d.file.ext,preview:(null===(r=d.file)||void 0===r?void 0:r.browse_preview)||(null===(c=d.file)||void 0===c?void 0:c.preview),size:d.file.bytes,isDir:d.file.is_dir,thumbnailUrl:d.thumbnailUrl,icon:d.file.icon,itemId:d.itemId,itemName:d.itemName,type:d.type,descendantsCount:d.file.descendants_count,starrable:!e,isDisabled:"ON"===f.CONTENT_TILES_DISABLED_TILE?e:void 0}}return s.React$1.createElement(Es,{file:g,paper:d.paper,key:d.id,contentTileMetadata:_,onClick:d.onClick,onRightClick:d.onRightClick,onDoubleClick:d.onDoubleClick,width:this.state.tileWidth,leftOffset:t,tileIndex:e,labelHeight:b,actionNode:d.actionNode,labelNode:d.labelNode,renameNode:d.renameNode,altText:d.altText,isDraggable:d.isDraggable,onDragEnter:d.onDragEnter,onDragStart:d.onDragStart,onDragEnd:d.onDragEnd,isFocused:d.isFocused,isSelectable:d.isSelectable,isSelected:u,isViewOnly:d.isViewOnly,isActiveDropTarget:m,isAvailableDropTarget:p,handleToggleSelect:d.handleToggleSelect,href:d.href,overrideTabIndex:E,isCutToClipboard:d.isCutToClipboard,className:d.className,isMobile:this.props.isMobile,onHeightChange:this.handleContentTileHeightChange,onThumbnailLoad:this.props.handleTTI,updateSelection:this.props.updateSelection,isRenameInProgress:this.props.isRenameInProgress})}return s.React$1.createElement(Ui,{file:g,paper:d.paper,key:d.id,onClick:d.onClick,onRightClick:d.onRightClick,onDoubleClick:d.onDoubleClick,onLabelClick:d.onLabelClick,width:this.state.tileWidth,leftOffset:t,tileIndex:e,labelHeight:b,delayRenderFullTile:h,actionNode:d.actionNode,thumbnailUrl:d.thumbnailUrl,labelNode:d.labelNode,altText:d.altText,onThumbnailError:this.props.logTileLoading?this.logTileError:void 0,onThumbnailLoad:this.props.logTileLoading?this.logTileLoaded:void 0,isDraggable:d.isDraggable,onDragEnter:d.onDragEnter,onDragStart:d.onDragStart,onDragEnd:d.onDragEnd,isFocused:d.isFocused,isSelectable:d.isSelectable,isSelected:u,isViewOnly:d.isViewOnly,isActiveDropTarget:m,isAvailableDropTarget:p,handleToggleSelect:d.handleToggleSelect,checkboxAriaText:d.checkboxAriaText,checkboxTabIndex:d.isCheckboxFocusable?0:-1,href:d.href,overrideTabIndex:E,isCutToClipboard:d.isCutToClipboard,className:d.className})},this.renderRow=(e,t,i)=>{const a=this.getRowHeight(t);let n;if(!e)return s.React$1.createElement(H.CulledItem,{className:this.props.rowClass,height:a,key:t,tagName:"div",topOffset:i});if(!Array.isArray(e))return s.React$1.createElement(H.CulledItem,{className:this.props.rowClass,height:a,key:t,tagName:"div",topOffset:i},e);const[o,l]=e,r=this.state.tileWidth+this.props.tilePadding,c=[];let d=this.state.contentTilesOnOutOfSearchOrOverridden&&this.props.isMobile?0:4;for(let e=o;e<l;e++)c.push(this.renderTileElement(e,d,c.length,i)),d+=r;return this.state.contentTilesOnOutOfSearchOrOverridden&&this.props.isMobile&&(n={right:"12px"}),s.React$1.createElement(H.CulledItem,{className:this.props.rowClass,height:a,key:t,tagName:"div",topOffset:i,style:n},c)},this.handleRangeInView=function(e){let t=null;return(...i)=>{if(!t||t.length!==i.length||!t.every(((e,t)=>e===i[t])))return t=i,e(...i)}}(((e,t)=>{const{onRangeInView:i}=this.props;if(!i)return;if(0===this.props.totalNumItems)return;const[s,a]=this.translateRowRangeToItemRange(e,t);isNaN(s)||isNaN(a)||i(s,a)})),this.props.sectionLabels||this.props.sectionStartIndices){if(!this.props.sectionLabels||!this.props.sectionStartIndices)throw new Error("Included only one of `sectionLabels` or `sectionStartIndices`.");if(this.props.sectionLabels.length!==this.props.sectionStartIndices.length)throw new Error("sectionLabels and sectionStartIndices must be of same length.")}const a="ON"===f.CONTENT_TILES&&(!this.props.isSearchMode||"ON"===f.CONTENT_TILES_SEARCH),n=a?0:64;this.state={tileWidth:this.props.maxTileWidth,contentTileHeight:0,labelHeight:null!==(t=this.props.labelHeight)&&void 0!==t?t:n,contentTilesOnOutOfSearchOrOverridden:a},i.JSStopwatch.create_stopwatch_if_not_exist("infinite_tile_grid_logging"),this.resizeObserver=new P.index(this.updateLayout)}componentDidMount(){window.addEventListener("resize",this.updateLayout),this.updateLayout(),this.updateScroll(!0);const e=document.querySelector(".maestro-secondary-sidebar-v2");e&&this.resizeObserver.observe(e)}componentDidUpdate(e){this.tileLoadLogger&&this.tileLoadLogger.updateNumTiles(this.props.totalNumItems),e.scrollToIndex!==this.props.scrollToIndex&&this.updateScroll(void 0===e.scrollToIndex||e.scrollToIndex<0),e.maxTileWidth!==this.props.maxTileWidth&&this.updateLayout()}componentWillUnmount(){this.resizeObserver.disconnect(),window.removeEventListener("resize",this.updateLayout),this.animationFrameRequestId&&window.cancelAnimationFrame(this.animationFrameRequestId),this.tileLoadLogger&&(clearInterval(this.logTrackingInterval),this.tileLoadLogger=null)}getRowHeight(e){if(void 0!==e&&this.rowHeights)return this.rowHeights[e];let t=this.state.tileWidth+this.props.tilePadding;return this.state.contentTilesOnOutOfSearchOrOverridden&&(t=this.state.contentTileHeight+this.props.tilePadding),this.props.showLabels&&(t+=this.state.labelHeight+4),t}getPageHeight(){const e=(document.documentElement.clientHeight||window.outerHeight)-(this.props.contentOffset||0),t=this.getRowHeight(),i=t*Math.ceil(e/t);return Math.max(i,t)}setupTileLogging(e,t){const i=this.getPageHeight(),s=t*Math.ceil(i/e);this.tileLoadLogger=new Hi(this.props.totalNumItems,s,t,this.handleTTI),this.tileLoadLogger.pagesToLog.add(0);const a=this.tileLoadLogger.getTimeNow();this.tileLoadLogger.startTimeByPage.set(0,a),this.logTrackingInterval=setInterval(this.setLastViewedPage,200,i)}translateRowRangeToItemRange(e,t){const{itemRangeByRow:i}=this;return[i[e][0],i[t][1]]}render(){this.itemRangeByRow=[],this.rowHeights=[],this.tileIndexToRowIndex=[];const e=[],t=this.getRowHeight(),{containerClass:i,enableMaxHeightGrouping:a,numThresholdRows:n,scrollDeltaThreshold:o,sectionStartIndices:l,sectionLabels:r,totalNumItems:c,window:d}=this.props;if(l&&l.length>0)l.forEach(((i,a)=>{let n=c;a!==l.length-1&&(n=l[a+1]),this.rowHeights.push(32);const o=n-i,d=Math.ceil(o/this.props.tilesPerRow),h=r[a],u=s.React$1.createElement("div",{className:"tile-section-header",role:"heading","aria-level":2},h);e.push(u),this.itemRangeByRow.push([i,i]);for(let s=0;s<d;s++){const a=i+s*this.props.tilesPerRow,o=Math.min(a+this.props.tilesPerRow,n),l=[a,o];e.push(l),this.itemRangeByRow.push(l);for(let e=a;e<o;e++)this.tileIndexToRowIndex.push(this.rowHeights.length);this.rowHeights.push(t)}}));else{const i=Math.ceil(c/this.props.tilesPerRow);for(let s=0;s<i;s++){const i=s*this.props.tilesPerRow,a=Math.min(i+this.props.tilesPerRow,c),n=[i,a];e.push(n),this.itemRangeByRow.push(n);for(let e=i;e<a;e++)this.tileIndexToRowIndex.push(this.rowHeights.length);this.rowHeights.push(t)}}return s.React$1.createElement(H.CulledList,{enableMaxHeightGrouping:a,items:e,listItemHeight:this.rowHeights,itemBuffer:n,className:i,renderRow:this.renderRow,scrollThreshold:o,shouldUseWindowAsScrollContainer:!0,onRangeInView:this.handleRangeInView,tagName:"div",window:d})}}function ws(e){e.stopPropagation()}Ts.defaultProps={enableMaxHeightGrouping:!1,numThresholdRows:10,tilePadding:16,tileHeight:160,maxTileWidth:160,logTileLoading:!1,scrollDeltaThreshold:1,showLabels:!0,getTileItem:()=>null,handleTTI:()=>{}},Ts.displayName="InfiniteTileGrid";class Cs extends s.React$1.PureComponent{render(){const{fileRename:e,user:t,item:a,createRenameCancelHandler:n,createRenameSubmitHandler:o}=this.props;let l;if(l=a instanceof i.File?i.filename(a.fq_path):a instanceof i.FileSharedWithMe?a.filename:a instanceof i.Paper?a.title:a.name,a instanceof i.File&&e&&i.paths_are_equal(e.file.fq_path,a.fq_path)){if(e.state===i.RenameState.PENDING_INPUT)return s.React$1.createElement(Pi,{defaultValue:l,label:l,onCancel:n(a),onSubmit:o(a)});if(e.state===i.RenameState.SAVING_INPUT)return s.React$1.createElement(_s,{className:"tile-label__text--saving",label:d.intl.formatMessage({id:"OefYpa",defaultMessage:"Renaming…"})})}const r=i.Emstring.em_snippet(l,14,.5),c=a instanceof i.File&&!i.File.isNoAccessSharedFolder(a);let h=s.React$1.createElement(_s,{key:"label",label:r});if(l!==r){const e=l.length<=i.FILE_NAME_TOOLTIP_MAX_LINE_LENGTH?l:s.React$1.createElement("div",{className:"tile-label-tooltip"},l);h=s.React$1.createElement(v.TitleBubble,{content:e,position:I.StickyPosition.BOTTOM,className:"tile-label__title-bubble",key:"tooltip"},h)}const u=s.React$1.createElement(St,{item:a,user:t,className:"tile-star",key:"tileStar",tabIndex:-1});return s.React$1.createElement("span",null,[h,c&&!e&&u])}}Cs.displayName="TileLabel";class Rs extends s.React$1.PureComponent{constructor(){super(...arguments),this.tileGridRef=s.React$1.createRef(),this.state={inSelectMode:!1,selectedIds:i.immutableExports.Set(),menuOpenId:void 0},this.createRenameCancelHandler=e=>()=>{this.props.onRenameCancel(e)},this.createRenameSubmitHandler=e=>t=>{this.props.onRenameSubmit(e,t)},this.logOverflowMenuOpen=()=>{const{selectedFiles:e,user:t,viewType:s}=this.props,a=e?e.count((e=>e.is_dir)):0,n=e?e.count()-a:0;i.logContextMenuClick({uid:t.id,viewType:s,action_surface:i.ActionSurfaceLogValue.CENTER_PANE,numFilesSelected:n,numFoldersSelected:a})},this.hrefForItem=(e,t)=>t instanceof i.File?this.props.hrefForFile(e,t):t instanceof i.FileSharedWithMe?t.href:t.url,this.getTileItem=(e,t)=>{const{activeDropTarget:s,isCreateFolderUIActive:a,isPhotosPage:n,items:o,selection:l,user:r,viewType:c,focusedFileIndex:h,disabledMultiselect:u,cutItems:p}=this.props,{menuOpenId:m}=this.state,{inSelectMode:g}=this.state;if(a){if(0===e)return this.getCreateFolderTile();e-=1}const S=o.get(e);if(!S){const t=`Placeholder ${e}`;return{altText:t,id:t,isViewOnly:!0,isDraggable:!1,isSelectable:!1}}const b=i.isFile(S)||i.isFswm(S),E=S,_=g&&b,T=h===e,w=_&&l.selected.some((e=>E instanceof i.FileSharedWithMe?E.file_id===e:E.fq_path===e)),C=this.createToggleSelectHandler(E,w),R=this.createRightClickSelectHandler(E,w),F=this.createClickHandler({item:S,inSelectModeAndIsFile:_,toggleSelectHandler:C}),v=this.createRightClickHandler({item:S,rightClickSelectHandler:R}),I=this.createViewFileHandler(S,i.ActionSourceValue.ROW_DOUBLE_CLICK),N=this.createViewFileHandler(S,i.ActionSourceValue.ROW_TITLE),D=i.isFile(S)?this.renderTileOverflowMenu(S,n,T,"ON"===f.CONTENT_TILES_DISABLED_TILE&&i.File.isNoAccessSharedFolder(S)):void 0,y=this.renderLabelElement(e),M=this.renderRenameInput(S),L=function(e){let t=e instanceof i.File?i.filename(e.fq_path):i.isFswm(e)?e.filename:e instanceof i.Paper?e.title:e.name;if(e instanceof i.File)switch(e.type){case i.FileTypes.FOLDER:t=d.intl.formatMessage({id:"C/gp+a",defaultMessage:"Folder, {alt}"},{alt:t});break;case i.FileTypes.PACKAGE:t=d.intl.formatMessage({id:"FhSkpL",defaultMessage:"Package, {alt}"},{alt:t});break;case i.FileTypes.SHARED_FOLDER:t=d.intl.formatMessage({id:"rWEPV0",defaultMessage:"Shared folder, {alt}"},{alt:t});break;case i.FileTypes.SANDBOX:t=d.intl.formatMessage({id:"+vbakm",defaultMessage:"Sandbox, {alt}"},{alt:t});break;case i.FileTypes.TEAM_SHARED_FOLDER:t=d.intl.formatMessage({id:"ZtOyAr",defaultMessage:"Team shared folder, {alt}"},{alt:t});break;case i.FileTypes.TEAM_MEMBER_FOLDER:t=d.intl.formatMessage({id:"1yRjbu",defaultMessage:"Team member folder, {alt}"},{alt:t});break;default:t=d.intl.formatMessage({id:"e8WrLw",defaultMessage:"File, {alt}"},{alt:t})}return t}(S),O=S===s,x=this.hrefForItem(r,S),k=S instanceof i.File||S instanceof i.FileSharedWithMe?$.getThumbnailUrlForItem(S.thumbnail_url_tmpl,i.ViewTypeThumbnailSizes[c]):void 0,{id:A,type:P}=i.idTypePairFromStarrableItem(S),H=i.itemNameFromStarrableItem(S);return{file:E,paper:S instanceof i.Paper?S:void 0,fileSharedWithMe:S instanceof i.FileSharedWithMe?S:void 0,id:i.itemId(S),type:P,itemName:H,itemId:A,labelNode:y,renameNode:M,altText:L,thumbnailUrl:k,actionNode:D,onClick:F,onRightClick:v,onDoubleClick:I,onLabelClick:N,isDraggable:!n&&(w||!_),isViewOnly:u,isFocused:T,isSelectable:b,handleToggleSelect:C,checkboxAriaText:d.intl.formatMessage({id:"o3Djy2",defaultMessage:"Select tile"}),href:x,onDragEnter:n?void 0:this.createDragEnterHandler(E,w,O),onDragStart:n?void 0:this.createDragStartHandler(E,w,C),onDragEnd:n?void 0:this.createDragEndHandler(),isCheckboxFocusable:n,isCutToClipboard:p&&i.isCutToClipboard(S,p),className:m===i.itemId(S)?"tile--hover-forced":void 0}},this.shouldFileBeHighlightedDropTarget=(e,t)=>{const{dropTargetHighlightMode:i}=this.props;return Ae({file:e,dropTargetHighlightMode:i})},this.scrollIntoView=({top:e,bottom:t},i)=>{const{viewportTopOffset:s=0}=this.props,{height:a,scrollTop:n,scrollTo:o}=this.getScrollPane(),l=a-s,r=n+l;e<n?o(0,e):t>r&&o(0,i&&t-e<l/2?t-l/2:t-l)}}UNSAFE_componentWillMount(){this.setState({inSelectMode:this.props.selectedFiles.count()>0}),this.setSelectedTiles(this.props)}componentDidMount(){this.setupExternalDragHandler(),this.setupKeyboardShortcuts()}componentWillUnmount(){this.props.isPhotosPage||g.resetFileJumpKeyboardShortcuts(C.SELECTABLE_TILE_GRID_KEY_SCOPE),g.resetFilesViewKeyboardShortcuts(C.SELECTABLE_TILE_GRID_KEY_SCOPE),De(C.SELECTABLE_TILE_GRID_KEY_SCOPE)}UNSAFE_componentWillReceiveProps(e){e.selectedFiles!==this.props.selectedFiles&&(this.setSelectedTiles(e),this.setState({inSelectMode:e.selectedFiles.count()>0}))}componentDidUpdate(e){(e.createNewFolderState===i.NewFolderCreationState.PENDING_INPUT&&this.props.createNewFolderState===i.NewFolderCreationState.SAVING_INPUT||e.fileRename!==this.props.fileRename||e.items!==this.props.items)&&this.tileGridRef.current&&this.tileGridRef.current.forceUpdate(),e.isActive!==this.props.isActive&&(this.props.isActive?this.setupKeyboardShortcuts():g.resetFilesViewKeyboardShortcuts(C.SELECTABLE_TILE_GRID_KEY_SCOPE))}getTotalNumItems(){const{items:e,totalNumItems:t,isCreateFolderUIActive:i}=this.props;let s=Math.max(e.size,t);return i&&(s+=1),s}createToggleSelectHandler(e,t){const s=e instanceof i.FileSharedWithMe?e.file_id:e.fq_path;return e=>{const{onDeselectFile:i,onSelectFile:a}=this.props,n=Boolean(!("keyCode"in e)&&e.shiftKey);t?i(s,n):a(s,n?C.SelectOptions.EXTEND:C.SelectOptions.DEFAULT)}}createRightClickSelectHandler(e,t){const s=e instanceof i.FileSharedWithMe?e.file_id:e.fq_path;return e=>{const{onSelectFile:i}=this.props,a=Boolean(!("keyCode"in e)&&(e.shiftKey||e.metaKey||e.ctrlKey));t||i(s,a?C.SelectOptions.EXTEND:C.SelectOptions.DEFAULT)}}renderTileOverflowMenu(e,t,a,n){const{getOverflowMenuActions:o,inlineActions:l}=this.props,r=!this.props.responsive.isMatchedLarge&&!this.props.responsive.isMatchedMedium,c=e;let d,h;return"ON"!==f.CONTENT_TILES||this.props.isSearchMode&&"ON"!==f.CONTENT_TILES_SEARCH||(d=s.React$1.createElement(Zi,{showTooltip:!0,inverse:!!r,variant:r?"filled":"transparent",isMobile:r,identifier:c?i.filename(c.fq_path):void 0,tabIndex:!n&&a?0:-1,isDisabled:n}),h=i.ActionSurfaceLogValue.CONTENT_TILE_ACTION_MENU),l&&e instanceof i.File?s.React$1.createElement("div",{onClick:ws},s.React$1.createElement(l,{file:e,className:"tile__action-button--overflow-menu",onHoverLocked:({isOpen:t})=>{this.setState({menuOpenId:t?i.itemId(e):void 0})},customButton:d,actionSurface:h})):s.React$1.createElement(_i,{file:e,getOverflowMenuActions:o,size:Ei.Small,showBorders:!0,ariaHidden:!t,onMenuOpen:this.logOverflowMenuOpen})}renderLabelElement(e){const{items:t,focusedFileIndex:i,user:a,fileRename:n,isPhotosPage:o}=this.props;if(o)return;const l=t.get(e);if(!l)return;const{inSelectMode:r}=this.state,c=i===e;return s.React$1.createElement(Cs,{item:l,user:a,fileRename:n,inSelectMode:r,isTileFocused:c,createRenameCancelHandler:this.createRenameCancelHandler,createRenameSubmitHandler:this.createRenameSubmitHandler})}renderRenameInput(e){const{fileRename:t,isSearchMode:a}=this.props;let n;if(n=e instanceof i.File?i.filename(e.fq_path):e instanceof i.FileSharedWithMe?e.filename:e instanceof i.Paper?e.title:e.name,e instanceof i.File&&t&&i.paths_are_equal(t.file.fq_path,e.fq_path)){if(t.state===i.RenameState.PENDING_INPUT)return s.React$1.createElement(Pi,{defaultValue:n,label:n,onCancel:this.createRenameCancelHandler(e),onSubmit:this.createRenameSubmitHandler(e),isSearchMode:a});if(t.state===i.RenameState.SAVING_INPUT)return s.React$1.createElement(_s,{className:"tile-label__text--saving",label:d.intl.formatMessage({id:"OefYpa",defaultMessage:"Renaming…"})})}}createViewFileHandler(e,t){return s=>{if(s.preventDefault(),s.stopPropagation(),"click"===s.type){const t=s;if(0===t.button){const s=this.hrefForItem(this.props.user,e);if(i.hasModifierKey(t))return void i.open_tab(s)}}e instanceof i.File?this.props.onNavigateToFileOrFolder(e,{actionSource:t}):e instanceof i.FileSharedWithMe?this.props.onOpenFileSharedWithMe(e):e instanceof i.Paper&&this.props.onOpenPaper(e)}}createClickHandler({item:e,inSelectModeAndIsFile:t,toggleSelectHandler:s}){const a=e instanceof i.File||e instanceof i.FileSharedWithMe;return t=>{if(a){const a="keyCode"in t;if(t.preventDefault(),a)s(t);else{const a=e instanceof i.FileSharedWithMe?e.file_id:e.fq_path;this.props.onSelectFile&&(t.shiftKey?this.props.onSelectFile(a,C.SelectOptions.EXTEND):t.ctrlKey||t.metaKey?s(t):this.props.onSelectFile(a,C.SelectOptions.ONLY))}}}}createRightClickHandler({item:e,rightClickSelectHandler:t}){const s=e instanceof i.File||e instanceof i.FileSharedWithMe;return a=>{if(!s)return;const n="keyCode"in a;if(a.preventDefault(),n)t(a);else{if(!this.props.onSelectFile)return;const t=e instanceof i.FileSharedWithMe?e.file_id:e.fq_path,s=this.props.selectedFiles.has(t);a.shiftKey?this.props.onSelectFile(t,C.SelectOptions.EXTEND):a.ctrlKey||a.metaKey?this.props.onSelectFile(t,C.SelectOptions.DEFAULT):s||this.props.onSelectFile(t,C.SelectOptions.ONLY)}}}setSelectedTiles(e){const t=i.immutableExports.Set().withMutations((t=>{e.selectedFiles.forEach((e=>{var s;t.add((s=e)instanceof i.FileSharedWithMe?s.file_id:s.fq_path)}))}));this.setState({selectedIds:t})}setupExternalDragHandler(){Ne(C.SELECTABLE_TILE_GRID_KEY_SCOPE,(()=>!!this.props.isDraggingInternalFiles),(()=>!!this.props.isDraggingExternalFiles),this.props.onSetFileUploaderPath,".tile",(()=>this.props.activeDropTarget),this.props.onSetDropTarget)}setupKeyboardShortcuts(){const{user:e,viewType:t,onDelete:i,onShowRename:s,deselectAll:a,getIsCurrentPathWriteable:n,getIsFileJumping:o,onAddFileJumpKeyCode:l,onResetFileJump:r,onCopyToClipboard:c,onCutToClipboard:d,onFocusSearchBar:h,onPasteFromClipboard:u,selectAll:p}=this.props,m=g.generateGetIsGlobalEvent(this),f=m;this.props.isPhotosPage||g.setupFileJumpKeyboardShortcuts({scope:C.SELECTABLE_TILE_GRID_KEY_SCOPE,getIsFileJumping:o,onAddFileJumpKeyCode:l,onResetFileJump:r}),g.setupFilesViewKeyboardShortcuts({user:e,viewType:t,getIsGlobalEvent:m,getIsItemEvent:f,getSelectedFiles:()=>this.props.selectedFiles,isCurrentPathWriteable:n,selectAllAction:p,deselectAllAction:a,onCopyToClipboard:c,onCutToClipboard:d,onDelete:i,onFocusSearchBar:h,onPasteFromClipboard:u,onShowRename:s,onNavigateToFileOrFolder:()=>{},onNavigateToParentFolder:()=>{},scope:C.SELECTABLE_TILE_GRID_KEY_SCOPE,onShowHelpMenu:this.props.onOpenKeyboardShortcutModal})}createDragEnterHandler(e,t,i){return s=>{this.props.onDragEnter(s,e,t,i)}}createDragStartHandler(e,t,i){const{preventSelectionOnDrag:s}=this.props;return a=>{t?this.props.onDragStart(a):(s||i(a),this.props.onDragStart(a,[e]))}}createDragEndHandler(){return e=>{this.props.onDragEnd(e)}}getCreateFolderTile(){const{createNewFolderState:e,onNewFolderCancel:t,onNewFolderSubmit:a}=this.props;let n=d.intl.formatMessage({id:"pxGZm3",defaultMessage:"New folder"}),o=s.React$1.createElement("div",null);return e===i.NewFolderCreationState.PENDING_INPUT?(n=d.intl.formatMessage({id:"ss4CO0",defaultMessage:"Folder name"}),o=s.React$1.createElement(Pi,{label:n,onCancel:t,onSubmit:a})):e===i.NewFolderCreationState.SAVING_INPUT&&(n=d.intl.formatMessage({id:"p58M12",defaultMessage:"Creating new folder…"}),o=s.React$1.createElement(_s,{className:"tile-label__text--saving",label:n})),{altText:n,id:"New folder tile",isDraggable:!1,isSelectable:!1,labelNode:o}}getScrollPane(){const{scrollContainer:e}=this.props;if(e&&e.current){const{clientHeight:t,scrollTop:i,scrollTo:s}=e.current;return{height:t,scrollTop:i,scrollTo:s?s.bind(e.current):()=>{}}}return{height:window.innerHeight,scrollTop:"scrollingElement"in window.document&&window.document.scrollingElement?window.document.scrollingElement.scrollTop:window.document.documentElement.scrollTop,scrollTo:window.scrollTo?window.scrollTo.bind(window):()=>{}}}getWindow(){const{scrollContainer:e}=this.props;return e&&e.current?i.createFakeWindow(e.current):window}render(){const{enableMaxHeightGrouping:e,sections:t,viewType:a,viewportTopOffset:n,scrollContainer:o,scrollPositionOffset:l,registerSelectableTile:r,isPhotosPage:c,isSearchMode:d}=this.props,h=i.cx({"file-tile-grid-container":!0,"file-tile-grid-container--show-checkboxes":this.state.inSelectMode,"file-tile-grid-container--click-to-select":!0}),u=new Set;if(this.state.selectedIds.forEach((e=>u.add(e))),o&&!o.current)return null;let p=i.ViewTypeGridSizes[a],m=i.ViewTypeGridSizes[a];"ON"!==f.CONTENT_TILES||d&&"ON"!==f.CONTENT_TILES_SEARCH||(a===i.ViewType.Grid?(p=i.ContentTileConstants.SMALL_GRID_VIEW_MAX_WIDTH,m=i.ContentTileConstants.SMALL_GRID_VIEW_MAX_HEIGHT):a===i.ViewType.LargeGrid&&(p=i.ContentTileConstants.LARGE_GRID_VIEW_MAX_WIDTH,m=i.ContentTileConstants.LARGE_GRID_VIEW_MAX_HEIGHT));const g=!this.props.responsive.isMatchedLarge&&!this.props.responsive.isMatchedMedium;return s.React$1.createElement("div",{role:"grid","aria-multiselectable":"true"},s.React$1.createElement(Ts,{key:"tileGrid",ref:this.tileGridRef,totalNumItems:this.getTotalNumItems(),containerClass:h,rowClass:"file-tile-row",enableMaxHeightGrouping:e,delayRenderFullTile:!this.props.isCreateFolderUIActive,logTileLoading:!0,numThresholdRows:i.FilesViewTileGridConstants.NUM_THRESHOLD_ROWS,scrollDeltaThreshold:i.FilesViewTileGridConstants.SCROLL_DELTA_THRESHOLD,sectionStartIndices:t.sectionStartIndices,sectionLabels:t.sectionLabels,showLabels:!c||"ON"===f.CONTENT_TILES&&!d,contentOffset:n,getTileItem:this.getTileItem,selectedIds:u,handleTTI:this.props.onTTI,onRangeInView:this.props.onRangeInView,tilesPerRow:this.props.tilesPerRow,onTilesPerRowChange:this.props.onTilesPerRowChange,activeDropTarget:this.props.activeDropTarget,maxTileWidth:p,tileHeight:m,shouldFileBeHighlightedDropTarget:this.shouldFileBeHighlightedDropTarget,scrollToIndex:this.props.focusedFileIndex,scrollIntoView:this.scrollIntoView,scrollPositionOffset:l||0,window:this.getWindow(),registerSelectableTile:r,isMobile:g,isSearchMode:d,updateSelection:this.props.updateSelection,isRenameInProgress:!!this.props.fileRename}))}}Rs.defaultProps={enableMaxHeightGrouping:!1},Rs.displayName="FilesViewTileGrid";const Fs=(e,t)=>!(e.top+e.height<t.top||e.top>t.top+t.height||e.left+e.width<t.left||e.left>t.left+t.width),vs=a.throttle((function(e,t,s,a,n){Object.keys(e).forEach((o=>{Fs(e[o],t)?(null==n?void 0:n.selected.has(o))||s(o,C.SelectOptions.DEFAULT,i.ActionSourceValue.DRAG_TO_SELECT):(null==n?void 0:n.selected.has(o))&&a(o,!1,i.ActionSourceValue.DRAG_TO_SELECT)}))}),25),Is=e=>{let t=e.target;for(;t instanceof Node&&t!==e.currentTarget;){if(!0===t.draggable)return!0;t=t.parentElement}return!1},Ns=i.requireCssWithComponent((e=>{const[t,n]=s.React$1.useState(!1),[o,l]=s.React$1.useState(!1),[r,c]=s.React$1.useState(0),d=s.React$1.useRef(null),h=s.React$1.useRef({}),[u,p]=s.React$1.useState({top:0,left:0}),[m,g]=s.React$1.useState({top:0,left:0,width:0,height:0}),f=s.reactExports.useCallback(((e,t)=>{var i;const s=t.top+40,a=null===(i=d.current)||void 0===i?void 0:i.getBoundingClientRect();if(a){const i=t.width||a.width;h.current[e]={top:s,width:i,left:t.left,height:t.height}}}),[]);s.React$1.useEffect((()=>{t&&vs(h.current,m,e.handleSelect,e.handleDeselect,e.selection)}),[t,m,e.selection,e.handleSelect,e.handleDeselect]);const S=s.reactExports.useCallback((s=>{var a;if(o){if(1!==s.buttons)return l(!1),void n(!1);const o=null===(a=d.current)||void 0===a?void 0:a.getBoundingClientRect();let r=s.clientX-((null==o?void 0:o.left)||0),c=s.clientY-((null==o?void 0:o.top)||0);c<0&&(c=0),r<0&&(r=0),o&&r-10>o.width&&(r=o.width-10),o&&c-20>o.height&&(c=o.height-20);const h={top:Math.min(u.top,c),left:Math.min(u.left,r),height:Math.abs(u.top-c),width:Math.abs(u.left-r)};!t&&h.width<=5&&h.height<=5||(t?t&&g(h):(s.preventDefault(),e.updateSelection([],i.ActionSourceValue.DRAG_TO_SELECT,!0),g(h),n(!0)))}}),[o,u.top,u.left,t,e]),b=s.reactExports.useCallback((e=>{o&&(t&&c(Date.now()),n(!1),l(!1),g({top:0,left:0,width:0,height:0}),p({top:0,left:0}),e.preventDefault())}),[t,o]);s.React$1.useEffect((()=>{const e=a.throttle(S,8);return o&&(window.document.addEventListener("mouseup",b),window.document.addEventListener("mousemove",e)),()=>{window.document.removeEventListener("mousemove",e),window.document.removeEventListener("mouseup",b)}}),[o,t,S,b]);const E=s.reactExports.useCallback((e=>{Date.now()-r<50&&e.preventDefault(),window.document.removeEventListener("click",E,!0)}),[r]);if(s.React$1.useEffect((()=>(window.document.addEventListener("click",E,!0),()=>{window.document.removeEventListener("click",E,!0)})),[E]),!e.isDragToSelectEnabled){const t=(e,t)=>{};return s.React$1.createElement("div",null,e.children({registerSelectableItem:t}))}return s.React$1.createElement("div",{className:"files-view_drag-to-select",onMouseDown:t=>{var i;if(!t.isDefaultPrevented()&&!o&&1===t.buttons){const s=null===(i=d.current)||void 0===i?void 0:i.getBoundingClientRect(),a=t.clientX-((null==s?void 0:s.left)||0),n=t.clientY-((null==s?void 0:s.top)||0);((e,t,i,s)=>!(Is(e)||e.target!==e.currentTarget&&(null==i?void 0:i.selected)&&i.selected.some((e=>s[e]&&Fs(s[e],Object.assign(Object.assign({},t),{height:0,width:0}))))))(t,{top:n,left:a},e.selection,h.current)&&(p({top:n,left:a}),g({top:n,left:a,width:0,height:0}),l(!0))}},ref:d},s.React$1.createElement("div",{className:"files-view_drag-to-select-removal"},e.children({registerSelectableItem:f})),t&&s.React$1.createElement("div",{className:"files-view_select-box",style:{top:m.top+"px",left:m.left+"px",width:m.width+"px",height:m.height+"px"}}))}),["/static/metaserver/static/css/files_view/drag_to_select-vfl1pMR5V.css"]),Ds=({items:t,userId:a})=>{const[n,o]=s.React$1.useState(void 0);return s.React$1.useEffect((()=>{const t=i.makeCancelable(l.__awaiter(void 0,void 0,void 0,(function*(){return yield i.waitForTTI(),(yield new Promise((function(t,i){e(["./c_unity_browse_interface"],t,i)}))).unityBrowseInterface})));return t.then((e=>o(e))),()=>t.cancel()}),[]),s.React$1.useEffect((()=>{null==n||n.browse_visible_change_callback(t.toArray().filter((e=>e instanceof i.File)),a,0,t.size-1)}),[n,t,a]),null};Ds.displayName="UnityListener";const ys=i.Loadable({loader:()=>new Promise((function(t,i){e(["./c_src_file-drag_index"],t,i)})).then((({InternalFileDrag:e})=>e))}),Ms=[i.NameSpaceAccess.ACCESS_NO_ACCESS,i.NameSpaceAccess.ACCESS_READER,i.NameSpaceAccess.ACCESS_READER_NO_COMMENT],Ls={keyboard:i.ActionSourceValue.KEYBOARD,drag_to_select:i.ActionSourceValue.DRAG_TO_SELECT},Os=[];function xs(e){return e.some(ks)}function ks(e){return e instanceof i.File||e instanceof i.FileSharedWithMe}class As extends s.React$1.Component{constructor(){super(...arguments),this.internalDragStatusRef=s.React$1.createRef(),this.state={dropTarget:null,tilesPerRow:1,draggedFiles:null},this.handleCopyToClipboard=()=>{const{selectedFiles:e,onSetClipboard:t}=this.props;e.size&&t({files:e.toArray(),action:"copy"})},this.handleCutToClipboard=()=>{const{selectedFiles:e,onSetClipboard:t}=this.props,i=e.filter((e=>!e.read_only));i.size&&t({files:i.toArray(),action:"cut"})},this.handleNewFolderSubmit=e=>{""===e?(this.props.onNewFolderCancel(),this.handleNewFolderCancel({source:i.NameInputActionSource.SUBMIT})):this.props.onNewFolderSubmit(e)},this.handleNewFolderCancel=({source:e})=>{e!==i.NameInputActionSource.ESC&&G.Notify.error(d.intl.formatMessage({id:"9xXIAi",defaultMessage:"Please provide a name for the new folder."})),this.props.onNewFolderCancel()},this.handleSetFileUploaderPath=e=>{const t=e?e.path:this.props.path;let i=this.props.context.isCurrentPathWriteable();e&&e.hasOwnProperty("hasPermissionToUploadToFolder")&&(i=!!e.hasPermissionToUploadToFolder);const s=!!(null==e?void 0:e.isMovingIntoVault);this.props.setFileUploaderPath({path:t,hasPermissionToUploadToFolder:i,isMovingIntoVault:s,targetSurface:"files_view"})},this.handleDragStart=(e,t=[])=>{var n;const{path:o,selectedFiles:l,user:r,preventSelectionOnDrag:h}=this.props;let u=a.keyBy(t,"fq_path");0!==t.length&&h||(u=Object.assign(Object.assign({},u),l.toJS()));const p=a.values(u),{isInsideBackupFolder:m}=this.props;if(m)return void G.Notify.error(d.intl.formatMessage({id:"+HTDO0",defaultMessage:"Backup contents can’t be moved."}));if(null==p?void 0:p.some((e=>i.isBackupFolderIcon(e))))return void G.Notify.error(d.intl.formatMessage({id:"isN1D3",defaultMessage:"Backups can’t be moved."}));if(p.some((e=>i.File.isTeamSharedFolder(e))))return void G.Notify.error(d.intl.formatMessage({id:"1cIg3V",defaultMessage:"Team folders can’t be moved."}));if(p.some((e=>i.File.isTeamMemberFolder(e))))return void G.Notify.error(d.intl.formatMessage({id:"ZxTpZJ",defaultMessage:"Your member folder can’t be moved."}));const g=e.dataTransfer;if(!g)return;if(this.setState({draggedFiles:p}),g.setDragImage&&(null===(n=this.internalDragStatusRef)||void 0===n?void 0:n.current)){const e=s.reactDomExports.findDOMNode(this.internalDragStatusRef.current);e&&g.setDragImage(e,-10,-10)}const f={userId:r.id,fromPath:o,fileInfos:p.map((e=>({target_ns:e.target_ns,file_id:e.file_id,is_dir:e.is_dir,fq_path:e.fq_path})))};g.setData(c.INTERNAL_FILE_DATA_TRANSFER_TYPE,JSON.stringify(f)),g.effectAllowed="copyMove",this.props.onDragStart&&this.props.onDragStart(e,p)},this.handleDragEnter=(e,t,s,a)=>{const{draggedFiles:n}=this.state;n&&i.isBackupFolderIcon(t)&&G.Notify.error(d.intl.formatMessage({id:"rRI7QJ",defaultMessage:"Files can’t be moved into backups."}));const o=null==n?void 0:n.some((e=>e.fq_path===t.fq_path));!function(e,t,s,a,n,o,l,r){if(!t&&!s)return;if(!e.is_dir||a&&s||i.isBackupFolderIcon(e))l(null),r();else{if(n)return;const t=o.isCurrentPathWriteable()&&!i.File.isReadOnlySharedFolder(e);l(e),r({path:e.fq_path,hasPermissionToUploadToFolder:t,isMovingIntoVault:Boolean(e.is_in_vault_folder)})}}(t,!!this.props.isDraggingExternalFiles,!!this.props.isDraggingInternalFiles,!!o,a,this.props.context,this.handleSetDropTarget,this.handleSetFileUploaderPath)},this.handleDragEnd=e=>{this.setState({draggedFiles:null}),this.props.onDragEnd&&this.props.onDragEnd(e)},this.handleSetDropTarget=e=>{this.setState({dropTarget:e}),this.props.updateDropTarget&&this.props.updateDropTarget(e)},this.handleSelectionChange=(e,t)=>{const i=t?t in C.SelectableListActionSource?Ls[t]:t:void 0;this.props.onSelectionChange(e,i)},this.onAllCheckboxDeselectAll=()=>{const{selection:e,onSelectionChange:t}=this.props;t(e.set("selected",i.immutableExports.OrderedSet()),i.ActionSourceValue.ALL_CHECKBOX)},this.onAllCheckboxSelectAll=()=>{const{items:e,selection:t,onSelectionChange:s}=this.props;s(t.set("selected",i.immutableExports.OrderedSet(e.filter(ks).map((e=>"fq_path"in e?this.props.fileToId(e):e.file_id)))),i.ActionSourceValue.ALL_CHECKBOX)},this._handleGetOverflowMenuActions=(e,t)=>{const{getOverflowMenuActions:i,responsive:s}=this.props;return i(e,t,s)},this.handleTTI=()=>{this.props.onComponentTTI("FilesViewController")},this.getIsCurrentPathWriteable=()=>this.props.context.isCurrentPathWriteable(),this.onTilesPerRowChange=e=>{this.setState({tilesPerRow:e})},this.onDeselectAll=()=>{this.props.isSearchMode&&this.props.onFocusSearchBar()},this.logRightClick=e=>{const{selectedFiles:t,user:s,viewType:a}=this.props,n=t?t.count((e=>e.is_dir)):0,o=t?t.count()-n:0;i.logRightClickItems({uid:s.id,viewType:a,action_surface:i.ActionSurfaceLogValue.CENTER_PANE,numFilesSelected:o,numFoldersSelected:n})},this.InternalFileDragHelper=()=>{const e=this.state.draggedFiles||Os,t=e.length;let a="",n=!1,o="";return t>0&&(a=i.filename(e[0].fq_path),n=e[0].is_dir,o=e[0].icon),s.React$1.createElement(ys,{ref:this.internalDragStatusRef,numberOfFiles:t,firstFileName:a,isFolder:n,icon:o})}}shouldComponentUpdate(e){return e.loadingState!==this.props.loadingState||e.loadingState!==i.LoadingState.LOADING_FIRST_PAGE&&e.loadingState!==i.LoadingState.UPDATING_FILTERED_VIEW||(a=e.context,n=this.props.context,!!(a&&n&&a.currentFQPath!==n.currentFQPath||(t=e.items,s=this.props.items,t!==s)));var t,s,a,n}renderEmptyFolderView(){const{context:e,customEmptyFolderView:t,onFocusSearchBar:i,onPasteFromClipboard:a,onNavigateToParentFolder:n,isDraggingExternalFiles:o,isColumnResizingEnabled:l,scrollContainerWidth:r,isInsideBackupFolder:c}=this.props;if(t){const e=t({isDraggingExternalFiles:!!o,handleTTI:this.handleTTI,isColumnResizingEnabled:l,width:r});if(e)return e}const{isInsideSharedFolder:h,currentSharedFolderPermissionRole:u}=e,p=h&&Ms.includes(u)?void 0:c?d.intl.formatMessage({id:"qgGik0",defaultMessage:"Files added to your device will appear here"}):d.intl.formatMessage({id:"jXqkXG",defaultMessage:"Drag and drop files onto this window to upload."});return s.React$1.createElement(Me,{title:d.intl.formatMessage({id:"YLBqRL",defaultMessage:"This folder is empty"}),subtitle:p,onTTI:this.handleTTI,onFocusSearchBar:i,onPasteFromClipboard:a,onNavigateToParentFolder:n,onOpenKeyboardShortcutModal:this.props.openKeyboardShortcutsModal})}getSelectAllCheckboxCheckedVariant(){const{selectedFiles:e,items:t}=this.props;let i="unchecked";return e.size===t.filter(ks).size?i="checked":e.size&&(i="mixed"),i}isCreateFolderUIActive(){const{createNewFolderState:e}=this.props;return e&&"CREATE_FOLDER_INACTIVE"!==e}shouldShowEmptyFolderView(){return this.props.loadingState===i.LoadingState.LOADED&&!this.props.items.size&&!this.isCreateFolderUIActive()}render(){const{id:e,onDelete:t,onShowRename:a,onRenameSubmit:l,onRenameCancel:r,onSwitchViewType:c,onPasteFromClipboard:d,onColumnsChanged:h,onCanDisplayFolderSizesChanged:u,onFocusSearchBar:p,currentSort:m,createNewFolderState:g,context:f,columns:b,dropTargetHighlightMode:E,fileRename:_,getIsFileJumping:T,onAddFileJumpKeyCode:w,onResetFileJump:R,hideViewFileButton:F,items:v,itemIds:I,isCompactMode:N,isSearchMode:D,isDraggingExternalFiles:y,isDraggingInternalFiles:M,isQueryingFolderSizes:L,isFileViewerShown:O,loadingState:x,onSortChange:k,path:A,responsive:$,selectedFiles:P,selection:H,renderSharedWithController:W,onShowShare:V,totalNumFiles:B,user:z,viewType:U,viewTypeColumns:G,onLocationLinkClick:K,onNavigateToFileOrFolder:q,onNavigateToParentFolder:j,onOpenFileSharedWithMe:Y,onOpenPaper:X,scrollContainer:J,stickyOffsetTop:Z,disabledMultiselect:Q,isStickyColumnHeader:ee,onRangeInView:ie,highDensity:se,filteredContactName:ae,sections:ne,preferredColumns:oe,isDragToSelectEnabled:le,cutItems:re,numVisibleColumns:ce,isListView:de,isActive:he,enableUnity:ue,inlineActionBar:pe,scrollContainerWidth:me,columnResizeStorageSetting:ge,isColumnResizingEnabled:fe,expManualTagging:Se,useSkinnyCheckboxes:be,isRightClickEnabled:Ee}=this.props,{isMatchedLarge:_e,isMatchedMedium:Te}=$,{dropTarget:we,tilesPerRow:Ce}=this.state;if(x===i.LoadingState.LOADING_FIRST_PAGE||x===i.LoadingState.UPDATING_FILTERED_VIEW)return s.React$1.createElement(n.MediaTableSkeleton,{numRows:15});const Re=!!P.size,Fe=!!fe;if(this.shouldShowEmptyFolderView())return s.React$1.createElement("div",{className:"brws-files-view"},this.renderEmptyFolderView(),ue&&s.React$1.createElement(Ds,{items:this.props.unityItems,userId:z.id}));const Ie=_e?i.DEFAULT_COLUMN_HEADER_HEIGHT:i.COMPACT_COLUMN_HEADER_HEIGHT,Ne=Ie+Z,De=this.props.scrollPositionOffset||0;return s.React$1.createElement("div",{className:i.cx("brws-files-view",`brws-files-view--${U.toLowerCase()}`,{"brws-files-view-condensed-list":U===i.ViewType.CondensedList}),onContextMenu:this.logRightClick},s.React$1.createElement(te,{columns:b,viewTypeColumns:G,currentSort:m,onCanDisplayFolderSizesChanged:u,onColumnsChanged:h,isMatchedLarge:_e,isMatchedMedium:Te,isSearchMode:D,viewType:U,responsiveContainer:D,preferredColumns:oe,isMoreColumnsEnabled:Fe,numVisibleColumns:ce,scrollContainerWidth:me,columnResizeStorageSetting:ge},(({visibleColumns:n,handleSelection:h,canDisplayFolderSizes:u,containerWidth:x,handleReorder:G})=>{const te=(D?i.LIST_VIEW_SEARCH_MODE_COLUMN_FLEX:i.LIST_VIEW_COLUMN_FLEX)[n.length];be&&te&&(te[0]=i.CHECKBOX_CELL_FLEX_RIGHT_RAIL);const oe={columnFlex:te,currentSort:m,isCompactMode:N,isSelectMode:Re,onDeselectAll:this.onAllCheckboxDeselectAll,onSelectAll:this.onAllCheckboxSelectAll,onSelection:(e,t,s)=>{var a,o;e.popoverTriggerLabel!==t.popoverTriggerLabel&&S.logEvent({user:z,action:i.WebUserActionLogEvent.SWITCH_COLUMN_TYPE,extra:{column_position:(s+1).toString(),selected_column_header:null!==(a=e.loggingLabel)&&void 0!==a?a:e.popoverTriggerLabel,open_from_column_header:null!==(o=e.loggingLabel)&&void 0!==o?o:t.popoverTriggerLabel,action_type:n.includes(e)?"deselected":"selected"}}),h(e,t)},onSort:k,onMenuOpen:(e,t)=>{S.logEvent({user:z,action:i.WebUserActionLogEvent.SELECT_COLUMN_MENU,extra:{column_position:(e+1).toString(),column_header:t}})},onReorder:G,onSwitchViewType:c,selectAllCheckboxState:this.getSelectAllCheckboxCheckedVariant(),showSelectAllCheckbox:xs(this.props.items),stickyOffsetHeight:Ie,stickyOffsetTop:Z,columns:b,visibleColumns:n,viewType:U,isSearchMode:D,presentationOnly:de,isMoreColumnsEnabled:de&&Fe,items:v};return de?s.React$1.createElement(C.SelectableList,{itemIds:I,keyScope:C.SELECTABLE_LIST_KEY_SCOPE,onSelectionChange:this.handleSelectionChange,selection:H,tilesPerRow:Ce,onDeselectAll:this.onDeselectAll,isActive:he},(({focusedFileId:c,handleDeselect:h,handleFocusFile:m,handleSelect:S,isSelectableListEvent:b,updateSelection:v})=>s.React$1.createElement(Ns,{handleSelect:S,handleDeselect:h,updateSelection:v,selection:H,isDragToSelectEnabled:le},(({registerSelectableItem:v})=>{var L,k;return s.React$1.createElement(o.Table,{"aria-rowcount":B,className:i.cx("brws-files-view-list",{"brws-files-view-list-high-density":se}),columnFlex:te},s.React$1.createElement(ve,Object.assign({},oe,{variant:J?"sticky-native":ee?"sticky":"fixed"})),s.React$1.createElement(Ai,{onTTI:this.handleTTI,registerListItem:v,instanceId:e,onDelete:t,onShowRename:a,activeDropTarget:we,context:f,createNewFolderState:g,dropTargetHighlightMode:E,fileRename:_,focusedFileIndex:c?I.indexOf(c):void 0,getOverflowMenuActions:this._handleGetOverflowMenuActions,getIsCurrentPathWriteable:this.getIsCurrentPathWriteable,getIsFileJumping:T,onAddFileJumpKeyCode:w,onResetFileJump:R,isCompactMode:N,hideViewFileButton:!!F,isDraggingExternalFiles:y,isDraggingInternalFiles:M,isFileViewerShown:O,isSearchMode:D,isSelectMode:Re,isSelectableListEvent:b,keyScope:C.SELECTABLE_LIST_KEY_SCOPE,onCopyToClipboard:this.handleCopyToClipboard,onCutToClipboard:this.handleCutToClipboard,onDragStart:this.handleDragStart,onDragEnter:this.handleDragEnter,onDragEnd:this.handleDragEnd,onDeselectFile:h,onFocusFile:m,onFocusSearchBar:p,onOpenKeyboardShortcutModal:this.props.openKeyboardShortcutsModal,onLocationLinkClick:K,onNavigateToFileOrFolder:q,onNavigateToParentFolder:j,onNewFolderCancel:this.handleNewFolderCancel,onNewFolderSubmit:this.handleNewFolderSubmit,onOpenFileSharedWithMe:Y,onOpenPaper:X,onPasteFromClipboard:d,onRenameCancel:r,onRenameSubmit:l,onSelectFile:S,onSetDropTarget:this.handleSetDropTarget,onSetFileUploaderPath:this.handleSetFileUploaderPath,responsive:$,scrollPositionOffset:De,selectedFiles:P,selection:H,renderSharedWithController:W,hrefForFile:this.props.hrefForFile,onShowShare:V,user:z,viewportTopOffset:Ne,visibleColumns:n,canDisplayFolderSizes:u,scrollContainer:J,shareButtonLabel:this.props.shareButtonLabel,showShareButton:this.props.showShareButton,onRangeInView:ie,containerWidth:x,highDensity:se,filteredContactName:ae,fileToId:this.props.fileToId,eligibleForFirstTaskSubtitle:this.props.eligibleForFirstTaskSubtitle,expVaultEnableViewOnlySharing:this.props.expVaultEnableViewOnlySharing,expManualTagging:Se,preventSelectionOnDrag:this.props.preventSelectionOnDrag,defaultListviewIconSize:null===(L=this.props.overrides)||void 0===L?void 0:L.defaultListviewIconSize,isBoldFileNamesEnabled:null===(k=this.props.overrides)||void 0===k?void 0:k.isBoldFileNamesEnabled,isRightClickEnabled:Ee}))})))):s.React$1.createElement(C.SelectableList,{itemIds:I,keyScope:C.SELECTABLE_TILE_GRID_KEY_SCOPE,onSelectionChange:this.handleSelectionChange,selection:H,tilesPerRow:Ce,sectionStartIndices:ne.sectionStartIndices,isActive:he,isSearchMode:D},(({handleDeselect:e,handleDeselectAll:n,handleFocusFile:c,handleSelect:h,handleSelectAll:u,updateSelection:m,focusedFileId:S})=>s.React$1.createElement(Ns,{handleSelect:h,handleDeselect:e,updateSelection:m,selection:H,isDragToSelectEnabled:le},(({registerSelectableItem:b})=>s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.Table,{columnFlex:be?i.GRID_VIEW_COLUMN_FLEX_RIGHT_RAIL:i.GRID_VIEW_COLUMN_FLEX,role:"presentation",style:J?{position:"sticky",top:Z,zIndex:1}:void 0},s.React$1.createElement(ve,Object.assign({},oe,{variant:J?"default":ee?"sticky":"fixed",disableResizing:!0}))),s.React$1.createElement(Rs,{onDelete:t,disabledMultiselect:Q||!1,onShowRename:a,activeDropTarget:we,createNewFolderState:g,context:f,deselectAll:n,dropTargetHighlightMode:E,fileRename:_,getOverflowMenuActions:this._handleGetOverflowMenuActions,getIsCurrentPathWriteable:this.getIsCurrentPathWriteable,getIsFileJumping:T,onAddFileJumpKeyCode:w,onResetFileJump:R,onTTI:this.handleTTI,items:v,isCreateFolderUIActive:this.isCreateFolderUIActive(),isDraggingExternalFiles:y,isDraggingInternalFiles:M,isQueryingFolderSizes:L,isSearchMode:D,onCopyToClipboard:this.handleCopyToClipboard,onCutToClipboard:this.handleCutToClipboard,onDeselectFile:e,onDragEnter:this.handleDragEnter,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onFocusFile:c,onFocusSearchBar:p,onNewFolderCancel:this.handleNewFolderCancel,onNewFolderSubmit:this.handleNewFolderSubmit,onNavigateToFileOrFolder:q,onOpenFileSharedWithMe:Y,onOpenPaper:X,onOpenKeyboardShortcutModal:this.props.openKeyboardShortcutsModal,onPasteFromClipboard:d,onRangeInView:ie,onRenameCancel:r,onRenameSubmit:l,onSelectFile:h,onSetDropTarget:this.handleSetDropTarget,onSortChange:k,onTilesPerRowChange:this.onTilesPerRowChange,path:A,sections:ne,selectAll:u,selectedFiles:P,selection:H,onSetFileUploaderPath:this.handleSetFileUploaderPath,tilesPerRow:Ce,totalNumItems:B,user:z,viewportTopOffset:Ne,viewType:U,hrefForFile:this.props.hrefForFile,focusedFileIndex:S?I.indexOf(S):void 0,scrollContainer:J,scrollPositionOffset:De,registerSelectableTile:b,cutItems:re,isActive:he,inlineActions:pe,preventSelectionOnDrag:this.props.preventSelectionOnDrag,responsive:$,updateSelection:m}))))))})),s.React$1.createElement($i,{scrollContainer:J,path:A,viewType:U}),this.InternalFileDragHelper(),ue&&s.React$1.createElement(Ds,{items:this.props.unityItems,userId:z.id}))}}As.defaultProps={fileToId:e=>e.fq_path},As.displayName="FilesViewComponent";const $s=i.connect(((e,{id:t})=>Object.assign(Object.assign({},i.selectInstance(e,{instanceId:t})),{itemIds:i.selectItemIds(e,{instanceId:t}),sections:i.selectSections(e,{instanceId:t}),responsive:i.selectResponsive(e,{instanceId:t}),isCompactMode:i.selectIsCompactMode(e,{instanceId:t}),viewType:i.selectViewType(e,{instanceId:t}),preferredColumns:i.selectPreferredColumns(e,{instanceId:t}),cutItems:i.selectCutItems(e,{instanceId:t}),numVisibleColumns:i.selectNumVisibleColumns(e,{instanceId:t}),isListView:i.selectIsListView(e,{instanceId:t}),isActive:i.isActiveFilesView(e,t),unityItems:i.selectItemsForUnityListener(e,{instanceId:t})})),((e,{id:t})=>({openKeyboardShortcutsModal:()=>e(i.openKeyboardShortcutsModal({instanceId:t}))})))(As),Ps=({children:e,props:t,instanceId:a})=>{const{items:n,path:o}=t,l=i.useSelector((e=>t=>i.selectViewType(t,{instanceId:e}))(a));return s.reactExports.createElement(pt,{props:t},s.reactExports.createElement(D.ThumbStoreProvider,{shouldPrewarm:l!==i.ViewType.Grid,items:n,path:o},s.reactExports.createElement(D.FilesViewOverrideContext.Provider,{value:t.overrides||{}},e)))};Ps.displayName="FilesViewContextProvider";const Hs={context:!0,createNewFolderState:!0,items:!0,selection:!0,user:!0,responsive:!0,clipboard:!0,currentSort:!0,disabledMultiselect:!0,dropTargetHighlightMode:!0,enableUnity:!0,expBizFoldersEmptyStateAdmin:!0,expBizFoldersEmptyStateUser:!0,fileRename:!0,filteredContactName:!0,renderFilenameSubtitleAsLink:!0,hideViewFileButton:!0,highDensity:!0,isOverFreeQuota:!0,isSearchMode:!0,loadingState:!0,teamFolders:!0,viewTypeScope:!0,viewTypes:!0,eligibleForFirstTaskSubtitle:!0,expVaultEnableViewOnlySharing:!0,isActionBarEnabled:!0,inlineActionBar:!0,expFlowsAutomatedFolderUI:!0,expManualTagging:"OFF",currentFolderInfo:!0,isRightClickEnabled:!0,selectedFilter:!0},Ws=(e,t,i)=>{t[i]=e[i]};let Vs=0;const Bs=e=>{const{id:t,isActive:a=!0}=e,n=i.useDispatch(),{ownProps:o,upsertedProps:l}=(e=>{const t={},i={};for(const s of Object.keys(e))if(Hs.hasOwnProperty(s)){const t=s;void 0!==e[t]&&Ws(e,i,t)}else Ws(e,t,s);return{ownProps:t,upsertedProps:i}})(e),r=s.React$1.useMemo((()=>t||"files-view:"+Vs++),[t]),c=r!==t;return n(i.upsertInstance(r,l)),s.React$1.useEffect((()=>()=>{c&&n(i.deleteInstance(r))}),[c,n,r]),s.React$1.useEffect((()=>{a&&t&&n(i.markActiveInstance(t))}),[a,t,n]),s.React$1.createElement(Ps,{props:e,instanceId:r},s.React$1.createElement($s,Object.assign({},o,{id:r})))};Bs.displayName="UpsertWrapper";const zs=i.connect()(Bs),Us=i.getStoreForFilesView(),Gs=e=>s.React$1.createElement(i.Provider,{store:Us},s.React$1.createElement(zs,Object.assign({},e)));Gs.displayName="FilesViewController",t.FilesViewController=Gs,t.Sticky=we,t.StickyContainer=Ce,t.flattenSearchResults=di,t.formatSearchResultsPageData=hi,t.formatSearchResultsPageLoadingState=({isError:e,isLoading:t,isSuccess:s,isFetchingNextPage:a})=>e?i.SearchLoadingState.LOAD_ERROR:t?i.SearchLoadingState.LOADING_FIRST_PAGE:a?i.SearchLoadingState.LOADING_ADDITIONAL_PAGE:s?i.SearchLoadingState.LOADED:i.SearchLoadingState.ZERO_QUERY,t.getWidthOfElement=function(e){try{const t=window.getComputedStyle(e,null),i=e.clientWidth,s=parseInt(t.getPropertyValue("padding-left"),10);let a=parseInt(t.getPropertyValue("padding-right"),10);if(isNaN(i)||isNaN(s)||isNaN(a))throw new Error("failed to calculate width");const n=e.clientHeight<(e.hasChildNodes()?e.children[0].clientHeight:0)?0:15;return a=Math.max(16,a)+n,i-s-a}catch(e){return}},t.isBrowseSuggestionsEnabled_TTVCTest=function(){return ft()||!(null==mt?void 0:mt.includes("A"))},t.isDragAndDropEnabled_TTVCTest=function(){return ft()||!(null==mt?void 0:mt.includes("G"))},t.isFacePileEnabled_TTVCTest=function(){return ft()||!(null==mt?void 0:mt.includes("B"))},t.isInsideVault=function(e){const t=e.split("/");return("/"===e[0]?t[1]:t[0])===A.VAULT_NAME},t.localStorage={type:"local_storage",localStorageKey:"dbx_files_view_column_sizes"},t.noStorage=Z,t.searchResultsRequestPackage=ri,t.swapColumns=K,t.useSearchResultsRequestArgs=ci}));
//# sourceMappingURL=c_browse_element_width.js-vflXxCN7e.map
