define(["exports","./e_edison","./c_core_i18n","./e_ui_page_files_router","./c_file_viewer_file_viewer_components","./c_file_viewer_utils","./c_action_bar_action_bar_strings","./c_file_viewer_sdk_file_viewer_file_viewer","./c_extensions_cloud_docs_compat","./c_action_plugins_open_in_action_hooks","./c_file_store_utils","./c_common_logging_uxa","./c_core_logging_constants","./c_tslib","./c_apex-metrics_src_types","./c_lodash-es_lodash","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_core_xhr","./c_csrf","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","./c_core_data_utils","./c_core_data_preview_key","./c_core_types_preview_type","./c_file_viewer_logging_performance","./c_file_viewer_file_extension_extension_constants","./c_src_simple-action-bar_action_bar_types","./c_api_v2_redux_files","./c_resize-observer-polyfill_dist_ResizeObserver","./c_truncate_index","./c_file_viewer_toolbar","./c_breadcrumb_index","./c_portable_delete_snackbars","./c_portable_delete_strings","./c_file_actions_strings","./c_files_view_file_actions_snackbars","./c_history","./c_ux_analytics_dispatch_custom_event","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments","./c_auth_login_or_register_types","./c_downloads","./c_form_row_index","./c_ui_tree_view","./c_icon_folder_icon","./c_sharing_ui_notifications_util","./c_src_utils_logging","./c_share_download_ui_api","./c_account_email_verify_reasons","./c_account_email","./c_ui_modal_dig","./c_ui_input_dig","./c_loggers_device_type","./c_share_modal_evolution_utils_logging","./c_dig-illustrations_spot_file-folders","./c_pass_store","./c_sharing_share_page_action_types","metaserver/static/js/modules/constants/python","./c_flux_base_store","./c_sharing_ui_util","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","./c_sharing_settings_utils_sharing_settings_util","./c_preview_audio_video_video_editing_utils","./c_components_approval-forms_url_utils","./c_capture_api","./c_pap-events_previews_rename_file","./c_pap-events_filesystem_item_actions_unstar_file","./c_pap-events_enums_file_type-utils","./c_pap-events_navigation_navigate_to_edit","./c_pap-events_previews_crop_rotate_select_rotate","./c_src_preview-photo-editor_types","./c_pap-events_previews_create_folder","./c_keymaster","./c_bug_reporting_routing","./c_clipboard_v3","metaserver/static/js/modules/constants/publish","./c_file_viewer_data_store","./c_previews_data_actions","./c_file_viewer_mobile_web","./c_integrations_data_selectors","./c_capture_redux_selectors","./c_flows_flows_client","./c_docsend_src_utils","./c_components_approval-forms_approval_metadata","./c_contacts_data_v2","./c_contacts_bloodhound","metaserver/static/js/modules/constants/contacts","./c_profile_services_profile_services_link","./c_profile_services_profile_services_constants","metaserver/static/js/modules/constants/login_and_register","./c_flows_approval_approval_io_client","./c_typeahead_index","./c_src_common_format_bytes","./c_info_blade_content_metadata_image_metadata","./c_src_simple-action-bar_inline_action_bar","./c_src_highlighted-truncated-string_em-string","./c_extensions_split_share_button","./c_team_discovery_data_utils","./c_spectrum_avatar_avatar_initials","./c_spectrum_positioned_portal","./c_growth_ui_teams_web_actions_logger_events","./c_teams_let_members_invite_non_admin_invite_modal","./c_contacts_tokenizer_v2","./c_integrations_profile_card_tooltip","./c_src_text","./c_spectrum_colorized_icon","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_src_instrumentation_common_context","./c_src_instrumentation_constants","./c_src_instrumentation_function_wrapper","./c_preview_audio_video_video_editing_strings","./c_file_viewer_toolbar_v2_toolbar_holder","./c_campaigns_campaigns_element_id_enum","./c_flows_constants","./c_src_components_action-bar-strings","./c_integrations_hellosign_deep_integration_constants","./c_ui_hoc"],(function(e,t,s,o,_,n,i,a,c,r,l,d,m,u,p,v,g,f,w,b,S,E,I,h,A,D,O,R,N,x,P,T,y,j,k,L,$,C,F,U,M,B,W,K,G,H,V,z,q,Y,Z,J,Q,X,ee,te,se,oe,_e,ne,ie,ae,ce,re,le,de,me,ue,pe,ve,ge,fe,we,be,Se,Ee,Ie,he,Ae,De,Oe,Re,Ne,xe,Pe,Te,ye,je,ke,Le,$e,Ce,Fe,Ue,Me,Be,We,Ke,Ge,He,Ve,ze,qe,Ye,Ze,Je,Qe,Xe,et,tt,st,ot,_t,nt,it,at,ct,rt,lt,dt,mt,ut,pt,vt,gt,ft,wt,bt,St,Et,It,ht,At,Dt,Ot,Rt,Nt,xt,Pt,Tt,yt,jt,kt){"use strict";const Lt=[r.SDKPreviewSurface.BROWSE,r.SDKPreviewSurface.SEARCH,r.SDKPreviewSurface.STANDALONE_PREVIEW],$t=(e,t)=>{t&&Lt.includes(t)&&o.UserSurvey.trackEvent("download_item","previews"),a.isVideoPreview(e)&&o.UserSurvey.trackEvent("video_preview_download","previews")},Ct=({children:e,disabled:_})=>_?t.React$1.createElement(o.Tooltip,{title:s.intl.formatMessage(i.DOWNLOAD_NO_PERMISSION_TOOLTIP_STRING)},t.React$1.createElement("div",null,e)):t.React$1.createElement(t.React$1.Fragment,null,e);Ct.displayName="TooltipIfDisabled";const Ft=({downloadAction:e,saveACopyToDropboxAction:_,shareToken:n,downloadAllowed:c,user:l})=>{const d=t.React$1.createElement(o.UIIcon,{src:o.DownloadLine}),m=s.intl.formatMessage(i.DOWNLOAD_ACTION_STRING),u=e=>{e.menuItem.handler()},p=t=>{t.preventDefault(),t.stopPropagation(),e()},v=t=>{"Enter"===t.key&&(t.preventDefault(),t.stopPropagation(),e())},g=a.makePluginActionDefinition({icon:d,label:m,action:e,id:r.DOWNLOAD_ACTION_PLUGIN_ID,disabled:c?{disabled:!1}:{disabled:!0,tooltipMessage:s.intl.formatMessage(i.DOWNLOAD_NO_PERMISSION_TOOLTIP_STRING)}});let f=null;if(n&&(f=a.makePluginActionDefinition({icon:t.React$1.createElement(o.UIIcon,{src:o.DropboxLine}),label:s.intl.formatMessage(i.SAVE_COPY_ACTION_STRING),action:()=>{_()},id:"SHARECOPY_ACTION",disabled:c?{disabled:!1}:{disabled:!0,tooltipMessage:s.intl.formatMessage(i.SAVE_COPY_NO_PERMISSION_TOOLTIP_STRING)},overflowItemTooltipDataAttribute:"action-bar-download-split-button-menu-save-a-copy-overflow-item"})),!l)return[{id:g.id,renderButton:e=>{var s;const o=null===(s=g.renderButton)||void 0===s?void 0:s.call(g,e);return t.React$1.createElement(t.React$1.Fragment,null,o)},overflowItem:g.overflowItem},...f?[{id:f.id,renderButton:e=>{var s;const o=null===(s=null==f?void 0:f.renderButton)||void 0===s?void 0:s.call(f,e);return t.React$1.createElement(t.React$1.Fragment,null,o)},overflowItem:f.overflowItem}]:[]];const w=t.React$1.createElement(t.React$1.Fragment,null,g.overflowItem,null==f?void 0:f.overflowItem),b=({buttonProps:e})=>t.React$1.createElement(o.Menu.Wrapper,{onSelection:u},(({getTriggerProps:s,getContentProps:_})=>t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(o.Button$1,Object.assign({"aria-label":"Show options"},e,s(),{disabled:!c,"data-tooltip":"action-bar-download-split-button-menu","data-testid":"action-bar-download-split-button-menu"})),t.React$1.createElement(o.Menu.Content,Object.assign({},_(),{placement:"bottom-end"}),t.React$1.createElement(o.Menu.Segment,null,w)))));return[{renderButton:e=>t.React$1.createElement(Ct,{disabled:!c},t.React$1.createElement(o.SplitButton,{onClick:p,onKeyPress:v,variant:"opacity",renderMenu:b,disabled:!c},!e&&d,m)),overflowItem:t.React$1.createElement(Ct,{disabled:!c},t.React$1.createElement(o.Menu.Submenu,{disabled:!c,withTriggerContent:m,withLeftAccessory:d},t.React$1.createElement(o.Menu.Segment,null,w)))}]};e.makeDownloadActionLoader=(e,u,p,v,g,f,w,b,S,E)=>{const I=(e,t)=>{const s=[r.SDKPreviewSurface.BROWSE,r.SDKPreviewSurface.SHARED_LINK,r.SDKPreviewSurface.STANDALONE_PREVIEW];return v&&-1===l.getFilename(e).indexOf("~")&&a.showEditPlugin(e,t)&&p&&s.includes(p)},h=a.makePluginActionDefinition({label:s.intl.formatMessage(i.DOWNLOAD_ACTION_STRING),icon:t.React$1.createElement(o.UIIcon,{src:o.DownloadLine}),id:r.DOWNLOAD_ACTION_PLUGIN_ID,action:()=>{const{file:t,sharePermission:s}=e();$t(t,p),I(t,s)&&o.publishEvent(o.CampaignEvents.DOWNLOAD_BUTTON_CLICKED,{context:{file_name:l.getFilename(t),file_extension:l.getExtension(t)}});const n={onAttempt:()=>u.logUserAction(m.UserAction.DownloadStart),onSuccess:()=>{u.logUserAction(m.UserAction.DownloadSuccess,"title_bar_open_split_button"),_.setHubEntryPoint(_.HubEntryPointType.Download)},onError:()=>u.logUserAction(m.UserAction.DownloadFailed)},{rootNSID:i,blockHash:a}=o.getBrowseState(o.getStoreForBrowse().getState()).context;v&&i&&o.isUnmountedBackupBrowse(v,i)?a&&l.isBrowseFile(t)&&c.downloadSingleFileAsZip({fqPath:t.fq_path,rootNsId:i,source:"PREVIEWS",blockHash:a,user:v},n):c.downloadSingleFile({href:t.href,source:"PREVIEWS",isFswm:l.isSharedFile(t),userId:null==v?void 0:v.id},n)}}),A=n.getWebSignInTag(void 0!==v&&p===r.SDKPreviewSurface.INBAND_SHARE,!!(null==f?void 0:f.isSharedFolder)),[D,O]=Ft({downloadAllowed:!!f&&a.isDownloadAllowed(f),downloadAction:()=>{u.logUserAction("download","title_bar_download_split_button");const{file:t,sharePermission:s}=e();$t(t,p),I(t,s)&&o.publishEvent(o.CampaignEvents.DOWNLOAD_BUTTON_CLICKED,{context:{file_name:l.getFilename(t),file_extension:l.getExtension(t)}}),a.downloadActiveFile(t,v,w,b,u.logUserAction,g,S,A)},saveACopyToDropboxAction:()=>{const{file:t}=e();a.saveToDropbox(t,(e=>u.logUserAction(e,"title_bar_download_split_button")),v,g,w,d.RegistrationSource.SHMODEL_SAVE_TO_REGISTER,E,A)},getActiveFile:e,user:v,shareToken:g,encryptionOptions:w});return{actionDefinitions:()=>{const{file:t}=e();if(!r.isLiveFile(t)||r.isPnmLinkNodeSelected(t)||r.isCloudDoc(t))return{};let s;return s=l.isSharedFile(t)?v||!O?[D]:[D,O]:[h],{atTopLevelIfSpace:s,alwaysInOverflow:[s]}}}}}));
//# sourceMappingURL=c_action_plugins_download_action_legacy_plugin.js-vfl_x5lx5.map
