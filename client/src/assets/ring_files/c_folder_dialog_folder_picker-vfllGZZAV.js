define(["exports","./c_tslib","./e_ui_page_files_router","./c_lodash-es_lodash","./c_keymaster","./e_edison","./c_spectrum_dimensions","./c_spectrum_icon_arrow_index","./c_icon_templates_selectable_index","./c_spectrum_media_table_media_cell","./c_spectrum_tooltip","./c_browse_interface","./c_icon_folder_icon","./c_icon_icon_helper","./c_ui_title_bubble","./c_core_i18n","./c_ui_overlay","./c_ui_selectable_list","./e_core_exception","./c_core_exception_info"],(function(e,t,s,a,r,i,o,n,l,d,c,h,g,u,p,m,S,E,f,_){"use strict";const b=2.625,C=20;function L(e,t,a=C){return a-(t?b:new s.Emstring(e).length)}var F;!function(e){e.LARGE="LARGE",e.SMALL="SMALL"}(F||(F={}));class v extends i.React$1.PureComponent{constructor(e){super(e),this._breadcrumbContainerElement=null,this.resizeListener=()=>{const e=this.getBreadcrumbsContainerSpan();if(e){let t=e.getBoundingClientRect().width;this.props.mobileWebInvites&&(t-=20);const s=Math.max(0,this.getMaxWidthInEm(t));s!==this.state.maxWidthInEm&&s>0&&this.setState({maxWidthInEm:s})}},this.handleTitleClick=e=>t=>{const s=e.path;if(0===t.button){if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return void t.stopPropagation();t.preventDefault(),t.stopPropagation(),this.props.setUrl({path:s})}};const t=this.getBreadcrumbsContainerSpan();this.state={maxWidthInEm:t?this.getMaxWidthInEm(t.getBoundingClientRect().width):C}}getBreadcrumbsContainerSpan(){if(!this._breadcrumbContainerElement){const e=document.getElementsByClassName("maestro-app-content");e&&1===e.length&&(this._breadcrumbContainerElement=e[0])}return this._breadcrumbContainerElement}getMaxWidthInEm(e){return(e-100)/22}componentDidMount(){window.addEventListener("resize",this.resizeListener),s.waitForTTI().then((()=>this.resizeListener()))}componentWillUnmount(){window.removeEventListener("resize",this.resizeListener)}componentDidUpdate(e){e.mobileWebInvites!==this.props.mobileWebInvites&&this.resizeListener()}render(){const e=this.props.path,{firstBreadcrumbName:t,firstBreadcrumbAlt:a,firstBreadcrumbPath:r,shouldHighlightDropTargets:o,setFileUploaderPath:n,getUrlForPath:l,setUrl:d,size:c,enableDragging:h}=this.props,g=this.state.maxWidthInEm?this.state.maxWidthInEm:C,{dropdownCrumbs:p,inlineCrumbs:S,root:E}=function(e,t,a,r,i=C,o){const n=null!=o?o:"",l=e.substring(n.length).split("/").filter(Boolean),d=[{path:n,icon:"folder_dropbox-small",folderName:t,alt:a}],c=u.spectrumFolderIcon({size:u.SpectrumIconSize.Small});for(let t=0;t<l.length;t++)e=`${n}/${l.slice(0,t+1).join("/")}`,d.push({path:e,folderName:s.getDisplayedFilename(s.filename(e)),icon:c,alt:m.intl.formatMessage({id:"MLqiSW",defaultMessage:"Folder"})});if(d.length<3)return{dropdownCrumbs:[],inlineCrumbs:d,root:d[0]};const h=L(d[0]&&d[0].folderName||"",!1,i),g=d.map((e=>new s.Emstring(e.folderName||"").length));let p=1,S=g[d.length-1];for(let e=d.length-2;e>=1&&(S+=1.64,S+=g[e],!(S>h));e--)p+=1;d.length===p+1&&(p+=1),1===p&&r===F.SMALL&&p++;const E=d.length-p;return{dropdownCrumbs:d.slice(0,E),inlineCrumbs:d.slice(E),root:d[0]}}(e,t,a,c,g,r),f=L(E&&E.folderName||"",p.length>0,g),_=s.cx({"brws-path-breadcrumbs":!0,"brws-path-breadcrumbs--small":this.props.size===F.SMALL});if(S.length>1||p.length>0)return i.React$1.createElement("span",{className:_},i.React$1.createElement("h1",{className:"ax-visually-hidden"},s.filename(e)),i.React$1.createElement("nav",{className:"page-header-text u-l-fl",id:"path-breadcrumbs","aria-label":m.intl.formatMessage({id:"SzftTr",defaultMessage:"Folder hierarchy"}),role:"navigation"},p.length>0&&i.React$1.createElement(I,{crumbs:p,currentPath:e,shouldHighlightDropTargets:o,setFileUploaderPath:n,setUrl:d,enableDragging:!!h,onTitleClick:this.handleTitleClick,getUrlForPath:l}),S.map(((t,s)=>i.React$1.createElement(D,Object.assign({},t,{key:encodeURI(t.path),isOnlyCrumb:0===s&&1===S.length&&0===p.length,index:s,isLastCrumb:s===S.length-1,maxWidth:f,currentPath:e,shouldHighlightDropTargets:o,setFileUploaderPath:n,getUrlForPath:l,setUrl:d,size:c,enableDragging:!!h,onTitleClick:this.handleTitleClick(t)}))))));{const e=c===F.SMALL?s.Text:s.Title,a=c===F.SMALL?"small":"standard";return i.React$1.createElement(s.UserEducationEffect,{containerName:"PathBreadcrumbs",name:"HomeTitle",useSpan:!0},i.React$1.createElement(e,{size:a,className:"page-header-text"},t))}}}v.defaultProps={path:"/",shouldHighlightDropTargets:!1,setFileUploaderPath:()=>{},size:F.LARGE,enableDragging:!1},v.displayName="PathBreadcrumbs";class D extends i.React$1.Component{constructor(e){super(e),this.handleDragEnter=e=>{e.preventDefault(),e.target!==this.lastEnteredElement&&this.props.enableDragging&&(this.lastEnteredElement=e.target,this.dragEnterCount+=1,this.setState({isDraggedOver:!0}),this.props.isLastCrumb||this.props.setFileUploaderPath({path:this.props.path,targetSurface:"breadcrumb"}))},this.handleDragLeave=e=>{e.preventDefault(),this.props.enableDragging&&(this.lastEnteredElement=null,this.dragEnterCount-=1,this.dragEnterCount<1&&(this.dragEnterCount=0,this.state.isDraggedOver&&(this.props.setFileUploaderPath({path:this.props.currentPath}),this.setState({isDraggedOver:!1}))))},this.handleDrop=()=>{this.setState({isDraggedOver:!1})},this.handleDragOver=e=>{e.preventDefault(),e.stopPropagation()},this.handleMouseEnter=()=>{this.props.enableDragging||this.setState({isDraggedOver:!0})},this.handleMouseLeave=()=>{this.state.isDraggedOver&&this.setState({isDraggedOver:!1})},this.handleMouseUp=()=>{this.state.isDraggedOver&&this.setState({isDraggedOver:!1})},this.eventHandlers={onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop,onDragOver:this.handleDragOver,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp},this.state={isDraggedOver:!1}}componentDidMount(){this.dragEnterCount=0,this.lastEnteredElement=null}render(){const{getUrlForPath:e,path:t,index:a,isOnlyCrumb:r,maxWidth:o,isLastCrumb:n,shouldHighlightDropTargets:l,size:d}=this.props,c=r?this.props.folderName:s.Emstring.em_snippet(this.props.folderName,o),h={"breadcrumb-segment":!0,"breadcrumb-text-dragged-over":!n&&l&&this.state.isDraggedOver},g=d===F.SMALL?s.Text:s.Title,u=d===F.SMALL?"small":"standard";let m;return m=n?i.React$1.createElement(g,Object.assign({size:u,"aria-current":"page"},this.eventHandlers,{"data-testid":"breadcrumb-segment"}),c):i.React$1.createElement("span",Object.assign({className:"breadcrumb-segment__wrapper"},this.eventHandlers),i.React$1.createElement(s.UserEducationEffect,{containerName:"BreadcrumbSegment",name:`link-${a}`,useSpan:!0},i.React$1.createElement(g,{size:u,color:"faint"},i.React$1.createElement("a",{href:e(t).toString(),onClick:this.props.onTitleClick,className:s.cx(h),"data-testid":"breadcrumb-segment"},c),i.React$1.createElement(s.UIIcon,{src:s.ChevronRightLine,size:"small",className:"breadcrumb__spacer"})))),this.props.folderName!==c?i.React$1.createElement(p.TitleBubble,{content:this.props.folderName,position:S.StickyPosition.BOTTOM,className:"list-label__title-bubble"},m):m}}D.defaultProps={isOnlyCrumb:!1,shouldHighlightDropTargets:!1,disableDragging:!1},D.displayName="BreadcrumbSegment";class R extends i.React$1.Component{constructor(e){super(e),this.handleDragEnter=e=>{e.preventDefault(),e.target!==this.lastEnteredElement&&this.props.enableDragging&&(this.lastEnteredElement=e.target,this.dragEnterCount+=1,this.setState({isDraggedOver:!0}),this.props.setFileUploaderPath({path:this.props.path,targetSurface:"breadcrumb"}))},this.handleDragLeave=e=>{e.preventDefault(),this.props.enableDragging&&(this.lastEnteredElement=null,this.dragEnterCount-=1,this.dragEnterCount<1&&(this.dragEnterCount=0,this.state.isDraggedOver&&(this.props.setFileUploaderPath({path:this.props.currentPath}),this.setState({isDraggedOver:!1}))))},this.handleDrop=e=>{this.setState({isDraggedOver:!1}),this.dragEnterCount=0,this.props.onClose()},this.handleDragOver=e=>{e.preventDefault(),e.stopPropagation()},this.handleMouseEnter=()=>{this.props.enableDragging&&this.setState({isDraggedOver:!0})},this.handleMouseLeave=()=>{this.state.isDraggedOver&&(this.setState({isDraggedOver:!1}),this.props.onClose())},this.handleMouseUp=()=>{this.state.isDraggedOver&&this.setState({isDraggedOver:!1}),this.props.enableDragging&&!this.props.isLastCrumb&&this.props.onClose()},this.state={isDraggedOver:!1}}componentDidMount(){this.dragEnterCount=0,this.lastEnteredElement=null}render(){const{icon:e,alt:t,folderName:a}=this.props,r={"breadcrumb-text-dragged-over":this.state.isDraggedOver};return i.React$1.createElement(s.Menu.LinkItem,{href:this.props.href,onClick:this.props.onCrumbClick,className:s.cx(r),withLeftAccessory:i.React$1.createElement(s.IconContent,{name:e,"aria-label":t,role:"img",className:"breadcrumb-menu-item-icon"}),onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop,onDragOver:this.handleDragOver,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp},s.Emstring.em_snippet(a,20))}}R.defaultProps={isHighlightedDropTarget:!1,onClose(){},alt:"",disableDragging:!1},R.displayName="BreadcrumbMenuItem";class I extends i.React$1.Component{constructor(){super(...arguments),this.state={menuVisible:!1},this.handleDragOver=e=>t=>{this.props.enableDragging&&(t.preventDefault(),e({autoFocus:!1}),this.setState({menuVisible:!0}))},this.handleInnerDragEnter=e=>{e.preventDefault(),this.dragEnterCount++},this.handleDragLeave=e=>t=>{t.preventDefault(),this.dragEnterCount--,this.dragEnterCount<1&&(this.dragEnterCount=0,this.state.menuVisible&&(this.setState({menuVisible:!1}),e({autoFocus:!1})))},this.handleMouseEnter=e=>t=>{this.props.enableDragging&&(t.preventDefault(),this.setState({menuVisible:!0}),e({autoFocus:!1}))},this.handleCrumbSelected=e=>{this.props.setUrl({path:e})},this.handlePopoverToggle=({isOpen:e})=>{this.setState({menuVisible:e})},this.handleClose=()=>{this.dragEnterCount=0,this.handlePopoverToggle({isOpen:!1})}}componentDidMount(){this.dragEnterCount=0}render(){const e=[...this.props.crumbs].reverse(),{currentPath:t,shouldHighlightDropTargets:a,setFileUploaderPath:r,enableDragging:o,onTitleClick:n}=this.props,l=m.intl.formatMessage({id:"JY5LSc",defaultMessage:"Show parent folders (descending)"});return i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(s.Menu.Wrapper,{onSelection:this.handleCrumbSelected,shouldPropagateClickOutsideMouseEvents:!0,className:"breadcrumb-menu-wrapper"},(({getContentProps:d,getTriggerProps:c,openMenu:h,closeMenu:g})=>i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(s.IconButton,Object.assign({variant:"transparent",onDragOver:this.handleDragOver(h),onMouseEnter:this.handleMouseEnter(h)},c()),i.React$1.createElement(s.IconContent,{name:"folder_dropdown-small","aria-label":l,role:"img",className:"breadcrumb-menu-icon"})),i.React$1.createElement(s.Menu.Content,Object.assign({},d(),{onDragEnter:this.handleInnerDragEnter,onDragLeave:this.handleDragLeave(g)}),i.React$1.createElement(s.Menu.Segment,null,e.map((e=>i.React$1.createElement(R,{key:encodeURI(e.path),path:e.path,icon:e.icon,alt:e.alt,folderName:e.folderName,currentPath:t,isHighlightedDropTarget:a,setFileUploaderPath:r,onClose:this.handleClose,enableDragging:o,onCrumbClick:n(e),href:this.props.getUrlForPath(e.path).toString()})))))))),i.React$1.createElement(s.Text,{color:"faint",className:"breadcrumb-menu-icon-parent"},i.React$1.createElement(s.UIIcon,{src:s.ChevronRightLine,className:"breadcrumb__spacer",size:"small"})))}}I.defaultProps={shouldHighlightDropTargets:!1},I.displayName="BreadcrumbMenu";let k="";class M extends i.React$1.Component{constructor(){super(...arguments),this.handleClick=()=>{this.props.onClick(this.props.folder,this.props.index)},this.handleMouseOver=()=>{this.props.onMouseOver(this.props.folder)},this.handleMouseLeave=()=>{this.props.onMouseLeave()}}render(){const{folder:e,isSelected:a,isFocused:r,index:o}=this.props,l=s.Emstring.em_snippet(s.filename(e.path),s.MAX_FOLDER_NAME_LENGTH),c=[i.React$1.createElement(d.MediaCell,{key:l,icon:i.React$1.createElement(s.IconContent,{name:e.icon,disabled:!e.isClickable}),title:l}),i.React$1.createElement(d.MediaCell,{key:"has_subdirs",className:"folder-picker__right-arrow",icon:e.hasSubfolders&&e.isClickable?i.React$1.createElement(n.IconArrow,{name:"right"}):void 0})];let h={className:s.cx({folder_picker_row:!0,read_only:!e.isClickable,focused:r,selected:a}),variant:a?"selected":"default"};e.isClickable&&(h=Object.assign(Object.assign({},h),{onClick:this.handleClick,onMouseOver:this.handleMouseOver,onMouseLeave:this.handleMouseLeave}));const{ref:g}=h,u=t.__rest(h,["ref"]),p=a?m.intl.formatMessage({id:"apGvjm",defaultMessage:"{folder} (selected)"},{folder:l}):l;return i.React$1.createElement(d.MediaRow,Object.assign({role:"option",id:`folder_picker_row_${o}`,"aria-label":p,"aria-selected":a},u),c)}}M.displayName="FolderPickerRow";class T extends i.React$1.Component{constructor(e){super(e),this.preloadErrorImages=()=>{const e=new Image;e.src=i.static_url("/static/metaserver/static/images/illustration_catalog/dropbox_somethings_not_working-vfl2QXPxi.png"),e.srcset=i.static_url("/static/metaserver/static/images/illustration_catalog/dropbox_somethings_not_working@2x-vflkcbmXv.png")+" 2x"},this.setStatus=(e,t)=>{e!==this.state.loadingState&&(this.cancelStatusTimeout(),t?this.setState({loadingState:e,loadingStateShown:e}):(this.setState({loadingState:e}),this.statusTimeout=setTimeout((()=>{this.setState({loadingStateShown:e})}),s.LOADING_MIN_TIME)))},this.cancelStatusTimeout=()=>{void 0!==this.statusTimeout&&clearTimeout(this.statusTimeout),this.statusTimeout=void 0},this.unFocusRows=()=>{this.setState({focusIndex:s.INVALID_FOCUS_INDEX})},this.setPathWithErrorHandling=e=>{this.setPath(e).catch(this.handleError)},this.handleError=e=>{this.props.onError(e),this.props.onFolderSelected(),this.setStatus(s.FolderPickerLoadingState.ERROR)},this.canInstantlySetPath=e=>{if(this.cachedFolders.has(s.normalize(e).toLowerCase())&&this.cachedFolders.has(s.normalize(s.parent_dir(e)).toLowerCase()))return!0;if(this.cachedFolders.has(s.normalize(s.parent_dir(e)).toLowerCase())){const t=a.find(this.cachedFolders.get(s.normalize(s.parent_dir(e)).toLowerCase()),(t=>t.path===e));if(t&&!t.hasSubfolders)return!0}return!1},this.setPath=(e,r)=>t.__awaiter(this,void 0,void 0,(function*(){const{onFolderSelected:t,onDataLoaded:i,user:o}=this.props;let n,l,d,c=[],h=!1;this.setState({loadingPath:e});const g=this.canInstantlySetPath(e);if(this.setStatus(s.FolderPickerLoadingState.LOADING,!0),g||t(void 0,void 0,void 0,void 0,!0),s.paths_are_equal(e,"/"))c=yield this.fetchFolderContents("/"),h=this.canSelectRoot(),n=o.root_ns_id;else{const t=yield this.fetchFolderContents(s.parent_dir(e)),r=a.find(t,(t=>s.paths_are_equal(t.path,e)));if(!r)throw new Error("Could not find folder in API response");d=r.isLockedVaultFolder,n=r.nsId,h=r.isSelectable,l=r.icon,c=r.hasSubfolders?yield this.fetchFolderContents(e):yield this.fetchFolderContents(s.parent_dir(e)),r.hasSubfolders&&0===c.length&&(r.hasSubfolders=!1,c=yield this.fetchFolderContents(s.parent_dir(e)),yield this.fetchFolderContents(s.parent_dir(s.parent_dir(e))))}g||i(e),this.setStatus(s.FolderPickerLoadingState.LOADED,g),this.setState({path:e,folders:c,focusIndex:r?s.INVALID_FOCUS_INDEX:this.getFolderIndex(c,e),isFolderSuggestionSelected:!1}),h||this.props.forceFolderSelectedCallback?t(e,n,void 0,d,void 0,l):t(void 0,void 0)})),this.setupKeyboardShortcuts=()=>{k=r.key.getScope(),k!==s.KEY_SCOPE&&r.key.setScope(s.KEY_SCOPE),r.key("up",s.KEY_SCOPE,this.handleFocusPrevious),r.key("down",s.KEY_SCOPE,this.handleFocusNext),r.key("left",s.KEY_SCOPE,this.handleSelectParent),r.key("right",s.KEY_SCOPE,this.handleSelectCurrentFolder),r.key("space",s.KEY_SCOPE,this.handleSelectCurrentFolder),r.key("enter",s.KEY_SCOPE,this.handleSelect)},this.cleanupKeyboardShortcuts=()=>{r.key.clearScope(s.KEY_SCOPE),k&&r.key.setScope(k),r.key.resetFilter()},this.setupSuggestedLocationKeyboardShortcuts=()=>{k=r.key.getScope(),k!==s.SUGGESTED_LOCATION_KEY_SCOPE&&r.key.setScope(s.SUGGESTED_LOCATION_KEY_SCOPE);const{folderSuggestion:e}=this.state;e&&r.key("enter",s.SUGGESTED_LOCATION_KEY_SCOPE,(()=>this.handleFolderSuggestionClick(e)))},this.cleanupSuggestedLocationKeyboardShortcuts=()=>{r.key.clearScope(s.SUGGESTED_LOCATION_KEY_SCOPE),k&&r.key.setScope(k),r.key.resetFilter()},this.getUrlForBreadcrumb=()=>"#",this.getAccessLevel=e=>e.icon.endsWith(s.ACCESS_LEVEL$1.NO_ACCESS)?s.ACCESS_LEVEL$1.NO_ACCESS:e.icon.endsWith(s.ACCESS_LEVEL$1.LIMITED_ACCESS_VAULT)?s.ACCESS_LEVEL$1.LIMITED_ACCESS_VAULT:e.icon.endsWith(s.ACCESS_LEVEL$1.LIMITED_ACCESS)||e.read_only?s.ACCESS_LEVEL$1.LIMITED_ACCESS:s.ACCESS_LEVEL$1.ACCESS,this.convertJsonFolderToFolder=e=>{const{canSelectReadonly:t}=this.props,{path:a,icon:r,has_subdirs:i,contained_ns:o}=e,n=this.getAccessLevel(e);return{path:a,icon:g.convertLegacyFolderIconToSpectrum(r,"small"),hasSubfolders:i,isSelectable:n===s.ACCESS_LEVEL$1.LIMITED_ACCESS_VAULT||n===s.ACCESS_LEVEL$1.ACCESS||n===s.ACCESS_LEVEL$1.LIMITED_ACCESS&&t,isClickable:n===s.ACCESS_LEVEL$1.LIMITED_ACCESS_VAULT||n===s.ACCESS_LEVEL$1.ACCESS||n===s.ACCESS_LEVEL$1.LIMITED_ACCESS&&(t||i),nsId:o,isLockedVaultFolder:n===s.ACCESS_LEVEL$1.LIMITED_ACCESS_VAULT&&e.read_only}},this.fetchFolderSuggestion=()=>t.__awaiter(this,void 0,void 0,(function*(){const{apiClient:e,user:t,onFetchFolderSuggestionSuccess:s}=this.props;try{const{path:a,prediction_id:r,suggest_id:i}=yield e.fetchFolderSuggestion(t.id);if(a){const e={path:a,predictionId:r};s([e],i),this.setState({folderSuggestion:e})}else s([],i);this.setState({isFolderSuggestionLoading:!1})}catch(e){const t=e.raw?e.raw.responseBody:"Received error response from folder suggestion API";f.reportException({err:new Error(t),tags:["folder_suggestion"],severity:_.SEVERITY.NONCRITICAL}),this.setState({isFolderSuggestionLoading:!1})}})),this.handleFolderHover=e=>{const{folders:t,focusIndex:s}=this.state,a=this.getFolderIndex(t,e.path);a!==s&&this.setState({focusIndex:a})},this.handleFolderClick=(e,t,s)=>{this.props.onRowClicked(e.path,t,!!s),this.setPathWithErrorHandling(e.path)},this.handleBreadcrumbClick=({path:e})=>{this.props.onBreadcrumbClicked(e),this.setPathWithErrorHandling(e)},this.handleFocusPrevious=()=>{this.hasNotLoaded||this.focusNeighboringItem(E.SelectDirection.PREV)},this.handleFocusNext=()=>{this.hasNotLoaded||this.focusNeighboringItem(E.SelectDirection.NEXT)},this.handleSelectParent=()=>{this.hasNotLoaded||this.setPathWithErrorHandling(s.parent_dir(this.state.path))},this.handleSelectCurrentFolder=()=>{const{focusIndex:e,folders:t,path:s}=this.state,a=this.getFolderIndex(t,s);this.hasNotLoaded||e===a||this.handleSelect()},this.handleSelect=()=>{if(this.hasNotLoaded)return;const{focusIndex:e,folders:t,path:s}=this.state;this.getFolderIndex(t,s)===e?this.props.onSuccess():this.handleFolderClick(t[e],e,!0)},this.handleTryAgainClick=()=>{this.cachedFolders.delete(s.normalize(this.state.loadingPath).toLowerCase()),this.cachedFolders.delete(s.parent_dir(this.state.loadingPath).toLowerCase()),this.setPathWithErrorHandling(this.state.loadingPath)},this.setTableRef=e=>{this.table=e?i.reactDomExports.findDOMNode(e):void 0},this.handleFolderSuggestionClick=e=>{this.props.onFolderSuggestionClick(e),this.setState({isFolderSuggestionSelected:!0}),this.props.onFolderSelected(e.path,void 0,e.predictionId)},this.handleFolderSuggestionLocationClick=(e,t)=>{this.props.onFolderSuggestionLocationClick(t),this.setPathWithErrorHandling(e)},this.renderErrorMessage=()=>this.state.loadingStateShown!==s.FolderPickerLoadingState.ERROR?null:i.React$1.createElement("div",{className:"folder-picker__error"},i.React$1.createElement(s.Image$1,{src:i.static_url("/static/metaserver/static/images/illustration_catalog/dropbox_somethings_not_working-vfl2QXPxi.png"),srcHiRes:i.static_url("/static/metaserver/static/images/illustration_catalog/dropbox_somethings_not_working@2x-vflkcbmXv.png"),alt:""}),i.React$1.createElement("span",null,m.intl.formatMessage({id:"zD5i93",defaultMessage:"Something went wrong on our end."})),i.React$1.createElement(s.Button,{variant:"primary",onClick:this.handleTryAgainClick},m.intl.formatMessage({id:"BCyGLk",defaultMessage:"Try again"}))),this.renderLoadingMessage=()=>this.state.loadingStateShown===s.FolderPickerLoadingState.LOADING||this.state.isFolderSuggestionLoading?i.React$1.createElement("tr",{className:"folder-picker-loading"},i.React$1.createElement("td",null,i.React$1.createElement("span",{className:"folder-picker-view__loading-label"},m.intl.formatMessage({id:"9fef95",defaultMessage:"Loading your folders…"})))):null,this.renderFolders=()=>{if(this.hasNotLoaded)return null;const{focusIndex:e,loadingStateShown:t,isFolderSuggestionSelected:a}=this.state;return this.state.folders.map(((r,o)=>i.React$1.createElement(M,{key:r.path,folder:r,index:o,isSelected:s.paths_are_equal(this.state.path,r.path)&&t===s.FolderPickerLoadingState.LOADED&&!a,isFocused:o===e,onClick:this.handleFolderClick,onMouseOver:this.handleFolderHover,onMouseLeave:this.unFocusRows})))},this.renderEmptyMessage=()=>this.hasNotLoaded||this.state.folders.length||!s.paths_are_equal(this.state.path,"/")?null:i.React$1.createElement("tr",{className:"folder-picker__empty-message"},i.React$1.createElement("td",{className:"u-font-center u-pad-top-xl"},i.React$1.createElement(s.Image$1,{src:i.static_url("/static/metaserver/static/images/empty_states/folder-picker-vfl3_Hwxf.png"),srcHiRes:i.static_url("/static/metaserver/static/images/empty_states/folder-picker@2x-vfl7Aum9o.png"),alt:""}),i.React$1.createElement("h2",{className:"u-pad-top-l"},m.intl.formatMessage({id:"wUZqfd",defaultMessage:"This is the only folder there is."})))),this.renderFolderSuggestion=()=>{const{folderSuggestion:e}=this.state;return this.state.loadingStateShown!==s.FolderPickerLoadingState.ERROR&&e&&e.path?this.renderFolderSuggestionTable(e):null},this.renderFolderSuggestionTable=e=>{const{isFolderSuggestionSelected:t}=this.state,a=s.cx("brws-file-row folder-suggestion-row",{"brws-file-row-selected":t}),r=s.filename(e.path),o=t?m.intl.formatMessage({id:"hJeUi9",defaultMessage:"Suggested location: {folder} (selected)"},{folder:r}):m.intl.formatMessage({id:"N0ElEH",defaultMessage:"Suggested location: {folder}"},{folder:r});return i.React$1.createElement(d.Table,{className:"brws-files-view-list folder-suggestion-table",role:"presentation"},i.React$1.createElement(d.TableHead,null,i.React$1.createElement(d.TableHeadCell,{className:"brws-column-header-table-cell",role:"columnheader",scope:"col",tabIndex:0},this.renderFolderSuggestionHeadText(),this.renderFolderSuggestionHeadInfoIcon())),i.React$1.createElement(d.TableBody,{role:"listbox",onFocus:this.setupSuggestedLocationKeyboardShortcuts,onBlur:this.cleanupSuggestedLocationKeyboardShortcuts},i.React$1.createElement(d.CulledMediaRow,{className:a,topOffset:0,onClick:()=>this.handleFolderSuggestionClick(e),role:"option","aria-label":o,"aria-selected":t,tabIndex:0},(({isHovered:t})=>this.renderFolderSuggestionRow(e,t)))))},this.renderFolderSuggestionHeadText=()=>{const e=m.intl.formatMessage({id:"h/hLSy",defaultMessage:"Suggested location"});return i.React$1.createElement("span",null,e," ")},this.renderFolderSuggestionHeadInfoIcon=()=>{const e=m.intl.formatMessage({id:"5hFsVX",defaultMessage:"Based on previous activity and file type"});return i.React$1.createElement(c.Tooltip,{positioning:"above",tooltipContent:e},i.React$1.createElement(l.IconGlobal,{name:"help",className:"icon-help","aria-label":e}))},this.renderFolderSuggestionRow=(e,t)=>i.React$1.createElement(d.MediaCell,{className:"brws-file-name-cell folder-suggestion-name-cell",icon:this.renderFolderSuggestionIcon()},i.React$1.createElement("div",{className:"brws-file-name-cell-text brws-vertically-center"},this.renderFolderSuggestionTitle(e,t),this.renderFolderSuggestionSubtitle(e))),this.renderFolderSuggestionIcon=()=>i.React$1.createElement(s.IconContent,{className:"brws-file-name-cell-icon",name:"folder-small"}),this.renderFolderSuggestionTitle=(e,t)=>{const a=s.filename(e.path);return i.React$1.createElement(d.MediaCellText,{key:"title",highlight:t},i.React$1.createElement("div",{className:"brws-file-name-element"},i.React$1.createElement("span",null,a)))},this.renderFolderSuggestionSubtitle=e=>{const{user:t}=this.props,a=s.parent_dir(e.path),r=s.paths_are_equal(a,"/")?h.get_browse_root_name(t):a.slice(1),o=m.intl.formatMessage({id:"R7F8Tb",defaultMessage:"in {location}"},{location:r});return i.React$1.createElement(d.MediaCellText,{key:"subtitle",variant:"subtitle"},i.React$1.createElement("a",{role:"button",className:"brws-file-name-cell-location folder-suggestion-location",href:"#",onClick:t=>{t.stopPropagation(),t.preventDefault(),this.handleFolderSuggestionLocationClick(a,e)}},o))},this.cachedFolders=new Map,this.state={folders:[],focusIndex:s.INVALID_FOCUS_INDEX,loadingState:s.FolderPickerLoadingState.LOADING,loadingStateShown:s.FolderPickerLoadingState.LOADING,path:e.initialPath,loadingPath:e.initialPath,folderSuggestion:void 0,isFolderSuggestionLoading:!!e.showFolderSuggestion&&!!e.apiClient.fetchFolderSuggestion,isFolderSuggestionSelected:!1}}componentDidMount(){return t.__awaiter(this,void 0,void 0,(function*(){try{yield this.setPath(s.normalize(this.props.initialPath),this.props.skipFocusOnMount)}catch(e){this.handleError(e)}this.state.isFolderSuggestionLoading&&(yield this.fetchFolderSuggestion()),this.preloadErrorImages()}))}componentWillUnmount(){this.cancelStatusTimeout()}componentDidUpdate(e,t){if(this.state.loadingState!==s.FolderPickerLoadingState.LOADING&&t.loadingState===s.FolderPickerLoadingState.LOADING){const e=document.querySelector(".folder-picker-view");e&&!this.props.skipFocusOnMount&&e.focus()}}get hasNotLoaded(){return this.state.loadingStateShown!==s.FolderPickerLoadingState.LOADED||this.state.isFolderSuggestionLoading}canSelectRoot(){const{user:e,canSelectReadonly:t}=this.props;return t||!e.is_cdm_member||e.is_cdm_member&&"edit"===e.user_root_permissions}getFolderIndex(e,t){return a.findIndex(e,(e=>s.paths_are_equal(e.path,t)))}focusNeighboringItem(e){const{folders:t,focusIndex:a}=this.state,r=t.length;let i=a;e===E.SelectDirection.PREV&&a===s.INVALID_FOCUS_INDEX&&i++;for(let s=0;s<r;s++)if(e===E.SelectDirection.PREV?i=(i+r-1)%r:e===E.SelectDirection.NEXT&&(i=(i+1)%r),t[i].isClickable){this.setState({focusIndex:i});break}setTimeout((()=>this.scrollToFocused()))}scrollToFocused(){if(!this.table)return;const e=this.table.getElementsByTagName("tbody").item(0);if(!e)return;const t=this.table.getElementsByClassName("focused").item(0);if(!t)return;const s=t.getBoundingClientRect().top,a=t.getBoundingClientRect().bottom,r=e.getBoundingClientRect().top,i=e.getBoundingClientRect().bottom;s<r||s>i?e.scrollTop+=s-r:a>i&&(e.scrollTop+=a-i)}fetchFolderData(e){return t.__awaiter(this,void 0,void 0,(function*(){const{apiClient:t,user:a}=this.props,r=(yield t.getFolderContents(a.id,e)).map(this.convertJsonFolderToFolder),i=a.cdm_tmf_path&&s.paths_are_equal(e,"/")?[...r.filter((e=>s.paths_are_equal(e.path,a.cdm_tmf_path))),...r.filter((e=>!s.paths_are_equal(e.path,a.cdm_tmf_path)))]:r;return this.cachedFolders.set(s.normalize(e).toLowerCase(),i),i}))}fetchFolderContents(e){return t.__awaiter(this,void 0,void 0,(function*(){const t=s.normalize(e);return this.cachedFolders.get(t.toLowerCase())||this.fetchFolderData(t)}))}renderTable(e){const{rootName:t}=this.props,{path:a,focusIndex:r}=this.state;if(!e||this.state.loadingStateShown===s.FolderPickerLoadingState.ERROR)return null;const o=e-s.PATH_BREADCRUMB_HEIGHT-(this.state.folderSuggestion?s.FOLDER_SUGGESTION_HEIGHT:0);return i.React$1.createElement(d.Table,{columnFlex:[9,1],className:"folder-picker-table",ref:this.setTableRef,role:"presentation"},i.React$1.createElement(d.TableHead,null,i.React$1.createElement(d.TableHeadCell,{className:"folder-picker__breadcrumbs"},i.React$1.createElement(v,{firstBreadcrumbName:t,firstBreadcrumbAlt:t,getUrlForPath:this.getUrlForBreadcrumb,setUrl:this.handleBreadcrumbClick,path:a,size:F.SMALL}))),i.React$1.createElement(d.TableBody,{tabIndex:0,role:"listbox","aria-activedescendant":`folder_picker_row_${r}`,className:"folder-picker-view",style:{height:o},onFocus:this.setupKeyboardShortcuts,onBlur:this.cleanupKeyboardShortcuts},this.renderLoadingMessage(),this.renderFolders(),this.renderEmptyMessage()))}render(){return i.React$1.createElement(o.Dimensions,{className:"folder-picker-container"},(({height:e})=>i.React$1.createElement("div",{className:"folder-picker"},this.renderErrorMessage(),this.renderFolderSuggestion(),this.renderTable(e))))}}T.defaultProps={initialPath:"/",onSuccess:a.noop,onError:a.noop,onDataLoaded:a.noop,onRowClicked:a.noop,onBreadcrumbClicked:a.noop,onFetchFolderSuggestionSuccess:a.noop,onFolderSuggestionClick:a.noop,onFolderSuggestionLocationClick:a.noop},T.displayName="FolderPickerWithoutCSS";const N=s.requireCssWithComponent(T,["/static/metaserver/static/css/browse/browse-vflpkVhOi.css","/static/metaserver/static/css/react/folder_picker-vflhBHl9O.css","/static/metaserver/static/css/scooter/scooter-scoped-vfl0EaHDR.css","/static/metaserver/static/css/dig-components/index.web-vflGcQt8W.css"]);e.FolderPicker=N}));
//# sourceMappingURL=c_folder_dialog_folder_picker.js-vflHjwwvU.map
