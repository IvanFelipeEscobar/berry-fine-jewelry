define(["exports","./c_tslib","./e_ui_page_files_router","./e_edison","./c_lodash-es_lodash","./c_core_i18n","./c_core_utils_time_utils","./c_file_viewer_file_viewer_components","./c_file_viewer_toolbar"],(function(e,t,a,r,n,i,o,_,s){"use strict";function c(e){const t={},a=e.text.split(/#xywh=/i);if(t.imageUrl=a[0],2===a.length){const e=a[1].split(/[ ,]+/);4===e.length&&(t.imageX=+e[0],t.imageY=+e[1],t.imageWidth=+e[2],t.imageHeight=+e[3])}return t}function l(e){const t=c(e);return t.imageUrl?_.preloadImage(t.imageUrl):Promise.reject("Unable to get imageUrl from vtt cue")}function u(e){return new Promise(((t,a)=>{const r=[],n=new WebVTT.Parser(window,WebVTT.StringDecoder());n.oncue=function(e){r.push(e)},n.onparsingerror=function(e){a(e)},n.onflush=function(){t(r)},n.parse(e),n.flush()}))}function m(e){return(a=e,t.__awaiter(void 0,void 0,void 0,(function*(){return(yield fetch(a,{method:"GET",credentials:"include"})).text()}))).then(u);var a}a.injectInternalStyle("js/file_viewer/video_controls/audio_video_markers.module.out.css",(e=>'._commentMarkersContainer_vhuqv_1{height:var(--spacing__unit--0_5);left:0;position:absolute;top:2px;width:100%}._thumbnailHolder_vhuqv_9{--seek_bar_height:var(--spacing__unit--0_5);--seek_bar_height--expanded:calc(var(--seek_bar_height) + 2px);height:var(--spacing__unit--1);left:0;position:absolute;top:0;width:100%}._thumbnailWrapper_vhuqv_20{background-clip:content-box;background-color:var(--color__faint__background);bottom:0;opacity:0;padding-bottom:20px;pointer-events:none;position:absolute;transition:opacity .2s ease-in-out;width:128px}._thumbnailWrapper_vhuqv_20:after{content:"";height:24px;left:50%;pointer-events:auto;position:absolute;transform:translate(-50%);width:100%}._lightTheme_vhuqv_42 ._thumbnailWrapper_vhuqv_20{background-color:var(--color__inverse__faint__background)}.vjs-progress-control:hover ._thumbnailWrapper_vhuqv_20{opacity:1}._thumbnailHolderComment_vhuqv_50{background-color:var(--color__core__accent);cursor:pointer;text-align:center}._commentIconHolder_vhuqv_56{align-items:center;display:none;justify-content:center;width:100%}._thumbnailHolderComment_vhuqv_50:hover ._commentIconHolder_vhuqv_56{display:flex}._thumbnailHolderComment_vhuqv_50:hover ._thumbnailTime_vhuqv_67{display:none}._thumbnailLoadError_vhuqv_71{padding:0 var(--spacing__unit--0_5);width:80px}._thumbnailImage_vhuqv_76{height:72px;margin:2px auto 0;position:relative}._thumbnailImage_vhuqv_76,._thumbnailTime_vhuqv_67{align-items:center;display:flex;justify-content:center}._thumbnailTime_vhuqv_67{font-feature-settings:"tnum";color:var(--color__standard__text);font-family:inherit;font-size:14px;font-variant-numeric:tabular-nums;height:24px;width:100%}._lightTheme_vhuqv_42 ._thumbnailTime_vhuqv_67{color:var(--color__inverse__standard__text)}._thumbnailHolder_vhuqv_9 ._timeLine_vhuqv_102{background-clip:content-box;background-color:var(--color__core__primary);bottom:2px;display:none;height:var(--seek_bar_height--expanded);padding-left:calc(50% - 1px);padding-right:calc(50% - 1px);position:absolute;width:100%;z-index:1}._thumbnailHolder_vhuqv_9:not(._isRedesign2023_vhuqv_116) ._timeLine_vhuqv_102{height:var(--seek_bar_height)}.vjs-progress-control:hover ._timeLine_vhuqv_102{display:block}._rangeMarkersContainer_vhuqv_124{height:var(--spacing__unit--0_5);left:0;position:absolute;top:2px;width:100%}._rangeMarker_vhuqv_124{background-color:var(--color__inverse__success__text);border-left:1px solid var(--color__core__primary);border-right:1px solid var(--color__core__primary)}._commentMarker_vhuqv_1,._rangeMarker_vhuqv_124{height:100%;pointer-events:none;position:absolute}._commentMarker_vhuqv_1{background-color:var(--color__core__primary);width:2px}'));var d;function h(e){var t;switch(null===(t=e.annotation)||void 0===t?void 0:t.type){case"audio":case"video":return e.annotation.time/100;default:return}}!function(e){e.Requesting="requesting",e.Failed="failed",e.ImageLoaded="image_loaded"}(d||(d={}));const v=({duration:e,thread:t,className:a})=>{const n=h(t);if(void 0===n)return null;const i=0===e?0:100*n/e;return r.React$1.createElement("div",{className:a,style:{left:`${i}%`}})};v.displayName="Marker";const p=({threads:e,vttUrl:t,onScrubberThumbnailsLoaded:u,onHoverScrubberThumbnails:p,duration:g,openThreadInRightRail:b,showInverse:f,isRedesign2023:x})=>{const q=r.reactExports.useRef([]),k=i.useIntl(),[E,R]=r.reactExports.useState(d.Requesting),[y,M]=r.reactExports.useState(0),[w,$]=r.reactExports.useState(0),[T,I]=r.reactExports.useState(),[N,C]=r.reactExports.useState(0),L=r.reactExports.useRef(null),H=a.useSelector((e=>e.showResolvedComments)),S=r.React$1.useMemo((()=>e?H?Object.entries(e):Object.entries(e).filter((e=>!e[1].resolvedInfo)):void 0),[e,H]),j=r.React$1.useMemo((()=>S&&S.find((e=>{const t=h(e[1]);return void 0!==t&&100*Math.abs(N-t)/g<2}))),[S,N,g]),U=_.useStabilizedCallback((e=>{j&&(null==b||b(j[1]),e.stopPropagation())}));r.reactExports.useEffect((()=>{t&&m(t).then((e=>{q.current=e,e&&e.length>0&&l(e[0]).then((()=>{R(d.ImageLoaded),u(!0)})).catch((()=>{u(!1),R(d.Failed)}))})).catch((()=>{u(!1),R(d.Failed)}))}),[t,u]);const V=r.reactExports.useMemo((()=>n.throttle((e=>{if(!e.currentTarget)return;const a=e.currentTarget.getBoundingClientRect(),r=a.width,n=e.clientX-a.left,i=Math.min(Math.max(n,0),r)/r*g;if($(a.width),M(e.clientX-a.left),C(i),t&&q.current){const e=q.current.find((e=>e.startTime<=i&&e.endTime>=i));e&&I(c(e))}}),17,{trailing:!1})),[g,t]),W=r.reactExports.useMemo((()=>n.throttle((()=>{p(E===d.ImageLoaded)}),1e3)),[p,E]);r.reactExports.useEffect((()=>{const e=L.current;if(e)return e.addEventListener("click",U),()=>e.removeEventListener("click",U)}),[U,L]);const{imageUrl:F,imageX:P,imageY:z,imageWidth:A,imageHeight:D}=T||{},X=E===d.Failed?80:128,B=E===d.ImageLoaded?{background:`url("${F}") no-repeat -${P}px -${z}px`,width:A,height:D}:E===d.Failed?{display:"none"}:{},O=Math.min(Math.max(0,y-X/2),w-X),Y={left:O},G={left:y-(O+X/2)},J=o.formatTime(N,g,o.showTimestampDecimalPlaces(g)),K=k.formatMessage({id:"3Unj79",defaultMessage:"Loading video thumbnail"});return r.React$1.createElement(r.React$1.Fragment,null,S&&r.React$1.createElement("div",{className:"_commentMarkersContainer_vhuqv_1"},S.map((e=>r.React$1.createElement(v,{className:"_commentMarker_vhuqv_1",key:e[0],duration:g,thread:e[1]})))),r.React$1.createElement("div",{className:a.cx("_thumbnailHolder_vhuqv_9",{_lightTheme_vhuqv_42:!f,_isRedesign2023_vhuqv_116:x}),onMouseMove:V,onMouseEnter:W},r.React$1.createElement("div",{className:a.cx("_thumbnailWrapper_vhuqv_20",{_thumbnailHolderComment_vhuqv_50:!!j,_thumbnailLoadError_vhuqv_71:!!t&&E===d.Failed}),style:Y,ref:L},!!t&&r.React$1.createElement("div",{className:"_thumbnailImage_vhuqv_76",style:B},E===d.Requesting?r.React$1.createElement(a.Spinner,{"aria-valuetext":K,size:"small"}):null),!!j&&!!t&&r.React$1.createElement("div",{className:"_commentIconHolder_vhuqv_56"},r.React$1.createElement(a.IconButton,{className:a.cx(s.regularButton),variant:"transparent",size:"small",inverse:!0},r.React$1.createElement(a.UIIcon,{src:a.CommentLine}))),!!t&&r.React$1.createElement("div",{className:"_thumbnailTime_vhuqv_67"}," ",J," "),r.React$1.createElement("div",{className:"_timeLine_vhuqv_102",style:G}))))};p.displayName="AudioVideoMarkersComponent",p.displayName="AudioVideoMarkersComponent";const g=e=>{var{container:a}=e,n=t.__rest(e,["container"]);return r.reactDomExports.createPortal(r.React$1.createElement(p,Object.assign({},n)),a)};g.displayName="AudioVideoMarkers";e.AudioVideoMarkers=g,e.AudioVideoMarkersComponent=p,e.TimeRangeMarker=({timeRange:e,duration:t,container:a})=>{const n=0===t?0:100*e.start/t;let i;return i=e.end?0===t?0:100*(e.end-e.start)/t:0===t?0:100*(t-e.start)/t,r.reactDomExports.createPortal(r.React$1.createElement("div",{className:"_rangeMarkersContainer_vhuqv_124"},r.React$1.createElement("div",{className:"_rangeMarker_vhuqv_124",style:{left:`${n}%`,width:`${i}%`}})),a)},e.loadVtt=m,e.parseVttCue=c,e.preloadThumbImage=l}));
//# sourceMappingURL=c_file_viewer_video_controls_audio_video_markers.js-vflF9IHNE.map
