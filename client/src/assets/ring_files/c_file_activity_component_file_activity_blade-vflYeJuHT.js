define(["exports","./c_tslib","./e_edison","./e_ui_page_files_router","./c_core_i18n","./c_api_v2_redux_files","./c_src_right-rail_hooks","./c_components_approval-forms_approval_metadata","./c_list_index","./c_combinations_index"],(function(e,t,a,i,s,n,r,c,o,l){"use strict";const d="file_activity_blade_state";var m,u;e.EventState=void 0,(m=e.EventState||(e.EventState={})).loading="loading",m.error="error",m.loaded="loaded",function(e){e.added="added",e.viewed="viewed",e.moved="moved",e.renamed="renamed",e.edited="edited",e.shared="shared",e.commented="commented"}(u||(u={}));const f=[u.added,u.viewed,u.moved,u.renamed,u.edited,u.shared,u.commented],g={added:!0,viewed:!0,moved:!0,renamed:!0,edited:!0,shared:!0,commented:!0},_=s.defineMessage({id:"aYLqOs",defaultMessage:"You added this file"}),v=s.defineMessage({id:"r350bw",defaultMessage:"{name} added this file"}),h=s.defineMessage({id:"WoiUCT",defaultMessage:"You edited this file"}),y=s.defineMessage({id:"PP4asw",defaultMessage:"{name} edited this file"}),p=s.defineMessage({id:"YWTgGL",defaultMessage:"You moved this file"}),M=s.defineMessage({id:"dy7I1D",defaultMessage:"{name} moved this file"}),E=s.defineMessage({id:"9Jrqwg",defaultMessage:"You moved this file from {source} to {destination}"}),R=s.defineMessage({id:"P/MCW3",defaultMessage:"{name} moved this file from {source} to {destination}"}),b=s.defineMessage({id:"LC8/hs",defaultMessage:"You moved this file to {destination}"}),S=s.defineMessage({id:"BYEslL",defaultMessage:"{name} moved this file to {destination}"}),w=s.defineMessage({id:"LUhKEK",defaultMessage:"You renamed this file"}),C=s.defineMessage({id:"CnmSS0",defaultMessage:"{name} renamed this file"}),x=s.defineMessage({id:"6JV0MA",defaultMessage:"You renamed this file from {source} to {destination}"}),T=s.defineMessage({id:"HM1XZN",defaultMessage:"{name} renamed this file from {source} to {destination}"}),A=s.defineMessage({id:"8xmD+i",defaultMessage:"You viewed this file"}),I=s.defineMessage({id:"3Lujbg",defaultMessage:"{name} viewed this file"}),Y=s.defineMessage({id:"9rTtPu",defaultMessage:"You turned on viewer info"});s.defineMessage({id:"LZWy+W",defaultMessage:"{name} turned on viewer info"});const F=s.defineMessage({id:"SpYtHi",defaultMessage:"You turned off viewer info"}),L=s.defineMessage({id:"YreIO/",defaultMessage:"{name} turned off viewer info"}),k=s.defineMessage({id:"Bxed/V",defaultMessage:"You changed the file settings"}),O=s.defineMessage({id:"ylS32o",defaultMessage:"{name} changed the file settings"}),$=s.defineMessage({id:"CuL293",defaultMessage:"You turned on commenting for {entity}"}),j=s.defineMessage({id:"3GsixE",defaultMessage:"{name} turned on commenting for {entity}"}),N=s.defineMessage({id:"IHPb9R",defaultMessage:"You gave view-only access to {entity}"}),B=s.defineMessage({id:"knYfRN",defaultMessage:"{name} gave view-only access to {entity}"}),H=s.defineMessage({id:"fISzu/",defaultMessage:"You removed {entity} from this file"}),P=s.defineMessage({id:"BPYbF7",defaultMessage:"{name} removed {entity} from this file"}),U=s.defineMessage({id:"hs2ngj",defaultMessage:"You shared this file with {entity}"}),D=s.defineMessage({id:"IU0MF2",defaultMessage:"{name} shared this file with {entity}"}),z=s.defineMessage({id:"152Ljh",defaultMessage:"{count, plural, one{You shared this file with {entity} and 1 other} other{You shared this file with {entity} and {count} others}}"}),W=s.defineMessage({id:"ccCFDs",defaultMessage:"{count, plural, one{{name} shared this file with {entity} and 1 other} other{{name} shared this file with {entity} and {count} others}}"}),G=s.defineMessage({id:"YLJCy8",defaultMessage:"You locked this file"}),V=s.defineMessage({id:"hfFN3P",defaultMessage:"{name} locked this file"}),q=s.defineMessage({id:"HdrdWl",defaultMessage:"You unlocked this file"}),Z=s.defineMessage({id:"1vj0Yj",defaultMessage:"{name} unlocked this file"}),Q=s.defineMessage({id:"+hvlZB",defaultMessage:"You commented on this file"}),J=s.defineMessage({id:"Zqv2X5",defaultMessage:"{name} commented on this file"}),K=s.defineMessage({id:"VXfrbS",defaultMessage:"You replied to a comment on this file"}),X=s.defineMessage({id:"MK98nK",defaultMessage:"{name} replied to a comment on this file"});var ee;!function(e){e.event="event",e.dateBanner="date-banner",e.emptyDay="empty-day"}(ee||(ee={}));const te=e=>t=>{const a=ne(Object.assign({activity:t},e));return a?Object.assign({type:ee.event,id:t.id,user:t.user,timestamp:t.timestamp},a):void 0},ae=(e,t)=>{const a=new Date;a.setHours(0,0,0,0);const i=a.getTime(),s=i-864e5,n=new Date(t),r=n.getTime();return r>=i?e.formatMessage({id:"ihD7Zm",defaultMessage:"Today"}):r>=s?e.formatMessage({id:"ZA9ZwS",defaultMessage:"Yesterday"}):e.formatDate(n,{year:"numeric",month:"short",day:"numeric"})},ie=e=>(t,a)=>{if(void 0===a)return t;const i=0===t.length?void 0:t[t.length-1],s=ae(e,a.timestamp);return!i||"timestamp"in i&&ae(e,i.timestamp)!==s?t.concat({type:ee.dateBanner,eventCardDate:s},a):t.concat(a)},se=(e,t,a)=>t===a.id?e.formatMessage({id:"fGE/Cv",defaultMessage:"You"}):a.display_name,ne=e=>{var{activity:a}=e,i=t.__rest(e,["activity"]);switch(a[".tag"]){case"add":return re(Object.assign({activity:a},i),_,v);case"edit":return re(Object.assign({activity:a},i),h,y);case"move":return ce(Object.assign({activity:a},i));case"rename":return oe(Object.assign({activity:a},i));case"view":return re(Object.assign({activity:a},i),A,I);case"file_settings_change":return le(Object.assign({activity:a},i));case"shared_content_change":return de(Object.assign({activity:a},i));case"shared_content_invite":return me(Object.assign({activity:a},i));case"file_lock_change":return ue(Object.assign({activity:a},i));case"comment_new":return re(Object.assign({activity:a},i),Q,J);case"comment_reply":return re(Object.assign({activity:a},i),K,X);case"trello_file_activity":case"shared_link_change":case"slack_link_share":case"zoom_screen_share":return}};function re(e,t,a,i={},s){const{intl:n,viewingUserId:r,activity:{user:c}}=e;return{eventHeadline:r===c.id?n.formatMessage(t,i):n.formatMessage(a,Object.assign(Object.assign({},i),{name:c.display_name})),cardSubheading:s}}const ce=e=>{const{activity:t,rootNamespaceName:a}=e;if("path"in t){const i=c.parentDirName(t.path)||a,s=t.last_path&&(c.parentDirName(t.last_path)||a);return s?re(e,E,R,{source:s,destination:i}):re(e,b,S,{destination:i})}return re(e,p,M)},oe=e=>{const{activity:t}=e;return"filename"in t&&t.last_filename?re(e,x,T,{source:t.last_filename,destination:t.filename}):re(e,w,C)},le=e=>{const{activity:t}=e,a="changed_viewer_info_policy"in t?t.changed_viewer_info_policy:void 0;switch(null==a?void 0:a[".tag"]){case"enabled":return re(e,Y,L);case"disabled":return re(e,F,L);default:return re(e,k,O)}};const de=e=>{const{activity:t}=e;if(!("access_type"in t))return;const a=function(e){return e.changed_group?e.changed_group.name:e.changed_user?e.changed_user.display_name:e.changed_email?e.changed_email:void 0}(t);if(!a)return;const i={entity:a};switch(t.access_type[".tag"]){case"writer":case"owner":case"reader":return re(e,$,j,i);case"reader_no_comment":return re(e,N,B,i);case"no_access":return re(e,H,P,i)}},me=e=>{const{activity:t,intl:a,viewingUserId:i}=e;if(!("shared_users"in t))return;const{shared_users:s,shared_emails:n,shared_groups:r}=t;s.sort(((e,t)=>se(a,i,e).localeCompare(se(a,i,t)))),n.sort(),r.sort(((e,t)=>e.name.localeCompare(t.name)));const c=[...s.map((e=>se(a,i,e))),...n,...r.map((e=>e.name))],o={entity:c[0],count:c.length-1};return 1===c.length?re(e,U,D,o):c.length>1?re(e,z,W,o):void 0},ue=e=>{const{activity:t}=e;if("activity_type"in t)return"lock"===t.activity_type[".tag"]?re(e,G,V):re(e,q,Z)},fe=e=>f.reduce(((t,a)=>e[a]?t+1:t),0),ge=e=>(e=0===fe(e)?g:e,t=>{switch(t[".tag"]){case"add":return e[u.added];case"edit":return e[u.edited];case"move":return e[u.moved];case"rename":return e[u.renamed];case"view":return e[u.viewed];case"file_settings_change":case"file_lock_change":case"shared_content_change":case"shared_content_invite":return e[u.shared];case"comment_new":case"comment_reply":return e[u.commented];case"trello_file_activity":case"shared_link_change":case"slack_link_share":case"zoom_screen_share":return!1}}),_e={status:e.EventState.loading},ve=e=>e[d],he=(e,{fileId:t})=>ve(e).eventHistory[t]||_e,ye=e=>ve(e).filter;i.injectInternalStyle("typescript/component_libraries/files_components/src/blades/file_activity/component/index.module.out.css",(e=>"._activity-history-event-list-container_1fomv_1{flex-grow:1;min-height:0}._activity-history-event-list-container--empty_1fomv_6{padding-left:var(--spacing__unit--0_5);padding-top:var(--spacing__unit--2)}._activity-history-event-header_1fomv_11{padding-left:var(--spacing__unit--0_5);padding-top:var(--spacing__unit--1_5)}._event-history-loading-indicator-container_1fomv_16{align-items:center;display:flex;height:100%;justify-content:center;width:100%}._activity-history-container_1fomv_24 ._activity-history-filter-menu_1fomv_24{background-color:var(--color__standard__background);padding-top:3px;position:-webkit-sticky;position:sticky;top:0;width:100%;z-index:2}._activity-history-container_1fomv_24{display:flex;flex-direction:column;height:auto;position:relative;width:100%}._activity-history-version-history-menu_1fomv_41{margin-left:auto}"));const pe="_activity-history-event-list-container_1fomv_1",Me="_activity-history-event-list-container--empty_1fomv_6",Ee="_activity-history-event-header_1fomv_11",Re="_event-history-loading-indicator-container_1fomv_16",be="_activity-history-container_1fomv_24",Se="_activity-history-filter-menu_1fomv_24",we="_activity-history-version-history-menu_1fomv_41",Ce=({activity:e})=>{const t=s.useIntl();return a.reactExports.createElement("div",{className:i.cx(pe,{[Me]:0===e.length})},0===e.length?a.reactExports.createElement(i.Text,{color:"faint",size:"small"},t.formatMessage({id:"4hDYQO",defaultMessage:"There's nothing in our records"})):a.reactExports.createElement(o.List,null,e.map(xe)))};Ce.displayName="ActivityList";const xe=e=>e.type===ee.event?a.reactExports.createElement(Te,Object.assign({key:e.id},e)):e.type===ee.dateBanner?a.reactExports.createElement(Ie,Object.assign({key:e.eventCardDate},e)):a.reactExports.createElement(Ye,{key:e.id});xe.displayName="ActivityCard";const Te=e=>{const t=s.useIntl();return a.reactExports.createElement(o.List.Item,null,a.reactExports.createElement(o.List.Accessory,null,a.reactExports.createElement(Ae,{user:e.user})),a.reactExports.createElement(o.List.Content,null,a.reactExports.createElement(l.LabelGroup,{withText:e.eventHeadline,withSubtext:t.formatDate(new Date(e.timestamp),{hour:"numeric",minute:"2-digit"})})))};Te.displayName="EventCard";const Ae=({user:e})=>{const t=e.photo_url?e.photo_url:void 0,s=e.display_name.split(/\s+/g).slice(0,2).map((e=>e[0])).join("").toUpperCase();return a.reactExports.createElement(i.Avatar,{src:t,backgroundColor:i.avatarColorForUserIdentifier(s),size:"small",hasNoOutline:!0},s)};Ae.displayName="CardAvatar";const Ie=e=>a.reactExports.createElement("div",{className:Ee},a.reactExports.createElement(i.Text,{isBold:!0,variant:"label"},e.eventCardDate));Ie.displayName="DateBannerCard";const Ye=()=>{const e=s.useIntl();return a.reactExports.createElement(o.List.Item,null,a.reactExports.createElement(i.Text,{variant:"label"},e.formatMessage({id:"NYLgxb",defaultMessage:"Nothing happened on this day"})))};Ye.displayName="EmptyDayCard";const Fe={GetActivityStream:"@@apiv2_redux/file_activity_stream/get_activity_stream",GetActivityStreamResult:"@@apiv2_redux/file_activity_stream/get_activity_stream_result",GetActivityStreamBatch:"@@apiv2_redux/file_activity_stream/get_activity_stream_batch",GetActivityStreamBatchResult:"@@apiv2_redux/file_activity_stream/get_activity_stream_batch_result",RecentFilesWithLatestEvents:"@@apiv2_redux/file_activity_stream/recent_files_with_latest_events",RecentFilesWithLatestEventsResult:"@@apiv2_redux/file_activity_stream/recent_files_with_latest_events_result"},Le=n._createAction(Fe.GetActivityStream),ke=n._createAction(Fe.GetActivityStreamResult),Oe=n._createAction(Fe.GetActivityStreamBatchResult),$e=n._createAction(Fe.RecentFilesWithLatestEventsResult),je={[Fe.GetActivityStream]:{endpoint:"get_activity_stream",action:ke},[Fe.GetActivityStreamBatch]:{endpoint:"get_activity_stream_batch",action:Oe},[Fe.RecentFilesWithLatestEvents]:{endpoint:"recent_files_with_latest_events",action:$e}},Ne=n._createMiddleware(je),Be={added:s.defineMessage({id:"pQdQ0E",defaultMessage:"Added"}),viewed:s.defineMessage({id:"nw8m8S",defaultMessage:"Viewed"}),moved:s.defineMessage({id:"jqrPlN",defaultMessage:"Moved"}),renamed:s.defineMessage({id:"+bqj0P",defaultMessage:"Renamed"}),edited:s.defineMessage({id:"eq7WUQ",defaultMessage:"Edited"}),shared:s.defineMessage({id:"2Vp/+6",defaultMessage:"Shared"}),commented:s.defineMessage({id:"nih9gu",defaultMessage:"Commented"})};function He(e){return fe(e)===f.length}const Pe=e=>a.React$1.createElement(i.Menu.ActionItem,{key:e.value,value:e.value,role:"menuitemcheckbox","aria-checked":e.isChecked,"aria-label":e.label,withLeftAccessory:a.React$1.createElement(i.Checkbox,{checked:e.isChecked,readOnly:!0,tabIndex:-1})},e.label);var Ue;e.FilterUserEvent=void 0,(Ue=e.FilterUserEvent||(e.FilterUserEvent={})).SELECT_ALL_HISTORY_TYPE="select_all_history_type",Ue.CLEAR_SELECT_HISTORY_TYPE="clear_select_history_type",Ue.SELECT_HISTORY_TYPE="select_history_type",Ue.UNSELECT_HISTORY_TYPE="unselect_history_type";const De=({filter:t,setFilter:n,logFilterChange:r,logUserAction:c})=>{const o=s.useIntl(),l=fe(t),d=a.React$1.useCallback((a=>{n(Object.assign(Object.assign({},t),{[a]:!t[a]})),null==r||r(t[a]?e.FilterUserEvent.UNSELECT_HISTORY_TYPE:e.FilterUserEvent.SELECT_HISTORY_TYPE),null==c||c("add_activity_filter",a)}),[t,r,n]),m=a.React$1.useCallback((({isOpen:e})=>{e&&(null==c||c("activity_filter_menu"))}),[c]),u=a.React$1.useCallback((()=>{He(t)?(n({}),null==r||r(e.FilterUserEvent.CLEAR_SELECT_HISTORY_TYPE)):(n(g),null==r||r(e.FilterUserEvent.SELECT_ALL_HISTORY_TYPE))}),[t,r,n]);return a.React$1.createElement("div",{className:Se},a.React$1.createElement(i.Menu.Wrapper,{closeOnSelection:!1,isPortaled:!1,onSelection:d,onToggle:m},(({getContentProps:e,getTriggerProps:s})=>a.React$1.createElement(a.React$1.Fragment,null,a.React$1.createElement(i.FilterChip,Object.assign({withDropdownIcon:!0},s()),o.formatMessage({id:"k7FRk3",defaultMessage:"Filter"}),l>0?` • ${l}`:null),a.React$1.createElement(i.Menu.Content,Object.assign({},e(),{style:{width:296}}),a.React$1.createElement(i.Menu.Segment,{withLabel:a.React$1.createElement(a.React$1.Fragment,null,a.React$1.createElement(i.Text,{isBold:!0},o.formatMessage({id:"YAOfjz",defaultMessage:"Select type"})),a.React$1.createElement(i.Button$1,{variant:"transparent",onClick:u},a.React$1.createElement(i.Text,{isBold:!0,size:"small"},He(t)?o.formatMessage({id:"JPzwuS",defaultMessage:"Clear"}):o.formatMessage({id:"JlWpUr",defaultMessage:"Select all"}))))},f.map((e=>a.React$1.createElement(Pe,{key:e,value:e,label:o.formatMessage(Be[e]),isChecked:!!t[e]})))))))))};De.displayName="ActivityFilter",e.FileActivityActionTypes=void 0,(e.FileActivityActionTypes||(e.FileActivityActionTypes={})).SET_FILTER="FILE_ACTIVITY/SET_FILTER";const ze=a.React$1.memo((({fileId:t,user:n,rootNamespaceName:r="Dropbox",logFilterChange:c,logUserAction:o})=>{const l=s.useIntl(),d=i.useDispatch(),m=a.React$1.useMemo((()=>i.createSelector(he,ye,((t,a)=>t.status===e.EventState.loaded?{status:t.status,activity:t.activity.filter(ge(a))}:t))),[]),u=i.useSelector((e=>m(e,{fileId:t}))),f=i.useSelector(ye),g=i.useSelector((a=>((t,a)=>{const i=he(t,a);return i.status===e.EventState.loaded&&i.activity.length})(a,{fileId:t}))),_=a.React$1.useMemo((()=>{return t=u,a={intl:l,viewingUserId:n.account_id,rootNamespaceName:r},t.status!==e.EventState.loaded?[]:t.activity.sort(((e,t)=>e.timestamp<t.timestamp?1:e.timestamp>t.timestamp?-1:0)).map(te(a)).reduce(ie(a.intl),[]);var t,a}),[u,l,n,r]);a.React$1.useEffect((()=>{d(Le({arg:{file_path_or_id:t},params:{subjectUserId:String(n.id)}}))}),[t,n,d]);const v=a.React$1.useCallback((t=>{d({type:e.FileActivityActionTypes.SET_FILTER,filter:t})}),[d]);return a.React$1.createElement("div",{className:be},u.status===e.EventState.loading?a.React$1.createElement("div",{className:Re},a.React$1.createElement(i.Spinner,{size:"standard","aria-valuetext":l.formatMessage({id:"csFB2E",defaultMessage:"Loading"})})):u.status===e.EventState.error?a.React$1.createElement(i.Text,{color:"faint",size:"small"},u.errorString):g?a.React$1.createElement(a.React$1.Fragment,null,a.React$1.createElement(De,{filter:f,setFilter:v,logFilterChange:c,logUserAction:o}),a.React$1.createElement(Ce,{activity:_})):a.React$1.createElement(i.Text,{size:"small",color:"faint"},l.formatMessage({id:"E5o8M1",defaultMessage:"When people work with this file, you'll see their activity here."})))}));ze.displayName="FileActivity";var We=Object.freeze({__proto__:null,FileActivity:ze});const Ge=({onVersionHistoryClicked:e,iconSize:t="small"})=>{const n=s.useIntl(),r=a.React$1.useCallback((t=>{"version-history"===t&&e()}),[e]);return a.React$1.createElement(i.Menu.Wrapper,{onSelection:r,className:we},(({getTriggerProps:e,getContentProps:s})=>{const r=e();return a.React$1.createElement(i.IconButton,Object.assign({variant:"transparent"},r,{onClick:e=>{var t;e.stopPropagation(),null===(t=r.onClick)||void 0===t||t.call(r,e)},size:"small","aria-label":n.formatMessage({id:"eCPSMy",defaultMessage:"Other actions"})}),a.React$1.createElement(i.UIIcon,{src:i.MoreHorizontalLine,size:t,"aria-label":""}),a.React$1.createElement(i.Menu.Content,Object.assign({},s()),a.React$1.createElement(i.Menu.Segment,null,a.React$1.createElement(i.Menu.ActionItem,{value:"version-history"},n.formatMessage({id:"h+Ew4R",defaultMessage:"Version history"})))))}))};Ge.displayName="VersionHistoryMenu";const Ve=c=>{var{id:o,versionHistory:l,intl:d}=c,m=t.__rest(c,["id","versionHistory","intl"]);!function(t){const s=i.useDispatch();a.reactExports.useEffect((()=>{s({type:e.FileActivityActionTypes.SET_FILTER,filter:{}})}),[s,t])}(m.fileId);const u=r.useIsExpanded(o);return a.reactExports.createElement(s.Provider,{value:d},a.reactExports.createElement(n.RightRail.Blade,{withTitle:d.formatMessage({id:"avG+QD",defaultMessage:"Activity"}),withIcon:a.reactExports.createElement(i.UIIcon,{src:i.FileHistoryLine}),id:o,withTitleRightAccessory:u&&l&&l.enabled&&a.reactExports.createElement(Ge,{onVersionHistoryClicked:l.onVersionHistoryClicked})},a.reactExports.createElement(ze,Object.assign({},m))))};Ve.displayName="FileActivityBlade";const qe=({id:e,intl:t})=>a.reactExports.createElement(n.RightRail.CollapsedBladeIcon,{id:e,withIcon:a.reactExports.createElement(i.UIIcon,{src:i.FileHistoryLine,"aria-label":t.formatMessage({id:"Qimr0o",defaultMessage:"Open activity panel"})}),tooltip:t.formatMessage({id:"huSYqM",defaultMessage:"Activity"})});qe.displayName="CollapsedFileActivityBladeButton",e.Action=Fe,e.CollapsedFileActivityBladeButton=qe,e.FILE_ACTIVITY_BLADE_NAMESPACE_KEY=d,e.FileActivityBlade=Ve,e.VersionHistoryMenu=Ge,e.defaultFileActivityState={filter:{},eventHistory:{}},e.file_activity_esnext=We,e.middleware=Ne}));
//# sourceMappingURL=c_file_activity_component_file_activity_blade.js-vflCUmTZ1.map
