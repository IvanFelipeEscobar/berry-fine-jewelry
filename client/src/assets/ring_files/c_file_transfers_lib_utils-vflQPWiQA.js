define(["exports","./c_tslib","./e_ui_page_files_router","./c_src_common_constants2","./c_file_transfers_lib_urls","./c_lodash-es_lodash","./c_core_browser_detection","./c_browser_cookies","./c_downloads","./e_core_exception","./c_upload_kit_lib_types","./c_core_i18n"],(function(e,r,t,a,i,n,o,s,l,c,d,f){"use strict";var u,T,p,m,g,S,_,F,E,h,L,O;e.UserFlow=void 0,(u=e.UserFlow||(e.UserFlow={})).TRANSFER_MANAGEMENT_MODAL="transfer_management_modal",u.MANAGEMENT_LIST_VIEW="management_list_view",u.CREATION="creation",u.RECIPIENT="recipient",u.BROWSE="browse",u.TRANSFER_CREATION_MODAL="transfer_creation_modal",e.ModalVisibilityChange=void 0,(T=e.ModalVisibilityChange||(e.ModalVisibilityChange={})).OPEN="open",T.CANCEL="cancel",T.OK="ok",e.SettingsVisibilityChange=void 0,(p=e.SettingsVisibilityChange||(e.SettingsVisibilityChange={})).OPEN="open",p.CLOSE="close",e.TransferListView=void 0,(m=e.TransferListView||(e.TransferListView={}))[m.Active=0]="Active",m[m.Expired=1]="Expired",m[m.All=2]="All",e.Actions=void 0,(g=e.Actions||(e.Actions={})).ChangeSettingsModalState="FileTransfers/ChangeSettingsModalState",g.ChangeConfirmTransferDeletionModalState="FileTransfers/ChangeConfirmTransferDeletionModalState",g.LogTransferCreationModalOpened="FileTransfers/LogTransferCreationModalOpened",g.CopyTransferLink="FileTransfers/CopyTransferLink",g.DeleteTransferSummary="FileTransfers/DeleteTransferSummary",g.ExpireTransferSummary="FileTransfers/ExpireTransferSummary",g.ReactivateTransferSummary="FileTransfers/ReactivateTransferSummary",g.FinishedEditing="FileTransfers/FinishedEditing",g.HideOnboardingStep="FileTransfers/HideOnboardingStep",g.InitApp="FileTransfers/InitApp",g.LogAllItemsUploaded="FileTransfers/LogAllItemsUploaded",g.LogAutoDownload="FileTransfers/LogAutoDownload",g.LogOnboarding="FileTransfers/LogOnboarding",g.LogEmailFeedback="FileTransfers/LogEmailFeedback",g.LogUpsell="FileTransfers/LogUpsell",g.MarkOnboardingStepComplete="FileTransfers/MarkOnboardingStepComplete",g.MarkServerRestrictedFiles="FileTransfers/MarkServerRestrictedFiles",g.MetadataUpdated="FileTransfers/MetadataUpdated",g.SendTransferViaEmail="FileTransfers/SendTransferViaEmail",g.TrackUserLeapEvent="FileTransfers/TrackUserLeapEvent",g.ReceivedTransferRowClick="FileTransfers/ReceivedTransferRowClick",g.TransferManagementTabClick="FileTransfers/TransferManagementTabClick",g.SetActiveUserId="FileTransfers/SetActiveUserId",g.SetBackground="FileTransfers/SetBackground",g.SetBackgroundPreview="FileTransfers/SetBackroundPreview",g.SetLogo="FileTransfers/SetLogo",g.SaveLogo="FileTransfers/SaveLogo",g.SetCurrentTransfer="FileTransfers/SetCurrentTransfer",g.SetExpiration="FileTransfers/SetExpiration",g.SetIsShared="FileTransfers/SetShareStatus",g.SetIsShareComplete="FileTransfer/SetShareComplete",g.ChangeManagementModalState="FileTransfers/ChangeManagementModalState",g.SetProductConfig="FileTransfers/SetProductConfig",g.SetRecipients="FileTransfers/SetRecipients",g.SetShareUrl="FileTransfers/SetShareUrl",g.SetFileTransfersUserMetadata="FileTransfers/SetFileTransfersUserMetadata",g.UpdateTransferSummaries="FileTransfers/UpdateTransferSummaries",g.AddNewTransferSummary="FileTransfers/AddNewTransferSummary",g.UpdateReceivedTransferSummaries="FileTransfers/UpdateReceivedTransferSummaries",g.ViewFeedbackForm="FileTransfers/ViewFeedbackForm",g.TemporarilySaveEmailFormInfo="FileTransfers/TemporarilySaveEmailFormInfo",g.ClearSavedEmailFormInfo="FileTransfers/ClearSavedEmailFormInfo",g.LogInternetDisconnected="FileTransfers/LogInternetDisconnected",g.LogOnboardingStepShown="FileTransfers/LogOnboardingStepShown",g.MarkOnboardingStepShown="FileTransfers/MarkOnboardingStepShown",g.LogShareError="FileTransfers/LogShareError",g.UpdateSettingsFromManagementModal="FileTransfers/UpdateSettingsFromManagementModal",g.LogSettingsClicked="LogSettingsClicked",g.RemoveReceivedTransferFromList="FileTransfers/RemoveReceivedTransferFromList",g.LogRemoveReceivedTransferClicked="FileTransfers/LogRemoveReceivedTransferClicked",g.LogShopEntryPointViewed="FileTransfers/LogShopEntryPointViewed",g.LogShopEntryPointClicked="FileTransfers/LogShopEntryPointClicked",e.UploadStatus=void 0,(S=e.UploadStatus||(e.UploadStatus={}))[S.Waiting=0]="Waiting",S[S.Uploading=1]="Uploading",S[S.Success=2]="Success",S[S.Error=3]="Error",e.FileSource=void 0,(_=e.FileSource||(e.FileSource={})).Dropbox="dropbox",_.Computer="computer",_.Transfer="transfer",e.OriginalFileSource=void 0,(F=e.OriginalFileSource||(e.OriginalFileSource={})).Dropbox="dropbox",F.Computer="computer",F.Unknown="unknown",e.UploadActionSource=void 0,(E=e.UploadActionSource||(e.UploadActionSource={})).DRAG_DROP="drag_drop",E.DROPBOX_CHOOSER_ADDITIONAL="dropbox_chooser_additional",E.DROPBOX_CHOOSER_INITIAL="dropbox_chooser_initial",E.UPLOAD_BUTTON_ADDITIONAL="upload_button_additional",E.UPLOAD_BUTTON_INITIAL="upload_button_initial",E.DESKTOP_CONTEXT_MENU="desktop_context_menu",E.PAGELET_ON_LOAD="pagelet_on_load",E.TRANSFER_CREATION_MODAL_ON_LOAD="transfer_creation_modal_on_load",e.UploadErrorType=void 0,(h=e.UploadErrorType||(e.UploadErrorType={})).EmptyFile="empty_file",h.IgnoredFile="ignored_file",h.OverMaxFileSize="over_max_file_size",h.PointerFile="pointer_file",h.TemporaryFile="temporary_file",h.InvalidChar="invalid_char",h.NotFound="not_found",h.NoPermission="no_permission",h.Restricted="restricted",h.InvalidArgs="invalid_args",h.Unknown="unknown",e.UploadCancelSource=void 0,(L=e.UploadCancelSource||(e.UploadCancelSource={})).CancelButton="cancel_button",L.WindowClose="window_close",function(e){e[e.NOT_STARTED=0]="NOT_STARTED",e[e.DOWNLOADING=1]="DOWNLOADING",e[e.ERROR=2]="ERROR",e[e.PAUSED=3]="PAUSED",e[e.FETCHING_TOKENS=4]="FETCHING_TOKENS",e[e.CANCELED=5]="CANCELED",e[e.COMPLETED=6]="COMPLETED"}(O||(O={}));class C extends Error{constructor(e){super(e),this.message=e,this.name="BlockTokenExpired"}}function I(e){return{recipient:{".tag":"email_address",email_address:e.email}}}function D(e,r={}){return void 0===r.numDecimalPlaces&&(e<t.SWITCH_UNIT_THRESHOLD*a.BYTES_IN_KILOBYTE?r.numDecimalPlaces=0:e<t.SWITCH_UNIT_THRESHOLD*a.BYTES_IN_MEGABYTE?r.numDecimalPlaces=1:r.numDecimalPlaces=2),t.format_bytes(e,r.numDecimalPlaces,r.includeSpace,r.lazy,r.allowNegative)}function A(e){const r=localStorage.getItem(e);return null===r?null:"true"===r}function U(e,r){localStorage.setItem(e,r.toString())}function v(e,r){return e.title||y(e.summary_file_names,e.display_file_count,r)}function y(e,r,t){return 0===e.length?f.intl.formatMessage({id:"syJiNE",defaultMessage:"Transfer with no items"}):r<=1?f.intl.formatMessage({id:"8oHG0B",defaultMessage:"{item_name}"},{item_name:t?N(e[0]):e[0]}):f.intl.formatMessage({id:"IUBT/B",defaultMessage:"{item_name} + {item_count}"},{item_name:t?N(e[0]):e[0],item_count:r-1})}function N(e){let r=e;if(e.length>i.MAX_LEN_OF_FILE_NAME){r=`${e.slice(0,i.LEN_OF_FILE_NAME_PREFIX)}...${e.slice(e.length-i.LEN_OF_FILE_NAME_SUFFIX)}`}return r}function R(r,t){return{id:r.transfer_file_id,isDir:r.obsolete_is_dir,path:r.relative_path,size:r.file_size,source:e.FileSource.Transfer,originalSource:t,thumbnailUrl:r.thumbnail_url||null,fileForPreview:r.file_preview_info}}function w(r){return{id:r.file_id,isDir:r.is_dir,path:t.filename(r.ns_path),size:r.bytes,source:e.FileSource.Dropbox,originalSource:e.OriginalFileSource.Dropbox,thumbnailUrl:null}}function M(e){const r=e.split("/");return r[r.length-1]}function b(e,r={}){return Object.assign({id:e.id,isDir:e.isDir,name:M(e.path),size:e.size,thumbnailUrl:e.thumbnailUrl,fileForPreview:e.fileForPreview},r)}function k(e){return null===P(e)}function P(e){let r;if("dest"in e)r=e.dest;else if("fullPath"in e){if(!e.fullPath)return null;r=e.fullPath,"/"===r.charAt(0)&&(r=e.fullPath.substring(1))}else{if(!("path"in e))throw new Error("file must be either PluploadFile, StateFileInfo, or FileSystemEntry");if(!e.path)return null;r=e.path}const t=r.split("/");return t.length<=1?null:t[0]}function x(e){return e||i.NULL_FILE_TRANSFER_KEY}function B(r){return r.isDir&&r.source===e.FileSource.Computer}function V(e,r=[]){const a=[],i=[],n=new Set,o=new Set;return r.filter((e=>k(e))).forEach((e=>{n.add(e.id),o.add(e.path.toLowerCase())})),e.forEach((e=>{let r;const s=t.split_filename(e.path);let l;if(o.has(e.path.toLowerCase())){if(n.has(e.id))return;let t,i=1;do{t=`${s.name} (${i})`,r=s.ext?`${t}.${s.ext}`:t,i++}while(o.has(r.toLowerCase()));n.add(e.id),o.add(r.toLowerCase()),l=Object.assign(Object.assign({},e),{path:r}),a.push(l)}else k(e)?(n.add(e.id),o.add(e.path.toLowerCase()),l=Object.assign({},e)):l=Object.assign({},e);i.push(l)})),{files:i,filesRenamed:a}}const H=864e5;function Y(e,r){return Math.round((r.getTime()-e.getTime())/H)}function W(e,r){const t=Y(new Date(e.getFullYear(),e.getMonth(),e.getDate()),new Date(r.getFullYear(),r.getMonth(),r.getDate()));switch(t){case a.ExpirationOption.SEVEN_DAYS:case a.ExpirationOption.THIRTY_DAYS:case a.ExpirationOption.NINETY_DAYS:return t;default:return a.ExpirationOption.CUSTOM}}function K(e,r){const t={ctaCopy:e.cta_copy,ctaLink:e.cta_link,productName:e.product_name};return r&&(t.ctaLink=i.addTrackingParams(t.ctaLink,{},r)),t}function G(e){return r=>function(e){return e.value?e.value[".tag"]:"other"}(r)===e}const z=G("image"),X=G("video");function $(e){return!!e.color_hex&&!e.asset}function j(e){return!!e.asset&&z(e.asset)}function J(e){return!!e.asset&&X(e.asset)}function Z(){return t.UUID.v4()}function q(e,r){if(!e.isDir)throw Error("Can only get children of a directory");return r.filter((r=>r.path!==e.path&&r.path.startsWith(`${e.path}/`)))}function Q(r,t){return r.every((r=>t[r.id]&&t[r.id].status===e.UploadStatus.Success))}function ee(e,r){const t=e=>Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),a=t(r)-t(e);return new Date(+e+a)}function re(e){var r;switch(null===(r=e.error_type)||void 0===r?void 0:r[".tag"]){case"not_found":return d.UploadErrorType.NotFound;case"no_permission":return d.UploadErrorType.NoPermission;case"restricted":return d.UploadErrorType.Restricted;case"invalid_args":return d.UploadErrorType.InvalidArgs;default:return d.UploadErrorType.Unknown}}function te(e){return e?a.DEFAULT_EXPIRATION_OPTION_PAID:a.DEFAULT_EXPIRATION_OPTION_FREE}const ae=(e,r)=>{const a=i.prepareFileIdsParam(e);t.Snackbar.sync(f.intl.formatMessage({id:"EmOY+w",defaultMessage:"Creating new transfer..."}),!1,"create-transfer"),t.redirect(i.createTransferUrlWithParams({referrer:r,fileids:a}))},ie=(e,r)=>e&&r.length>0&&!r.some((e=>e.is_cloud_doc))&&!r.some(t.File.isNoAccessSharedFolder);var ne=Object.freeze({__proto__:null,DAYS_IN_MS:H,areItemsUploaded:Q,browseFileAsStateFileInfo:w,computeCreationRelativeExpirationDate:ee,contactToEmailRecipient:I,convertToUploadErrorType:re,estimateExpirationOption:W,fileNameFromPath:M,formatBytes:D,formatLongFileNameForDisplay:N,generateTransferSummaryTitle:v,generateTransferTitle:y,generateTransferTrackingId:Z,getChildrenFiles:q,getDateDiff:Y,getDefaultExpirationOption:te,getLocalStorageBooleanValueForKey:A,getRootDirectory:P,getTransferFilesKey:x,getUpsellProps:K,isAtRoot:k,isColorBackground:$,isImageBackground:j,isLocalDirectory:B,isVideoBackground:J,redirectToCreateTransferWithFiles:ae,renameDuplicateFiles:V,setLocalStorageValueForKey:U,shouldShowTransferInSplitShare:ie,stateFileInfoAsFileInfo:b,transferFileAsStateFileInfo:R});e.areItemsUploaded=Q,e.browseFileAsStateFileInfo=w,e.computeCreationRelativeExpirationDate=ee,e.contactToEmailRecipient=I,e.convertToUploadErrorType=re,e.estimateExpirationOption=W,e.formatBytes=D,e.formatTimestamp=function(e){return t.format_date_utc(e,"yyyy-MM-ddTHH:mm:ssZ")},e.generateTransferSummaryTitle=v,e.generateTransferTrackingId=Z,e.getChildrenFiles=q,e.getDateDiff=Y,e.getDefaultExpirationOption=te,e.getLocalStorageBooleanValueForKey=A,e.getTransferFilesKey=x,e.getUpsellProps=K,e.isAtRoot=k,e.isColorBackground=$,e.isImageBackground=j,e.isLocalDirectory=B,e.isVideoBackground=J,e.redirectToCreateTransferWithFiles=ae,e.renameDuplicateFiles=V,e.setLocalStorageValueForKey=U,e.shouldShowTransferInSplitShare=ie,e.stateFileInfoAsFileInfo=b,e.transferFileAsStateFileInfo=R,e.utils_esnext=ne}));
//# sourceMappingURL=c_file_transfers_lib_utils.js-vflouRVWr.map
