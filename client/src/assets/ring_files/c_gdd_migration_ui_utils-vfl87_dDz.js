define(["exports","./c_core_i18n","./e_edison","./e_ui_page_files_router","./c_tslib","./c_profile_services_profile_services_link","./c_profile_services_profile_services_constants","./c_file_imports_gdrive_file_picker"],(function(e,t,i,a,s,o,n,r){"use strict";var l;e.Strings=void 0,(l=e.Strings||(e.Strings={})).OK=t.intl.formatMessage({id:"G6rEKj",defaultMessage:"OK"}),l.NEXT=t.intl.formatMessage({id:"yah+je",defaultMessage:"Next"}),l.BACK=t.intl.formatMessage({id:"k9vJ0G",defaultMessage:"Back"}),l.CANCEL=t.intl.formatMessage({id:"S53N5s",defaultMessage:"Cancel"}),l.CREATE=t.intl.formatMessage({id:"cVVoCl",defaultMessage:"Create"}),l.SAVE=t.intl.formatMessage({id:"HqImMi",defaultMessage:"Save"}),l.LEARN_MORE=t.intl.formatMessage({id:"sUsXMb",defaultMessage:"Learn more"}),l.FINISH=t.intl.formatMessage({id:"H/MlMr",defaultMessage:"Done"}),l.CLOSE=t.intl.formatMessage({id:"/nCb7L",defaultMessage:"Close"}),l.DISMISS=t.intl.formatMessage({id:"h4rpeQ",defaultMessage:"Dismiss"}),l.CONFIGURE_NOW=t.intl.formatMessage({id:"vQKdKf",defaultMessage:"Configure now"}),l.RECONFIGURE=t.intl.formatMessage({id:"DN+Nvb",defaultMessage:"Reconfigure"}),l.CONFIRM_PREFERENCE=t.intl.formatMessage({id:"qlRt63",defaultMessage:"Confirm your preference"}),l.MANAGE_PREFERENCE=t.intl.formatMessage({id:"ILUbaa",defaultMessage:"Manage preference"}),l.SHOW_IN_GOOGLE_DRIVE=t.intl.formatMessage({id:"S0LHV5",defaultMessage:"Show in Google Drive"}),l.LINK_ACCOUNT=t.intl.formatMessage({id:"JhmneM",defaultMessage:"Link account"}),l.GET_MIGRATION_SETTINGS_ERROR=t.intl.formatMessage({id:"C40Kmf",defaultMessage:"Could not fetch migration settings"}),l.SET_MIGRATION_SETTINGS_ERROR=t.intl.formatMessage({id:"omeHSB",defaultMessage:"Could not update migration settings"}),l.EDIT_APP_PERMISSIONS=t.intl.formatMessage({id:"GYeDWi",defaultMessage:"Edit app permissions"}),l.MIGRATION_FOLDER=t.intl.formatMessage({id:"vp+jh3",defaultMessage:"Dropbox"}),l.DEFAULT_SHORTCUT_NAME=t.intl.formatMessage({id:"o9Zw70",defaultMessage:"Untitled"}),l.VIEW_SUMMARY=t.intl.formatMessage({id:"9m2UYm",defaultMessage:"View summary"}),l.LOADING_ANIMATION=t.intl.formatMessage({id:"2/JlYM",defaultMessage:"Loading animation..."}),l.DISABLED_MIGRATE_FILES_TO_GOOGLE_DRIVE_TOOLTIP_TEXT=t.intl.formatMessage({id:"hC4dZf",defaultMessage:"You do not have permission to move your Google files to Google Drive. Please reach to your admin to get permission"});a.injectInternalStyle("metaserver/static/js/cloud_docs/gdd_migration/ui/modals/modal_template.module.out.css",(e=>"._modalTemplateWrapper_1iofx_1{display:flex;flex-direction:row}._modalTemplateContainer_1iofx_6{align-items:flex-start;display:flex;flex:1;flex-direction:column;padding:0}._modalTemplatePaper_1iofx_15{align-items:flex-start;align-self:stretch;display:flex;flex-direction:row;padding:var(--spacing__unit--3) var(--spacing__unit--3) 0}._modalTemplateContent_1iofx_24{align-items:flex-start;display:flex;flex-direction:column;flex-grow:1;justify-content:center;padding:0}._modalTemplateHeading_1iofx_34{align-items:flex-start;display:flex;flex-direction:row;padding:var(--spacing__unit--4) var(--spacing__unit--3) var(--spacing__unit--2)}._modalTemplateText_1iofx_42{padding:0 var(--spacing__unit--3)}._modalTemplateActions_1iofx_46{align-items:center;align-self:stretch;display:flex;flex-direction:row;gap:var(--spacing__unit--1);padding:var(--spacing__unit--3)}._modalTemplateButtonGroup_1iofx_56,._modalTemplateTertiaryActionContainer_1iofx_65{align-items:center;display:flex;flex-direction:row;gap:var(--spacing__unit--1);padding:0}._modalTemplateTertiaryActionContainer_1iofx_65{flex-grow:1;justify-content:flex-end}._modalTemplateImageFrame_1iofx_76{align-items:center;background:var(--color__opacity--3);display:flex;flex:1;flex-direction:column;justify-content:center;min-height:420px;min-width:400px;position:relative}@media (max-width:767.98px){._modalTemplateImageFrame_1iofx_76{display:none}}"));const d="_modalTemplateWrapper_1iofx_1",_="_modalTemplateContainer_1iofx_6",c="_modalTemplatePaper_1iofx_15",g="_modalTemplateContent_1iofx_24",f="_modalTemplateHeading_1iofx_34",u="_modalTemplateText_1iofx_42",m="_modalTemplateActions_1iofx_46",p="_modalTemplateButtonGroup_1iofx_56",M="_modalTemplateTertiaryActionContainer_1iofx_65",v="_modalTemplateImageFrame_1iofx_76",I=({actions:e,ariaLabel:t,bodyText:s,height:o,infoTextAboveModalTitle:n,tertiaryActions:r,title:l,rightFrameComponent:I,onRequestClose:E,open:C,width:T,withCloseButton:L})=>i.React$1.createElement(a.Modal$1,{onRequestClose:E,open:null==C||C,width:T,isCentered:!0,shouldCloseOnOverlayClick:!1,withCloseButton:L,"aria-labelledby":t},i.React$1.createElement("div",{className:d,style:{minHeight:null!=o?o:"auto"}},i.React$1.createElement("div",{className:_},n&&i.React$1.createElement("div",{className:c},i.React$1.createElement(a.Text,{size:"small",color:"faint"},n)),i.React$1.createElement("div",{className:g},i.React$1.createElement("div",{className:f},i.React$1.createElement(a.Title,null,l)),i.React$1.createElement("div",{className:u},s)),i.React$1.createElement("div",{className:m},e&&i.React$1.createElement("div",{className:p},e),r&&i.React$1.createElement("div",{className:M},r))),I&&i.React$1.createElement("div",{className:v},I)));I.displayName="ModalTemplate";const E=["documents"];var C;function T(t,i){return s.__awaiter(this,void 0,void 0,(function*(){const s=new a.UserApiV2Client,o=yield s.ns("profile_services").rpc("list_linked_services",void 0,{subjectUserId:t.id});let n=!1;for(const t of o.linked_services){if(!("google"===t.service_type[".tag"]))continue;if(!("is_connected"===t.connection_state[".tag"]))continue;if(E.every((e=>t.granted_permissions.some((t=>t[".tag"]===e))))&&(n=!0,!i||t.display_name===i))return e.GddMigrationCompatibleLinkStatus.HAS_COMPATIBLE_LINK}return n?e.GddMigrationCompatibleLinkStatus.HAS_INCOMPATIBLE_LINK:e.GddMigrationCompatibleLinkStatus.NOT_LINKED}))}e.GddMigrationCompatibleLinkStatus=void 0,(C=e.GddMigrationCompatibleLinkStatus||(e.GddMigrationCompatibleLinkStatus={}))[C.HAS_COMPATIBLE_LINK=0]="HAS_COMPATIBLE_LINK",C[C.HAS_INCOMPATIBLE_LINK=1]="HAS_INCOMPATIBLE_LINK",C[C.NOT_LINKED=2]="NOT_LINKED";e.DEFAULT_MIGRATION_MODAL_HEIGHT=475,e.DEFAULT_MIGRATION_MODAL_WIDTH=850,e.HELP_CENTER_ARTICLE_URL="https://help.dropbox.com/integrations/move-google-docs",e.ModalTemplate=I,e.chooseGdriveFolder=e=>s.__awaiter(void 0,void 0,void 0,(function*(){const t=yield((e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){const i=new a.UserApiV2Client,{access_token:s}=yield i.ns("profile_services").rpc("get_access_token",{service:{".tag":"google"},permissions:t},{subjectUserId:e});return s})))(e,[{".tag":"documents"}]),i=yield r.openGdriveFilePicker(t,void 0,[{viewId:r.FilePickerViewId.FOLDERS,includeFolders:!0,allowSelectFolders:!0}],"root","Select a folder");if(i.action!==r.FilePickerAction.PICKED)return null;const{fileIds:o,filesInfo:n}=i,l=o[0];return{folderId:l,folderName:n[l].name}})),e.ensureUserHasGddMigrationCompatibleLink=function(t,i){return s.__awaiter(this,void 0,void 0,(function*(){const r=t.email,l=yield T(t,r);if(!i){if(l===e.GddMigrationCompatibleLinkStatus.HAS_COMPATIBLE_LINK)return e.GddMigrationCompatibleLinkStatus.HAS_COMPATIBLE_LINK;if(l===e.GddMigrationCompatibleLinkStatus.HAS_INCOMPATIBLE_LINK)try{yield function(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=new a.UserApiV2Client;yield t.ns("profile_services").rpc("unlink",{service:{".tag":"google"}},{subjectUserId:e.id})}))}(t)}catch(e){}}const d=new o.ProfileServicesLinkingHandler,_=yield d.auth_service_with_user_promise(n.ProfileServicesConstants.GOOGLE,t.id,null,"link_read_files",void 0,void 0,E,void 0,r);return _.success?_.display_name===r?e.GddMigrationCompatibleLinkStatus.HAS_COMPATIBLE_LINK:e.GddMigrationCompatibleLinkStatus.HAS_INCOMPATIBLE_LINK:e.GddMigrationCompatibleLinkStatus.NOT_LINKED}))},e.fetchUserHasGddMigrationCompatibleLink=T,e.getDefaultGdssShortcutsTargetFolder=e=>a.UserLocalStorage.get(e,"gdss_shortcuts_target_folder"),e.getErrorMessageForApiError=e=>{switch(e[".tag"]){case"invalid_dest_service":return t.intl.formatMessage({id:"naF0qP",defaultMessage:"The provided destination service is not valid"});case"invalid_dest_doc_type":return t.intl.formatMessage({id:"7dGke6",defaultMessage:"The selected destination document type is not valid"});case"invalid_shortcut_file_path":return t.intl.formatMessage({id:"OzwVRj",defaultMessage:"The file path provided is not valid"});case"missing_linked_service":return t.intl.formatMessage({id:"eWGDzQ",defaultMessage:"There is no linked service for this account"});case"migration_folder_not_found":return t.intl.formatMessage({id:"nS5vet",defaultMessage:"Could not find Gdd migration folder url"});case"external_api_error":switch(e.error_sub_type[".tag"]){case"create_folder":return t.intl.formatMessage({id:"R4+Bie",defaultMessage:"Could not create destination folder"});case"find_unused_filename":return t.intl.formatMessage({id:"BaVK9c",defaultMessage:"Could not find unused filename"});case"create_file":return t.intl.formatMessage({id:"O6K4d3",defaultMessage:"Could not create file"});case"upload":return t.intl.formatMessage({id:"VmFQIK",defaultMessage:"Could not upload file"});case"delete_file":return t.intl.formatMessage({id:"6B6Nhk",defaultMessage:"Could not delete file"});case"grant_role":return t.intl.formatMessage({id:"V0gb4H",defaultMessage:"Could not grant permissions"});case"find_file_or_folder":return t.intl.formatMessage({id:"sAdchD",defaultMessage:"Could not find file or folder"});case"other":return t.intl.formatMessage({id:"rzEExT",defaultMessage:"Unknown external error"});default:a.enforceExhaustive(e.error_sub_type)}break;case"shortcut_already_exists":return t.intl.formatMessage({id:"wS11og",defaultMessage:"Shortcut already exists"});case"quota_exceeded":return t.intl.formatMessage({id:"JHtCrO",defaultMessage:"Quota exceeded"});case"invalid_dest_folder_mime_type":return t.intl.formatMessage({id:"QqSC6b",defaultMessage:"Invalid destination folder"});case"other":break;default:a.enforceExhaustive(e)}return t.intl.formatMessage({id:"D/bI4/",defaultMessage:"Could not complete request"})},e.getMigrationDetails=e=>s.__awaiter(void 0,void 0,void 0,(function*(){const t=a.LocalStorage.get("gdd_migration_override"),i=new a.UserApiV2Client,s=yield i.ns("cloud_docs").rpc("get_gdd_migration_details",void 0,{subjectUserId:e.id});return Object.assign(Object.assign({},s),null==t?void 0:t.details)})),e.getMigrationFolderURLInGDrive=e=>s.__awaiter(void 0,void 0,void 0,(function*(){const t=new a.UserApiV2Client,{url:i}=yield t.ns("cloud_docs").rpc("get_migration_folder_url_in_gdrive",void 0,{subjectUserId:e});return i})),e.getMigrationReportUrl=e=>s.__awaiter(void 0,void 0,void 0,(function*(){const t=new a.UserApiV2Client;return yield t.ns("cloud_docs").rpc("get_migration_report_url",void 0,{subjectUserId:e.id})})),e.getMigrationSettings=e=>s.__awaiter(void 0,void 0,void 0,(function*(){const t=a.LocalStorage.get("gdd_migration_override"),i=new a.UserApiV2Client,{settings:s}=yield i.ns("cloud_docs").rpc("get_gdd_migration_settings",void 0,{subjectUserId:e.id});return Object.assign(Object.assign({},s),null==t?void 0:t.settings)})),e.parseLinkAccountError=e=>"window_not_created"===e?t.intl.formatMessage({id:"6EyPz0",defaultMessage:"Pop-up blocked. Please disable pop-up blockers in order to link your Google account"}):"window_closed"!==e?t.intl.formatMessage({id:"4Mo3Jb",defaultMessage:"Google authentication failed"}):void 0,e.setDefaultGdssShortcutsTargetFolder=(e,t)=>a.UserLocalStorage.set(e,"gdss_shortcuts_target_folder",t),e.setMigrationSettings=(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){const i=new a.UserApiV2Client,{settings:s}=yield i.ns("cloud_docs").rpc("set_gdd_migration_settings",{settings:t},{subjectUserId:e.id});return s}))}));
//# sourceMappingURL=c_gdd_migration_ui_utils.js-vflzBo7EE.map
