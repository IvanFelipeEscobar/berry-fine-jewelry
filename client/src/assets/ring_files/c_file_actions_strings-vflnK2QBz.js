define(["exports","./c_tslib","./e_ui_page_files_router","./e_core_exception","./c_core_exception_info","./c_core_i18n"],(function(e,r,t,a,s,i){"use strict";const n=1e3,o="file_actions_client_error",c=e=>({isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error",jobId:e}),d=(e,r)=>{a.reportStack(JSON.stringify("error"in r?r.error:r),{severity:s.SEVERITY.NON_CRITICAL,silent:!0,tags:[o,`${o}_${e}`]})};function l(e){return Boolean("fq_path"in e?e:null)}function u(e){return l(e)?t.filename(e.fq_path):e.name}function _(e,a){return r.__awaiter(this,void 0,void 0,(function*(){const r=new t.UserApiV2Client;try{return{isError:!1,result:yield r.ns("files").rpc("undo_batch",{entries:e},{subjectUserId:a.id})}}catch(e){return d("undo_batch",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:c()}}))}function f(e,a,s,i){return r.__awaiter(this,void 0,void 0,(function*(){const r=t.parent_dir(e),n=t.normalize(r)+"/"+a,o=new t.UserApiV2Client,{checkFSWs:c}=i;try{const r=yield o.ns("files").rpc("move_v2",{from_path:e,to_path:n,autorename:!0,allow_ownership_transfer:!1,fsw_request:c?{".tag":"check"}:void 0},{subjectUserId:s});return{isError:!1,result:{changeset_data:r.changeset_data,entries:[{".tag":"success",success:r.metadata}]}}}catch(e){return w(e)}}))}const g=(e,r,t,a,s)=>()=>e.ns("files").rpc("move_batch_v2",{entries:t,autorename:!0,allow_ownership_transfer:!!a,fsw_request:s?{".tag":"check"}:void 0},{subjectUserId:r}),h=(e,r)=>t=>e.ns("files").rpc("move_batch/check_v2",{async_job_id:t},{subjectUserId:r});function m(e,a,s,i={}){return r.__awaiter(this,void 0,void 0,(function*(){const r=new t.UserApiV2Client,{allowOwnershipTransfer:n,checkFSWs:o}=i,c=e=>{const r=`${a}/${u(e)}`;return l(e)?{from_path:e.fq_path,to_path:r}:{from_path:e.id,to_path:r}};if(1===e.length&&l(e[0])&&!e[0].is_dir)try{const t=yield r.ns("files").rpc("move_v2",Object.assign(Object.assign({},c(e[0])),{allow_ownership_transfer:!!n,fsw_request:o?{".tag":"check"}:void 0}),{subjectUserId:s});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(e){return w(e)}const d=g(r,s,e.map(c),n,o),_=h(r,s);return yield b(d,_)}))}function p(e,a,s,i,n={}){return r.__awaiter(this,void 0,void 0,(function*(){const r=new t.UserApiV2Client,{allowOwnershipTransfer:o,checkFSWs:c}=n,d=e=>{const r=`${a}/${s}`;return l(e)?{from_path:e.fq_path,to_path:r}:{from_path:e.id,to_path:r}};if(l(e)&&!e.is_dir)try{const t=yield r.ns("files").rpc("move_v2",Object.assign(Object.assign({},d(e)),{allow_ownership_transfer:!!o,fsw_request:c?{".tag":"check"}:void 0}),{subjectUserId:i});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(e){return w(e)}const u=g(r,i,[d(e)],o,c),_=h(r,i);return yield b(u,_)}))}function v(e,a,s,i={}){var n;return r.__awaiter(this,void 0,void 0,(function*(){const r=new t.UserApiV2Client,{checkFSWs:o}=i;if(1===e.length&&!e[0].is_dir)try{const i=yield r.ns("files").rpc("copy_v2",{from_path:null!==(n=e[0].file_id)&&void 0!==n?n:e[0].fq_path,to_path:`${a}/${t.filename(e[0].fq_path)}`,autorename:!0,fsw_request:o?{".tag":"check"}:void 0},{subjectUserId:s});return{isError:!1,result:{changeset_data:i.changeset_data,entries:[{".tag":"success",success:i.metadata}]}}}catch(e){return w(e)}return yield b((()=>r.ns("files").rpc("copy_batch_v2",{entries:e.map((e=>{var r;return{from_path:null!==(r=e.file_id)&&void 0!==r?r:e.fq_path,to_path:`${a}/${t.filename(e.fq_path)}`}})),autorename:!0,fsw_request:o?{".tag":"check"}:void 0},{subjectUserId:s})),(e=>r.ns("files").rpc("copy_batch/check_v2",{async_job_id:e},{subjectUserId:s})))}))}function b(e,t){return r.__awaiter(this,void 0,void 0,(function*(){try{const r=yield e();if("complete"===r[".tag"])return F("relocation_batch",r),{isError:!1,result:r};{let e;do{yield new Promise((e=>setTimeout(e,n))),e=yield t(r.async_job_id)}while(e&&"in_progress"===e[".tag"]);if("complete"===e[".tag"]){const t=e;for(const e of t.entries){const t=y(e,r.async_job_id);if(t)return t}return F("relocation_batch",t),{isError:!1,result:t,jobId:r.async_job_id}}return d("relocation_batch_poll",e),c(r.async_job_id)}}catch(e){return d("relocation_batch_poll",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.error[".tag"]}:function(e){if(e&&e.raw&&400===e.raw.status)return{isError:!0,error:e.error,error_summary:"client_error"};return c()}(e)}}))}function y(e,r){return"failure"===e[".tag"]&&"relocation_error"===e.failure[".tag"]&&"to"===e.failure.relocation_error[".tag"]&&"file_system_warnings"===e.failure.relocation_error.to[".tag"]?{isError:!0,error:e.failure.relocation_error,error_summary:"file_system_warnings",jobId:r}:"failure"===e[".tag"]&&"relocation_error"===e.failure[".tag"]&&"internal_error"===e.failure.relocation_error[".tag"]?{isError:!0,error:e.failure.relocation_error,error_summary:"internal_error",jobId:r}:void 0}function w(e){var r;if(null===(r=null==e?void 0:e.error)||void 0===r?void 0:r[".tag"]){const r={".tag":"failure",failure:{".tag":"relocation_error",relocation_error:e.error}},t=y(r,void 0);return void 0!==t?t:{isError:!1,result:{changeset_data:[],entries:[r]}}}return c()}function M(e,a){return r.__awaiter(this,void 0,void 0,(function*(){const r=new t.UserApiV2Client;try{return yield r.ns("device_sync").rpc("do_not_backup",{entries:e.map((e=>{return"file_id"in(r=e)?r.file_id:r.fq_path;var r}))},{subjectUserId:a}),{isError:!1,result:!0}}catch(e){return{isError:!0,error:e.error,error_summary:e.summary}}}))}function j(e,a,s){var i;return r.__awaiter(this,void 0,void 0,(function*(){const o=new t.UserApiV2Client,l=e=>"file_id"in e?e.file_id:e.fq_path;if(1===e.length&&!e[0].is_dir)try{const r=yield o.ns("files").rpc("delete_v2",{path:l(e[0]),fsw_request:s?{".tag":"check"}:void 0},{subjectUserId:a});return{isError:!1,result:{changeset_data:r.changeset_data,entries:[{".tag":"success",metadata:r.metadata}]}}}catch(e){return U(e)||d("delete_v2",e),(null===(i=null==e?void 0:e.error)||void 0===i?void 0:i[".tag"])?{isError:!1,result:{changeset_data:[],entries:[{".tag":"failure",failure:e.error}]}}:c()}return yield function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){try{const r=yield e();if("complete"===r[".tag"])return F("delete_batch",r),{isError:!1,result:r};if("other"===r[".tag"])return d("delete_batch",r),c();{let e;do{yield new Promise((e=>setTimeout(e,n))),e=yield t(r.async_job_id)}while(e&&"in_progress"===e[".tag"]);return"complete"===e[".tag"]?(F("delete_batch",e),{isError:!1,result:e,jobId:r.async_job_id}):(d("delete_batch_poll",e),c(r.async_job_id))}}catch(e){return d("delete_batch",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.error[".tag"]}:function(e){if(e&&e.raw&&400===e.raw.status)return{isError:!0,error:e.error,error_summary:"client_error"};return c()}(e)}}))}((()=>o.ns("files").rpc("delete_batch",{entries:e.map((e=>({path:l(e)}))),fsw_request:s?{".tag":"check"}:void 0},{subjectUserId:a})),(e=>o.ns("files").rpc("delete_batch/check",{async_job_id:e},{subjectUserId:a})))}))}const F=(e,r)=>{r.entries.forEach((r=>{".tag"in r&&"failure"===r[".tag"]&&d(e,r.failure)}))};function k(e,a,s,i){return r.__awaiter(this,void 0,void 0,(function*(){const r=new t.UserApiV2Client;try{return{isError:!1,result:yield r.ns("files").rpc("create_folder_v2",{path:t.normalize(e)+"/"+a,autorename:!0,fsw_request:i?{".tag":"check"}:void 0},{subjectUserId:s.id})}}catch(e){return d("create_folder",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:c()}}))}const E=e=>"failure"===e[".tag"],U=e=>"path_lookup"===e[".tag"];var I=Object.freeze({__proto__:null,EXCLOG_TAG:o,copyFiles:v,createFolder:k,createUndefinedRpcResult:c,deleteFiles:j,doNotBackupFiles:M,fileInfoIsFqPathBased:l,getFilenameFromActionInfo:u,isFailure:E,isPathLookupFailure:U,moveAndRenameContent:p,moveFiles:m,renameFile:f,undo:_});const q=i.defineMessage({id:"z7/sbf",defaultMessage:"{count, plural, one{Deleting {count} item...} other{Deleting {count} items...}}"}),C=i.defineMessage({id:"da2lvf",defaultMessage:"Delete"}),S=i.defineMessage({id:"hCpZct",defaultMessage:"Delete undone."}),A=i.defineMessage({id:"KYHY0Z",defaultMessage:"Name was invalid."}),T=i.defineMessage({id:"8j6sBp",defaultMessage:"Renaming"}),N=i.defineMessage({id:"NYv8Vp",defaultMessage:"Rename"}),R=i.defineMessage({id:"deJ8cD",defaultMessage:"Undoing rename..."}),V=i.defineMessage({id:"n4o67d",defaultMessage:"Undo failed."}),O=i.defineMessage({id:"6RXx/7",defaultMessage:"Rename undone."}),P=i.defineMessage({id:"NqCfwG",defaultMessage:"Renamed 1 item."}),$=i.defineMessage({id:"U3y3i9",defaultMessage:"Creating folder..."}),x=i.defineMessage({id:"HOb8Zp",defaultMessage:'The following characters are not allowed: angle brackets \\ / : ? * " |'}),D=i.defineMessage({id:"qZTFM0",defaultMessage:"Canâ€™t create folder."}),L=i.defineMessage({id:"VDjS9+",defaultMessage:"Create folder"}),Y=i.defineMessage({id:"1zC4ih",defaultMessage:"Folder created."});i.defineMessage({id:"m96IvY",defaultMessage:"Starred {itemName}."}),i.defineMessage({id:"Yn2gx1",defaultMessage:"Unstarred {itemName}."}),i.defineMessage({id:"LdcLnn",defaultMessage:"There was a problem starring {itemName}"}),i.defineMessage({id:"t8Eqso",defaultMessage:"There was a problem unstarring {itemName}"}),e.ApiV2=I,e.copyFiles=v,e.createFolder=k,e.createFolderErrorGeneric=D,e.createFolderErrorMalformedPath=x,e.createFolderFswConfirmText=L,e.createFolderSnackbarProgress=$,e.createFolderSnackbarSuccess=Y,e.createUndefinedRpcResult=c,e.deleteFiles=j,e.deleteFswConfirmText=C,e.deleteSnackbarProgressMessage=q,e.deleteUndoSnackbarMessage=S,e.doNotBackupFiles=M,e.getFilenameFromActionInfo=u,e.isFailure=E,e.isPathLookupFailure=U,e.moveAndRenameContent=p,e.moveFiles=m,e.renameErrorInvalidName=A,e.renameFile=f,e.renameFswConfirmText=N,e.renameSnackbarProgressMessage=T,e.renameSnackbarSuccessMessage=P,e.renameUndoSnackbarErrorMessage=V,e.renameUndoSnackbarProgressMessage=R,e.renameUndoSnackbarSuccessMessage=O,e.undo=_}));
//# sourceMappingURL=c_file_actions_strings.js-vfl-U0M5z.map
