define(["exports","./c_tslib"],(function(t,e){"use strict";var i;const s=t=>t,r=t=>"string"==typeof t?t:JSON.stringify(t),h=()=>{},n=t=>t?t.split(/\s+/):[],o=t=>t?t.split(/\W+/):[],a=t=>function(e){return i=>{let s=[];return e.forEach((e=>{var r;s=s.concat(t(null!==(r=i[e])&&void 0!==r?r:""))})),s}},c={nonword:o,whitespace:n,obj:{nonword:a(o),whitespace:a(n)}};class l{constructor(){this.add=t=>{this.head&&(t.next=this.head,this.head.prev=t),this.head=t,this.tail=this.tail||t},this.remove=t=>{t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev},this.moveToFront=t=>{this.remove(t),this.add(t)},this.head=this.tail=void 0}}class u{constructor(t,e){this.key=t,this.val=e,this.prev=this.next=void 0}}class d{constructor(t){this.set=(t,e)=>{const i=this.list.tail;this.size>=this.maxSize&&i&&(this.list.remove(i),delete this.hash[i.key],this.size--);const s=this.hash[t];if(s)s.val=e,this.list.moveToFront(s);else{const i=new u(t,e);this.list.add(i),this.hash[t]=i,this.size++}},this.get=t=>{const e=this.hash[t];if(e)return this.list.moveToFront(e),e.val},this.reset=()=>{this.size=0,this.hash={},this.list=new l},this.maxSize=null!=t?t:100,this.reset(),this.maxSize<=0&&(this.set=h,this.get=h)}}const f=window.localStorage,p=()=>(new Date).getTime();class m{constructor(t){this.getPrefix=t=>this.prefix+t,this.getTtlKey=t=>this.getPrefix(t)+this.ttlKey,this.safeSet=(t,e)=>{try{f.setItem(t,e)}catch(t){"QuotaExceededError"===t.name&&this.clear()}},this.get=t=>{var e;return this.isExpired(t)&&this.remove(t),JSON.parse(null!==(e=f.getItem(this.getPrefix(t)))&&void 0!==e?e:"")},this.set=(t,e,i)=>(i?this.safeSet(this.getTtlKey(t),(p()+i).toString()):f.removeItem(this.getTtlKey(t)),this.safeSet(this.getPrefix(t),JSON.stringify(e))),this.remove=t=>(f.removeItem(this.getTtlKey(t)),f.removeItem(this.getPrefix(t)),this),this.clear=()=>{const t=(t=>{var e;let i,s;const r=[],h=f.length;for(i=0;i<h;i++)(null===(e=s=f.key(i))||void 0===e?void 0:e.match(t))&&r.push(s.replace(t,""));return r})(this.keyMatcher);for(let e=t.length;e--;)this.remove(t[e]);return this},this.isExpired=t=>{var e;const i=JSON.parse(null!==(e=f.getItem(this.getTtlKey(t)))&&void 0!==e?e:"");return"number"==typeof i&&p()>i},this.prefix=["__",t,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+this.prefix.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"))}}class g{constructor(t){this.fingerprint=t=>{var e;return t.url+JSON.stringify(null!==(e=t.fingerprint)&&void 0!==e?e:{})},this.makeRequest=(t,e)=>{const i=new URL(t.url,"https://www.dropbox.com"),s=fetch(i,t).then((t=>(g.pendingRequestsCount--,delete g.pendingRequests[e],t.json())));return g.pendingRequestsCount++,g.pendingRequests[e]=s,s},this._get=t=>e.__awaiter(this,void 0,void 0,(function*(){const e=this.fingerprint(t);if(this.cancelled||e!==this.lastReq)return;const i=g.pendingRequests[e];if(!i&&g.pendingRequestsCount>=g.maxPendingRequests)return;const s=i||this.makeRequest(t,e);let r;try{r=yield s,this.cache.set(e,r)}catch(t){r=void 0}return r})),this.get=t=>e.__awaiter(this,void 0,void 0,(function*(){const e="string"==typeof t?{url:t}:t,i=this.fingerprint(e);this.cancelled=!1,this.lastReq=i;const s=this.cache.get(i);return s||(yield this._get(e))})),this.cancel=()=>{this.cancelled=!0},this.cancelled=!1,this.lastReq=void 0,this.cache=!1===t.cache?new d(0):g.sharedCache}}i=g,g.pendingRequests={},g.sharedCache=new d(10),g.pendingRequestsCount=0,g.maxPendingRequests=6,g.setMaxPendingRequests=t=>{i.maxPendingRequests=t},g.resetCache=()=>{i.sharedCache.reset()};const v="c",y=t=>t.filter((t=>!!t)).map((t=>t.toLowerCase())),x=()=>({i:[],[v]:{}});class w{constructor(t){this.bootstrap=t=>{this.datums=t.datums,this.trie=t.trie},this.add=t=>{t.forEach((t=>{const e=this.identify(t);this.datums[e]=t;y(this.datumTokenizer(t)).forEach((t=>{let i,s=this.trie;const r=t.split("");for(;i=r.shift();)s=s[v][i]||(s[v][i]=x()),s.i.push(e)}))}))},this.get=t=>t.map((t=>this.datums[t])),this.search=t=>{let e;return y(this.queryTokenizer(t)).forEach((t=>{let i,s,r;if(e&&0===e.length)return!1;i=this.trie;const h=t.split("");for(;i&&(s=h.shift());)i=i[v][s];return i&&0===h.length?(r=i.i.slice(0),e=e?((t,e)=>{let i=0,s=0;const r=[];t=t.sort(),e=e.sort();const h=t.length,n=e.length;for(;i<h&&s<n;)t[i]<e[s]?i++:(t[i]>e[s]||(r.push(t[i]),i++),s++);return r})(e,r):r):e=[],!1})),e?(t=>{const e={},i=[];for(let s=0,r=t.length;s<r;s++)e[t[s]]||(e[t[s]]=!0,i.push(t[s]));return i})(e).map((t=>this.datums[t])).filter((t=>!!t)):[]},this.all=()=>{const t=[];for(const e in this.datums)if(this.datums.hasOwnProperty(e)){const i=this.datums[e];i&&t.push(i)}return t},this.reset=()=>{this.datums={},this.trie=x()},this.serialize=()=>({datums:this.datums,trie:this.trie}),this.identify=t.identify||r,this.datumTokenizer=t.datumTokenizer,this.queryTokenizer=t.queryTokenizer,this.reset()}}const z="data",_="protocol",q="thumbprint";class T{constructor(t){this.settings=()=>({url:this.url,method:"GET"}),this.store=t=>{this.cache&&(this.storage.set(z,t,this.ttl),this.storage.set(_,location.protocol,this.ttl),this.storage.set(q,this.thumbprint,this.ttl))},this.fromCache=()=>{if(!this.cache)return;const t=this.storage.get(z),e=this.storage.get(_),i=this.storage.get(q)!==this.thumbprint||e!==location.protocol;return t&&!i?t:void 0},this.fromNetwork=()=>e.__awaiter(this,void 0,void 0,(function*(){const t=this.prepare(this.settings());try{const e=yield fetch(t.url,t);return yield e.json()}catch(t){return}})),this.clear=()=>(this.storage.clear(),this),this.url=t.url,this.ttl=t.ttl,this.cache=t.cache,this.prepare=t.prepare,this.thumbprint=t.thumbprint,this.storage=new m(t.cacheKey)}}class k{constructor(t){this.settings=()=>({url:this.url,method:"GET"}),this.get=t=>e.__awaiter(this,void 0,void 0,(function*(){t=t||"";const e=this.prepare(t,this.settings());return yield this.transport.get(e)})),this.cancelLastRequest=()=>{this.transport.cancel()},this.url=t.url,this.prepare=t.prepare,this.transport=new g({cache:t.cache})}}const R=t=>{var e;if(!t)return;const i="string"==typeof t?{url:t}:t;return{url:i.url,ttl:864e5,cache:!0,prepare:null!==(e=i.prepare)&&void 0!==e?e:s,cacheKey:i.cacheKey||i.url,thumbprint:"0.11.1"+i.thumbprint}},C=t=>{var e;if(!t)return;const i="string"==typeof t?{url:t}:t;return{url:i.url,cache:null===(e=i.cache)||void 0===e||e,prepare:P(i)}},P=t=>{const{prepare:e,replace:i,wildcard:s}=t;return e||(i?(t,e)=>(e.url=i(e.url,t),e):s?(t,e)=>(e.url=e.url.replace(s,encodeURIComponent(t)),e):(t,e)=>e)};class b{constructor(t){this.loadPrefetch=()=>e.__awaiter(this,void 0,void 0,(function*(){var t;if(!this.prefetch)return;const e=this.prefetch.fromCache();if(e)return void this.index.bootstrap(e);const i=yield this.prefetch.fromNetwork();i&&this.add(i),null===(t=this.prefetch)||void 0===t||t.store(this.index.serialize())})),this._initialize=()=>e.__awaiter(this,void 0,void 0,(function*(){this.clear(),yield this.loadPrefetch(),this.add(this.local)})),this.initialize=t=>!this.initPromise||t?this._initialize():this.initPromise,this.add=t=>(this.index.add(t),this),this.get=t=>this.index.get(t),this.search=(t,i,s)=>e.__awaiter(this,void 0,void 0,(function*(){const e=this.sorter(this.index.search(t));if(i(this.remote?e.slice():e),this.remote&&e.length<this.sufficient){const i=yield this.remote.get(t),r=[];null==i||i.forEach((t=>{e.some((e=>this.identify(t)===this.identify(e)))||r.push(t)})),null==s||s(r)}else this.remote&&this.remote.cancelLastRequest()})),this.all=()=>this.index.all(),this.clear=()=>(this.index.reset(),this),this.clearPrefetchCache=()=>{var t;return null===(t=this.prefetch)||void 0===t||t.clear(),this},this.clearRemoteCache=()=>(g.resetCache(),this);const i=(t=>{var e,i,h;return{initialize:!0,identify:null!==(e=t.identify)&&void 0!==e?e:r,datumTokenizer:t.datumTokenizer,queryTokenizer:t.queryTokenizer,sufficient:null!==(i=t.sufficient)&&void 0!==i?i:5,local:"function"==typeof t.local?t.local():null!==(h=t.local)&&void 0!==h?h:[],prefetch:R(t.prefetch),remote:C(t.remote),sorter:t.sorter?e=>e.sort(t.sorter):s}})(t);this.sorter=i.sorter,this.identify=i.identify,this.sufficient=i.sufficient,this.local=i.local,this.remote=i.remote?new k(i.remote):void 0,this.prefetch=i.prefetch?new T(i.prefetch):void 0,this.index=new w({identify:this.identify,datumTokenizer:i.datumTokenizer,queryTokenizer:i.queryTokenizer}),this.initialize()}}b.tokenizers=c,t.Bloodhound=b}));
//# sourceMappingURL=c_contacts_bloodhound.js-vfl5T1lzR.map
