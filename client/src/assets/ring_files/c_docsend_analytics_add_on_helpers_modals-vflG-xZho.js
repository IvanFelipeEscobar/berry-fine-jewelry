define(["exports","./e_edison","./e_ui_page_files_router","./c_tslib","./c_docsend_analytics_add_on_data_apiUtils","./c_core_i18n","./c_docsend_analytics_add_on_components_snackbar_utils","./c_docsend_src_utils","./c_csrf","./c_table_index","./c_apex-metrics_src_types","./c_lodash-es_lodash","metaserver/static/js/modules/constants/files_spa","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_core_xhr","./c_browser_cookies","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/core/langpack"],(function(e,t,a,i,s,n,l,r,c,o,d,m,f,_,u,g,p,v,E,h,y,R,b,$,w,k,x,N,M,T,S,D,A,C,L,I,V){"use strict";var O,P;!function(e){e.UNKNOWN="UNKNOWN",e.UNABLE_TO_GET_PLAN_STATUS="UNABLE_TO_GET_PLAN_STATUS"}(O||(O={})),function(e){e.PROVISIONED="PROVISIONED",e.NONE="NONE"}(P||(P={}));var U;!function(e){e.UNKNOWN="UNKNOWN"}(U||(U={}));a.injectInternalStyle("metaserver/static/js/docsend_analytics_add_on/components/docsend_analytics_add_on_modal.module.out.css",(e=>"._ds-analytics-header_1pfff_2{align-items:center;display:flex;font-size:16px;gap:var(--spacing__base_unit);line-height:26px}._ds-analytics-header-filename_1pfff_10{font-size:16px;font-weight:500;line-height:26px}._divider_1pfff_16{background-color:var(--color__faint__border);flex:none;flex-grow:0;height:1px;order:0;width:652px}._spinner-container_1pfff_25{align-items:center;display:flex;height:400px;justify-content:center;width:100%}._spinner-with-text_1pfff_33{display:flex;flex-direction:row;gap:var(--spacing__base_unit)}._spinner-text_1pfff_39{font-size:16px;font-weight:500}._modal-content_1pfff_44{gap:var(--spacing__unit--3)}._modal-content_1pfff_44,._tos-section_1pfff_50{display:flex;flex-direction:column}._tos-section_1pfff_50{gap:var(--spacing__unit--2_5)}._tos-heading_1pfff_56{display:flex;flex-direction:column;gap:var(--spacing__base_unit)}._tos-title_1pfff_62{font-size:16px;font-weight:500;line-height:24px}._tos-checkbox-section_1pfff_68{display:flex;flex-direction:row;gap:var(--spacing__base_unit)}._tos-error_1pfff_74{margin-bottom:var(--spacing__unit--0_5)!important}._link-section_1pfff_78{display:flex;flex-direction:column;gap:var(--spacing__unit--2)}._link-permission_1pfff_84{font-weight:500}._link-options_1pfff_88{gap:var(--spacing__unit--1_5)}._link-details_1pfff_94,._link-options_1pfff_88{display:flex;flex-direction:row}._link-details_1pfff_94{align-items:center;gap:18px}._link-area_1pfff_101{height:40px;width:544px}._summary-analytics-section_1pfff_106{display:flex;flex-direction:column;gap:var(--spacing__unit--2_5);max-height:100px}._summary-analytics-data_1pfff_113{display:grid;grid-template-columns:2fr 3fr 3fr 4fr}._summary-analytics-data_1pfff_113,._summary-analytics-data-image_1pfff_120{padding-left:var(--spacing__unit--2);padding-right:var(--spacing__unit--2)}._summary-analytics-data-image_1pfff_120{display:flex;flex-direction:row;justify-content:space-around}._summary-analytics-data-image_1pfff_120>div,._summary-analytics-data_1pfff_113>div{display:grid;row-gap:var(--spacing__base_unit)}._summary-data-label_1pfff_134{color:var(--color__faint__text)}._top-pages-chart_1pfff_138{align-items:end;column-gap:var(--spacing__unit--1_5);display:grid;grid-auto-flow:column;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(2,auto);justify-items:center;row-gap:var(--spacing__unit--0_5)}._chart-bar_1pfff_149{background:var(--color__attention__background);cursor:default;width:40px}._chart-bar_1pfff_149:hover:before,._chart-bar_1pfff_149:not(:focus):before{background-color:unset;transition:unset}._chart-label_1pfff_161{color:var(--color__faint__text)}._visit-analytics-section_1pfff_165{display:flex;flex-direction:column;gap:var(--spacing__unit--2_5);min-height:75px}._visit-analytics-table_1pfff_172{display:flex;margin-bottom:var(--spacing__unit--3);max-height:350px;overflow-y:auto}._visit-analytics-table-header_1pfff_179{background-color:var(--color__elevated__background);position:-webkit-sticky;position:sticky;top:0}._visit-count-section_1pfff_185{margin-left:var(--spacing__unit--2)}._visit-count_1pfff_185{font-size:20px;font-weight:500;line-height:30px}._name-cell_1pfff_195{align-items:center;display:flex;flex-direction:row;gap:10px}._email-box_1pfff_202{display:flex;flex-direction:column;gap:2px}._email_1pfff_202{font-size:14px;font-weight:400;line-height:18px}._disabled-text_1pfff_214{color:var(--color__disabled__text)}._document-version-container_1pfff_218{align-items:center;display:flex;flex-direction:row;gap:var(--spacing__base_unit)}._onboarding-image_1pfff_225{align-items:center;background-color:var(--color__attention__background);display:flex;justify-content:center;margin-bottom:var(--spacing__unit--3);padding:var(--spacing__unit--3)}._onboarding-image_1pfff_225>img{display:block}._teams-close-button_1pfff_238{margin-left:auto}._teams-survey-slide-content_1pfff_242{width:100%}._teams-survey-subtext_1pfff_246{margin-bottom:var(--spacing__unit--3)!important}._teams-survey-question-label_1pfff_250{height:auto!important;margin-bottom:var(--spacing__unit--1_5)}._teams-survey-checkbox-row_1pfff_255{display:flex;margin-bottom:var(--spacing__unit--2_5);margin-top:var(--spacing__unit--3)}._teams-survey-checkbox-label_1pfff_261{margin-left:var(--spacing__unit--1_5)}._teams-survey-empty-form-error_1pfff_265{margin-top:var(--spacing__unit--3)}._teams-survey-select-menu_1pfff_269{display:block;width:100%}._teams-survey-select-trigger_1pfff_274{width:100%}._teams-survey-select-trigger-text_1pfff_278{max-width:calc(100% - 28px);overflow:hidden;text-overflow:ellipsis}"));const B="_ds-analytics-header_1pfff_2",F="_ds-analytics-header-filename_1pfff_10",j="_divider_1pfff_16",K="_spinner-container_1pfff_25",z="_spinner-with-text_1pfff_33",W="_spinner-text_1pfff_39",q="_modal-content_1pfff_44",G="_tos-section_1pfff_50",H="_tos-heading_1pfff_56",X="_tos-title_1pfff_62",J="_tos-checkbox-section_1pfff_68",Y="_tos-error_1pfff_74",Z="_link-section_1pfff_78",Q="_link-permission_1pfff_84",ee="_link-options_1pfff_88",te="_link-details_1pfff_94",ae="_link-area_1pfff_101",ie="_summary-analytics-section_1pfff_106",se="_summary-analytics-data_1pfff_113",ne="_summary-analytics-data-image_1pfff_120",le="_summary-data-label_1pfff_134",re="_top-pages-chart_1pfff_138",ce="_chart-bar_1pfff_149",oe="_chart-label_1pfff_161",de="_visit-analytics-section_1pfff_165",me="_visit-analytics-table_1pfff_172",fe="_visit-analytics-table-header_1pfff_179",_e="_visit-count-section_1pfff_185",ue="_visit-count_1pfff_185",ge="_name-cell_1pfff_195",pe="_email-box_1pfff_202",ve="_email_1pfff_202",Ee="_disabled-text_1pfff_214",he="_document-version-container_1pfff_218",ye="_onboarding-image_1pfff_225",Re=()=>t.React$1.createElement("div",{className:K,"data-testid":"centered-spinner"},t.React$1.createElement(a.Spinner,null)),be=({text:e})=>t.React$1.createElement("div",{className:z,"data-testid":"spinner-with-text"},t.React$1.createElement(a.Spinner,{"aria-valuetext":e,size:"xsmall"}),t.React$1.createElement(a.Text,{className:W},e)),$e=t.React$1.memo((()=>t.React$1.createElement("div",{className:ye,"data-testid":"onboarding-image"},t.React$1.createElement("img",{src:t.static_url("/static/metaserver/static/images/docsend_addon/abstract_ui-vflEMii5w.png"),alt:"",width:320,height:286}))));var we;$e.displayName="OnboardingImage",function(e){e.UNABLE_TO_PROVISION_ACCOUNT="UNABLE_TO_PROVISION_ACCOUNT",e.UNABLE_TO_CREATE_LINK="UNABLE_TO_CREATE_LINK"}(we||(we={}));const ke=({onAcceptedTOS:e,fileId:r,fileExt:c,user:o,entryPoint:d})=>{const[m,f]=t.React$1.useState(!1),[_,u]=t.React$1.useState(!1),g=t.React$1.useMemo((()=>new a.DefaultUserApiV2Client(o)),[o]),[p,v]=t.React$1.useState(!1),E=t.React$1.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){if(!m)return u(!0),void a.ProEventsLogger.log("docsend_analytics_add_on_failed_to_accept_tos",{fileExt:c,entryPoint:d});v(!0);if(yield s.provisionAccount(g,d)){const t=yield s.getOrCreateLink(g,r,c,d);t||l.showSnackbar("fail",n.intl.formatMessage({id:"LGBKXL",defaultMessage:"There was a problem creating this link."})),e(null==t?void 0:t.link,null==t?void 0:t.file_has_newer_version,null==t?void 0:t.file_hlc_unix_micros)}else l.showSnackbar("fail",n.intl.formatMessage({id:"y6HA13",defaultMessage:"There was a problem provisioning your account."}));v(!1)}))),[g,r,e,d,c,u,m]),h=t.React$1.useCallback((()=>{f((e=>!e)),u(!1)}),[]);return t.React$1.createElement("div",{className:G,"data-testid":"terms-of-service-section"},p?t.React$1.createElement(be,{text:n.intl.formatMessage({id:"R6/Bzs",defaultMessage:"Creating link..."})}):t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement("div",{className:j}),t.React$1.createElement("div",{className:H},t.React$1.createElement(a.Title,{className:X}," ",n.intl.formatMessage({id:"xt9dt6",defaultMessage:"Try analytics in Dropbox"})," "),t.React$1.createElement(a.Text,null,n.intl.formatMessage({id:"vH5eUV",defaultMessage:"Get page-by-page viewer insights for the documents you share using Dropbox."}))),t.React$1.createElement("div",null,t.React$1.createElement("div",{className:J},t.React$1.createElement(a.Checkbox,{checked:m,onChange:h,"data-testid":"terms-of-service-checkbox",autoFocus:!0}),t.React$1.createElement(a.Text,null,n.intl.formatMessage({id:"yAx7CP",defaultMessage:"I agree to <link1>DocSend Terms</link1> and <link2>Privacy Policy</link2>. Weâ€™ll create a DocSend account with your Dropbox email address. If you have an existing DocSend account, we will create a separate account to power the analytics feature. This new account will be linked across platforms."},{link1:e=>t.React$1.createElement(a.Link,{rel:"noreferrer",target:"_blank",hasNoUnderline:!0,href:"https://www.docsend.com/terms-of-service/",key:"terms"},e),link2:e=>t.React$1.createElement(a.Link,{rel:"noreferrer",target:"_blank",hasNoUnderline:!0,href:"https://www.docsend.com/privacy-policy/",key:"privacy-policy"},e)}))),_&&t.React$1.createElement(a.Text,{tagName:"p",className:Y,color:"error","data-testid":"tos-error"},n.intl.formatMessage({id:"q02yFP",defaultMessage:"Please agree to the terms of service."}))),t.React$1.createElement("div",null,t.React$1.createElement(a.Button$1,{variant:"primary",size:"large",onClick:E,"data-testid":"terms-of-service-button"},n.intl.formatMessage({id:"bElaaI",defaultMessage:"Get 30 days free access"})))))};var xe;!function(e){e.UNABLE_TO_CREATE_LINK="UNABLE_TO_CREATE_LINK"}(xe||(xe={}));const Ne=({apiV2Client:e,fileId:r,fileExt:c,link:o,hasNewerFileVersion:d,fileTimestampMicro:m,entryPoint:f})=>{const[_,u]=t.React$1.useState(!1),[g,p]=t.React$1.useState(!d),[v,E]=t.React$1.useState(!1),[h,y]=t.React$1.useState(m?m/1e3:void 0),R=t.React$1.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){u(!0);const t=yield s.updateDocument(e,r,c,f,o);t?(y((t.file_hlc_unix_micros||0)/1e3),E(!0),p(!0)):l.showSnackbar("fail",n.intl.formatMessage({id:"DQ80ri",defaultMessage:"There was a problem updating this link"})),u(!1)}))),[]);if(_)return t.React$1.createElement("div",{className:he,"data-testid":"loading-latest-version"},t.React$1.createElement(be,{text:n.intl.formatMessage({id:"FJY4Sn",defaultMessage:"Loading latest version..."})}));if(!g)return t.React$1.createElement("div",{className:he,"data-testid":"update-document-banner"},t.React$1.createElement(a.UIIcon,{src:a.WarningLine,size:"small"}),t.React$1.createElement(a.Text,null,n.intl.formatMessage({id:"gpZE8T",defaultMessage:"There is a new version of this file. Update it so viewers can see your latest changes."})),t.React$1.createElement(a.Button$1,{variant:"transparent",onClick:R,"data-testid":"update-button"},n.intl.formatMessage({id:"OwaQ5z",defaultMessage:"Update"})));if(!h||!v)return null;const b=new Date(h),$=b.toLocaleDateString(),w=b.toLocaleTimeString();return t.React$1.createElement("div",{className:he,"data-testid":"latest-version-banner"},t.React$1.createElement(a.UIIcon,{src:a.CheckmarkCircleLine,size:"small",color:"var(--color__faint__text)"}),t.React$1.createElement(a.Text,{color:"faint"},n.intl.formatMessage({id:"gSpGZq",defaultMessage:"Latest version. Last updated on {date} at {time}."},{date:$,time:w})))},Me=({onUpdatedLink:e,link:c,fileId:o,user:d,fileExt:m,didDeleteLink:f,onShowDeleteLinkModal:_,hasNewerFileVersion:u,fileTimestampMicro:g,entryPoint:p})=>{const v=t.React$1.useMemo((()=>new a.DefaultUserApiV2Client(d)),[d]),[E,h]=t.React$1.useState(!1),[y,R]=t.React$1.useState(void 0),b=t.React$1.useRef(null),$=t.React$1.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){h(!0);const t=yield s.getOrCreateLink(v,o,m,p);t?(R(void 0),e(t.link)):(R(xe.UNABLE_TO_CREATE_LINK),l.showSnackbar("fail",n.intl.formatMessage({id:"Uwmac/",defaultMessage:"There was a problem creating or getting this link"}))),h(!1)}))),[v,o,e,m]),w=t.React$1.useCallback((()=>{var e;const t=r.getLinkIdFromLink(c);navigator.clipboard.writeText(null===(e=b.current)||void 0===e?void 0:e.textContent).then((()=>{a.ProEventsLogger.log("docsend_analytics_add_on_copy_link_success",{fileExt:m,linkId:t,entryPoint:p}),l.showSnackbar("complete",n.intl.formatMessage({id:"hdfAQY",defaultMessage:"Link copied. Allows viewing."}))})).catch((()=>{a.ProEventsLogger.log("docsend_analytics_add_on_copy_link_failure",{fileExt:m,linkId:t,entryPoint:p}),l.showSnackbar("fail",n.intl.formatMessage({id:"g71D9h",defaultMessage:"There was a problem copying this link"}))}))}),[m]),k=t.React$1.useCallback((()=>{const e=r.getLinkIdFromLink(c);a.ProEventsLogger.log("docsend_analytics_add_on_manually_copy_link_success",{fileExt:m,linkId:e,entryPoint:p}),l.showSnackbar("complete",n.intl.formatMessage({id:"hdfAQY",defaultMessage:"Link copied. Allows viewing."}))}),[m]),x=t.React$1.useCallback((()=>{_()}),[_]);return t.React$1.useEffect((()=>{c?h(!1):($(),h(!0))}),[c,$]),E?t.React$1.createElement("div",{className:Z,"data-testid":"link-section"},t.React$1.createElement(be,{text:n.intl.formatMessage({id:"R6/Bzs",defaultMessage:"Creating link..."})})):y||f?t.React$1.createElement("div",{className:Z,"data-testid":"link-section"},t.React$1.createElement("div",{className:te},t.React$1.createElement(a.Button$1,{variant:"primary",onClick:$,"data-testid":"create-link-button",autoFocus:!0},n.intl.formatMessage({id:"JalrqG",defaultMessage:"Create shareable link"})))):t.React$1.createElement("div",{className:Z,"data-testid":"link-section"},t.React$1.createElement(a.Text,null,n.intl.formatMessage({id:"fZek45",defaultMessage:"Copy and share this link to get page-by-page viewer insights for your document."})," "),t.React$1.createElement(Ne,{hasNewerFileVersion:u,fileTimestampMicro:g,apiV2Client:v,fileId:o,fileExt:m,link:c,entryPoint:p}),t.React$1.createElement("div",{className:te,"data-testid":"link-details-section"},t.React$1.createElement(a.TextArea,{"aria-labelledby":n.intl.formatMessage({id:"FGPqKs",defaultMessage:"Link textbox"}),ref:b,onCopy:k,className:ae,readOnly:!0,value:c,"data-testid":"link-text-area"}),t.React$1.createElement(a.Button$1,{variant:"primary",size:"large",onClick:w,"data-testid":"copy-link-button",autoFocus:!0},n.intl.formatMessage({id:"fMWfC+",defaultMessage:"Copy link"}))),t.React$1.createElement("div",{className:ee},t.React$1.createElement(a.Text,null," ",n.intl.formatMessage({id:"ohyMJi",defaultMessage:"Anyone with this link "})," ",t.React$1.createElement(a.Text,{className:Q}," ",n.intl.formatMessage({id:"X8/J/n",defaultMessage:"can view "}))," ",n.intl.formatMessage({id:"VIfxi5",defaultMessage:"this document"})," "),t.React$1.createElement(a.Button$1,{"data-testid":"delete-link-button",variant:"transparent",onClick:x},n.intl.formatMessage({id:"peEHe5",defaultMessage:"Delete link"}))))};class Te extends t.React$1.Component{constructor(e){super(e),this.triggerSubmit=()=>{this.form.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))},this.handleSubmit=e=>{if(e.preventDefault(),"function"!=typeof this.form.submit)throw new Error("Form has child element with name or id submit overwriting submit function");c.assertDropboxDomain(this.form.action);let t="";"POST"===this.props.method.toUpperCase()&&(t=c.readCsrfToken()||""),this.setState({csrf:t},(()=>{let e=!1;this.props.handleSubmit&&(e=this.props.handleSubmit(new FormData(this.form))),e||this.form.submit(),setTimeout((()=>this.setState({csrf:""})),0)}))},this.checkValidity=()=>this.form.checkValidity(),this.setFormAction=e=>{this.form.action=e},this.state={csrf:""}}render(){return t.React$1.createElement("form",{ref:e=>{this.form=e},action:this.props.action,method:this.props.method,onSubmit:this.handleSubmit,target:this.props.target||"_self"},""!==this.state.csrf&&t.React$1.createElement("input",{type:"hidden",name:"t",value:this.state.csrf}),this.props.children)}}Te.displayName="DropboxForm";class Se extends t.React$1.Component{constructor(e){super(e),this.handleSubmit=e=>{e.set("is_xhr","true");const t=new XMLHttpRequest;return t.onreadystatechange=()=>{t.readyState===XMLHttpRequest.DONE&&this.props.responseDone&&this.props.responseDone(t)},t.open("POST",this.props.action),t.setRequestHeader("Content-Type","multipart/form-data"),t.send(e),!1}}render(){return t.React$1.createElement(Te,{action:this.props.action,method:"POST",handleSubmit:this.handleSubmit},this.props.children)}}Se.displayName="DropboxLegacyAjaxForm";const De=({daysRemaining:e,stormcrowVariant:i,fileId:s,filePath:l,user:c,fileExt:o,entryPoint:d,link:m})=>{const[f,_]=t.React$1.useState(!0),u=t.React$1.useCallback((()=>{_(!1)}),[_]),g=`https://${document.location.host.replace(/^www./g,"")}${a.get_browse_root(c)}${l}?analytics_file_id=${s}&plan_upgraded=true`,p=r.getUpgradeURL(null!=i?i:"",g),v=t.React$1.useCallback((()=>(a.ProEventsLogger.log("docsend_analytics_add_on_upgrade_button_click",{daysRemaining:e,stormcrowVariant:i,fileExt:o,entryPoint:d,linkId:r.getLinkIdFromLink(m)}),!1)),[e,i,o,d,m]);return void 0!==e&&f?e>5?t.React$1.createElement(a.Banner,{type:"attention",withLeftIcon:!1,withCloseButton:"Close",onRequestClose:u,"data-testid":"upgrade-banner-attention"},t.React$1.createElement(a.Banner.Message,null,n.intl.formatMessage({id:"XFu8X8",defaultMessage:"You have {daysRemaining, number} days to access analytics. Add analytics to your Dropbox plan now."},{daysRemaining:e})),t.React$1.createElement(a.Banner.Actions,null,t.React$1.createElement(Te,{action:p,method:"post",handleSubmit:v},t.React$1.createElement(a.Button$1,{variant:"transparent","data-testid":"upgrade-button"},n.intl.formatMessage({id:"sOfbLs",defaultMessage:"Upgrade"}))))):e>0?t.React$1.createElement(a.Banner,{type:"warning",withLeftIcon:!1,withCloseButton:"Close",onRequestClose:u,"data-testid":"upgrade-banner-warning"},t.React$1.createElement(a.Banner.Message,null,n.intl.formatMessage({id:"8egoWm",defaultMessage:"You will lose access to analytics in {daysRemaining, plural, one {# day} other {# days}}. Add it to your Dropbox plan now."},{daysRemaining:e})),t.React$1.createElement(a.Banner.Actions,null,t.React$1.createElement(Te,{action:p,method:"post",handleSubmit:v},t.React$1.createElement(a.Button$1,{variant:"transparent"},n.intl.formatMessage({id:"sOfbLs",defaultMessage:"Upgrade"}))))):t.React$1.createElement(a.Banner,{variant:"rich",type:"alert",withLeftPictogram:null,"data-testid":"upgrade-banner-alert"},t.React$1.createElement(a.Banner.Message,null,t.React$1.createElement(a.Title,{size:"small"},n.intl.formatMessage({id:"rfgp7o",defaultMessage:"Your access to analytics has ended"})),t.React$1.createElement(a.Text,null,n.intl.formatMessage({id:"/M90bu",defaultMessage:"Add analytics to your Dropbox plan now to continue getting real-time document analytics and more."}))),t.React$1.createElement(a.Banner.Actions,null,t.React$1.createElement(Te,{action:p,method:"post",handleSubmit:v},t.React$1.createElement(a.Button$1,{variant:"outline"},n.intl.formatMessage({id:"XKOnEF",defaultMessage:"Upgrade now"}))))):null};var Ae;!function(e){e.UNKNOWN="UNKNOWN",e.LINK_NOT_FOUND="LINK_NOT_FOUND"}(Ae||(Ae={}));const Ce=(e,t)=>e&&t?{numVisitors:e.num_visitors,avgViewTimeMs:e.average_view_time_ms,numDownloads:e.num_downloads,pageViews:t.top_viewed_pages,pageAvgViewTime:t.top_viewed_pages_average_time_ms}:{},Le=({label:e,value:i,disabled:s})=>t.React$1.createElement("div",null,t.React$1.createElement(a.Text,{className:s?Ee:le,variant:"label",size:"small"},e),t.React$1.createElement(a.Text,{className:s?Ee:"",variant:"label",size:"xlarge",isBold:!0,"data-testid":"summary-data-value"},i)),Ie=({pageViews:e,pageAvgViewTime:i,disabled:s})=>(void 0===e&&(e={}),void 0===i&&(i={}),t.React$1.createElement("div",null,t.React$1.createElement(a.Text,{className:s?Ee:le,variant:"label",size:"small"},n.intl.formatMessage({id:"0upQrV",defaultMessage:"Top pages (latest file version)"})),t.React$1.createElement(Ve,{pageViews:e,pageAvgViewTime:i,disabled:s}))),Ve=({pageViews:e,pageAvgViewTime:i,disabled:s})=>{if(s||0===Object.keys(e).length)return t.React$1.createElement(a.Text,{className:s?Ee:"",variant:"label",size:"xlarge",isBold:!0},n.intl.formatMessage({id:"/Eqf0q",defaultMessage:"N/A"}));{const s=Object.keys(i).sort(((e,t)=>i[t]-i[e]));s.length>3&&(s.length=3);const l=s.reduce(((t,a)=>[...t,{pageNum:a,views:e[a],avgViewTime:i[a]}]),[]),c=[];return l.forEach((e=>{const i=Ue(e,l),s=e.pageNum,o=r.convertToHumanReadableTime(e.avgViewTime),d=t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(a.Text,{variant:"label",tagName:"p",inverse:!0},n.intl.formatMessage({id:"owVLCX",defaultMessage:"Avg. visit time: {avgViewTime}"},{avgViewTime:o})),t.React$1.createElement(a.Text,{variant:"label",tagName:"p",inverse:!0},n.intl.formatMessage({id:"BXZjTy",defaultMessage:"Views: {views}"},{views:e.views}))),m=t.React$1.createRef();c.push(t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(a.Tooltip,{title:d,triggerRef:m,placement:"bottom"},t.React$1.createElement(a.Button$1,{variant:"primary",style:{height:`${i}px`},className:ce})),t.React$1.createElement(a.Text,{className:oe,variant:"label",size:"xsmall",ref:m},n.intl.formatMessage({id:"4OIiar",defaultMessage:"p. {pageNum}"},{pageNum:s}))))})),t.React$1.createElement("div",{className:re,"data-testid":"top-pages-chart"},c)}},Oe={numVisitors:0,avgViewTimeMs:0,numDownloads:0,pageViews:{},pageAvgViewTime:{}},Pe=({fileId:e,fileExt:c,link:o,user:d,disabled:m,entryPoint:f,skip:_})=>{const u=_||m,{isSummaryAnalyticsLoading:g,summaryData:p,summaryDataError:v}=(({fileId:e,fileExt:n,link:l,user:r,skip:c,entryPoint:o})=>{const[d,m]=t.reactExports.useState(!0),[f,_]=t.reactExports.useState({}),[u,g]=t.reactExports.useState(void 0),p=t.reactExports.useMemo((()=>new a.DefaultUserApiV2Client(r)),[r]),v=t.reactExports.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){if(l){const[t,a]=yield Promise.all([s.getSummaryAnalytics(p,e,l,n,o),s.getAnalyticsForDocumentVersion(p,e,l,n,o)]);if(void 0===t||void 0===a)g(Ae.UNKNOWN);else{const e=Ce(t,a);_(e)}}else a.ProEventsLogger.log("docsend_analytics_add_on_use_summary_analytics_failure",{error:Ae.LINK_NOT_FOUND,fileExt:n,entryPoint:o}),g(Ae.LINK_NOT_FOUND);m(!1)}))),[p,e,l]);return t.reactExports.useEffect((()=>{c||v()}),[v,c]),c?{}:{isSummaryAnalyticsLoading:d,summaryData:f,summaryDataError:u}})({user:d,fileId:e,link:o,skip:u,fileExt:c,entryPoint:f});if(t.React$1.useEffect((()=>{v&&l.showSnackbar("fail",n.intl.formatMessage({id:"ixxWOz",defaultMessage:"There was a problem getting summmary analytics."}))}),[v]),g)return t.React$1.createElement("div",{className:ie},t.React$1.createElement("div",{className:j}),t.React$1.createElement(Re,null));const E=m||!!v,h=u||E?Oe:p;return t.React$1.createElement("div",{className:ie},t.React$1.createElement("div",{className:j}),t.React$1.createElement("div",{className:r.isImage(c)?ne:se,"data-testid":"summary-analytics-data"},t.React$1.createElement(Le,{label:n.intl.formatMessage({id:"Ju+Xsr",defaultMessage:"Viewers"}),value:null==h?void 0:h.numVisitors,disabled:E}),t.React$1.createElement(Le,{label:n.intl.formatMessage({id:"apw/4g",defaultMessage:"Avg. visit time"}),value:r.convertToHumanReadableTime(null==h?void 0:h.avgViewTimeMs),disabled:E}),t.React$1.createElement(Le,{label:n.intl.formatMessage({id:"31KJBU",defaultMessage:"Downloads"}),value:null==h?void 0:h.numDownloads,disabled:E}),!r.isImage(c)&&t.React$1.createElement(Ie,{pageViews:null==h?void 0:h.pageViews,pageAvgViewTime:null==h?void 0:h.pageAvgViewTime,disabled:E})))},Ue=(e,t)=>{const a=Math.floor(24*e.avgViewTime/t[0].avgViewTime);return Math.max(a,6)};var Be,Fe;!function(e){e.UNKNOWN="UNKNOWN",e.LINK_NOT_FOUND="LINK_NOT_FOUND",e.GET_MORE_VISIT_DATA_FAILED="GET_MORE_VISIT_DATA_FAILED"}(Be||(Be={})),function(e){e.EMAIL="email",e.DATE="date",e.VIEW_TIME="view_time",e.PERCENT_VIEWED="percent_viewed",e.NONE="none"}(Fe||(Fe={}));const je=e=>!!(e.totalCount&&e.visits&&e.visits.length<e.totalCount),Ke=(e,t,a,n,l,r,c,o,d,m)=>i.__awaiter(void 0,void 0,void 0,(function*(){const i=t;let f=m;if(!i.totalCount||!i.visits)return;let _=1,u=i.totalCount-i.visits.length;for(;u>0;){_++;const t=yield s.getVisitAnalytics(e,a,n,l,d,_,o,f);if(!t){c(Be.GET_MORE_VISIT_DATA_FAILED);break}{const e=Xe(t);if(!e.visits)break;i.visits=[...i.visits,...e.visits],i.cursor=e.cursor,f=i.cursor,u-=e.visits.length}}r(i)})),ze=(e,t)=>{if(!e.visits)return e;switch(t){case"asc":return e.visits.sort(((e,t)=>e.email.localeCompare(t.email))),Object.assign({},e);case"desc":return e.visits.sort(((e,t)=>t.email.localeCompare(e.email))),Object.assign({},e)}return e},We=(e,t)=>{if(!e.visits)return e;switch(t){case"asc":return e.visits.sort(((e,t)=>new Date(e.occurredAt).getTime()-new Date(t.occurredAt).getTime())),Object.assign({},e);case"desc":return e.visits.sort(((e,t)=>new Date(t.occurredAt).getTime()-new Date(e.occurredAt).getTime())),Object.assign({},e)}return e},qe=(e,t)=>{if(!e.visits)return e;switch(t){case"asc":return e.visits.sort(((e,t)=>e.timeSpentMs-t.timeSpentMs)),Object.assign({},e);case"desc":return e.visits.sort(((e,t)=>t.timeSpentMs-e.timeSpentMs)),Object.assign({},e)}return e},Ge=(e,t)=>{if(!e.visits)return e;switch(t){case"asc":return e.visits.sort(((e,t)=>He(e.numPagesViewed,e.totalPages)-He(t.numPagesViewed,t.totalPages))),Object.assign({},e);case"desc":return e.visits.sort(((e,t)=>He(t.numPagesViewed,t.totalPages)-He(e.numPagesViewed,e.totalPages))),Object.assign({},e)}return e},He=(e,t)=>e&&t?Math.ceil(e/t*100):0,Xe=e=>{return e?{cursor:e.cursor,pageSize:e.page_size,totalCount:e.total_count,visits:(t=e.visits,t?t.map((e=>({timeSpentMs:e.time_spent_ms,occurredAt:e.occurred_at,email:e.email,visitorName:e.visitor_name,numPagesViewed:e.num_pages_viewed,totalPages:e.total_pages,downloaded:e.downloaded,documentVersion:e.document_version}))):[])}:{};var t},Je=({email:e,initials:i,disabled:s})=>{const n=`${ve} ${Ee}`;return t.React$1.createElement("div",{className:ge},t.React$1.createElement("div",null,t.React$1.createElement(a.Avatar,{size:"standard",backgroundColor:a.avatarColorForUserIdentifier(i),isInactive:s},s?"":i)),t.React$1.createElement("div",{className:pe},t.React$1.createElement(a.Text,{"data-testid":"email-text",className:s?n:ve},e)))},Ye=({visit:e,index:i,disabled:s,hidePercentViewed:l})=>{let c="";if(e.occurredAt){const t=new Date(e.occurredAt);c=isNaN(t.getTime())?e.occurredAt:t.toLocaleDateString()}const d=at(e.numPagesViewed,e.totalPages);return t.React$1.createElement(o.Table.Row,{key:i,"data-testid":`row-${i}`},t.React$1.createElement(o.Table.Cell,null,t.React$1.createElement(Je,{email:e.email,initials:it(e.email),disabled:s})),t.React$1.createElement(o.Table.Cell,null,t.React$1.createElement(a.Text,{"data-testid":"date-text",className:s?Ee:""},c)),t.React$1.createElement(o.Table.Cell,null,t.React$1.createElement(a.Text,{"data-testid":"time-spent-text",className:s?Ee:""},r.convertToHumanReadableTime(e.timeSpentMs))),!l&&t.React$1.createElement(o.Table.Cell,null,t.React$1.createElement(a.Text,{"data-testid":"percent-viewed-text",className:s?Ee:""},n.intl.formatMessage({id:"ZLFg36",defaultMessage:"{percentViewed}%"},{percentViewed:d}))))},Ze=()=>{const e={timeSpentMs:0,occurredAt:n.intl.formatMessage({id:"/Eqf0q",defaultMessage:"N/A"}),email:n.intl.formatMessage({id:"GrD0Fp",defaultMessage:"Email address"}),numPagesViewed:0,totalPages:0,downloaded:!1,documentVersion:0};return t.React$1.createElement("div",{className:de,"data-testid":"disabled-visit-analytics"},t.React$1.createElement("div",{className:j}),t.React$1.createElement(Qe,{numVisits:0,disabled:!0}),t.React$1.createElement("div",{className:me},t.React$1.createElement(o.Table,{spacing:"large"},t.React$1.createElement(et,{disabled:!0}),t.React$1.createElement(o.Table.Body,null,t.React$1.createElement(Ye,{key:0,visit:e,index:0,disabled:!0})))))},Qe=({numVisits:e,disabled:i})=>t.React$1.createElement("div",{className:_e,"data-testid":"visit-count-section"},t.React$1.createElement(a.Text,{className:`${ue} ${i?Ee:""}`}," ",n.intl.formatMessage({id:"aNjPN4",defaultMessage:"{numVisits, plural, one {# visit} other {# visits}}"},{numVisits:e}))),et=({disabled:e,changeSortDirection:a,sortState:i,hidePercentViewed:s})=>{const l=t.React$1.useCallback(((e,t)=>t.columnName===e?t.sortDirection:"none"),[]);return t.React$1.createElement(o.Table.Header,{className:fe},t.React$1.createElement(o.Table.Row,null,t.React$1.createElement(o.Table.HeaderCell,Object.assign({"data-testid":"email-header",className:e?Ee:""},a&&i?{sortDirection:l(Fe.EMAIL,i),onSort:()=>a(Fe.EMAIL)}:{}),n.intl.formatMessage({id:"BLNJWZ",defaultMessage:"Email"})),t.React$1.createElement(o.Table.HeaderCell,Object.assign({"data-testid":"date-header",className:e?Ee:""},a&&i?{sortDirection:l(Fe.DATE,i),onSort:()=>a(Fe.DATE)}:{}),n.intl.formatMessage({id:"U0C7zN",defaultMessage:"Date"})),t.React$1.createElement(o.Table.HeaderCell,Object.assign({"data-testid":"view-time-header",className:e?Ee:""},a&&i?{sortDirection:l(Fe.VIEW_TIME,i),onSort:()=>a(Fe.VIEW_TIME)}:{}),n.intl.formatMessage({id:"bGYbSG",defaultMessage:"Visit time"})),!s&&t.React$1.createElement(o.Table.HeaderCell,Object.assign({"data-testid":"percent-viewed-header",className:e?Ee:""},a&&i?{sortDirection:l(Fe.PERCENT_VIEWED,i),onSort:()=>a(Fe.PERCENT_VIEWED)}:{}),n.intl.formatMessage({id:"xFgp/b",defaultMessage:"Percent viewed"}))))},tt=({fileId:e,fileExt:c,link:d,user:m,disabled:f,entryPoint:_,skip:u})=>{var g,p;const v=u||f,{isVisitAnalyticsLoading:E,visitData:h,visitDataError:y,sortVisitData:R}=(({fileId:e,fileExt:n,link:l,cursor:c,pageSize:o,user:d,skip:m,entryPoint:f})=>{const[_,u]=t.reactExports.useState(!0),[g,p]=t.reactExports.useState({}),[v,E]=t.reactExports.useState(void 0),h=t.reactExports.useMemo((()=>new a.DefaultUserApiV2Client(d)),[d]),y=t.reactExports.useCallback(((e,t)=>{var i;switch(e){case Fe.EMAIL:p(ze(g,t));break;case Fe.DATE:p(We(g,t));break;case Fe.VIEW_TIME:p(qe(g,t));break;case Fe.PERCENT_VIEWED:p(Ge(g,t))}a.ProEventsLogger.log(`docsend_analytics_add_on_sort_visit_table_by_${e}_${t}`,{fileExt:n,entryPoint:f,linkId:r.getLinkIdFromLink(l),pageSize:g.pageSize,pageCount:null===(i=g.visits)||void 0===i?void 0:i.length,totalCount:g.totalCount})}),[g]),R=t.reactExports.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){if(l){const t=yield s.getVisitAnalytics(h,e,l,n,o,1,f,c);if(t){const i=Xe(t);p(i),i.totalCount&&a.UserSurvey.trackEvent("viewed_analytics_on_file_shared_with_docsend_analytics_add_on","docsend_analytics_add_on_modal"),je(i)&&Ke(h,Object.assign({},i),e,l,n,p,E,f,o,t.cursor)}else E(Be.UNKNOWN)}else a.ProEventsLogger.log("docsend_analytics_add_on_use_visit_analytics_failure",{error:Be.LINK_NOT_FOUND,fileExt:n,entryPoint:f}),E(Be.LINK_NOT_FOUND);u(!1)}))),[h,e,l,c,o]);return t.reactExports.useEffect((()=>{m||R()}),[R,m]),m?{}:{isVisitAnalyticsLoading:_,visitData:g,visitDataError:v,sortVisitData:y}})({user:m,fileId:e,link:d,fileExt:c,skip:v,entryPoint:_}),[b,$]=t.React$1.useState({columnName:Fe.NONE,sortDirection:"none"});t.React$1.useEffect((()=>{if(y){let e=n.intl.formatMessage({id:"niUAOO",defaultMessage:"There was a problem getting visit analytics."});y===Be.GET_MORE_VISIT_DATA_FAILED&&(e=n.intl.formatMessage({id:"ViJ/ns",defaultMessage:"There was a problem getting more visit analytics."})),l.showSnackbar("fail",e)}}),[y]);const w=t.React$1.useCallback((e=>{switch(b.columnName!==e&&(b.columnName=e,b.sortDirection="none"),b.sortDirection){case"asc":b.sortDirection="desc";break;case"desc":case"none":b.sortDirection="asc"}R&&(R(b.columnName,b.sortDirection),$({columnName:b.columnName,sortDirection:b.sortDirection}))}),[R]);if(f||y&&y!==Be.GET_MORE_VISIT_DATA_FAILED)return t.React$1.createElement(Ze,null);if(E)return t.React$1.createElement("div",{className:de},t.React$1.createElement("div",{className:j}),t.React$1.createElement(Re,null));const k=(null===(g=null==h?void 0:h.visits)||void 0===g?void 0:g.length)||0;return t.React$1.createElement("div",{className:de},t.React$1.createElement("div",{className:j}),t.React$1.createElement(Qe,{numVisits:k}),k>0&&(null===(p=null==h?void 0:h.visits)||void 0===p?void 0:p.length)?t.React$1.createElement("div",{className:me},t.React$1.createElement(o.Table,{spacing:"large","data-testid":"visit-analytics-table"},t.React$1.createElement(et,{changeSortDirection:w,sortState:b,hidePercentViewed:r.isImage(c)}),t.React$1.createElement(o.Table.Body,null,h.visits.map(((e,a)=>t.React$1.createElement(Ye,{key:a,visit:e,index:a,hidePercentViewed:r.isImage(c)})))))):null)},at=(e,t)=>e&&t?Math.ceil(e/t*100):0,it=e=>e?e.charAt(0).toUpperCase():"",st=({fileName:e,fileId:c,fileExt:o,link:d,user:m,onCloseDeleteLinkModal:f,entryPoint:_})=>{const[u,g]=t.React$1.useState(!1),p=t.React$1.useMemo((()=>new a.DefaultUserApiV2Client(m)),[m]),v=t.React$1.useCallback((()=>{a.dispatchModalClosed(),f(!1);const e=r.getLinkIdFromLink(d);a.ProEventsLogger.log("docsend_analytics_add_on_delete_link_cancel",{fileExt:o,entryPoint:_,linkId:e})}),[f]),E=t.React$1.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){g(!0),l.showSnackbar("sync",n.intl.formatMessage({id:"3/ldox",defaultMessage:"Deleting link to {fileName}."},{fileName:e}),0);(yield s.deleteLink(p,c,d,o,_))?(l.showSnackbar("complete",n.intl.formatMessage({id:"3qNu/U",defaultMessage:"Deleted link to {fileName}."},{fileName:e})),a.dispatchModalClosed(),f(!0)):l.showSnackbar("fail",n.intl.formatMessage({id:"aIZcFS",defaultMessage:"There was a problem deleting this link."})),g(!1)}))),[p,e,d,c,f]);return t.React$1.useEffect((()=>{a.dispatchModalOpened()}),[]),t.React$1.createElement(a.Modal$1,{open:!0,isCentered:!0,className:"uxa-modal",id:"docsend_analytics_add_on_delete_link_modal","aria-labelledby":"ds-analytics-delete-link-modal-title","data-testid":"delete-link-modal"},t.React$1.createElement(a.Modal$1.Header,{hasBottomSpacing:"title-standard"},t.React$1.createElement(a.Modal$1.Title,{id:"ds-analytics-delete-link-modal-title"},n.intl.formatMessage({id:"Q9LBuK",defaultMessage:'Delete link to "{fileName}"'},{fileName:e}))),t.React$1.createElement(a.Modal$1.Body,{hasVerticalSpacing:!0},t.React$1.createElement(a.Text,null,n.intl.formatMessage({id:"ZWg0m3",defaultMessage:"By deleting this link you will lose access to all past analytics. A new link can be created to track future analytics."}))),t.React$1.createElement(a.Modal$1.Footer,null,t.React$1.createElement(a.Button$1,{"data-testid":"cancel-button",variant:"opacity",onClick:v,autoFocus:!0},n.intl.formatMessage({id:"q/OeYK",defaultMessage:"Cancel"})),t.React$1.createElement(a.Button$1,{"data-testid":"delete-link-button",variant:"primary",onClick:E,disabled:u,autoFocus:!0},n.intl.formatMessage({id:"zpwh5R",defaultMessage:"Delete"}))))};st.displayName="DeleteLinkModal";const nt=({accountStatus:e,link:i,fileId:s,filePath:n,user:l,fileExt:r,accountStatusError:c,didDeleteLink:o,onShowDeleteLinkModal:d,onUpdatedLink:m,hasNewerFileVersion:f,fileTimestampMicro:_,stormcrowVariant:u,entryPoint:g,isNewLink:p})=>{const[v,E]=t.React$1.useState(!1),[h,y]=t.React$1.useState(e.daysRemaining),[R,b]=t.React$1.useState(f),[$,w]=t.React$1.useState(_),k=t.React$1.useRef(null),x=t.React$1.useCallback(((e,t,a)=>{b(t),w(a),m(e),E(!0),y(30)}),[m]);t.React$1.useEffect((()=>{k.current&&(a.dispatchModalOpened(),a.UserSurvey.trackEvent("viewed_docsend_analytics_add_on_modal","docsend_analytics_add_on_modal"))}),[k]);const N=e.isProvisioned||i||v||o,M=!c&&!N,T=!i||o||!e.hasAddOnAccess&&!v,S=(e.isProvisioned||v)&&!e.hasActivePlan;return t.React$1.createElement("div",{className:q,ref:k},S&&t.React$1.createElement(De,{daysRemaining:h,stormcrowVariant:u,fileId:s,filePath:n,user:l,fileExt:r,entryPoint:g,link:i}),N?t.React$1.createElement(Me,{link:i,onUpdatedLink:m,fileId:s,user:l,fileExt:r,didDeleteLink:o,onShowDeleteLinkModal:d,hasNewerFileVersion:R,fileTimestampMicro:$,entryPoint:g}):M?t.React$1.createElement(ke,{onAcceptedTOS:x,user:l,fileId:s,fileExt:r,entryPoint:g}):null,M?t.React$1.createElement($e,null):t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(Pe,{fileId:s,fileExt:r,user:l,link:i,disabled:T,entryPoint:g,skip:p}),t.React$1.createElement(tt,{fileId:s,fileExt:r,user:l,link:i,disabled:T,entryPoint:g,skip:p})))},lt=({fileName:e,fileId:r,filePath:c,user:o,stormcrowVariant:d,entryPoint:m})=>{var f;const _=a.file_extension(e),[u,g]=t.React$1.useState(!0),{isAccountStatusLoading:p,accountStatus:v,accountStatusError:E}=(({user:e,entryPoint:n})=>{const[l,r]=t.reactExports.useState(!0),[c,o]=t.reactExports.useState({}),[d,m]=t.reactExports.useState(void 0),f=t.reactExports.useMemo((()=>new a.DefaultUserApiV2Client(e)),[e]),_=t.reactExports.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){const e=yield s.getPlanStatus(f,n);if(e){const t={hasActivePlan:e.has_active_plan,hasAddOnAccess:e.has_addon_access,daysRemaining:e.trial_days_left,isProvisioned:e.provision_status===P.PROVISIONED};o(t)}else m(O.UNABLE_TO_GET_PLAN_STATUS);r(!1)}))),[f]);return t.reactExports.useEffect((()=>{_()}),[_]),{isAccountStatusLoading:l,accountStatus:c,accountStatusError:d}})({user:o,entryPoint:m}),{isAnalyticsLinkLoading:h,linkData:y,linkDataError:R}=(({skip:e,fileId:n,fileExt:l,user:r,entryPoint:c})=>{const[o,d]=t.reactExports.useState(!0),[m,f]=t.reactExports.useState({}),[_,u]=t.reactExports.useState(void 0),g=t.reactExports.useMemo((()=>new a.DefaultUserApiV2Client(r)),[r]),p=t.reactExports.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){const e=yield s.getOrCreateLink(g,n,l,c);e?f({link:null==e?void 0:e.link,hasNewerFileVersion:e.file_has_newer_version,fileTimestampMicro:e.file_hlc_unix_micros,isNewLink:e.is_new_link}):u(U.UNKNOWN),d(!1)}))),[g,n]);return t.reactExports.useEffect((()=>{e||p()}),[p,e]),e?{}:{isAnalyticsLinkLoading:o,linkData:m,linkDataError:_}})({user:o,skip:p||!!E||!v.isProvisioned,fileId:r,fileExt:_,entryPoint:m}),[b,$]=t.React$1.useState(!1),[w,k]=t.React$1.useState(!1),[x,N]=t.React$1.useState(null==y?void 0:y.link),M=t.React$1.useCallback((e=>{N(e),k(!1)}),[]);t.React$1.useEffect((()=>{(null==y?void 0:y.link)&&N(y.link)}),[y]);const T=t.React$1.useCallback((e=>{e&&k(!0),$(!1)}),[]),S=t.React$1.useCallback((()=>{$(!0)}),[]),D=t.React$1.useCallback((()=>{g(!1),a.dispatchModalClosed()}),[]),A=p||h;return t.React$1.useEffect((()=>{(E||R)&&l.showSnackbar("fail",n.intl.formatMessage({id:"CXl2Hh",defaultMessage:"There was a problem completing this request"}))}),[E,R]),b&&x?t.React$1.createElement(st,{link:x,fileExt:_,fileName:e,fileId:r,user:o,onCloseDeleteLinkModal:T,entryPoint:m}):t.React$1.createElement(a.Modal$1,{open:u,isCentered:!0,withCloseButton:"Close",className:"uxa-modal",id:"docsend_analytics_add_on_modal",width:700,onRequestClose:D,"aria-labelledby":"ds-analytics-modal-title"},t.React$1.createElement(a.Modal$1.Header,{hasBottomSpacing:"title-standard"},t.React$1.createElement(a.Modal$1.Title,{id:"ds-analytics-modal-title",className:B},t.React$1.createElement("div",null,n.intl.formatMessage({id:"m/4By6",defaultMessage:"Analytics for "}),t.React$1.createElement(a.Text,{className:F},e)),t.React$1.createElement(a.AccessoryBadge,{"data-testid":"beta-badge"},n.intl.formatMessage({id:"QT7EnD",defaultMessage:"Beta"})))),t.React$1.createElement(a.Modal$1.Body,{hasVerticalSpacing:!0},A?t.React$1.createElement(Re,null):t.React$1.createElement(nt,{accountStatus:v,link:x,hasNewerFileVersion:null==y?void 0:y.hasNewerFileVersion,fileTimestampMicro:null==y?void 0:y.fileTimestampMicro,user:o,fileId:r,filePath:c,fileExt:a.file_extension(e),accountStatusError:E,didDeleteLink:w,onShowDeleteLinkModal:S,onUpdatedLink:M,stormcrowVariant:d,entryPoint:m,isNewLink:null===(f=null==y?void 0:y.isNewLink)||void 0===f||f})))};lt.displayName="DocSendAnalyticsModal";e.showDocsendModal=e=>{(e=>{a.Modal.showInstance(t.React$1.createElement(lt,Object.assign({},e)))})(e)}}));
//# sourceMappingURL=c_docsend_analytics_add_on_helpers_modals.js-vflqwTkq4.map
