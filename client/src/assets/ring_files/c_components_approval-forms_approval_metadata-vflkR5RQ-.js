define(["exports","./e_ui_page_files_router","./c_lodash-es_lodash","./c_contacts_data_v2","./c_flows_approval_approval_io_client","./e_edison","./c_core_i18n","./c_breadcrumb_index","./c_components_approval-forms_url_utils"],(function(e,t,n,a,i,s,r,o,l){"use strict";const c={client:null,subscribe({app_id:e,revision:n,token:a,unique_id:i},s,r){const o=new t.SignedChannelState(e,i,n,a);c.client?c.client.update_states([o]):(c.client=new t.BoltClient([o],s,r),c.client.start())},unsubscribe(){c.client&&(c.client.unsubscribe(),c.client=null)}};function u(e){return{id:e.dbx_account_id,email:e.email,name:{display:e.name,initials:t.getInitials(e.name),public:t.getShortName(e.name)},photoUrl:e.photo_url||e.avatar_url}}class p{constructor(e,t=!1){this.cache={},this.filterContact=e=>{const t=!!e.group_id,n=!this.allowMentionSelf&&e.email===this.user.email;return!(t||n)},this.updateCache=(e,t,n)=>{let a;const i=t.map(u);if(n){a=[...this.cache[e]||[],...i]}else a=i;return this.cache=Object.assign(Object.assign({},this.cache),{[e]:a}),this.cache},this.user=e,this.allowMentionSelf=t,this.dataSource=new a.ContactsDataSourceV2(e,this.filterContact)}query(e,t,n){this.dataSource.search(e,(n=>{t(this.updateCache(e,n,!1))}),(a=>{(n||t)(this.updateCache(e,a,!0))}))}getMatchesWithStarterSuggestions(){const e=a.BloodhoundContactsV2.getAll(this.user).filter(this.filterContact).map(u),t=n.sortBy(e.slice(0,50),(e=>e.name||e.email));return this.cache=Object.assign(Object.assign({},this.cache),{"":t}),this.cache}}function d(e,t){return e?new p(e,t):{cache:{},query:()=>{},getMatchesWithStarterSuggestions:()=>({})}}function h(e){return e?("/"!==e.charAt(0)&&(e=`/${e}`),"/"===e.charAt(e.length-1)?e.substr(0,e.length-1):e):""}function m(e){return e.split("/").slice(0,-1).join("/")||"/"}const f=s.React$1.memo((({fileId:e,getApprovalStatus:n,InfoBladeRowComponent:a,onClick:i,logger:c})=>{const[u,p]=s.reactExports.useState(null),[d,h]=s.reactExports.useState(null),m=r.useIntl(),f={pending:m.formatMessage({id:"bxXd24",defaultMessage:"Pending approval"}),approved:m.formatMessage({id:"wtrJLn",defaultMessage:"Approved"}),no_status:null,other:null};if(s.reactExports.useEffect((()=>{let t=!0;return p(null),n(e).then((e=>{var n;const a=null===(n=e.status)||void 0===n?void 0:n[".tag"];if(!a||"pending"!==a&&"approved"!=a)return;const i=e.comment_id;if(i&&t){p(f[a]),h(i)}})),()=>{t=!1}}),[e]),!u||!d)return null;return s.React$1.createElement(a,{title:m.formatMessage({id:"vautul",defaultMessage:"Status"}),data:s.React$1.createElement(o.Breadcrumb,{size:"small"},s.React$1.createElement(o.Breadcrumb.Link,{onClick:()=>{c&&c(u),l.setApprovalCommentId(d),i()}},s.React$1.createElement(t.Text,{variant:"paragraph",size:"small"},u)))})}));f.displayName="ApprovalMetadata",e.ApprovalMetadata=f,e.dbxUserToIUser=function(e){return{id:e.account_id,name:{display:e.display_name,initials:t.getInitials(e.display_name),public:t.getShortName(e.display_name)},photoUrl:e.photo_circle_url}},e.file_extension=function(e){return function(e){if(!e)return{name:"",ext:""};const t=e.split("."),n=e.length>0&&"."===e[0];let a=e.indexOf(".")<0;n&&(a=t.length<=2);const i=t.pop();return i&&!a?{name:t.join("."),ext:i}:{name:e,ext:""}}(e).ext.toLowerCase()},e.filename=function(e,t){const n=(e=h(e)).split("/").pop();return n||(t||"Dropbox")},e.isVersioningMVPEnabled=e=>"MVP"===e,e.makeComments2Client=function(e){let t;if(e){let n=null;const a=()=>{const t=d(e);return{search(e,n){0!==e.length?t.query(e,n):n(t.getMatchesWithStarterSuggestions())}}};t=()=>(n||(n=a()),n)}return{boltIOClient:(e=>{let t=e=>{};return{subscribe:n=>(n.forEach((n=>{e.subscribe(function({channelId:e,revisionInfo:t}){return{app_id:e.appId,unique_id:e.uniqueId,revision:t.revision.toString(),token:t.token}}(n),t,t)})),Promise.resolve()),unsubscribe:()=>Promise.resolve(e.unsubscribe()),onSignal:e=>{t=t=>{const n=t.map((e=>{return{channelId:{appId:(t=e).app_id,uniqueId:t.unique_id},revisionInfo:{revision:parseInt(null!==(n=t.revision)&&void 0!==n?n:"",10),token:t.token}};var t,n}));e({updatedChannels:n})}}}})(c),mentionsIOClient:t,approvalIOClient:e?i.approvalIOClient(e.id):void 0}},e.mentionsApi=d,e.normalize=h,e.parentDirName=function(e){const t=e.split("/");return t.length>1?t[t.length-2]:""},e.parent_dirs=function(e){const t=[];let n=m(e);for(;"/"!==n;)t.push(n),n=m(n);return t},e.useTooltipPlacement=function(){const[e,t]=s.reactExports.useState("top"),n=s.reactExports.useCallback((e=>{t(e)}),[t]);return{placement:e,onChangePlacement:n}}}));
//# sourceMappingURL=c_components_approval-forms_approval_metadata.js-vflWBKpKD.map
