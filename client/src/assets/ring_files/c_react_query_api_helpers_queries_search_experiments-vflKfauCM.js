define(["exports","./c_tslib","./e_ui_page_files_router","./e_core_exception","./c_core_i18n","./c_icon_folder_icon","./c_core_exception_info"],(function(e,t,i,a,n,l,r){"use strict";const o=(e,t)=>({id:e.dbx_account_id,initials:i.getInitials(e.name),avatar:e.photo_url||e.avatar_url,name:e.name,nameHighlights:i.getHighlightSpansForName({name:e.name,query:t})||[],emailAddress:e.email,emailAddressHighlights:i.getHighlightSpansForEmail({email:e.email,query:t})||[],ariaLabel:n.intl.formatMessage({id:"zo1Vix",defaultMessage:"Search for {name}"},{name:e.name})}),s=e=>({tag:e.tag_text,isSmartTag:i.isSuggestedTag(e)}),u=e=>({query:e.text,ariaLabel:n.intl.formatMessage({id:"Nw8oMH",defaultMessage:"Search for {query}"},{query:e.text}),highlightSpans:(e.highlight_spans||[]).map((e=>({string:e.highlight_str,isHighlighted:!!e.is_highlighted})))}),d=(e,t,a)=>{var n,r,o,s;const u=i.getIdForSearchResult(e),d=i.resultObjectToUrl(e,t);if(e instanceof i.File){const t=e.type===i.FileTypes.FILE||e.type===i.FileTypes.PACKAGE;let o;if(e.is_in_backup_folder&&!e.fq_path){const t=i.filename_without_extension(i.filename(e.ns_path));o=a?null!==(n=a.displayName)&&void 0!==n?n:a.name:t}else o=i.filename(e.fq_path);return{resultId:u,url:d,resultName:o,ariaLabel:i.filename(e.fq_path),lastModifiedByPerson:null!==(r=e.last_modified_name)&&void 0!==r?r:null,lastModifiedDateOrTime:i.getLastModifiedDateOrTime(e.ts?1e3*e.ts:null),iconType:t?"unknown-small":l.convertLegacyFolderIconToSpectrum(e.icon,"small"),filePath:t?e.fq_path:void 0}}return e instanceof i.FileSharedWithMe?{resultId:u,url:d,resultName:i.filename(e.filename),ariaLabel:i.filename(e.filename),lastModifiedByPerson:null!==(o=e.last_modified_name)&&void 0!==o?o:null,lastModifiedDateOrTime:i.getLastModifiedDateOrTime(1e3*e.ts),iconType:"unknown-small",filePath:e.filename}:e instanceof i.Paper?{resultId:u,url:d,resultName:e.title,ariaLabel:e.title,lastModifiedByPerson:null!==(s=e.last_editor_name)&&void 0!==s?s:null,lastModifiedDateOrTime:i.getLastModifiedDateOrTime(e.ts),iconType:"paper-small"}:{resultId:u,url:d,resultName:e.name,ariaLabel:e.name,lastModifiedByPerson:null,lastModifiedDateOrTime:"",iconType:"folder-small"}},c=e=>({recentItemId:e.recentItemId,recentItemName:e.recentItemName,lastActivityLocalizedString:i.getLastActivityLocalizedString(e.lastActivityType,e.lastActivityTimestampMs),iconType:e.icon,url:e.url,fqPath:e.fqPath,parentFolderName:e.breadcrumb.length>0&&e.breadcrumb[0].name?e.breadcrumb[0].name:null,ariaLabel:e.recentItemName}),g=i.createApiv2Query({requestMethod:"search:get_experiment_data"});e.convertAssistantResultToRecentItem=(e,t)=>{var a,n,l,r,o,s,u,d;const c=(g=e).result&&"single_entry"===g.result[".tag"]&&g.result.feature&&"recent"===g.result.feature[".tag"]?g.result:null;var g;if(!c)return null;const m=(null===(a=c.content)||void 0===a?void 0:a.content)&&"resource"===c.content.content[".tag"]?c.content.content:null,_=null!==(n=c.last_activity_type&&c.last_activity_type[".tag"])&&void 0!==n?n:null,p=null!==(r=null===(l=c.last_activity_timestamp)||void 0===l?void 0:l.timestamp_ms)&&void 0!==r?r:null;if(!(m&&m.id&&m.name&&m.metadata&&_&&p))return null;if("file_metadata"===m.metadata[".tag"]){const e=m.metadata,a=m.id.id&&"file_obj_id"===m.id.id[".tag"]?m.id.id.file_obj_id:null;return a&&e.url?{recentItemId:a,recentItemName:m.name,lastActivityTimestampMs:p,lastActivityType:_,fqPath:null!==(o=e.fq_path)&&void 0!==o?o:null,url:e.fq_path?i.preview_uri_for_fq_path(t,e.fq_path).toString():e.url,icon:null!==(s=e.icon)&&void 0!==s?s:"unknown-small",breadcrumb:null!==(u=e.breadcrumb)&&void 0!==u?u:[]}:null}if("paper_metadata"===m.metadata[".tag"]){const e=m.metadata,t=m.id.id&&"paper_entity_id"===m.id.id[".tag"]?m.id.id.paper_entity_id:null;return t&&e.url?{recentItemId:t,recentItemName:m.name,lastActivityTimestampMs:p,lastActivityType:_,fqPath:null,url:e.url,icon:"paper-small",breadcrumb:null!==(d=e.breadcrumb)&&void 0!==d?d:[]}:null}return null},e.convertBasicContactResultToContact=e=>new i.Contact({dbx_account_id:e.account_id,email:e.email,group_id:e.group_id,name:e.display_name,type:i.ContactTypes.EMAIL}),e.convertContactToPeopleSuggestion=o,e.convertQuerySuggestionResultToQuerySuggestion=u,e.convertRecentItemToRecentItemSuggestion=c,e.convertSearchResultToResultSuggestion=d,e.convertSuggestionDataToHighlightedSuggestion=(e,t)=>{if(e)return i.isPeopleSuggestionData(e)?o(e,""):i.isTagsSuggestionData(e)?s(e):i.isQuerySuggestionData(e)?u(e):i.isResultSuggestionData(e)?d(e,t):i.isRecentItemSuggestionData(e)?c(e):void a.reportException({err:new Error("Unable to convert suggestion data due to invalid type for SuggestionData"),severity:r.SEVERITY.CRITICAL,tags:["js:search"]})},e.convertTagToTagSuggestion=s,e.getHighlightedSuggestion=(e,t,i)=>{if(void 0===t)return;let a=0;for(const n of i){const i=e.find((e=>e.suggestionSection===n));if(void 0!==i){if(void 0!==i.suggestions[t-a])return i.suggestions[t-a];a+=i.suggestions.length}}},e.getHighlightedSuggestionData=(e,t,i)=>{if(void 0===t||!i)return;let a=0;for(const n of i){const i=e[n];if(void 0!==i){if(void 0!==i[t-a])return i[t-a];a+=i.length}}},e.reportExceptionIfRequestFails=(e,i=[],n)=>t.__awaiter(void 0,void 0,void 0,(function*(){try{return yield e()}catch(e){const t=e.raw;if(0!==(null==t?void 0:t.status)){const l=t?new Error(t.responseBody):e;a.reportException({err:l,tags:["js:search",...i],severity:r.SEVERITY.NON_CRITICAL}),n&&n(e)}throw new Error(e)}})),e.searchExperimentsRequestPackage=g,e.useSearchActionBarExperiments=()=>{var e,t,i,a,n;const l=null===(t=null===(e=g.useQuery({}).data)||void 0===e?void 0:e.apiData)||void 0===t?void 0:t.experiments;return{expVaultEnableViewOnlySharing:!1,expSpacesFssDropdown:!1,expFlowsAutomatedFolderUI:null!==(i=null==l?void 0:l.flows_automated_folder_ui)&&void 0!==i&&i,expFlowsManualVideoGifUi:!1,expFssEntryPointForSpaces:!1,expCollectionsInBrowse:!1,expFlowsBrowseBarSaveAsUi:"OFF",expUserLevelSharingSettings:null!==(a=null==l?void 0:l.user_level_sharing_settings)&&void 0!==a?a:"OFF",expImageEditEntryPoint:null!==(n=null==l?void 0:l.core_attach_mpa_image_edit_entrypoint)&&void 0!==n?n:"OFF"}},e.useSearchInputExperiments=()=>{var e,t,i,a,n;const l=null===(t=null===(e=g.useQuery({}).data)||void 0===e?void 0:e.apiData)||void 0===t?void 0:t.experiments;return{expSearchEnableMSOfficeThumbnails:null!==(i=null==l?void 0:l.search_experiment_enable_msoffice_thumbnails)&&void 0!==i?i:"OFF",manualTaggingVariant:null!==(a=null==l?void 0:l.manual_tagging)&&void 0!==a?a:"OFF",searchDocClassification:null!==(n=null==l?void 0:l.search_doc_classification)&&void 0!==n?n:"OFF"}},e.useSearchResultsExperiments=()=>{var e,t,i,a,n,l,r,o,s,u,d,c,m,_,p;const v=null===(t=null===(e=g.useQuery({}).data)||void 0===e?void 0:e.apiData)||void 0===t?void 0:t.experiments;return{expManualTagging:null!==(i=null==v?void 0:v.manual_tagging)&&void 0!==i?i:"OFF",expFlowsAutomatedFolderUI:null!==(a=null==v?void 0:v.flows_automated_folder_ui)&&void 0!==a&&a,expFlowsAutoTagUi:null!==(n=null==v?void 0:v.flows_auto_tag_ui)&&void 0!==n&&n,expAutoTaggingAwarenessVariant:null!==(l=null==v?void 0:v.auto_tagging_awareness_variant)&&void 0!==l?l:"OFF",expSearchSerpCsat:null!==(r=null==v?void 0:v.search_experiment_serp_csat)&&void 0!==r?r:"OFF",expSearchSerpDesign:null!==(o=null==v?void 0:v.search_experiment_serp_design)&&void 0!==o?o:"OFF",expSearchEnableMSOfficeThumbnails:null!==(s=null==v?void 0:v.search_experiment_enable_msoffice_thumbnails)&&void 0!==s?s:"OFF",expSearchSerpListviewThumbnails:null!==(u=null==v?void 0:v.search_experiment_serp_listview_thumbnails)&&void 0!==u?u:"OFF",expSearchSerpListviewBigthumbs:null!==(d=null==v?void 0:v.search_experiment_serp_listview_bigthumb)&&void 0!==d?d:"OFF",expSearchSerpAutoGridView:null!==(c=null==v?void 0:v.search_experiment_serp_auto_grid_view)&&void 0!==c?c:"OFF",isSearchQuestionAnsweringEnabled:null!==(m=null==v?void 0:v.is_search_question_answering_enabled)&&void 0!==m&&m,folderHistoryRollbacks:null!==(_=null==v?void 0:v.folder_history_rollbacks)&&void 0!==_&&_,searchDocClassification:null!==(p=null==v?void 0:v.search_doc_classification)&&void 0!==p?p:"OFF"}}}));
//# sourceMappingURL=c_react_query_api_helpers_queries_search_experiments.js-vfljGL6p0.map
