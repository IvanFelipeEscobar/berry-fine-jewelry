define(["exports","./e_edison","./c_lodash-es_lodash","./e_ui_page_files_router","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","metaserver/static/js/modules/constants/trademark","./c_core_i18n","./e_core_exception","metaserver/static/js/modules/constants/page_load","./c_core_exception_info","./c_sharing_settings_utils_sharing_settings_util"],(function(e,t,r,o,a,s,n,i,l,d,_,u,m){"use strict";function c(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var E=c(_);const f=l.localeToBcp47LangTag(E.PAGE_LOCALE),g=l.createIntl({messages:{},locale:f,onError:e=>{if(e.code!==l.IntlErrorCode.MISSING_TRANSLATION)return d.reportException({err:e,tags:["format_html"],severity:u.SEVERITY.CRITICAL})}});function M(e,t){return g.formatMessage({id:e,defaultMessage:e,description:"nothing"},t)}const h=e=>t=>t===e,p=e=>!(e=>null===e)(e)&&!(e=>Array.isArray(e))(e)&&"object"==typeof e,S=e=>t=>p(t)&&Object.entries(e).every((([e,r])=>r(t[e]))),I={strong:e=>t.React$1.createElement("strong",null,e),em:e=>t.React$1.createElement("em",null,e)},O={SINGLE_INVALID:l.intl.formatMessage({id:"AwwRIX",defaultMessage:"The email address you entered is invalid."}),OUT_OF_TEAM:l.intl.formatMessage({id:"KCd6Mi",defaultMessage:"You can only share with your team and people your admin has approved."}),NOT_DROPBOX_USER:(e,t,r)=>l.intl.formatMessage({id:"vFxlGE",defaultMessage:"{count, plural, one{The person} other{Some people}} you invited will need to create an account to {access_level} the {file_type}. "},{file_type:t?"folder":"file",access_level:"writer"===r?"edit":"view",count:e}),SEND_LINK:l.intl.formatMessage({id:"f8bN8Q",defaultMessage:"Copy and send them a link instead to view without an account."}),SINGLE_TOO_MANY_MEMBERS:l.intl.formatMessage({id:"ZEnulX",defaultMessage:"Can’t share with this many people."}),GENERAL_INVALID:l.intl.formatMessage({id:"85p8vn",defaultMessage:"One or more names or email addresses you entered are invalid."}),GENERAL_OUT_OF_TEAM_MULTIPLE:l.intl.formatMessage({id:"XliECV",defaultMessage:"Some of these emails aren’t on your Dropbox team."}),GENERAL_OUT_OF_TEAM_SINGLE:l.intl.formatMessage({id:"vgnpLP",defaultMessage:"This email isn’t on your Dropbox team."}),GENERAL_TOO_MANY_MEMBERS:l.intl.formatMessage({id:"rTaV0v",defaultMessage:"This will put the folder over its {member_limit}-member limit. <a>Learn more.</a>"},{member_limit:n.GoldenGate.SHARING_TOTAL_LIMIT,a:e=>t.React$1.createElement("a",{href:"/help/9292",target:"_blank",key:"help_center_article"},e)}),NONGROUP_INVITEE:l.intl.formatMessage({id:"XHbTJ8",defaultMessage:"Only groups can be added to team folders."}),NO_PERMISSION:l.intl.formatMessage({id:"O1327M",defaultMessage:"You don’t have permission to share with this person."}),GENERAL_NO_PERMISSION:l.intl.formatMessage({id:"XDLsmJ",defaultMessage:"You don’t have permission to share with some of these people."})};var T;e.ContactsErrorLevel=void 0,(T=e.ContactsErrorLevel||(e.ContactsErrorLevel={})).Error="error",T.Warn="warn";const L=(e,t)=>(t.displayName()||"").toLowerCase(),N=Math.pow(2,53)-1,v=function(e,t,r){return!e.is_cdm_member&&(t||r)},R={access_error:l.intl.formatMessage({id:"N0ZK+y",defaultMessage:"You don’t have access to this content."}),email_unverified:l.intl.formatMessage({id:"YVPxPt",defaultMessage:"You haven’t verified your email. Check your email and try again."}),bad_member:l.intl.formatMessage({id:"0AMMBX",defaultMessage:"You entered an invalid name or email address."}),cant_share_outside_team:l.intl.formatMessage({id:"JoJWle",defaultMessage:"Your team settings don’t allow sharing outside your team."}),too_many_members:l.intl.formatMessage({id:"Zq3Ehi",defaultMessage:"You’re sharing with too many people."}),too_many_pending_invites:l.intl.formatMessage({id:"Zq3Ehi",defaultMessage:"You’re sharing with too many people."}),rate_limit:l.intl.formatMessage({id:"ZXI9uh",defaultMessage:"You’ve hit the limit of invites for today. Try again later."}),insufficient_plan:l.intl.formatMessage({id:"osl3qq",defaultMessage:"You need a Dropbox {trademark_plus} or Business account to do this."},{trademark_plus:i.TRADEMARK_PLUS}),team_folder:l.intl.formatMessage({id:"ehBhap",defaultMessage:"You can’t add members to a team folder. Contact your team admin."}),no_permission:l.intl.formatMessage({id:"5/am2Y",defaultMessage:"You don’t have permission to do this. Contact the owner."})};var A,b;e.SharingUserLeapEvent=void 0,(A=e.SharingUserLeapEvent||(e.SharingUserLeapEvent={})).SHARE_SUCCESS="share_success",A.SHARE_MODAL_CLOSE="share_modal_close",A.SHARE_LINK_MEMBER_LIST_ON="share_link_member_list_on",A.SHARE_LINK_MEMBER_LIST_CONTROL="share_link_member_list_control",A.SHARE_LINK_COPY_SUCCESS="share_link_copy_success",A.SHARE_LINK_CREATE_SUCCESS="share_link_create_success",e.ReceiverUserLeapEvent=void 0,(b=e.ReceiverUserLeapEvent||(e.ReceiverUserLeapEvent={})).VIEWED_SHARED_FOLDER="viewed_shared_folder",b.VIEWED_SHARED_FILE="viewed_shared_file",b.VISIT_SHARE_PAGE="visit_share_page",b.VISIT_SHARE_PAGE_LINKS_TAB="visit_share_page_links_tab",b.VIEWED_SHARED_FOLDER_PROMPT_ON="viewed_shared_folder_prompt_on",b.VIEWED_SHARED_FOLDER_PROMPT_CONTROL="viewed_shared_folder_prompt_control";const C=e=>{o.UserSurvey.addAttribute("eventName",e),o.UserSurvey.trackEvent(e,"sharing")},y=e=>S({error:S({".tag":h("too_many_mounts"),too_many_mounts:S({".tag":e})})}),P=y(h("total_mounts_exceeded")),x=y(h("home_mounts_exceeded")),G=y(h("tree_size_exceeded")),F=e=>{const t=(e=>new o.MountLimitInfo({limit:e.error.too_many_mounts.limit,current_count:e.error.too_many_mounts.current_count,new_count:e.error.too_many_mounts.new_count}))(e),r=t.limit;return t.new_count-r},U=(e,t)=>{const r=e.name().split(".").pop();let o="share_modal";return t&&(o=`${t}_${o}`),{fileExts:r?{[r]:1}:{},fileIds:e.fileId(),referrer:o,shouldLogQualifyEvent:!0}},D=(e,t)=>{const{referrer:r,fileExts:a}=U(e,t),s={experiment:"core_act_shop_entry_point",location:r,file_exts:a};return{onImpression:{eventName:o.ShopEntryPointEvents.SHOP_ENTRY_POINT_IMPRESSION,extras:s},onConfirm:{eventName:o.ShopEntryPointEvents.SHOP_ENTRY_POINT_CTA_CLICK,extras:s},onDismiss:{eventName:o.ShopEntryPointEvents.SHOP_ENTRY_POINT_DISMISS,extras:s}}};e.ABUSE_HELP_ARTICLE_LINK="https://help.dropbox.com/share/banned-links",e.CONTACT_ERROR_MESSAGES=O,e.NSF_HELP_ARTICLE_LINK="https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate",e.convertIfHTML=function(e){return e.toHTML?M(e.toHTML(),I):e},e.genAddMemberErrorMessage=function(e){return e.message?e.message:e instanceof o.AppError&&e.error&&e.error[".tag"]&&R[e.error[".tag"]]?R[e.error[".tag"]]:l.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."})},e.getContactSupportMessage=()=>l.intl.formatMessage({id:"Bcojaq",defaultMessage:"Contact support"}),e.getExceededCountInfo=F,e.getHomeMountsExceededLinkOnlyMsg=e=>l.intl.formatMessage({id:"wCYUIO",defaultMessage:"Your Dropbox account is {number, plural, one{1 shared folder} other {{number} shared folders}} over the limit."},{number:e}),e.getHomeMountsExceededMountFoldersMsg=e=>{const t=F(e);return l.intl.formatMessage({id:"ufWtvO",defaultMessage:"Couldn’t add folder. Your Dropbox account is {number, plural, one{1 shared folder} other {{number} shared folders}} over the limit."},{number:t})},e.getHomeMountsExceededMsg=()=>l.intl.formatMessage({id:"AMJRvM",defaultMessage:"Unable to complete this operation because your Dropbox has too many shared folders."}),e.getLinkOnlyTitle=()=>l.intl.formatMessage({id:"Ugz0Dm",defaultMessage:"This folder can only be shared with a link"}),e.getMemberCountForTokens=function(e){return null==e?0:e.map((e=>e.group_size||1)).reduce(((e,t)=>e+t),0)},e.getNewFolderPathFromContentName=function(e,t){return[o.normalize(t),e].join("/")},e.getShopModalCtx=U,e.getShopModalLoggingParams=D,e.getTotalMountsExceededLinkOnlyMsg=e=>l.intl.formatMessage({id:"XP7H5x",defaultMessage:"Your Dropbox account is {number, plural, one{1 shared folder} other {{number} shared folders}} over the limit."},{number:e}),e.getTotalMountsExceededMountFoldersMsg=e=>{const t=F(e);return l.intl.formatMessage({id:"EjCgHX",defaultMessage:"Couldn’t add folder. Your Dropbox account is {number, plural, one{1 shared folder} other {{number} shared folders}} over the limit."},{number:t})},e.getTotalMountsExceededMsg=()=>l.intl.formatMessage({id:"CdLxbe",defaultMessage:"Unable to complete this operation because your Dropbox has too many shared folders."}),e.getTreeSizeExceededLinkOnlyMsg=e=>l.intl.formatMessage({id:"BY6VL1",defaultMessage:"The parent folder is {number, plural, one{1 shared folder} other {{number} shared folders}} over the limit."},{number:e}),e.getTreeSizeExceededMountFoldersMsg=e=>{const t=F(e);return l.intl.formatMessage({id:"6mGfdj",defaultMessage:"Couldn’t add folder. Your Dropbox account is {number, plural, one{1 shared folder} other {{number} shared folders}} over the limit."},{number:t})},e.getTreeSizeExceededMsg=()=>l.intl.formatMessage({id:"SfQyoF",defaultMessage:"Unable to complete this operation because the top level folder has too many shared folders."}),e.isHomeMountsExceededError=x,e.isTotalMountsExceededError=P,e.isTreeSizeExceededError=G,e.legacyFormatHtmlAsReact=M,e.logTiburonEvent=(e,t,a,s={})=>{const n=e.extras.origin;o.ShareTibEventLogger.log(t,a,n,r.assignIn(s,{file_id:e.extras.fileId,fq_path:e.displayPath(),ns_id:e.isSharedFolder()?e.sharedFolderId():void 0,modal_session_id:e.extras.modalSessionId}))},e.makeMemberSortCmp=function(e,t,r){const a=r?(e=>function(t,r){const a=r.memberId()===t,s=r instanceof o.GroupMembershipInfo?"0":"1",n=(r.displayName()||"").toLowerCase(),i=null!=r.account_id&&e.has(r.account_id);return`${s}${i&&a?"a":i?"b":null!=r.time_last_seen?`c${function(e){let t=String(N-Number(e));const r=String(N).length;return t.length<r&&(t=`${Array(r-t.length+1).join("0")}${t}`),t}(r.time_last_seen)}`:"d"}${n}`})(t):L;return function(t,r){const o=a(e.account_id,t),s=a(e.account_id,r);return o<s?-1:o===s?0:1}},e.namespaceLimitExceededFailCreateSharedFolderSnackbarMsg=e=>{const t=F(e);return l.intl.formatMessage({id:"0UrAT5",defaultMessage:"Couldn’t create shared folder. Your Dropbox account is {number, plural, one{1 shared folder} other {{number} shared folders}} over the limit."},{number:t})},e.publishShopModalEvent=(e,t,r,a=!1)=>{t.isFile()&&t.name()&&o.publishEvent(e,{context:U(t,r),loggingParams:a?D(t,r):void 0})},e.shouldEnforceMemberLimits=v,e.spectrumFolderIconForMetadata=function(e){const t=null!=e.parent_shared_folder_id,r=e.isViewOnly();let a=o.FileTypes.FOLDER;return e.isSharedFolder()?a=o.FileTypes.SHARED_FOLDER:e.is_team_folder&&(a=o.FileTypes.TEAM_SHARED_FOLDER),s.spectrumFolderIcon({fileType:a,isInTeamFolderTree:t,isViewOnly:r})},e.trackReceiverUserLeapEvent=C,e.trackSharePageUserLeapEvent=(e,t)=>{o.UserSurvey.addAttribute("contentCount",t),C(e)},e.trackUserLeapEvent=(e,t)=>{(e=>void 0!==e&&[o.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,o.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_FACEPILE,o.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW,o.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON,o.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU,o.SHARE_ACTION_ORIGIN_TYPE.MANAGE_ACCESS_CLOSE,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_LINK_MODAL].indexOf(e)>=0)(t)&&(o.UserSurvey.addAttribute("eventName",e),o.UserSurvey.trackEvent(e,"sharing"))},e.validateContact=function(e,t,r,o,s,i,l){let d={state:a.ContactTokenState.ok,msg:null};if(s&&!e.group_id)return{state:a.ContactTokenState.invalid,msg:O.NONGROUP_INVITEE};if(v(t,s,i)&&l>n.GoldenGate.SHARING_TOTAL_LIMIT)return{state:a.ContactTokenState.invalid,msg:O.SINGLE_TOO_MANY_MEMBERS};if(e.invalid)d={state:a.ContactTokenState.invalid,msg:O.SINGLE_INVALID};else{if(e.email===t.email)return d;if(null!=r&&t.is_team&&e.dbx_team_id!==r.id&&!e.group_id){const e=O.OUT_OF_TEAM;let t;t="team"===(null!=o?o.member_policy:void 0)||"team"===(null!=o?o.resolved_member_policy:void 0)?a.ContactTokenState.invalid:a.ContactTokenState.warn,d={msg:e,state:t}}}return d},e.validateContacts=function(t,r,o,s,i,l,d,_,u){let c,E;for(const r of t){const s=o[r.getKey()];if(!s)continue;const n=t.filter((e=>!e.on_team)).length,i=t.filter((e=>null==e.dbx_account_id)).length,{state:l,msg:f}=s;if(l===a.ContactTokenState.invalid){if(c=e.ContactsErrorLevel.Error,f===O.SINGLE_INVALID){E=O.GENERAL_INVALID;break}f===O.OUT_OF_TEAM&&(E=n>1?O.GENERAL_OUT_OF_TEAM_MULTIPLE:O.GENERAL_OUT_OF_TEAM_SINGLE),f===O.NONGROUP_INVITEE&&(E=O.NONGROUP_INVITEE),f===O.NO_PERMISSION&&(E=O.GENERAL_NO_PERMISSION)}if(l===a.ContactTokenState.warn)if(c=e.ContactsErrorLevel.Warn,f===O.OUT_OF_TEAM)E=n>1?O.GENERAL_OUT_OF_TEAM_MULTIPLE:O.GENERAL_OUT_OF_TEAM_SINGLE;else if("NOT_DROPBOX_USER"===f){let e;if(E=O.NOT_DROPBOX_USER(i,_,d),e="writer"===d?u.find((e=>"editor"===e.accessLevel())):u.find((e=>"viewer"===e.accessLevel()||!e.isRighteousLink())),e){"no_one"!==m.getAudienceForLink(e.link_permissions)&&(E+=O.SEND_LINK)}else E+=O.SEND_LINK}}return v(r,s,i)&&t.length>0&&c!==e.ContactsErrorLevel.Error&&l>n.GoldenGate.SHARING_TOTAL_LIMIT&&(c=e.ContactsErrorLevel.Error,E=O.GENERAL_TOO_MANY_MEMBERS),{level:c,message:E}}}));
//# sourceMappingURL=c_sharing_ui_util.js-vflL_JYWq.map
