define(["exports","./e_edison","./c_core_i18n","./e_ui_page_files_router","./c_avatar_initials_avatar","./c_core_notify","./c_ui_title_bubble","./c_ui_tooltip","./c_integrations_profile_card_popover","./c_ui_overlay"],(function(e,t,a,o,n,r,i,s,l,c){"use strict";class u extends t.React$1.Component{constructor(e){super(e),this.state={photoUrl:this.props.photoUrl}}componentDidMount(){r.require_css("/static/metaserver/static/css/scooter/scooter-scoped-vfl0EaHDR.css"),document.addEventListener("db:account_photo:photo_set",(e=>{const a=2*this.props.dimension,o=`${a}x${a}`,n=t.URI.parse(e.detail.saved_photo_url).updateQuery({size:o}).toString();this.setState({photoUrl:n})})),document.addEventListener("db:account_photo:photo_deleted",(()=>{this.setState({photoUrl:null})})),!this.hasPhotoAvatar()&&this.props.onLoad&&this.props.onLoad()}hasPhotoAvatar(){return null!=this.state.photoUrl}render(){return this.state.photoUrl?t.React$1.createElement(n.PhotoAvatar,{alt:this.props.alt,dimension:this.props.dimension,onClick:this.props.onPhotoClick,photo:this.state.photoUrl,optionalClass:this.props.optionalClass,onLoad:this.props.onLoad,onError:this.props.onError,shape:"CIRCLE"}):this.props.defaultAvatar}}u.displayName="ViewerAvatar";function m(e,t,a){return function(o){e&&e(t,a),o.stopPropagation()}}const p={avatarDimension:32,titleButtonDirection:"south"};function d(e){return Object.assign(Object.assign({},p),e)}function f(){const e=o.Viewer.get_viewer(),t=e.get_user_by_role("personal",!0);if(t)return t.id;const a=e.get_user_by_role("work",!0);return a?a.id:void 0}function g(e){if(null==e||!(e.length>0))return"";let t=e.split(" ").map((e=>e.charAt(0).toLowerCase()));return t.length>2&&(t=t.splice(0,2)),t.join("")}function _(e,t){const n="editor"===t?a.defineMessage({id:"f8EJmj",defaultMessage:"{team_group_name} can edit"}):a.defineMessage({id:"JDP9ok",defaultMessage:"{team_group_name} can view"});return a.intl.formatMessage(n,{team_group_name:o.Emstring.em_snippet(e,o.SNIPPET_SIZES.DISPLAY_NAME)})}function v(e,t,n){let r;return r="editor"===t?a.intl.formatMessage({id:"yrMoVL",defaultMessage:"{count, plural, one{{count} person in {group_name} can edit} other{{count} people in {group_name} can edit}}"},{count:n,group_name:o.Emstring.em_snippet(e,o.SNIPPET_SIZES.DISPLAY_NAME)}):a.intl.formatMessage({id:"vbMu7n",defaultMessage:"{count, plural, one{{count} person in {group_name} can view} other{{count} people in {group_name} can view}}"},{count:n,group_name:o.Emstring.em_snippet(e,o.SNIPPET_SIZES.DISPLAY_NAME)}),r}function h(e,t,n,r=!1){let i;const s={viewer:a.intl.formatMessage({id:"DqcjPT",defaultMessage:"You can view"}),editor:a.intl.formatMessage({id:"yTQyaR",defaultMessage:"You can edit"}),owner:a.intl.formatMessage({id:"kQgvhd",defaultMessage:"You’re the owner"}),team:a.intl.formatMessage({id:"TCJe4K",defaultMessage:"You’re a member of this team folder"}),default:a.intl.formatMessage({id:"kFyzJs",defaultMessage:"You"})};e=o.Emstring.em_snippet(e,o.SNIPPET_SIZES.DISPLAY_NAME);const l={viewer:a.intl.formatMessage({id:"cIjfEc",defaultMessage:"{name} can view"},{name:e}),editor:a.intl.formatMessage({id:"WXJfQ5",defaultMessage:"{name} can edit"},{name:e}),owner:a.intl.formatMessage({id:"MomaNB",defaultMessage:"{name} is the owner"},{name:e}),pending:a.intl.formatMessage({id:"vTHStn",defaultMessage:"{name} hasn’t added this to their Dropbox yet"},{name:e}),team:a.intl.formatMessage({id:"1F4EvZ",defaultMessage:"{name} is a member of this team folder"},{name:e}),default:e,"no access":a.intl.formatMessage({id:"Y73l91",defaultMessage:"No access"})},c={viewer:a.intl.formatMessage({id:"fDtB1J",defaultMessage:"You ({name}) can view"},{name:e}),editor:a.intl.formatMessage({id:"lcZCGf",defaultMessage:"You ({name}) can edit"},{name:e}),owner:a.intl.formatMessage({id:"D9l0jJ",defaultMessage:"You ({name}) are the owner"},{name:e})};return i=n?r&&null!=e?c:s:l,i.hasOwnProperty(t)?i[t]:""}function E(e,t){if(e.length>t){const o=e.slice(0,t-1),n=e.length-(t-1);return o.push(a.intl.formatMessage({id:"OlmKiV",defaultMessage:"{count, plural, one{and {count} more…} other{and {count} more…}}"},{count:n})),o}return e}function M(e){switch(e){case"north":return c.StickyPosition.TOP;case"south":default:return c.StickyPosition.BOTTOM;case"east":return c.StickyPosition.RIGHT;case"west":return c.StickyPosition.LEFT}}function P(){return document.body}e.arePairedUsersInSf=function(e){if(!e)return!1;const t=o.Viewer.get_viewer();if(t.is_paired){const a=t.get_user_ids(!0),o=e.map((e=>e.user_id));if(o.includes(a[0])&&o.includes(a[1]))return!0}return!1},e.buildGroupsAndMembersText=function(e,n,r,i=5,l){const c=e.length,u=n.length+r.length;let m,p;const d=e=>o.Emstring.em_snippet(e,17);if(u>0){const e=E([...n.map((e=>d(e.display_name))),...r.map((e=>d(e.email_or_fbname)))],i);m=t.React$1.createElement(s.Tooltip,{key:"members_text",position:s.TooltipPosition.BOTTOM,tooltip_contents:e.join("\n"),tooltip_classname:l},a.intl.formatMessage({id:"ECZFz/",defaultMessage:"{count, plural, one{{count} member} other{{count} members}}"},{count:u}))}if(c>0){const o=E(e.map((e=>d(e.name))),i);p=t.React$1.createElement(s.Tooltip,{key:"groups_text",position:s.TooltipPosition.BOTTOM,tooltip_contents:o.join("\n"),tooltip_classname:l},a.intl.formatMessage({id:"GPgj53",defaultMessage:"{count, plural, one{{count} group} other{{count} groups}}"},{count:c}))}return m&&!p?m:p&&!m?p:p&&m?t.React$1.createElement("div",null,p,", ",m):void 0},e.findOwnerAndMeInJoinedMembers=function(e,t){let a,o;for(const n of e)if("owner"===n.access_type&&(a=n),n.user_id===t.id&&(o=n),a&&o)break;return[a,o]},e.getDescriptionForSharedLink=function(){return a.intl.formatMessage({id:"elYR2d",defaultMessage:"Shared link is available"})},e.getInitials=g,e.getViewerId=f,e.groupAccessTypeString=v,e.individualAccessTypeString=h,e.renderGroup=function({group:e,avatarArgs:a={}},r){let s,c;const{avatarDimension:u,onAvatarClick:p,titleButtonDirection:h}=d(a),E=m(p,"group",e);if(e.is_automatic?(c=_(e.name,e.access_type),s=t.React$1.createElement("div",{"data-testid":"facepile-avatar-wrapper",onMouseEnter:()=>{o.TeamsWebActionsLogger.log("hover_on_shared_with_facepile")}},t.React$1.createElement(n.PhotoAvatar,{alt:c,dimension:u,photo:o.TeamLine,shape:"CIRCLE",onClick:r?void 0:E}))):(c=v(e.name,e.access_type,e.num_users),s=t.React$1.createElement("div",{"data-testid":"facepile-avatar-wrapper",onMouseEnter:()=>{o.TeamsWebActionsLogger.log("hover_on_shared_with_facepile")}},t.React$1.createElement(n.InitialsAvatarWithColorDerivedFromName,{alt:c,dimension:u,name:e.name,shape:"CIRCLE",initials:g(e.name),onClick:r?void 0:E}))),r){const a=f();if(a)return t.React$1.createElement(o.Provider,{store:r.integrationStore,key:`group:${e.gid}:${e.name}`},t.React$1.createElement(l.ProfileCardPopover,{popoverGroup:r.integrationPopoverGroup,integrationStore:r.integrationStore,entryPoint:r.entryPoint,viewerId:a,avatarInfo:{avatarType:"group",targetGroup:{gid:e.gid,groupName:e.name,message:c}},file:r.fileInfo,portalParentElement:P()},t.React$1.createElement(o.Button,{variant:"styleless"},s)))}return t.React$1.createElement(i.TitleBubble,{key:`group:${e.gid}:${e.name}`,content:c,position:M(h)},s)},e.renderInvitedPerson=function({invited_member:e,avatarArgs:a={}},r){const{avatarDimension:s,onAvatarClick:c,titleButtonDirection:u}=d(a),p=m(c,"invited",e),_=h(e.email_or_fbname,"pending",!1),v=t.React$1.createElement("div",{"data-testid":"facepile-avatar-wrapper",onMouseEnter:()=>{o.TeamsWebActionsLogger.log("hover_on_shared_with_facepile")}},t.React$1.createElement(n.InitialsAvatar,{alt:_,dimension:s,color:"#aaa",initials:g(e.email_or_fbname),shape:"CIRCLE",onClick:r?void 0:p}));if(r){const a=f();if(a)return t.React$1.createElement(o.Provider,{store:r.integrationStore,key:`invitation:${e.invitation_id}`},t.React$1.createElement(l.ProfileCardPopover,{popoverGroup:r.integrationPopoverGroup,integrationStore:r.integrationStore,entryPoint:r.entryPoint,viewerId:a,avatarInfo:{avatarType:"invited_person",targetUser:{accountId:e.invitation_id,displayName:e.email_or_fbname,familiarName:void 0,accessType:_}},file:r.fileInfo,portalParentElement:P()},t.React$1.createElement(o.Button,{variant:"styleless"},v)))}return t.React$1.createElement(i.TitleBubble,{key:`invitation:${e.invitation_id}`,content:_,position:M(u)},v)},e.renderJoinedMember=function({arePairedUsersInSF:e,member:a,avatarArgs:r={}},s){let c;const p=a.user_id,g=o.Viewer.get_viewer(),_=g.get_user_ids(!0).includes(p);let v="";if(_&&e){const e=a.user_id,t=g.get_user_by_role("personal",!0),o=g.get_user_by_role("work",!0);t&&e===t.id?v="Personal":o&&e===o.id&&null!=g.team_name&&(v=g.team_name)}else({display_name:v}=a);v=o.Emstring.em_snippet(v,o.SNIPPET_SIZES.DISPLAY_NAME);const E=h(v,a.access_type,_,e),{avatarDimension:y,onAvatarClick:w,titleButtonDirection:b}=d(r),I=m(w,"member",a),S={alt:E,dimension:y,onPhotoClick:s?void 0:I,photoUrl:a.photo_url,defaultAvatar:t.React$1.createElement(n.InitialsAvatarWithColorDerivedFromName,{alt:E,dimension:y,name:a.display_name,initials:a.initials.toUpperCase(),shape:"CIRCLE",onClick:s?void 0:I})};if(c=_?t.React$1.createElement("div",{"data-testid":"facepile-avatar-wrapper",onMouseEnter:()=>{o.TeamsWebActionsLogger.log("hover_on_shared_with_facepile")}},t.React$1.createElement(u,Object.assign({},S))):t.React$1.createElement("div",{"data-testid":"facepile-avatar-wrapper",onMouseEnter:()=>{o.TeamsWebActionsLogger.log("hover_on_shared_with_facepile")}},t.React$1.createElement(n.AvatarWithDefault,Object.assign({},S))),s){const e=f();if(e)return t.React$1.createElement(o.Provider,{store:s.integrationStore,key:`user:${a.user_id}:${a.photo_url}`},t.React$1.createElement(l.ProfileCardPopover,{popoverGroup:s.integrationPopoverGroup,integrationStore:s.integrationStore,entryPoint:s.entryPoint,viewerId:e,avatarInfo:{avatarType:"joined_member",targetUser:{accountId:a.account_id,displayName:v,familiarName:a.familiar_name,accessType:E,isViewer:_,email:a.email,photoUrl:a.photo_url}},file:s.fileInfo,isShowInitially:s.autoDisplayTooltip,portalParentElement:P()},t.React$1.createElement(o.Button,{variant:"styleless"},c)))}return t.React$1.createElement(i.TitleBubble,{key:`user:${a.user_id}:${a.photo_url}`,content:E,position:M(b)},c)},e.renderOverflowCount=function(e){return({overflowCount:r,avatarArgs:s={}})=>{const c=a.intl.formatMessage({id:"kOMHR0",defaultMessage:"{count, plural, one{{count} more member} other{{count} more members}}"},{count:r}),u=r>=99?"99+":`${r}`,{avatarDimension:m,onAvatarClick:p,titleButtonDirection:g}=d(s),_=t.React$1.createElement(n.InitialsAvatar,{alt:c,dimension:m,initials:u,color:"#7B8994",shape:"CIRCLE",onClick:e?void 0:p});if(e){const a=f();if(a)return t.React$1.createElement(o.Provider,{store:e.integrationStore,key:"overflow_count"},t.React$1.createElement(l.ProfileCardPopover,{popoverGroup:e.integrationPopoverGroup,integrationStore:e.integrationStore,entryPoint:e.entryPoint,viewerId:a,avatarInfo:{avatarType:"overflow",overflowInfo:{message:c}},file:e.fileInfo,onAvatarClick:p||void 0,portalParentElement:P()},t.React$1.createElement(o.Button,{variant:"styleless"},_)))}return t.React$1.createElement(i.TitleBubble,{key:"overflow_count",content:c,position:M(g)},_)}},e.teamAccessTypeString=_}));
//# sourceMappingURL=c_sharing_member_avatars.js-vflTAcBDj.map
