define(["exports","./e_edison","./c_core_i18n","./e_ui_page_files_router","./c_api_v2_redux_files","./c_src_right-rail_hooks","./c_components_approval-forms_gating_utils","./c_components_approval-forms_url_utils","./c_components_approval-forms_approval_checkbox_in_share","./c_lodash-es_lodash","./c_tslib"],(function(e,t,n,a,o,i,s,r,c,d,l){"use strict";function m(t){return{type:e.Action$1.UpdateAnnotationMode,payload:{updatedAnnotationMode:t}}}e.Action$1=void 0,function(e){e.ActivateThread="@@comments/activateThread",e.ActivateInitialThread="@@comments/activateInitialThread",e.DeactivateAllThreads="@@comments/deactivateThread",e.FocusThread="@@comments/focusThread",e.HoverThread="@@comments/hoverThread",e.BoltSubscribe="@@comments/bolt/subscribe",e.BoltUnsubscribe="@@comments/bolt/unsubscribe",e.UpdateDraftAnnotation="@@comments/updateDraftAnnotation",e.ClearDraftAnnotation="@@comments/clearDraftAnnotation",e.FocusEditor="@@comments/focusEditor",e.EditorDidFocus="@@comments/editorDidFocus",e.ResolveNavigationToActiveThreadAnnotation="@@comments/resolveNavigationToActiveThreadAnnotation",e.UpdateShowResolvedComments="@@comments/updateShowResolvedComments",e.UpdateAnnotationMode="@@comments/UpdateCurrentAnnotationMode",e.StartAnnotating="@@comments/startAnnotating",e.ConfirmDraftAnnotation="@@comments/confirmDraftAnnotation",e.CancelAnnotating="@@comments/cancelAnnotating",e.AddAndCommitComment="@@comments/addAndCommitComment",e.EditAndCommitComment="@@comments/editAndCommitComment",e.DeleteAndCommitComment="@@comments/deleteAndCommitComment",e.DeleteAndCommitThread="@@comments/deleteAndCommitThread",e.SortComments="@@comments/sortComments",e.LogApprovalAction="@@comments/logApprovalAction",e.LogStartComment="@@comments/logStartComment",e.LogCancelComment="@@comments/logCancelComment",e.LogStickerStart="@@comments/logStickerStart",e.LogStickerSuccess="@@comments/logStickerSuccess",e.LogStickerCanceled="@@comments/logStickerCanceled",e.LogMentionStart="@@comments/logMentionStart",e.LogMentionSuccess="@@comments/logMentionSuccess",e.LogMentionCanceled="@@comments/logMentionCanceled"}(e.Action$1||(e.Action$1={}));const u=(e,t)=>t||e;var p,_;e.SectionAnnotationMode=void 0,(p=e.SectionAnnotationMode||(e.SectionAnnotationMode={})).continuous="continuous",p.single="single",function(e){e.ADD_COMMENT="add_comment",e.DELETE_COMMENT="delete_comment",e.REPLY_COMMENT="reply_comment",e.EDIT_COMMENT="edit_comment",e.RESOLVE_COMMENT="resolve_comment",e.UNRESOLVE_COMMENT="unresolve_comment",e.SUBSCRIBE_COMMENTS="subscribe_comments",e.UNSUBSCRIBE_COMMENTS="unsubscribe_comments",e.DISABLE_COMMENTS="disable_comments",e.ENABLE_COMMENTS="enable_comments",e.SHOW_RESOLVED_COMMENTS="show_resolved_comments",e.HIDE_RESOLVED_COMMENTS="hide_resolved_comments",e.SORT_COMMENTS="sort_comments",e.REQUEST_APPROVAL="request_approval",e.ENABLE_CONTINUOUS_ANNOTATIONS="enable_continuous_annotations",e.DISABLE_CONTINUOUS_ANNOTATIONS="disable_continuous_annotations",e.ADD_COMMENT_START="add_comment_start",e.ADD_COMMENT_CANCEL="add_comment_cancel",e.REPLY_COMMENT_START="reply_comment_start",e.REPLY_COMMENT_CANCEL="reply_comment_cancel",e.MARK_THREAD_READ="mark_thread_read",e.MARK_THREAD_UNREAD="mark_thread_unread",e.START_ANNOTATION_RECT="start_annotation_rect",e.START_ANNOTATION_TIMESTAMP="start_annotation_timestamp",e.START_ANNOTATION_HIGHLIGHT="start_annotation_highlight",e.STICKER_START="sticker_start",e.STICKER_SUCCESS="sticker_success",e.STICKER_CANCELED="sticker_canceled",e.MENTION_START="mention_start",e.MENTION_SUCCESS="mention_success",e.MENTION_CANCELED="mention_canceled"}(_||(_={}));const g=(e,t)=>{var n;const a=e.permissions[t],o=e.enableCommentStatus[t];return Boolean(null!==(n=null==o?void 0:o.commentsEnabled)&&void 0!==n?n:null==a?void 0:a.can_see_comment_editor)},b=t=>t.annotationSettings.mode===e.SectionAnnotationMode.single,f=(()=>{let e,t;const n=[];for(e=0,t=e;e<=255;e++,t=e)n.push((t+256).toString(16).substr(1));return n})();function v(e){return e.map((e=>f[e])).join("")}function h(){const e=function(){const e=new Uint8Array(16);return window.crypto&&window.crypto.getRandomValues(e),e}();e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=Array.prototype.slice.call(e);return[t.slice(0,4),t.slice(4,6),t.slice(6,8),t.slice(8,10),t.slice(10,16)].map(v).join("-")}function A({content:e,threadId:t,author:n}){const a=new Date;return{id:h(),timestamp:a,threadId:t,author:n,content:e,userPermissions:{canDelete:!1,canEdit:!1},revisionInfo:{isCurrent:!0,timestamp:a}}}function C(e){return{type:{".tag":"file"},identifier:{".tag":"file_path_or_id",file_path_or_id:e}}}function y(e,t){return t?function(e){return{type:{".tag":"file"},identifier:{".tag":"shared_link_details",url:e}}}(t):C(e)}const O={AddComment:"@@apiv2_redux/comments2/add_comment",AddCommentResult:"@@apiv2_redux/comments2/add_comment_result",CheckOnboardingStatus:"@@apiv2_redux/comments2/check_onboarding_status",CheckOnboardingStatusResult:"@@apiv2_redux/comments2/check_onboarding_status_result",DeleteComment:"@@apiv2_redux/comments2/delete_comment",DeleteCommentResult:"@@apiv2_redux/comments2/delete_comment_result",DisableCommenting:"@@apiv2_redux/comments2/disable_commenting",DisableCommentingResult:"@@apiv2_redux/comments2/disable_commenting_result",EditComment:"@@apiv2_redux/comments2/edit_comment",EditCommentResult:"@@apiv2_redux/comments2/edit_comment_result",EnableCommenting:"@@apiv2_redux/comments2/enable_commenting",EnableCommentingResult:"@@apiv2_redux/comments2/enable_commenting_result",GetFolderLiveUpdatingInfo:"@@apiv2_redux/comments2/get_folder_live_updating_info",GetFolderLiveUpdatingInfoResult:"@@apiv2_redux/comments2/get_folder_live_updating_info_result",ListComments:"@@apiv2_redux/comments2/list_comments",ListCommentsResult:"@@apiv2_redux/comments2/list_comments_result",ListCommentsBatch:"@@apiv2_redux/comments2/list_comments_batch",ListCommentsBatchResult:"@@apiv2_redux/comments2/list_comments_batch_result",ListThreadsBatchPaginated:"@@apiv2_redux/comments2/list_threads_batch_paginated",ListThreadsBatchPaginatedResult:"@@apiv2_redux/comments2/list_threads_batch_paginated_result",ListThreadsPaginated:"@@apiv2_redux/comments2/list_threads_paginated",ListThreadsPaginatedResult:"@@apiv2_redux/comments2/list_threads_paginated_result",LogEvent:"@@apiv2_redux/comments2/log_event",LogEventResult:"@@apiv2_redux/comments2/log_event_result",LogPerfEvent:"@@apiv2_redux/comments2/log_perf_event",LogPerfEventResult:"@@apiv2_redux/comments2/log_perf_event_result",LoggedOutAddComment:"@@apiv2_redux/comments2/logged_out/add_comment",LoggedOutAddCommentResult:"@@apiv2_redux/comments2/logged_out/add_comment_result",LoggedOutListComments:"@@apiv2_redux/comments2/logged_out/list_comments",LoggedOutListCommentsResult:"@@apiv2_redux/comments2/logged_out/list_comments_result",MarkHasOnboarded:"@@apiv2_redux/comments2/mark_has_onboarded",MarkHasOnboardedResult:"@@apiv2_redux/comments2/mark_has_onboarded_result",MarkThreadRead:"@@apiv2_redux/comments2/mark_thread_read",MarkThreadReadResult:"@@apiv2_redux/comments2/mark_thread_read_result",MarkThreadUnread:"@@apiv2_redux/comments2/mark_thread_unread",MarkThreadUnreadResult:"@@apiv2_redux/comments2/mark_thread_unread_result",ResolveThread:"@@apiv2_redux/comments2/resolve_thread",ResolveThreadResult:"@@apiv2_redux/comments2/resolve_thread_result",Subscribe:"@@apiv2_redux/comments2/subscribe",SubscribeResult:"@@apiv2_redux/comments2/subscribe_result",UnresolveThread:"@@apiv2_redux/comments2/unresolve_thread",UnresolveThreadResult:"@@apiv2_redux/comments2/unresolve_thread_result",Unsubscribe:"@@apiv2_redux/comments2/unsubscribe",UnsubscribeResult:"@@apiv2_redux/comments2/unsubscribe_result"},T=o._createAction(O.AddComment),S=o._createAction(O.AddCommentResult),E=o._createAction(O.CheckOnboardingStatusResult),I=o._createAction(O.DeleteComment),R=o._createAction(O.DeleteCommentResult),M=o._createAction(O.DisableCommenting),j=o._createAction(O.DisableCommentingResult),L=o._createAction(O.EditComment),k=o._createAction(O.EditCommentResult),x=o._createAction(O.EnableCommenting),N=o._createAction(O.EnableCommentingResult),w=o._createAction(O.GetFolderLiveUpdatingInfoResult),D=o._createAction(O.ListComments),U=o._createAction(O.ListCommentsResult),$=o._createAction(O.ListCommentsBatchResult),B=o._createAction(O.ListThreadsBatchPaginatedResult),V=o._createAction(O.ListThreadsPaginatedResult),F=o._createAction(O.LogEvent),P=o._createAction(O.LogEventResult),q=o._createAction(O.LogPerfEventResult),H=o._createAction(O.LoggedOutAddCommentResult),K=o._createAction(O.LoggedOutListComments),G=o._createAction(O.LoggedOutListCommentsResult),W=o._createAction(O.MarkHasOnboardedResult),Y=o._createAction(O.MarkThreadRead),z=o._createAction(O.MarkThreadReadResult),Q=o._createAction(O.MarkThreadUnread),X=o._createAction(O.MarkThreadUnreadResult),J=o._createAction(O.ResolveThread),Z=o._createAction(O.ResolveThreadResult),ee=o._createAction(O.Subscribe),te=o._createAction(O.SubscribeResult),ne=o._createAction(O.UnresolveThread),ae=o._createAction(O.UnresolveThreadResult),oe=o._createAction(O.Unsubscribe),ie=o._createAction(O.UnsubscribeResult),se={[O.AddComment]:{endpoint:"add_comment",action:S},[O.CheckOnboardingStatus]:{endpoint:"check_onboarding_status",action:E},[O.DeleteComment]:{endpoint:"delete_comment",action:R},[O.DisableCommenting]:{endpoint:"disable_commenting",action:j},[O.EditComment]:{endpoint:"edit_comment",action:k},[O.EnableCommenting]:{endpoint:"enable_commenting",action:N},[O.GetFolderLiveUpdatingInfo]:{endpoint:"get_folder_live_updating_info",action:w},[O.ListComments]:{endpoint:"list_comments",action:U},[O.ListCommentsBatch]:{endpoint:"list_comments_batch",action:$},[O.ListThreadsBatchPaginated]:{endpoint:"list_threads_batch_paginated",action:B},[O.ListThreadsPaginated]:{endpoint:"list_threads_paginated",action:V},[O.LogEvent]:{endpoint:"log_event",action:P},[O.LogPerfEvent]:{endpoint:"log_perf_event",action:q},[O.LoggedOutAddComment]:{endpoint:"logged_out/add_comment",action:H},[O.LoggedOutListComments]:{endpoint:"logged_out/list_comments",action:G},[O.MarkHasOnboarded]:{endpoint:"mark_has_onboarded",action:W},[O.MarkThreadRead]:{endpoint:"mark_thread_read",action:z},[O.MarkThreadUnread]:{endpoint:"mark_thread_unread",action:X},[O.ResolveThread]:{endpoint:"resolve_thread",action:Z},[O.Subscribe]:{endpoint:"subscribe",action:te},[O.UnresolveThread]:{endpoint:"unresolve_thread",action:ae},[O.Unsubscribe]:{endpoint:"unsubscribe",action:ie}},re=o._createMiddleware(se),ce="has_seen_continuous_annotation_feature";function de(){const[e,n]=t.React$1.useState((()=>null!==localStorage.getItem(ce)));return[e,t.reactExports.useCallback((()=>{n(!0),window.localStorage.setItem(ce,"true")}),[])]}const le=n.defineMessage({id:"U75RtN",defaultMessage:"Hide resolved comments"}),me=n.defineMessage({id:"fKXJUR",defaultMessage:"Show resolved comments"}),ue=n.defineMessage({id:"w904jy",defaultMessage:"Unsubscribe"}),pe=n.defineMessage({id:"cnLKs9",defaultMessage:"Subscribe"}),_e=n.defineMessage({id:"/XlCxM",defaultMessage:"Disable comments"}),ge=n.defineMessage({id:"bppWf8",defaultMessage:"Enable comments"}),be=n.defineMessage({id:"0GnzQS",defaultMessage:"Enable continuous commenting"}),fe=n.defineMessage({id:"oCFihF",defaultMessage:"Disable continuous commenting"}),ve=t.React$1.memo((({className:o,fileId:i,sharedLinkURL:r,size:c,approvalIOClient:d})=>{const l=a.useDispatch(),p=n.useIntl(),_=y(i,r),f=u(i,r),v=a.useSelector((e=>e.showResolvedComments)),h=a.useSelector((e=>{var t;return null===(t=e.permissions[f])||void 0===t?void 0:t.can_enable_commenting})),A=a.useSelector((e=>g(e,f))),C=a.useSelector((e=>{var t;return null===(t=e.permissions[f])||void 0===t?void 0:t.can_subscribe})),O=a.useSelector((e=>((e,t)=>{var n;const a=e.permissions[t],o=e.subscriptionStatus[t];return Boolean(null!==(n=null==o?void 0:o.isSubscribed)&&void 0!==n?n:null==a?void 0:a.is_subscribed)})(e,f))),T=a.useSelector((e=>b(e))),[S,E]=t.React$1.useState({showResolvedComments:v,inSingleAnnotatingMode:T}),I=t.reactExports.useCallback((()=>{l(function(t){return{type:e.Action$1.UpdateShowResolvedComments,payload:{showResolvedComments:t}}}(!v))}),[v]),R=t.reactExports.useCallback((()=>l(ee({arg:{stream:_}}))),[_]),j=t.reactExports.useCallback((()=>l(oe({arg:{stream:_}}))),[_]),L=t.reactExports.useCallback((()=>l(x({arg:{stream:_}}))),[_]),k=t.reactExports.useCallback((()=>l(M({arg:{stream:_}}))),[_]),N=t.reactExports.useCallback((()=>{var t,n;d&&d.logger.logRequestApprovalClick("comments_meatball_menu",i),l(s.setApprovalForm({[f]:{activeForm:"request",threadId:void 0}})),l((t="request_approval",n="comments_meatball",{type:e.Action$1.LogApprovalAction,payload:{action:t,context:n}}))}),[f,d]),[w,D]=de(),U=t.reactExports.useCallback((()=>{T?(l(m(e.SectionAnnotationMode.continuous)),w||D()):l(m(e.SectionAnnotationMode.single))}),[l,T]),$=t.React$1.useCallback((({isOpen:e})=>{e&&E({inSingleAnnotatingMode:T,showResolvedComments:v})}),[T,v]);if(!A&&!h)return null;const B=null==d?void 0:d.getUserExperiments(),V=B?B.flows_approval_flow_variant:"OFF",F=B?B.flows_approval_copy_experiment_variant:"OFF";return t.React$1.createElement(a.Menu.Wrapper,{className:o,onToggle:$},(({getContentProps:e,getTriggerProps:n})=>t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(a.IconButton,Object.assign({variant:"transparent"},n(),{size:c,"aria-label":p.formatMessage({id:"OD3YF0",defaultMessage:"Other actions"})}),t.React$1.createElement(a.UIIcon,{src:a.MoreHorizontalLine,size:c})),t.React$1.createElement(a.Menu.Content,Object.assign({},e()),t.React$1.createElement(a.Menu.Segment,null,t.React$1.createElement(a.Menu.ActionItem,{value:S.showResolvedComments?"hide-resolve-comments":"show-resolve-comments",onClick:I,disabled:!A},S.showResolvedComments?p.formatMessage(le):p.formatMessage(me)),C?t.React$1.createElement(a.Menu.ActionItem,{value:O?"unsubscribe":"subscribe",onClick:O?j:R,disabled:!A},O?p.formatMessage(ue):p.formatMessage(pe)):null,h?t.React$1.createElement(a.Menu.ActionItem,{value:O?"enableComments":"disableComments",onClick:A?k:L},A?p.formatMessage(_e):p.formatMessage(ge)):null,s.isApprovalEnabled(V)&&t.React$1.createElement(a.Menu.ActionItem,{value:"requestApproval",onClick:N,withTitle:t.React$1.createElement(t.React$1.Fragment,null,p.formatMessage(s.approvalCopyExperimentString(F)),t.React$1.createElement(a.AccessoryBadge,{style:{marginLeft:4}},p.formatMessage({id:"VgsgAq",defaultMessage:"New"})))}),t.React$1.createElement(a.Menu.ActionItem,{onClick:U,disabled:!A},S.inSingleAnnotatingMode?p.formatMessage(be):p.formatMessage(fe)))))))}));ve.displayName="CommentsMeatball";a.injectInternalStyle("typescript/component_libraries/files_components/src/blades/comments/component/index.module.out.css",(e=>"._base-comments-pane-blade_3oxdy_1{height:100%}._base-comments-pane-blade_3oxdy_1 ._sc-comment-stream_3oxdy_5{width:100%}._base-comments-pane-blade_3oxdy_1 ._sc-comment-stream-editor_3oxdy_9{margin:4px 0 0}._base-comments-pane-blade_3oxdy_1 ._sc-thread_3oxdy_14{margin-left:0;margin-right:0}._base-comments-pane-blade_3oxdy_1 ._sc-thread_3oxdy_14._sc-thread_3oxdy_14._sc-thread-editor-is-focused_3oxdy_19{box-shadow:inset 0 0 0 3px var(--color__utility__focusring)}._comment-stream-meatball-icon_3oxdy_23{align-self:center;padding:var(--spacing__unit--2) var(--spacing__unit--1) 0 0}._comments-blade-header-accessory-wrapper_3oxdy_28{align-items:center;display:flex;flex-grow:1}._comments-blade-header-menu_3oxdy_34{margin-left:auto}._comments-blade-loading-spinner-container_3oxdy_38{align-items:center;display:flex;height:100%;justify-content:center}._comments-blade-disabled-wrapper-redesign_3oxdy_45{padding:var(--spacing__unit--2)}"));const he={baseCommentsPaneBlade:"_base-comments-pane-blade_3oxdy_1",scCommentStream:"_sc-comment-stream_3oxdy_5",scCommentStreamEditor:"_sc-comment-stream-editor_3oxdy_9",scThread:"_sc-thread_3oxdy_14",scThreadEditorIsFocused:"_sc-thread-editor-is-focused_3oxdy_19",commentStreamMeatballIcon:"_comment-stream-meatball-icon_3oxdy_23",commentsBladeHeaderAccessoryWrapper:"_comments-blade-header-accessory-wrapper_3oxdy_28",commentsBladeHeaderMenu:"_comments-blade-header-menu_3oxdy_34",commentsBladeLoadingSpinnerContainer:"_comments-blade-loading-spinner-container_3oxdy_38",commentsBladeDisabledWrapperRedesign:"_comments-blade-disabled-wrapper-redesign_3oxdy_45"},Ae=n.defineMessage({id:"5PJLxb",defaultMessage:"{unreadCount} unread"}),Ce=n.defineMessage({id:"ZKwnCD",defaultMessage:"An error occurred."}),ye=e=>a.useSelector((t=>e?((e,t)=>{const n=e.threads[t];return n?Object.values(n).filter((e=>!e.read&&e.comments.some((e=>!e.deleted)))).length:0})(t,e):0));class Oe extends t.reactExports.PureComponent{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){const{intl:e}=this.props;return this.state.hasError?t.reactExports.createElement(a.Text,null,e.formatMessage(Ce)):this.props.children}}Oe.displayName="CommentsBladeErrorBoundary";const Te=({fileId:e,sharedLinkURL:o,showOverflowMenu:i,approvalIOClient:s})=>{const r=ye(u(e,o)),c=n.useIntl();return t.reactExports.createElement("div",{className:he.commentsBladeHeaderAccessoryWrapper},r>0?t.reactExports.createElement("div",{className:"comments-blade-header-badge"},t.reactExports.createElement(a.NotificationBadge,{status:"attention"},c.formatMessage(Ae,{unreadCount:r}))):null,i&&t.reactExports.createElement("div",{className:he.commentsBladeHeaderMenu},t.reactExports.createElement(ve,{fileId:e,sharedLinkURL:o,size:"small",approvalIOClient:s})))};Te.displayName="CommentsBladeRightAccessory";const Se=({id:e,intl:s,children:r,fileId:c,sharedLinkURL:d,approvalIOClient:l})=>{const m=i.useIsExpanded(e);return t.reactExports.createElement(n.Provider,{value:s},t.reactExports.createElement(o.RightRail.Blade,{withTitle:s.formatMessage({id:"TxGYML",defaultMessage:"Comments"}),withIcon:t.reactExports.createElement(a.UIIcon,{src:a.CommentLine}),id:e,withTitleRightAccessory:t.reactExports.createElement(Te,{fileId:c,sharedLinkURL:d,showOverflowMenu:m,approvalIOClient:l}),headerTooltipDataAttribute:"right-rail-comments-blade-header"},t.reactExports.createElement(Oe,{intl:s},r)))};Se.displayName="CommentsBlade";const Ee=({id:e,intl:n,fileId:i,sharedLinkURL:s})=>{const r=ye(i?u(i,s):void 0);return t.reactExports.createElement(o.RightRail.CollapsedBladeIcon,{id:e,withIcon:t.reactExports.createElement(a.UIIcon,{src:a.CommentLine,"aria-label":n.formatMessage({id:"JrjHYo",defaultMessage:"Open comments panel"})}),tooltip:n.formatMessage({id:"GSZlCi",defaultMessage:"Comments"}),withNotificationBadge:r,buttonTooltipDataAttribute:"right-rail-comments-blade-collapsed"})};Ee.displayName="CollapsedCommentsBladeButton";const Ie=e=>{for(const t of e)if("approval"===t.type)return t},Re=e=>!!Ie(e.comments[e.comments.length-1].content.metadata),Me=e=>{const t=Ie(e.comments[e.comments.length-1].content.metadata),n=null==t?void 0:t.approvers,a=null==t?void 0:t.requires_all;let o=0;if(!n)return 0;for(const e of n)if("approved"!==e.overall_status)o++;else if(!a)return 0;return a?o:1},je="@@apiv2_redux/stickers/get_stickers",Le="@@apiv2_redux/stickers/get_stickers_result",ke=o._createAction(je),xe={[je]:{endpoint:"get_stickers",action:o._createAction(Le)}},Ne=o._createMiddleware(xe);var we;function De(e){return({dispatch:t})=>n=>a=>{let o=n(a);if(a.type===we.SearchContacts){const n=e();try{n.search(a.payload,(e=>{var n;t((n={query:a.payload,result:e[a.payload]},{type:we.SearchContactsResult,payload:n}))}))}catch(e){}}else a.type===we.WarmContacts&&e();return o}}function Ue(e,t){return e[".tag"]===t}function $e(e){if(Ue(e,"video"))return{type:"video",time:e.time||0,timeSec:e.time_sec||0};if(Ue(e,"audio"))return{type:"audio",time:e.time};if(Ue(e,"document"))return{type:"document",regionType:e.region_type[".tag"],label:e.label,regions:e.regions};if(Ue(e,"image"))return{type:"image",region:e.region,label:e.label};throw new Error("Attempted to convert an annotation type that does not yet exist.")}function Be(e){return"video"===e.type?{".tag":"video",time:e.time,time_sec:e.timeSec}:"audio"===e.type?{".tag":"audio",time:e.time}:"document"===e.type?{".tag":"document",regions:e.regions,region_type:{".tag":e.regionType}}:{".tag":"image",region:Object.assign(Object.assign({},e.region),{page:1})}}function Ve(e,t){return e.type===t}function Fe(e){return Ve(e,"mention")}function Pe(e){return Ve(e,"style")}function qe(e){return Ve(e,"sticker")}function He(e){return Ve(e,"guest")}function Ke(e){return Ve(e,"reel")}function Ge(e){return Ve(e,"hyperlink")}function We(e){const t=e.format[".tag"];if("other"===t)throw new Error('"other" is not a valid format block');return{location:e.location,style:t,type:"style"}}function Ye(e){const t=e.user.type[".tag"];if("other"===t)throw new Error('"other" is not a valid user type');const n={identifier:e.user.identifier,type:t};return{location:e.location,type:"mention",user:n}}function ze(e){if(e.url&&e.location)return{location:e.location,type:"hyperlink",url:e.url}}function Qe(e){const t=[...e.formatting.map(We),...e.mentions.map(Ye)];if(e.sticker){const n=function(e){if(e.url&&e.name&&e.description)return{type:"sticker",id:e.id,url:e.url,name:e.name,description:e.description}}(e.sticker);n&&t.push(n)}if(e.guest){const n=function(e){if(e.first_name||e.last_name)return{type:"guest",first_name:e.first_name,last_name:e.last_name}}(e.guest);n&&t.push(n)}if(e.reel){const n=function(e){if(e.annotation_data)return{type:"reel",annotation_data:e.annotation_data}}(e.reel);n&&t.push(n)}if(e.approval){const n=function(e){var t,n,a;if(e.status&&e.approvers&&e.requester_email)return{type:"approval",status:e.status[".tag"],requester_email:e.requester_email,approval_type:null===(t=e.approval_type)||void 0===t?void 0:t[".tag"],actor:null===(n=e.actor)||void 0===n?void 0:n[".tag"],approvers:null===(a=e.approvers)||void 0===a?void 0:a.map((e=>{var t;return{email:e.email,display_name:e.display_name,overall_status:null===(t=e.overall_status)||void 0===t?void 0:t[".tag"]}})),requires_all:e.requires_all}}(e.approval);n&&t.push(n)}if(e.hyperlinks){const n=e.hyperlinks.map(ze);for(let e of n)e&&Ge(e)&&t.push(e)}return t}function Xe(e){const t=e.filter(Pe).map((e=>({format:{".tag":e.style},location:e.location}))),n=e.filter(Fe).map((e=>({user:{type:{".tag":e.user.type},identifier:e.user.identifier},location:e.location}))),a=e.find(qe),o=a?{id:a.id}:void 0,i=e.find(He),s=i?{first_name:i.first_name,last_name:i.last_name}:void 0,r=e.find(Ke);return{formatting:t,mentions:n,sticker:o,guest:s,reel:r?{annotation_data:r.annotation_data}:void 0,hyperlinks:e.filter(Ge).map((e=>({url:e.url,location:e.location})))}}function Je(e,t){const n=t.timestamp?new Date(t.timestamp):void 0;return{isCurrent:e.ns_id===t.ns_id&&e.sjid===t.sjid,revision:{nsId:t.ns_id,sjId:t.sjid},timestamp:n}}function Ze(e){return e&&"file"===e.type?{ns_id:e.ns_id,sjid:e.sjid}:void 0}function et(e,t){if("resolved_no_details"===e[".tag"])return{type:"no_details"};if(function(e){return"resolved_with_details"===e[".tag"]}(e))return{type:"with_details",resolver:t[e.resolver_id],resolvedTimestamp:new Date(e.resolved_timestamp)};throw new Error("Not a valid type for ResolvedInfo.")}function tt(e,t,n){const a=e.comments.map((a=>function(e,t,n,a){return{author:n[e.author_id],content:{metadata:Qe(e.metadata),text:e.content},deleted:e.deleted,id:e.id,threadId:t,timestamp:new Date(e.timestamp),revisionInfo:a&&e.revision?Je(a,e.revision):{isCurrent:!0},userPermissions:{canDelete:e.permissions.can_delete,canEdit:e.permissions.can_edit}}}(a,e.id,t,n))),o=e.resolved_info?{resolved:!0,resolvedInfo:et(e.resolved_info,t)}:{resolved:!1};return Object.assign(Object.assign({annotation:e.annotation_data?$e(e.annotation_data):void 0,comments:a,id:e.id,read:e.read,readonly:e.readonly,isThirdParty:e.is_third_party},o),{timestamp:a[0].timestamp})}function nt(e,t,n){const a=e.map((e=>tt(e,t,n)));return d.keyBy(a,"id")}function at(e){return{id:e.id,name:{display:e.display_name,initials:e.initials,public:e.public_name},photoUrl:e.photo_url}}function ot(e){const t=e.map(at);return d.keyBy(t,"id")}!function(e){e.WarmContacts="@@contacts/warm",e.SearchContacts="@@contacts/search",e.SearchContactsResult="@@contacts/searchResult"}(we||(we={}));const it="@@apiv2_redux/media_addon/get_features",st="@@apiv2_redux/media_addon/get_features_result",rt=o._createAction(st),ct={[it]:{endpoint:"get_features",action:rt}},dt=o._createMiddleware(ct);var lt;e.Status=void 0,(lt=e.Status||(e.Status={}))[lt.Disabled=0]="Disabled",lt[lt.ReadOnly=1]="ReadOnly",lt[lt.FullyEnabled=2]="FullyEnabled";const mt={},ut={fileIdentifierToBoltMap:{},boltUniqueIdToStream:{}},pt={},_t={},gt={},bt={currentQuery:"",result:[]},ft={},vt={},ht={},At={},Ct={},yt={},Ot={},Tt={},St=!1,Et={state:null,mode:e.SectionAnnotationMode.single},It=null,Rt=e=>{const{payload:{arg:{stream:t}}}=e;return Mt(t)};function Mt(e){return"file_path_or_id"===e.identifier[".tag"]?e.identifier.file_path_or_id:"shared_link_details"===e.identifier[".tag"]?e.identifier.url:void 0}function jt(e){const{stream:t,id:n}=e.payload.arg;return"file_path_or_id"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.file_path_or_id,threadId:n}:"shared_link_details"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.url,threadId:n}:{}}function Lt(e){var t;const{payload:{arg:{id:n,stream:{identifier:a}}}}=e,o=null===(t=e.meta)||void 0===t?void 0:t.threadId;return"file_path_or_id"===a[".tag"]?{fileIdOrUrl:a.file_path_or_id,commentId:n,threadId:o}:"shared_link_details"===a[".tag"]?{fileIdOrUrl:a.url,commentId:n,threadId:o}:{}}function kt(e,t,n,a){return Object.assign(Object.assign({},e),{[t]:n,pending:{action:a,originalValue:e[t],pendingValue:n}})}function xt(e,t,n,a,o){const{comments:i}=e,s=i.findIndex((e=>e.id===t)),r=i[s];if(!r)return e;const c=Object.assign(Object.assign({},r),{[n]:a}),d=[...i];return d.splice(s,1,c),kt(e,"comments",d,o)}function Nt(e,t,n){return Object.assign(Object.assign({},e),{[t]:n?e.pending.originalValue:e[t],pending:void 0})}const wt={boltInfo:(e=ut,t)=>{if(t.type===O.ListCommentsResult){const{payload:{arg:n,result:a}}=t,o=Mt(n.stream);if(o&&a)return{fileIdentifierToBoltMap:Object.assign(Object.assign({},e.fileIdentifierToBoltMap),{[o]:a.bolt_info}),boltUniqueIdToStream:Object.assign(Object.assign({},e.boltUniqueIdToStream),{[a.bolt_info.unique_id]:n.stream})}}return e},threads:(t=mt,n)=>{const a=!!n.error;switch(n.type){case O.AddComment:return Dt(t,n);case O.AddCommentResult:return Ut(t,n,a);case O.MarkThreadRead:case O.MarkThreadUnread:return $t(t,n);case O.MarkThreadReadResult:case O.MarkThreadUnreadResult:return Bt(t,n,a);case O.ResolveThread:case O.UnresolveThread:return Vt(t,n);case O.ResolveThreadResult:case O.UnresolveThreadResult:return Ft(t,n,a);case O.EditComment:return Pt(t,n);case O.EditCommentResult:return qt(t,n,a);case O.DeleteComment:return Ht(t,n);case O.DeleteCommentResult:return Kt(t,n,a);case O.ListCommentsResult:case O.LoggedOutListCommentsResult:return Gt(t,n);case e.Action$1.AddAndCommitComment:return Xt(t,n);case e.Action$1.EditAndCommitComment:return Qt(t,n);case e.Action$1.DeleteAndCommitComment:return Jt(t,n);case e.Action$1.DeleteAndCommitThread:return Zt(t,n);default:return t}},supportedEnhancements:(e={},t)=>{var n;if(t.type===O.ListCommentsResult){const{payload:{arg:a,result:o}}=t,i=Mt(a.stream);if(null!=i&&null!=o)return Object.assign(Object.assign({},e),{[i]:null!==(n=o.supported_enhancements)&&void 0!==n?n:{}})}return e},activeThreadID:(t=pt,n)=>{switch(n.type){case e.Action$1.ActivateThread:case e.Action$1.ActivateInitialThread:return Object.assign(Object.assign({},t),{[n.payload.fileViewerId]:n.payload.threadId});case e.Action$1.DeactivateAllThreads:return Object.assign(Object.assign({},t),{[n.payload.fileViewerId]:""});case O.AddComment:if(n.meta&&n.meta.tempThreadId)return Object.assign(Object.assign({},t),{[n.meta.fileViewerId]:n.meta.tempThreadId});break;case O.AddCommentResult:const{meta:a,payload:{result:o}}=n;if(o&&a&&a.tempThreadId===t[a.fileViewerId])return Object.assign(Object.assign({},t),{[a.fileViewerId]:o.id})}return t},focusedThreadID:(t=_t,{type:n,payload:a})=>{if(n===e.Action$1.FocusThread){const e=Object.assign({},t);return null==a.threadId?delete e[a.fileViewerId]:e[a.fileViewerId]=a.threadId,e}return t},hoverThreadID:(t=gt,{type:n,payload:a})=>{if(n===e.Action$1.HoverThread){const e=Object.assign({},t);return null==a.threadId?delete e[a.fileViewerId]:e[a.fileViewerId]=a.threadId,e}return t},mentionsSearchResult:(e=bt,t)=>{switch(t.type){case we.SearchContacts:return Object.assign(Object.assign({},e),{currentQuery:t.payload});case we.SearchContactsResult:if(t.payload.query===e.currentQuery)return Object.assign(Object.assign({},e),{result:t.payload.result})}return e},permissions:(e=vt,t)=>{if(t.type!==O.ListCommentsResult&&t.type!==O.LoggedOutListCommentsResult)return e;const{payload:{arg:n,result:a}}=t,o=Mt(n.stream);if(!o||!a)return e;const i=a.permissions;return Object.assign(Object.assign({},e),{[o]:i})},draftAnnotation:(t=ft,n)=>{switch(n.type){case e.Action$1.UpdateDraftAnnotation:{const{fileViewerId:e,annotation:a}=n.payload;return a===t[e]?t:Object.assign(Object.assign({},t),{[e]:a})}case e.Action$1.CancelAnnotating:case e.Action$1.ClearDraftAnnotation:{const{fileViewerId:e}=n.payload;if(!(e in t))return t;const a=Object.assign({},t);return delete a[e],a}case O.AddComment:if(null!=n.meta){const{fileViewerId:e}=n.meta;if(!(e in t))return t;const a=Object.assign({},t);return delete a[e],a}}return t},annotationSettings:(t=Et,n)=>{var a;switch(n.type){case e.Action$1.CancelAnnotating:case O.DisableCommentingResult:return Object.assign(Object.assign({},t),{state:null});case O.AddComment:return t.mode===e.SectionAnnotationMode.single?Object.assign(Object.assign({},t),{state:null}):Object.assign(Object.assign({},t),{state:"annotating"});case e.Action$1.ActivateThread:case e.Action$1.ActivateInitialThread:return null===t.state?Object.assign(Object.assign({},t),{state:"viewing"}):"viewing"!==t.state?Object.assign(Object.assign({},t),{state:null}):t;case e.Action$1.DeactivateAllThreads:return"viewing"===t.state?Object.assign(Object.assign({},t),{state:null}):t;case e.Action$1.StartAnnotating:return n.payload.accessible?Object.assign(Object.assign({},t),{state:"annotating-ax"}):Object.assign(Object.assign({},t),{state:"annotating"});case e.Action$1.UpdateAnnotationMode:return"continuous"===n.payload.updatedAnnotationMode?{mode:n.payload.updatedAnnotationMode,state:null!==(a=t.state)&&void 0!==a?a:"annotating"}:{mode:n.payload.updatedAnnotationMode,state:null};case e.Action$1.ConfirmDraftAnnotation:return Object.assign(Object.assign({},t),{state:"commenting"})}return t},editorFocusRequest:(t=ht,{type:n,payload:a})=>{if(n===e.Action$1.ConfirmDraftAnnotation&&!t[a.fileViewerId])return Object.assign(Object.assign({},t),{[a.fileViewerId]:!0});if(n===e.Action$1.FocusEditor&&!t[a.fileViewerId])return Object.assign(Object.assign({},t),{[a.fileViewerId]:!0});if(n===e.Action$1.EditorDidFocus&&t[a.fileViewerId]){const e=Object.assign({},t);return delete e[a.fileViewerId],e}return t},pendingNavigationToActiveThreadAnnotation:(t=At,{type:n,payload:a})=>{if(n===e.Action$1.ActivateThread||n===e.Action$1.ActivateInitialThread)return Object.assign({[a.fileViewerId]:!0},t);if(n===e.Action$1.ResolveNavigationToActiveThreadAnnotation){const e=Object.assign({},t);return delete e[a.fileViewerId],e}return t},status:(t=Ct,n)=>{if(n.type===O.ListCommentsResult){const{payload:{arg:a,result:o}}=n,i=Mt(a.stream);if(i&&o)switch(o.status[".tag"]){case"disabled":return Object.assign(Object.assign({},t),{[i]:e.Status.Disabled});case"enabled":return Object.assign(Object.assign({},t),{[i]:e.Status.FullyEnabled});case"readonly":return Object.assign(Object.assign({},t),{[i]:e.Status.ReadOnly})}}if(n.type===O.LoggedOutListCommentsResult){const{payload:{arg:a}}=n,o=Mt(a.stream);if(o)return Object.assign(Object.assign({},t),{[o]:e.Status.FullyEnabled})}return t},thirdPartySource:(e=yt,t)=>{if(t.type!==O.ListCommentsResult)return e;const{payload:{arg:n,result:a}}=t,o=Mt(n.stream);if(!o||!a)return e;const i=a.supported_enhancements&&a.supported_enhancements.third_party_source;return Object.assign(Object.assign({},e),{[o]:i?(s=i,s[".tag"]):void 0});var s},mediaAddonFeatures:(e=null,t)=>{var n;return t.type===st?null!==(n=t.payload.result)&&void 0!==n?n:null:e},subscriptionStatus:(e=Ot,t)=>{if(t.type!==O.SubscribeResult&&t.type!==O.UnsubscribeResult)return e;const n=Rt(t);if(void 0===n)return e;switch(t.type){case O.SubscribeResult:return Object.assign(Object.assign({},e),{[n]:{isSubscribed:!0,canSubscribe:!0}});case O.UnsubscribeResult:return Object.assign(Object.assign({},e),{[n]:{isSubscribed:!1,canSubscribe:!0}});default:return e}},enableCommentStatus:(e=Tt,t)=>{var n;if(t.type!==O.EnableCommentingResult&&t.type!==O.DisableCommentingResult&&t.type!==O.ListCommentsResult&&t.type!==O.LoggedOutListCommentsResult)return e;const a=Rt(t);if(void 0===a)return e;switch(t.type){case O.EnableCommentingResult:return Object.assign(Object.assign({},e),{[a]:{commentsEnabled:!0,canEnableCommenting:!0}});case O.DisableCommentingResult:return Object.assign(Object.assign({},e),{[a]:{commentsEnabled:!1,canEnableCommenting:!0}});case O.ListCommentsResult:case O.LoggedOutListCommentsResult:const o=t.payload.result;return o?Object.assign(Object.assign({},e),{[a]:{commentsEnabled:!("disabled"===o.status[".tag"]),canEnableCommenting:!!(null===(n=o.permissions)||void 0===n?void 0:n.can_enable_commenting)}}):e;default:return e}},showResolvedComments:(t=St,n)=>n.type===e.Action$1.UpdateShowResolvedComments?n.payload.showResolvedComments:t,approvalFormStatus:s.approvalReducer,stickerPacks:(e=It,t)=>{var n,a,o;return t.type===Le?null!==(o=null===(a=null===(n=t.payload.result)||void 0===n?void 0:n.sticker_sets)||void 0===a?void 0:a.map((e=>Object.assign(Object.assign({},e),{id:e.set_id}))))&&void 0!==o?o:null:e}},Dt=(e,t)=>{const{payload:{arg:{thread_id:n,stream:a}}}=t,o=Mt(a);if(!o||!t.meta)return e;const i=e[o],{content:s,author:r,annotation:c}=t.meta;if(n){const a=i[n],{comments:d}=a,l=Object.assign(Object.assign({},a),{comments:[...d,A({content:s,threadId:n,author:r})],annotation:c||a.annotation});return Object.assign(Object.assign({},e),{[o]:Object.assign(Object.assign({},i),{[n]:Object.assign(Object.assign({},l),{pending:{action:t.type,originalValue:a,newValue:l}})})})}const{tempThreadId:d}=t.meta;if(d){const n=A({threadId:d,author:r,content:s}),a={id:d,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[n],annotation:c,isThirdParty:!1},l=Object.assign(Object.assign({},a),{pending:{action:t.type,originalValue:void 0,pendingValue:a}});return Object.assign(Object.assign({},e),{[o]:Object.assign(Object.assign({},i),{[d]:l})})}return e},Ut=(e,t,n)=>{const{payload:{arg:{thread_id:a,stream:o}}}=t,i=Mt(o);if(!i||!t.meta)return e;const s=e[i];if(a){const t=Object.assign({},s[a]),{originalValue:o}=t.pending;return t.pending=void 0,Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},s),{[a]:n?o:t})})}const{tempThreadId:r}=t.meta;let c=s;if(!n&&r in s&&t.payload.result){c=Object.assign({},s),delete c[r];const e=s[r],{id:n}=t.payload.result;e.readonly=!1,e.id=n,c[n]=Object.assign(Object.assign({},e),{pending:void 0})}return Object.assign(Object.assign({},e),{[i]:c})},$t=(e,t)=>{const{fileIdOrUrl:n,threadId:a}=jt(t);if(!n||!a)return e;const o=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},o),{[a]:kt(o[a],"read",t.type===O.MarkThreadRead,t.type)})})},Bt=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o}=jt(t);if(!a||!o)return e;const i=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},i),{[o]:Nt(i[o],"read",n)})})},Vt=(e,t)=>{const{fileIdOrUrl:n,threadId:a}=jt(t);if(!n||!a)return e;const o=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},o),{[a]:kt(o[a],"resolved",t.type===O.ResolveThread,t.type)})})},Ft=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o}=jt(t);if(!a||!o)return e;const i=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},i),{[o]:Nt(i[o],"resolved",n)})})},Pt=(e,t)=>{const{fileIdOrUrl:n,threadId:a,commentId:o}=Lt(t);if(!(n&&a&&o&&t.meta))return e;const i=e[n],{content:s}=t.meta;return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},i),{[a]:xt(i[a],o,"content",s,t.type)})})},qt=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o,commentId:i}=Lt(t);if(!a||!o||!i)return e;const s=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},s),{[o]:Nt(s[o],"comments",n)})})},Ht=(e,t)=>{const{fileIdOrUrl:n,threadId:a,commentId:o}=Lt(t);if(!n||!a||!o)return e;const i=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},i),{[a]:xt(i[a],o,"deleted",!0,t.type)})})},Kt=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o,commentId:i}=Lt(t);if(!a||!o||!i)return e;const s=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},s),{[o]:Nt(s[o],"comments",n)})})},Gt=(e,t)=>{const{payload:{arg:n,result:a}}=t,o=Mt(n.stream);return o&&a?Object.assign(Object.assign({},e),{[o]:nt(a.threads,ot(a.users))}):e},Wt=a.combineReducers(wt);function Yt(e,t,n){return Object.assign(Object.assign({},e),{[t]:n})}function zt(e,t,n,a){const{comments:o}=e,i=o.findIndex((e=>e.id===t)),s=o[i];if(!s)return e;const r=Object.assign(Object.assign({},s),{[n]:a}),c=[...o];return c.splice(i,1,r),Yt(e,"comments",c)}const Qt=(e,t)=>{const{payload:{content:n,threadId:a,fileIdentifier:o,commentId:i}}=t,s=e[o],r=s[a];return r?Object.assign(Object.assign({},e),{[o]:Object.assign(Object.assign({},s),{[a]:zt(r,i,"content",n)})}):e},Xt=(e,t)=>{const{payload:{author:n,content:a,threadId:o,fileIdentifier:i}}=t,s=e[i];if(o){const t=s[o];if(!t)return e;const{comments:r}=t,c=Object.assign(Object.assign({},t),{comments:[...r,A({content:a,threadId:o,author:n})]});return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},s),{[o]:Object.assign({},c)})})}{const t=h(),o=A({threadId:t,author:n,content:a}),r={id:t,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[o],isThirdParty:!1};return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},s),{[t]:r})})}},Jt=(e,t)=>{const{payload:{threadId:n,fileIdentifier:a,commentId:o}}=t;if(!a||!n||!o)return e;const i=e[a],s=i[n];return s?Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},i),{[n]:zt(s,o,"deleted",!0)})}):e},Zt=(e,t)=>{const{payload:{threadId:n,fileIdentifier:a}}=t;if(!a||!n)return e;const o=e[a],i=o[n];return i?Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},o),{[n]:Yt(i,"comments",i.comments.map((e=>Object.assign(Object.assign({},e),{deleted:!0}))))})}):e},en="comments2";const tn=e=>{if(!e)return!1;if("document"===e.type&&"rectangle"===e.regionType&&1===e.regions.length){const t=e.regions[0];if(0===t.x&&0===t.y&&1===t.height&&1===t.width)return!1}return!0};e.Action=O,e.CollapsedCommentsBladeButton=Ee,e.CommentsBlade=Se,e.CommentsMeatball=ve,e.activateInitialThread=function(t){return{type:e.Action$1.ActivateInitialThread,payload:t}},e.activateThread=function(t){return{type:e.Action$1.ActivateThread,payload:t}},e.addAndCommitComment=function(t,n,a,o){return{type:e.Action$1.AddAndCommitComment,payload:{author:t,content:a,fileIdentifier:n,threadId:o}}},e.addCommentAction=T,e.areCommentsEnabled=g,e.boltSubscribe=function(t){return{type:e.Action$1.BoltSubscribe,payload:t}},e.boltUnsubscribe=function(t){return{type:e.Action$1.BoltUnsubscribe,payload:t}},e.canRespondToApproval=e=>{const t=Ie(e.content.metadata);return"request"===(null==t?void 0:t.approval_type)&&"approver"===(null==t?void 0:t.actor)&&!e.userPermissions.canEdit&&!e.userPermissions.canDelete},e.cancelAnnotating=function(t){return{type:e.Action$1.CancelAnnotating,payload:{fileViewerId:t}}},e.classes=he,e.clearDraftAnnotation=function(t){return{type:e.Action$1.ClearDraftAnnotation,payload:{fileViewerId:t}}},e.confirmDraftAnnotation=function(t,n){return{type:e.Action$1.ConfirmDraftAnnotation,payload:{fileViewerId:t,annotationType:n}}},e.createCommentFileIdentifier=u,e.createStreamFromFileId=C,e.createStreamFromFileOrSharedLink=y,e.deactivateAllThreads=function(t){return{type:e.Action$1.DeactivateAllThreads,payload:t}},e.deleteAndCommitComment=function(t,n,a,o){return{type:e.Action$1.DeleteAndCommitComment,payload:{author:t,fileIdentifier:n,threadId:a,commentId:o}}},e.deleteAndCommitThread=function(t,n,a){return{type:e.Action$1.DeleteAndCommitThread,payload:{author:t,fileIdentifier:n,threadId:a}}},e.deleteCommentAction=I,e.disableCommentingAction=M,e.editAndCommitComment=function(t,n,a,o,i){return{type:e.Action$1.EditAndCommitComment,payload:{author:t,content:i,fileIdentifier:n,threadId:a,commentId:o}}},e.editCommentAction=L,e.editorDidFocus=function(t){return{type:e.Action$1.EditorDidFocus,payload:{fileViewerId:t}}},e.enableCommentingAction=x,e.findActionableApprovalCommentId=e=>{const t=e.comments.filter((e=>!e.deleted)),n=Ie(t[0].content.metadata),a=null==n?void 0:n.actor;if("requester"===a){const e=t[t.length-1],n=Ie(e.content.metadata);if("request"===(null==n?void 0:n.approval_type))return e.id;for(let e=t.length-1;e>=0;e--){const n=t[e],a=Ie(n.content.metadata);if("request"===(null==a?void 0:a.approval_type))return;if("response"===(null==a?void 0:a.approval_type)&&"rejected"===(null==a?void 0:a.status))return n.id}}if("approver"===a)for(let e=t.length-1;e>=0;e--){const n=t[e],a=Ie(n.content.metadata),o=t[e].userPermissions.canEdit;if("request"===(null==a?void 0:a.approval_type))return n.id;if("response"===(null==a?void 0:a.approval_type)&&o)return n.id}},e.findCommentThread=function(e,t){for(const n of e){const e=n.comments;for(const a of e)if(a.id===t)return{comment:a,thread:n}}return null},e.focusEditor=function(t){return{type:e.Action$1.FocusEditor,payload:{fileViewerId:t}}},e.focusThread=function(t,n){return{type:e.Action$1.FocusThread,payload:{fileViewerId:t,threadId:n}}},e.getAnnotationType=(e,t)=>{var n;const a=e.threads[t],o=a?Object.values(a).find((e=>void 0!==e.annotation)):void 0;return null===(n=null==o?void 0:o.annotation)||void 0===n?void 0:n.type},e.getApprovalMetadata=Ie,e.getApprovalRequestCounts=e=>{let t=0,n=0;for(const a of e){const e=Me(a);0!==e&&(t+=e),Re(a)&&n++}return[t,n]},e.getApprovalRequestsSubtext=(e,t)=>t.formatMessage({id:"sj45d1",defaultMessage:"{openRequestsCount} {openRequestsCount, plural, one {approval request} other {approval requests}} open"},{openRequestsCount:e}),e.getApprovers=e=>{const t=Ie(e.comments[e.comments.length-1].content.metadata);return null==t?void 0:t.approvers},e.getFeaturesResultAction=rt,e.getStickersAction=ke,e.hoverThread=function(t,n){return{type:e.Action$1.HoverThread,payload:{fileViewerId:t,threadId:n}}},e.iCommentContentToUserSubmittedComment=function({annotation:e,content:t,stream:n}){return{annotation_data:e?Be(e):void 0,content:t.text,metadata:Xe(t.metadata),revision:Ze(n)}},e.isApprovalRequester=e=>{const t=Ie(e.comments[e.comments.length-1].content.metadata);return"requester"===(null==t?void 0:t.actor)},e.isApprovalThread=Re,e.isSingularlyAnnotating=b,e.listCommentsAction=D,e.logCancelComment=function(){return{type:e.Action$1.LogCancelComment,payload:{}}},e.logEventAction=F,e.logMentionCanceled=function(){return{type:e.Action$1.LogMentionCanceled,payload:{}}},e.logMentionStart=function(){return{type:e.Action$1.LogMentionStart,payload:{}}},e.logMentionSuccess=function(){return{type:e.Action$1.LogMentionSuccess,payload:{}}},e.logStartComment=function(){return{type:e.Action$1.LogStartComment,payload:{}}},e.logStickerCanceled=function(){return{type:e.Action$1.LogStickerCanceled,payload:{}}},e.logStickerStart=function(){return{type:e.Action$1.LogStickerStart,payload:{}}},e.logStickerSuccess=function(){return{type:e.Action$1.LogStickerSuccess,payload:{}}},e.loggedOutListCommentsAction=K,e.makeStore=function({apiv2ClientBase:t,boltIOClient:n,mentionsIOClient:i,logger:s},r){const c=[o.middleware(t.ns("files")),re(t.ns("comments2")),dt(t.ns("media_addon")),Ne(t.ns("stickers")),(d=n,({dispatch:t,getState:n})=>(d.onSignal((e=>{e.updatedChannels.filter((e=>e.channelId.appId===en)).map((e=>{const a=n().boltInfo.boltUniqueIdToStream[e.channelId.uniqueId];a&&t(D({arg:{include_permissions:!0,stream:a}}))}))})),t=>n=>{switch(n.type){case e.Action$1.BoltSubscribe:d.subscribe(n.payload.map((e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}}))));break;case e.Action$1.BoltUnsubscribe:d.unsubscribe(n.payload.map((e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}}))))}return t(n)})),({dispatch:t,getState:n})=>a=>o=>l.__awaiter(void 0,void 0,void 0,(function*(){const i=a(o);if(o.type===e.Action$1.ActivateThread||o.type===e.Action$1.ActivateInitialThread){const{threadId:e,fileId:a,sharedLinkURL:s}=o.payload,r=n().threads[u(a,s)];if(null==r)return i;const c=r[e];if(c&&!c.read&&!c.readonly){const e=y(a,s);t(Y({arg:{id:c.id,stream:e}}))}}return i}))];var d;i&&c.push(De(i)),s&&c.push((t=>({getState:n})=>a=>o=>{var i,s,r,c,d,l;switch(o.type){case O.AddCommentResult:const a=Boolean(o.payload.arg.thread_id);t({event:a?_.REPLY_COMMENT:_.ADD_COMMENT,extra:{hasAnnotation:String(tn(null===(i=o.meta)||void 0===i?void 0:i.annotation)),hasTimestampAnnotation:String((l=null===(s=o.meta)||void 0===s?void 0:s.annotation,!!l&&("video"===l.type||"audio"===l.type))),annotationMode:n().annotationSettings.mode,isSticker:(!!(null===(r=o.payload.arg.comment.metadata)||void 0===r?void 0:r.sticker)).toString(),hasMention:String((null!==(d=null===(c=o.payload.arg.comment.metadata)||void 0===c?void 0:c.mentions.length)&&void 0!==d?d:0)>0)}});break;case O.DeleteCommentResult:t({event:_.DELETE_COMMENT,extra:{annotationMode:n().annotationSettings.mode}});break;case O.EditCommentResult:t({event:_.EDIT_COMMENT,extra:{annotationMode:n().annotationSettings.mode}});break;case O.UnsubscribeResult:t({event:_.UNSUBSCRIBE_COMMENTS,extra:{annotationMode:n().annotationSettings.mode}});break;case O.SubscribeResult:t({event:_.SUBSCRIBE_COMMENTS,extra:{annotationMode:n().annotationSettings.mode}});break;case O.DisableCommentingResult:t({event:_.DISABLE_COMMENTS,extra:{annotationMode:n().annotationSettings.mode}});break;case O.EnableCommentingResult:t({event:_.ENABLE_COMMENTS,extra:{annotationMode:n().annotationSettings.mode}});break;case O.ResolveThreadResult:t({event:_.RESOLVE_COMMENT,extra:{annotationMode:n().annotationSettings.mode}});break;case O.UnresolveThreadResult:t({event:_.UNRESOLVE_COMMENT,extra:{annotationMode:n().annotationSettings.mode}});break;case e.Action$1.UpdateShowResolvedComments:t({event:o.payload.showResolvedComments?_.SHOW_RESOLVED_COMMENTS:_.HIDE_RESOLVED_COMMENTS,extra:{annotationMode:n().annotationSettings.mode}});break;case e.Action$1.SortComments:t({event:_.SORT_COMMENTS,extra:{annotationMode:n().annotationSettings.mode,sortType:o.payload.sortType}});break;case e.Action$1.LogApprovalAction:"request_approval"===o.payload.action&&t({event:_.REQUEST_APPROVAL,extra:{context:o.payload.context,annotationMode:n().annotationSettings.mode}});break;case e.Action$1.UpdateAnnotationMode:t({event:o.payload.updatedAnnotationMode===e.SectionAnnotationMode.continuous?_.ENABLE_CONTINUOUS_ANNOTATIONS:_.DISABLE_CONTINUOUS_ANNOTATIONS});break;case e.Action$1.LogStartComment:t({event:_.ADD_COMMENT_START});break;case e.Action$1.LogCancelComment:t({event:_.ADD_COMMENT_CANCEL});break;case e.Action$1.FocusThread:const m=n().focusedThreadID[o.payload.fileViewerId];o.payload.threadId?(m&&m!==o.payload.threadId&&t({event:_.REPLY_COMMENT_CANCEL}),t({event:_.REPLY_COMMENT_START})):m&&t({event:_.REPLY_COMMENT_CANCEL});break;case O.MarkThreadRead:t({event:_.MARK_THREAD_READ});break;case O.MarkThreadUnread:t({event:_.MARK_THREAD_UNREAD});break;case e.Action$1.StartAnnotating:"rect"===o.payload.annotationType?t({event:_.START_ANNOTATION_RECT}):"timestamp"===o.payload.annotationType&&t({event:_.START_ANNOTATION_TIMESTAMP});break;case e.Action$1.ConfirmDraftAnnotation:"timestamp"===o.payload.annotationType&&t({event:_.START_ANNOTATION_TIMESTAMP});break;case e.Action$1.UpdateDraftAnnotation:"document"===o.payload.annotation.type&&"highlight"===o.payload.annotation.regionType&&t({event:_.START_ANNOTATION_HIGHLIGHT});break;case e.Action$1.LogStickerStart:t({event:_.STICKER_START});break;case e.Action$1.LogStickerSuccess:t({event:_.STICKER_SUCCESS});break;case e.Action$1.LogStickerCanceled:t({event:_.STICKER_CANCELED});break;case e.Action$1.LogMentionStart:t({event:_.MENTION_START});break;case e.Action$1.LogMentionSuccess:t({event:_.MENTION_SUCCESS});break;case e.Action$1.LogMentionCanceled:t({event:_.MENTION_CANCELED})}return a(o)})(s)),r&&c.push(...r);const m=a.applyMiddleware(...c),p=window.__REDUX_DEVTOOLS_EXTENSION__,g=null==p?m:a.compose(m,p({name:"FVSDK Comments2 Plugin"}));return a.createStore(Wt,g)},e.markThreadReadAction=Y,e.markThreadUnreadAction=Q,e.resolveNavigationToActiveThreadAnnotation=function(t){return{type:e.Action$1.ResolveNavigationToActiveThreadAnnotation,payload:{fileViewerId:t}}},e.resolveThreadAction=J,e.searchContacts=function(e){return{type:we.SearchContacts,payload:e}},e.sortComments=function(t){return{type:e.Action$1.SortComments,payload:{sortType:t}}},e.startAnnotating=function(t,n,a){return{type:e.Action$1.StartAnnotating,payload:{fileViewerId:t,accessible:n,annotationType:a}}},e.subscribeAction=ee,e.unresolveThreadAction=ne,e.unsubscribeAction=oe,e.updateAnnotationMode=m,e.updateDraftAnnotation=function(t,n){return{type:e.Action$1.UpdateDraftAnnotation,payload:{fileViewerId:t,annotation:n}}},e.useContinuousAnnotation=de,e.useUnreadCount=ye,e.v4=h,e.warmContacts=function(e){return{type:we.WarmContacts,payload:e}}}));
//# sourceMappingURL=c_comments_data_store.js-vfljqybBU.map
