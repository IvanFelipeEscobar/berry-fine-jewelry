define(["require","exports","./c_account_email","./c_account_email_verify_reasons","./e_ui_page_files_router","./c_tslib","./e_edison","./c_core_i18n","./c_pass_store","./c_lodash-es_lodash","./c_src_utils_clipboard","./c_sharing_ui_notifications_util","./c_sharing_settings_utils_sharing_settings_util","./c_src_sink_index","./c_deprecated_ajax_ajax_form_extract_errors","./c_sharing_confirmation_modals_reset_access_modal","./c_sharing_share_page_action_types","./c_tabs_index","./c_components_sharing_modal_banner","./c_sharing_content_manager","metaserver/static/js/modules/constants/trademark","./c_sharing_gating_util","./c_src_utils_logging","./c_sharing_ui_util","./c_browse_tts","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_spectrum_colorized_icon","./e_core_exception","./c_core_exception_info","./c_share_modal_evolution_utils_logging","./c_clipboard_v3","./c_core_notify","./c_spectrum_modal_utility_modal","./c_sharing_upsells_util","./c_ui_flag","./c_icon_folder_icon","./c_contacts_contact_token_state","./c_core_browser_detection","./c_flows_logging_flows_loggers","./c_integrations_hellosign_deep_integration_constants","./c_flows_utils_async_modal_launchers","./c_integrations_data_selectors","./c_docsend_analytics_add_on_data_apiUtils","./c_docsend_src_utils","./c_flux_store_listener","./c_ui_bubble_dropdown_v2","./c_components_auto-folder-setup-checkbox_index","./c_icon_file_icon","./c_icon_icon_helper","./c_avatar_initials_avatar","./c_avatar_size","./c_ui_title_bubble","./c_spectrum_avatar_avatar_initials","./c_prop-types_index","./c_spectrum_positioned_portal","./c_spectrum_dropdown_button","./c_components_icons_icon_dropdown_selected","./c_integrations_profile_card_popover","./c_resize-observer-polyfill_dist_ResizeObserver","./c_ui_overlay","./c_spectrum_tooltip","./c_contacts_data_v2","./c_utils_contacts_tokenizer_contacts_tokenizer_util","./c_spectrum_culled_list","./c_profile_services_profile_services_constants","./c_profile_services_profile_services_link","metaserver/static/js/modules/constants/login_and_register","./c_components_sharing_spinner","./c_components_approval-forms_approval_checkbox_in_share","./c_flows_redux_selectors","./c_flows_redux_store","./c_flows_approval_approval_io_client"],(function(e,t,s,n,i,a,r,o,l,c,d,h,p,u,m,g,f,_,E,S,M,v,k,b,C,y,w,I,A,T,L,R,N,x,P,F,O,D,$,B,U,H,V,G,W,K,z,q,j,Y,Z,Q,J,X,ee,te,se,ne,ie,ae,re,oe,le,ce,de,he,pe,ue,me,ge,fe,_e,Ee){"use strict";class Se extends r.reactExports.Component{constructor(e){super(e),this.ref=null,this.setRef=e=>{this.ref&&this.ro.unobserve(this.ref),this.ref=e,this.ref&&this.ro.observe(this.ref)},this.onResize=e=>{e.length>0&&this.props.onResize(e[0].contentRect)},this.ro=new ae.index(this.onResize)}componentWillUnmount(){this.ref&&this.ro.unobserve(this.ref)}render(){return r.reactExports.createElement("div",{ref:this.setRef},this.props.children)}}Se.displayName="Resize";const Me="above";class ve extends r.reactExports.Component{constructor(e){super(e),this.id=c.uniqueId("integration_popover_"),this.resolvePortalPosition=()=>{if(this.portalInstance&&this.wrapperElementRef){const e=this.wrapperElementRef.childElementCount<2&&this.wrapperElementRef.firstElementChild||this.wrapperElementRef,{positioning:t=(()=>Me),positionOffset:s=0}=this.props,n=this.portalInstance.portalContentElementRef;let i={top:0,left:0};const a=e.getBoundingClientRect(),r=n.getBoundingClientRect();switch(t(this)){case"below":i={top:a.top+a.height+s,left:a.left+a.width/2-r.width/2};break;case"below_left":i={top:a.top+a.height+s,left:a.left+a.width-r.width};break;case"below_right":i={top:a.top+a.height+s,left:a.left};break;case"left":i={top:Math.min(a.top+a.height/2-r.height/2,document.documentElement.clientHeight-r.height-160),left:a.left-r.width-s};break;case"right":i={top:Math.min(a.top+a.height/2-r.height/2,document.documentElement.clientHeight-r.height-160),left:a.left+a.width+s};break;case"above":i={top:a.top-r.height-s,left:a.left+a.width/2-r.width/2}}this.portalInstance.portalContentElementRef.style.top=i.top+"px",this.portalInstance.portalContentElementRef.style.left=i.left+"px"}},this.handleMouseOverTrigger=this.handleMouseOverTrigger.bind(this),this.handleMouseOut=this.handleMouseOut.bind(this),this.handleOnFocus=this.handleOnFocus.bind(this),this.handleOnBlur=this.handleOnBlur.bind(this),this.handleClick=this.handleClick.bind(this),this.handleClickTrigger=this.handleClickTrigger.bind(this),this.closePortal=this.closePortal.bind(this),this.handleKeyEvent=this.handleKeyEvent.bind(this),this.handleScrollEvent=this.handleScrollEvent.bind(this),this.handleOnClickContent=this.handleOnClickContent.bind(this),this.hasInitiallyShown=!1,this.state={isShown:!!e.isShowInitially}}componentDidMount(){this.props.isShowInitially&&this.showPortal()}componentDidUpdate(){!this.hasInitiallyShown&&this.props.isShowInitially||this.state.isShown&&this.portalInstance?(this.mountListeners(),this.props.onWillShow&&this.props.onWillShow(this),this.portalInstance.mountPortal((()=>{this.props.onDidShow&&this.props.onDidShow(this),this.resolvePortalPosition()}))):this.portalInstance&&(this.unMountListeners(),this.props.onWillClose&&this.props.onWillClose(this),this.portalInstance.unMountPortal(),this.wrapperElementRef=null)}componentWillUnmount(){this.portalInstance&&this.portalInstance.unMountPortal(),this.unMountListeners()}mountListeners(){document.addEventListener("keydown",this.handleKeyEvent,!0),document.addEventListener("scroll",this.handleScrollEvent,!1),document.addEventListener("click",this.handleOnClickContent,!0)}unMountListeners(){document.removeEventListener("keydown",this.handleKeyEvent,!0),document.removeEventListener("scroll",this.handleScrollEvent,!1),document.removeEventListener("click",this.handleOnClickContent,!0)}handleOnFocus(e){this.showPortal()}handleOnBlur(e){}handleMouseOverTrigger(e){this.props.onMouseOverTrigger&&this.props.onMouseOverTrigger(e,this),this.showPortal()}handleMouseOut(e){this.props.shouldCloseOnMouseMoveOutTrigger&&this.props.shouldCloseOnMouseMoveOutTrigger(this)&&this.hidePortal()}handleClick(e){e.stopPropagation()}handleClickTrigger(e){this.props.onClickTrigger&&this.props.onClickTrigger(e,this),this.showPortal()}handleKeyEvent(e){if(this.state.isShown){const t=e.key;t===i.Key_enum.Key.Escape&&(this.closePortal(),this.props.onClickOutsideContent&&this.props.onClickOutsideContent(this),e.stopPropagation()),t!==i.Key_enum.Key.ArrowUp&&t!==i.Key_enum.Key.ArrowDown&&t!==i.Key_enum.Key.ArrowLeft&&t!==i.Key_enum.Key.ArrowRight||e.stopPropagation(),t===i.Key_enum.Key.Tab&&this.handleMouseOut()}}handleScrollEvent(){this.state.isShown&&this.resolvePortalPosition()}handleOnClickContent(e){this.contentElementRef&&this.contentElementRef.contains(e.target)||(this.props.onClickOutsideContent&&this.props.onClickOutsideContent(this),this.closePortal())}closePortal(){this.hidePortal(),this.props.onDidClose&&this.props.onDidClose(this)}showPortal(){this.setState({isShown:!0})}hidePortal(){this.props.isShowInitially&&!this.hasInitiallyShown&&(this.hasInitiallyShown=!0),this.setState({isShown:!1})}render(){const e=this.props.renderContent&&this.props.renderContent()||null;return r.reactExports.createElement("div",{"aria-describedby":this.props.id,onMouseLeave:this.handleMouseOut,onFocusCapture:this.handleOnFocus,onBlur:this.handleOnBlur,onClick:this.handleClick,className:this.props.wrapperClassName?this.props.wrapperClassName:"mc-positioned-portal-wrapper",ref:e=>this.wrapperElementRef=e,id:this.id},r.reactExports.createElement(te.Portal,{ref:e=>this.portalInstance=e,className:"mc-positioned-portal-content",parentElement:this.props.portalParentElement||document.querySelector(`div#${this.id}`)},r.reactExports.createElement("div",{ref:e=>this.contentElementRef=e},this.props.autoRePosition?r.reactExports.createElement(Se,{onResize:this.resolvePortalPosition},e):e)),r.reactExports.createElement("div",{onMouseOver:this.handleMouseOverTrigger,onClick:this.handleClickTrigger},this.props.children))}}ve.displayName="IntegrationPopover";class ke{constructor(){var e;this.onClickTrigger=()=>{this.clicked=!0},this.onClickOutsideContent=()=>{this.clicked=!1},this.shouldCloseOnMouseMoveOutTrigger=()=>!this.clicked,this.onDidShow=e=>{this.showingPortal&&this.showingPortal!==e&&this.showingPortal.closePortal(),this.showingPortal=e},this.onWillClose=e=>{this.showingPortal===e&&(this.showingPortal=null)},this.popover=(e=this,class extends r.reactExports.Component{constructor(){super(...arguments),this.openProfileCard=()=>{this.popoverRef&&(e.clicked=!0,this.popoverRef.showPortal())}}render(){const{upsellContent:t,profileCard:s,positioning:n,upsellPositioning:i,wrapperClassName:a,isShowInitially:o,children:l,positionOffset:c,portalParentElement:d,onClickTrigger:h,onMouseOverTrigger:p,autoRePosition:u}=this.props;return r.reactExports.createElement(ve,{ref:e=>this.popoverRef=e,renderContent:()=>e.clicked?s:t,onClickTrigger:(t,s)=>{e.onClickTrigger(s),h&&h(t)},onClickOutsideContent:e.onClickOutsideContent,onMouseOverTrigger:e=>{p&&p(e)},shouldCloseOnMouseMoveOutTrigger:e.shouldCloseOnMouseMoveOutTrigger,onDidShow:e.onDidShow,onWillClose:e.onWillClose,positioning:()=>!e.clicked&&i?i:n||Me,wrapperClassName:a,isShowInitially:o,positionOffset:c,portalParentElement:d,autoRePosition:u},l)}})}closePortal(){this.showingPortal&&(this.showingPortal.closePortal(),this.clicked=!1)}}const be={shared_folder_member_policy:"team",shared_folder_link_restriction_policy:"members"},Ce={member_policy:"shared_folder_member_policy",shared_link_policy:"shared_folder_link_restriction_policy"};function ye(e){switch(e){case"restricted_by_parent_folder":return o.intl.formatMessage({id:"98DfV5",defaultMessage:"This setting is turned off for all files in this folder."});case"restricted_by_team":return o.intl.formatMessage({id:"AGa70V",defaultMessage:"Your admin has disabled this setting."});default:return}}function we(e,t){let s;return s=t instanceof i.FilePolicy?new i.FilePolicy:t instanceof i.FolderPolicy?new i.FolderPolicy:new i.LinkPolicy,e.keySeq().toArray().map((n=>{const i=e.get(n),a=t.get(n);("object"==typeof i?c.isEqual(i,a):i===a)||(s=s.set(n,i))})),s}function Ie(e,t,s,n,i,a){let r;const o=Ce[e];null!=o&&null!=i&&(r=i.get(o));let l=null!=(null!=t?t.get(e):void 0)?null!=t?t.get(e):void 0:s.get(e),c=null!=a.change_options&&a.change_options.allow;return null!=r&&be[o]===r&&(c=!1,l=r),function(e){return-1!==[d.VIEWER_INFO_POLICY].indexOf(e)}(e)&&(c=function(e,t,s,n){return e===d.VIEWER_INFO_POLICY&&!n&&!!s&&(t&&"enabled"===t.get(d.VIEWER_INFO_POLICY)?!!s.disable_viewer_info&&s.disable_viewer_info.allow:!!s.enable_viewer_info&&s.enable_viewer_info.allow)}(e,s,a,n)),n&&(c=!1),[l,c]}const Ae=p.SharingSettingsUtil(o.intl),Te=e=>new i.LinkPolicy(Ae.getLinkPolicy(e)),Le=(e,t,s)=>{const n=Ae.getModifiedSettings(e,t,s);if(n)return n.error?(h.sharingNotificationError(n.error),null):{url:n.url,settings:n.settings,remove_expiration:n.remove_expiration}};function Re(e,t){return!!t&&t.some((t=>e===t.seen_state_user.user_id))}const Ne=new u.EventEmitter,xe={emit(e,t){Ne.emit(e,t)},on:(e,t)=>Ne.on(e,t),removeListener:(e,t)=>Ne.removeListener(e,t),removeAllListeners(){Ne.removeAllListeners()},eventNames:()=>Ne.eventNames()};var Pe=Object.freeze({__proto__:null,ActionsAdapter:xe});const Fe="confirm-with-option-modal";var Oe=function(e){if("string"==typeof e)return e;if("string"==typeof e.props)return e.props;if(e.props.text)return e.props.text;const t=[];return r.React$1.Children.forEach(e.props.children,(e=>t.push(Oe(e)))),t.join("")};const De=(e,t)=>new Promise((function(s,n){return e.setState(t,s)}));class $e extends r.React$1.Component{render(){const e=o.intl.formatMessage({id:"jxjvN9",defaultMessage:"We’ll let the owner know whenever you change these settings"});return r.React$1.createElement(E.SharingModalBanner,{className:this.props.isInSharingSettingsModal?"sharing-settings-modal__banner":void 0,type:"dark",message:e})}}$e.displayName="InformOwnerUpdateSection";i.injectInternalStyle("metaserver/static/js/sharing/views/sharing_settings_policy_view.module.out.css",(e=>"._sharing-settings-modal__toggle_v7upp_1{align-items:center;display:flex;justify-content:flex-end;line-height:24px}._sharing-settings-modal__toggle_v7upp_1 ._sharing-settings-modal__toggle_input_wrapper_v7upp_7{margin-left:var(--spacing__base_unit)}._sharing-settings-modal__toggle_v7upp_1 ._sharing-settings-modal-toggle-label_v7upp_10._toggle-disabled_v7upp_10{color:var(--color__disabled__text)}"));const Be="_sharing-settings-modal__toggle_v7upp_1",Ue="_sharing-settings-modal__toggle_input_wrapper_v7upp_7",He="_sharing-settings-modal-toggle-label_v7upp_10",Ve="_toggle-disabled_v7upp_10";class Ge extends r.React$1.Component{constructor(e){super(e),this.sharingModalSettingsRowLinkClicked=e=>{window.open(e,"_blank")},this.renderPolicyRow=(e,t,s,n,i)=>r.React$1.createElement(d.SharingModalSettingsRow,{policyFieldName:e,key:t.title,displayName:t.title,displayNameTitle:t.title,description:t.description,descriptionLinkUrl:t.descriptionLinkUrl,descriptionLinkText:t.descriptionLinkText,descriptionLinkOnClicked:this.sharingModalSettingsRowLinkClicked,rightSideElement:n,bottomElement:i})}renderDropdown(e,t,s,n,i,a){return r.React$1.createElement(d.SettingDropdown,{currentValue:t,valuesList:n,optionsDict:s,onValueSelected:i,disabled:a})}renderToggle(e,t,s,n,a){const l=a?(e,t)=>{}:n,c=i.cx(He,{[Ve]:a}),d=o.intl.formatMessage({id:"HveuHT",defaultMessage:"Policy toggle"});return r.React$1.createElement("div",{className:Be},r.React$1.createElement(i.Text,{tagName:"label",htmlFor:`${e}_toggle`,className:c},s[t].label),r.React$1.createElement(i.Toggle,{className:Ue,"aria-label":d,id:`${e}_toggle`,checked:s[t].value,disabled:a,onChange:e=>{l(e.currentTarget.checked,e)}}))}}Ge.displayName="SharingSettingsPolicyView";class We extends Ge{render(){return this.renderPolicies()}renderPolicies(){const e=this.props.policies.map((e=>{const t=this.getPolicyDict(e);return this.renderPolicy(e,t)}));return r.React$1.createElement("div",null,e)}renderPolicy(e,t){let s,n,i;[s,n]=Ie(e,this.props.policyUpdate,this.props.currentPolicy,this.props.showContentManagerBridge,this.props.teamPolicy,this.props.permissions);const a=Object.keys(t.optionsDict);if(s&&!a.includes(s))throw new Error(`Invalid Policy: ${s}`);if(t.type===d.DROPDOWN){const r=t=>{this.props.onPolicyUpdate(e,t)};i=this.renderDropdown(e,s,t.optionsDict,a,r,!n)}else if(t.type===d.TOGGLE){const r=(s,n)=>{for(const n of a){t.optionsDict[n].value===s&&this.props.onPolicyUpdate(e,n)}};i=this.renderToggle(e,s,t.optionsDict,r,!n)}return this.renderPolicyRow(e,t,n,i)}isTeamMemberFolder(){return!this.isTeamFolderTree()&&this.props.ownerTeam}isTeamFolderTree(){return this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree}getMemberPolicyQuestion(){return this.isTeamFolderTree()?o.intl.formatMessage({id:"+JxbQ8",defaultMessage:"Limit who can be added as a member of folders."}):o.intl.formatMessage({id:"lUdY7W",defaultMessage:"Limit who can be added as a member of this folder."})}getAclUpdatePolicyQuestion(){return this.isTeamFolderTree()?o.intl.formatMessage({id:"8eiYiI",defaultMessage:"Choose who can add people to folders."}):o.intl.formatMessage({id:"d2BniZ",defaultMessage:"Choose who can add people to this folder."})}getViewerInfoPolicyDescription(){return this.props.ownerTeam?this.props.isFolder?o.intl.formatMessage({id:"9Ihzjr",defaultMessage:"Show who viewed files in this folder to team members and people who can edit."}):o.intl.formatMessage({id:"pPFsa4",defaultMessage:"Show who viewed this file to team members and people who can edit."}):this.props.isFolder?o.intl.formatMessage({id:"FquCbz",defaultMessage:"Show who’s viewing files in this folder to people who can edit."}):o.intl.formatMessage({id:"VloA8O",defaultMessage:"Show who’s viewing this file to people who can edit."})}getPolicyDict(e){switch(e){case d.MEMBER_POLICY:return{title:o.intl.formatMessage({id:"Z0CQak",defaultMessage:"Folder membership"}),description:this.getMemberPolicyQuestion(),optionsDict:{anyone:{label:o.intl.formatMessage({id:"m1ZBqW",defaultMessage:"Anyone"})},team:{label:o.intl.formatMessage({id:"flkJcx",defaultMessage:"Only team members"})}},type:d.DROPDOWN};case d.ACL_UPDATE_POLICY:return{title:o.intl.formatMessage({id:"qG3VMJ",defaultMessage:"Manage access"}),description:this.getAclUpdatePolicyQuestion(),optionsDict:{editors:{label:this.isTeamFolderTree()||this.isTeamMemberFolder()?o.intl.formatMessage({id:"KBoyON",defaultMessage:"Team members who can edit"}):o.intl.formatMessage({id:"CyxyyA",defaultMessage:"Folder members"}),description:this.isTeamFolderTree()||this.isTeamMemberFolder()?o.intl.formatMessage({id:"rY7b9W",defaultMessage:"Team members with edit access can add people."}):o.intl.formatMessage({id:"U8/o8J",defaultMessage:"Members with edit access can add people."})},owner:{label:this.isTeamFolderTree()?o.intl.formatMessage({id:"FRQa4i",defaultMessage:"Only Team Admins"}):o.intl.formatMessage({id:"svCMOP",defaultMessage:"Only the owner"}),description:this.isTeamFolderTree()?o.intl.formatMessage({id:"kmb+og",defaultMessage:"Only Team Admins."}):o.intl.formatMessage({id:"mNi7Xx",defaultMessage:"Only the owner can add people."})}},type:d.DROPDOWN};case d.VIEWER_INFO_POLICY:return{title:o.intl.formatMessage({id:"OFgJ+q",defaultMessage:"Viewer info"}),description:this.getViewerInfoPolicyDescription(),optionsDict:{enabled:{label:o.intl.formatMessage({id:"4ASaZl",defaultMessage:"On"}),value:!0},disabled:{label:o.intl.formatMessage({id:"495asM",defaultMessage:"Off"}),value:!1}},type:d.TOGGLE};case d.FOLDER_LINK_AUDIENCE_POLICY:if(!this.props.ownerTeam)throw new Error("Policy only valid for teams");return"team"===this.props.currentPolicy[d.FOLDER_LINK_AUDIENCE_POLICY]?this.renderFolderLinkPolicyDropdown():{title:o.intl.formatMessage({id:"dpUA0F",defaultMessage:"Link restrictions"}),description:o.intl.formatMessage({id:"ZnIqIh",defaultMessage:"Prevent non-members from accessing this folder via link."}),optionsDict:{members:{label:o.intl.formatMessage({id:"4ASaZl",defaultMessage:"On"}),value:!0},anyone:{label:o.intl.formatMessage({id:"495asM",defaultMessage:"Off"}),value:!1}},type:d.TOGGLE};default:throw new Error("Policy name not found")}}renderFolderLinkPolicyDropdown(){if(!this.props.ownerTeam)throw new Error("Policy only valid for teams");return{title:o.intl.formatMessage({id:"dpUA0F",defaultMessage:"Link restrictions"}),description:o.intl.formatMessage({id:"W3KUO0",defaultMessage:"Limits who can access this folder via a link."}),optionsDict:{anyone:{label:o.intl.formatMessage({id:"xkdOhD",defaultMessage:"No restrictions"}),description:o.intl.formatMessage({id:"cLesiI",defaultMessage:"Show all access options for links."})},members:{label:o.intl.formatMessage({id:"Tj12s5",defaultMessage:"Invite-only"}),description:o.intl.formatMessage({id:"02i0Sa",defaultMessage:"Show “Only invited members” only."})},team:{label:o.intl.formatMessage({id:"axkOyT",defaultMessage:"Team only"}),description:o.intl.formatMessage({id:"chneWK",defaultMessage:"Show “Only people at {team_name}”."},{team_name:i.Emstring.em_snippet(this.props.ownerTeam.name,12)})}},type:d.DROPDOWN}}}const Ke=e=>{window.open(e,"_blank")};class ze extends r.React$1.Component{constructor(){super(...arguments),this.getPolicyDict=e=>this.props.getPolicyDict(e,this.props.isFolder),this.renderCannotPreviewBanner=()=>{if(!function(e,t){if(!e)return!1;if(null!=(null!=t?t.preview_type:void 0)){const{preview_type:e}=t;if(Array.from(l.VALID_PREVIEW_TYPES).includes(e))return!1}return!0}(!this.props.isFolder,this.props.linkMetadata))return;const e=i.file_extension(this.props.linkMetadata.name).toUpperCase();return r.React$1.createElement(E.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"default",message:o.intl.formatMessage({id:"7E5yD4",defaultMessage:"{file_extension} files can’t be previewed. Downloads must be enabled to share."},{file_extension:`.${e}`})})},this.handleMultiplePolicyUpdate=e=>{const t=this.props.linkPolicy.merge(e);this.props.onPolicyUpdate(this.props.linkMetadata,t)},this.handlePolicyUpdate=(e,t)=>{const s=this.props.linkPolicy.set(e,t);this.props.onPolicyUpdate(this.props.linkMetadata,s)}}render(){const e=this.props.readOnlyPolicy;return r.React$1.createElement("div",null,r.React$1.createElement(d.SharingSettingsAudience,{intl:o.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:e}),r.React$1.createElement(d.SharingSettingsExpire,{intl:o.intl,linkMetadata:this.props.linkMetadata,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:e}),r.React$1.createElement(d.SharingSettingsDownload,{intl:o.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handlePolicyUpdate,onLinkClicked:Ke,banner:this.renderCannotPreviewBanner(),readOnlyPolicy:e,isEditFolderLink:!1}))}}ze.displayName="SharingSettingsLinkPolicyView";const qe=d.SharingSettingsLinkPolicies(o.intl),je=qe.getShmodelInMultipleLinksPolicyDict,Ye=qe.getRLPolicyDict,Ze=e=>{window.open(e,"_blank")};class Qe extends r.React$1.Component{constructor(){super(...arguments),this.getPolicyDict=e=>{const{link_permissions:t}=this.props.linkMetadata;return Ye(e,t.link_access_level,this.props.linkMetadata.isFolder())},this.handleMultiplePolicyUpdate=e=>{const t=this.props.linkPolicy.merge(e);this.props.onPolicyUpdate(this.props.linkMetadata,t)},this.handlePolicyUpdate=(e,t)=>{const s=this.props.linkPolicy.set(e,t);this.props.onPolicyUpdate(this.props.linkMetadata,s)}}render(){const e=this.props.readOnlyPolicy;return r.React$1.createElement("div",null,r.React$1.createElement(d.SharingSettingsAudience,{intl:o.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:e}),r.React$1.createElement(d.SharingSettingsExpire,{intl:o.intl,linkMetadata:this.props.linkMetadata,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:e}),r.React$1.createElement(d.SharingSettingsPassword,{intl:o.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handleMultiplePolicyUpdate,readOnlyPolicy:e}),r.React$1.createElement(d.SharingSettingsDownload,{intl:o.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy,getPolicyDict:this.getPolicyDict,onPolicyUpdate:this.handlePolicyUpdate,onLinkClicked:Ze,readOnlyPolicy:e,isEditFolderLink:this.props.linkMetadata.isFolder()&&"editor"===this.props.linkMetadata.link_permissions.link_access_level,banner:r.React$1.createElement(d.DisableDownloadsBanner,{intl:o.intl,linkPermissions:this.props.linkMetadata.link_permissions,linkPolicy:this.props.linkPolicy})}))}}Qe.displayName="SharingSettingsRighteousLinkPolicyView";const Je="scl-sharing-modal-footer-link";class Xe extends r.reactExports.PureComponent{render(){const e=i.cx(Je,this.props.className);return r.reactExports.createElement("div",{className:e},!0!==this.props.isIconHidden&&r.reactExports.createElement("div",{className:`${Je}__icon`},this.props.icon?this.props.icon:r.reactExports.createElement(d.IconLink,null)),r.reactExports.createElement("div",{className:`${Je}__body`},this.props.body),r.reactExports.createElement("div",{className:`${Je}__actions`},this.props.actions))}}Xe.displayName="SharingModalFooterLink";const et=e=>r.reactExports.createElement(Xe,{className:e.className,icon:e.icon,body:e.statusNoLinkCreated,actions:r.reactExports.createElement(i.Button,{variant:"borderless",onClick:e.onClickButtonCreateLink},e.textButtonCreateLink)}),tt=function(e){const t=i.cx(Je,`${Je}--copy`,e.className);return r.reactExports.createElement(Xe,{className:t,icon:e.icon?e.icon:r.reactExports.createElement(d.IconLink,{variant:"active"}),isIconHidden:e.isIconHidden,body:r.reactExports.createElement("input",Object.assign({readOnly:!0,autoFocus:!0,value:e.sharedLinkUrl,onClick:st,onFocus:st,"aria-label":e.labelSharedLinkUrl},e.inputProps)),actions:r.reactExports.createElement(i.Button,{variant:"borderless",onClick:e.onClickButton},e.textButton)})};tt.displayName="SharingModalFooterLinkCopy";const st=e=>{e.currentTarget.select()},nt=JSON.parse('\n    {"link-edit":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M19.9 9.17l1.377-1.377a1 1 0 0 1 1.415 0l1.364 1.364a1 1 0 0 1 0 1.414l-1.377 1.377L19.9 9.17zM9.653 19.415l9.193-9.192 2.779 2.779-9.193 9.192-2.779-2.779zM8.6 20.441l2.778 2.779-3.219 1.073a.5.5 0 0 1-.632-.633L8.6 20.441z\\" fill=\\"#000\\"></path>"},"link-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><path d=\\"M5 12c0-1.657 1.347-3 2.997-3h3.006A3 3 0 0 1 14 12v3H7.997A3 3 0 0 1 5 12zm1.5 0c0 .834.672 1.5 1.5 1.5h1.5V15H14v-2.5h-1.5v-.505c0-.818-.67-1.495-1.499-1.495H8c-.834 0-1.499.672-1.499 1.5z\\" fill=\\"#637282\\"></path><path d=\\"M19 12c0 1.657-1.347 3-2.997 3h-3.006A3 3 0 0 1 10 12V9h6.003A3 3 0 0 1 19 12zm-1.5 0c0-.834-.672-1.5-1.5-1.5h-1.5V9H10v2.5h1.5v.505c0 .818.67 1.495 1.499 1.495H16c.834 0 1.499-.672 1.499-1.5z\\" fill=\\"#637282\\"></path></g>"},"link-view":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M16 22c3.524 0 6.612-2.572 8.324-4.348a2.354 2.354 0 0 0 0-3.304C22.612 12.572 19.524 10 16 10s-6.612 2.572-8.324 4.348a2.354 2.354 0 0 0 0 3.304C9.388 19.428 12.476 22 16 22zm0-2c2.153 0 3.899-1.79 3.899-4S18.153 12 16 12s-3.899 1.79-3.899 4 1.746 4 3.899 4z\\" fill=\\"#000\\"></path><path fill-rule=\\"evenodd\\" clip-rule=\\"evenodd\\" d=\\"M16 18.5c1.346 0 2.437-1.12 2.437-2.5S17.346 13.5 16 13.5c-1.346 0-2.437 1.12-2.437 2.5s1.091 2.5 2.437 2.5z\\" fill=\\"#000\\"></path>"},"link":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#637282\\"><path d=\\"M6 16c0-2.21 1.794-4 4.007-4h4.986A4.006 4.006 0 0 1 19 16v4h-8.993A4.006 4.006 0 0 1 6 16zm2 0c0 1.112.898 2 2.005 2H13v2h6v-3h-2v-.999c0-1.1-.894-2.001-1.997-2.001H9.997A2 2 0 0 0 8 16z\\"></path><path d=\\"M26 16c0 2.21-1.794 4-4.007 4h-4.986A4.006 4.006 0 0 1 13 16v-4h8.993A4.006 4.006 0 0 1 26 16zm-2 0c0-1.112-.898-2-2.005-2H19v-2h-6v3h2v.999c0 1.1.894 2.001 1.997 2.001h5.006A2 2 0 0 0 24 16z\\"></path></g></g>"}}\n  '),it=e=>{const{name:t}=e,s=r.reactExports.createElement(w.SvgIconBundle,{focusable:"false",icon:nt[t]});return r.reactExports.createElement(y.Component,Object.assign({icon:s},e))};it.displayName="IconAcl";const at=function(e){const t=e.expires?e.expires.getTime():0;if(null!=e.expires){let e=t-(new Date).getTime();return e<0&&(e=0),Math.floor(e/864e5)}return-1},rt=function(e){return!1===e.link_permissions.allow_download?null!=e.expires?function(e){r.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const t=at(e);return(()=>{if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return o.intl.formatMessage({id:"vZ+Gcq",defaultMessage:"{count, plural, one{Anyone with this link and the password can view the folder. Expires in a day. Downloads disabled.} other{Anyone with this link and the password can view the folder. Expires in {count} days. Downloads disabled.}}"},{count:t});case"public":return o.intl.formatMessage({id:"OrpLrY",defaultMessage:"{count, plural, one{Anyone with this link can view the folder. Expires in a day. Downloads disabled.} other{Anyone with this link can view the folder. Expires in {count} days. Downloads disabled.}}"},{count:t});case"shared_folder_only":return o.intl.formatMessage({id:"dBd/+Q",defaultMessage:"{count, plural, one{Members of the folder with this link can view this folder. Expires in a day. Downloads disabled.} other{Members of the folder with this link can view this folder. Expires in {count} days. Downloads disabled.}}"},{count:t});case"team_and_password":return o.intl.formatMessage({id:"gSChY6",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link and the password can view the folder. Expires in a day. Downloads disabled.} other{Anyone on your Dropbox team with this link and the password can view the folder. Expires in {count} days. Downloads disabled.}}"},{count:t});case"team_only":return o.intl.formatMessage({id:"SkY8H3",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link can view the folder. Expires in a day. Downloads disabled.} other{Anyone on your Dropbox team with this link can view the folder. Expires in {count} days. Downloads disabled.}}"},{count:t});case"no_one":return o.intl.formatMessage({id:"45l3oV",defaultMessage:"{count, plural, one{Members of the folder with this link can view. Expires in a day. Downloads disabled.} other{Members of the folder with this link can view. Expires in {count} days. Downloads disabled.}}"},{count:t});case"only_you":return o.intl.formatMessage({id:"8vR+GP",defaultMessage:"{count, plural, one{Only you can view via this link. Expires in a day. Downloads disabled.} other{Only you can view via this link. Expires in {count} days. Downloads disabled.}}"},{count:t});default:return ot(e.link_permissions.resolved_visibility)}else switch(e.link_permissions.resolved_visibility){case"password":return o.intl.formatMessage({id:"7v6dcE",defaultMessage:"{count, plural, one{Anyone with this link and the password can view the file. Expires in a day. Downloads disabled.} other{Anyone with this link and the password can view the file. Expires in {count} days. Downloads disabled.}}"},{count:t});case"public":return o.intl.formatMessage({id:"LhLDTC",defaultMessage:"{count, plural, one{Anyone with this link can view the file. Expires in a day. Downloads disabled.} other{Anyone with this link can view the file. Expires in {count} days. Downloads disabled.}}"},{count:t});case"shared_folder_only":return o.intl.formatMessage({id:"euxNFl",defaultMessage:"{count, plural, one{Members of the containing shared folder with this link can view the file. Expires in a day. Downloads disabled.} other{Members of the containing shared folder with this link can view this file. Expires in {count} days. Downloads disabled.}}"},{count:t});case"team_and_password":return o.intl.formatMessage({id:"8EZlSa",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link and the password can view the file. Expires in a day. Downloads disabled.} other{Anyone on your Dropbox team with this link and the password can view the file. Expires in {count} days. Downloads disabled.}}"},{count:t});case"team_only":return o.intl.formatMessage({id:"+sU/hx",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link can view the file. Expires in a day. Downloads disabled.} other{Anyone on your Dropbox team with this link can view the file. Expires in {count} days. Downloads disabled.}}"},{count:t});case"no_one":return o.intl.formatMessage({id:"9FCQD8",defaultMessage:"{count, plural, one{Members of the file with this link can view. Expires in a day. Downloads disabled.} other{Members of the file with this link can view. Expires in {count} days. Downloads disabled.}}"},{count:t});case"only_you":return o.intl.formatMessage({id:"8vR+GP",defaultMessage:"{count, plural, one{Only you can view via this link. Expires in a day. Downloads disabled.} other{Only you can view via this link. Expires in {count} days. Downloads disabled.}}"},{count:t});default:return ot(e.link_permissions.resolved_visibility)}})()}(e):(e=>(()=>{if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return o.intl.formatMessage({id:"vS4Oei",defaultMessage:"Anyone with this link and password can view the folder. Downloads disabled."});case"public":return o.intl.formatMessage({id:"2q+G4r",defaultMessage:"Anyone with this link can view the folder. Downloads disabled."});case"shared_folder_only":return o.intl.formatMessage({id:"eW5qss",defaultMessage:"Members of the folder with this link can view the folder. Downloads disabled."});case"team_and_password":return o.intl.formatMessage({id:"BOIgzx",defaultMessage:"Anyone on your Dropbox team with this link and the password can view the folder. Downloads disabled."});case"team_only":return o.intl.formatMessage({id:"xzbxdc",defaultMessage:"Anyone on your Dropbox team with this link can view the folder. Downloads disabled."});case"no_one":return o.intl.formatMessage({id:"9htZoO",defaultMessage:"Members of the folder with this link can view. Downloads disabled."});case"only_you":return o.intl.formatMessage({id:"fGFHbB",defaultMessage:"Only you can view via this link. Downloads disabled."});default:return ot(e.link_permissions.resolved_visibility)}else switch(e.link_permissions.resolved_visibility){case"password":return o.intl.formatMessage({id:"PqLAde",defaultMessage:"Anyone with this link and password can view the file. Downloads disabled."});case"public":return o.intl.formatMessage({id:"hgAISZ",defaultMessage:"Anyone with this link can view the file. Downloads disabled."});case"shared_folder_only":return o.intl.formatMessage({id:"GYDnJ7",defaultMessage:"Members of the containing shared folder with this link can view the file. Downloads disabled."});case"team_and_password":return o.intl.formatMessage({id:"pDYnvf",defaultMessage:"Anyone on your Dropbox team with this link and the password can view the file. Downloads disabled."});case"team_only":return o.intl.formatMessage({id:"dYMwXa",defaultMessage:"Anyone on your Dropbox team with this link can view the file. Downloads disabled."});case"no_one":return o.intl.formatMessage({id:"vWPrZf",defaultMessage:"Members of the file with this link can view. Downloads disabled."});case"only_you":return o.intl.formatMessage({id:"fGFHbB",defaultMessage:"Only you can view via this link. Downloads disabled."});default:return ot(e.link_permissions.resolved_visibility)}})())(e):null!=e.expires?function(e){r.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const t=at(e);return(()=>{if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return o.intl.formatMessage({id:"xYXFPH",defaultMessage:"{count, plural, one{Anyone with this link and the password can view the folder. Expires in a day.} other{Anyone with this link and the password can view the folder. Expires in {count} days.}}"},{count:t});case"public":return o.intl.formatMessage({id:"xZI0xM",defaultMessage:"{count, plural, one{Anyone with this link can view the folder. Expires in a day.} other{Anyone with this link can view the folder. Expires in {count} days.}}"},{count:t});case"shared_folder_only":return o.intl.formatMessage({id:"YUkY7N",defaultMessage:"{count, plural, one{Members of the folder with this link can view the folder. Expires in a day.} other{Members of the folder with this link can view the folder. Expires in {count} days.}}"},{count:t});case"team_and_password":return o.intl.formatMessage({id:"t7SwRy",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link and the password can view the folder. Expires in a day.} other{Anyone on your Dropbox team with this link and the password can view the folder. Expires in {count} days.}}"},{count:t});case"team_only":return o.intl.formatMessage({id:"mY+P4M",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link can view the folder. Expires in a day.} other{Anyone on your Dropbox team with this link can view the folder. Expires in {count} days.}}"},{count:t});case"no_one":return o.intl.formatMessage({id:"RHtmRP",defaultMessage:"{count, plural, one{Members of the folder with this link can view. Expires in a day.} other{Members of the folder with this link can view. Expires in {count} days.}}"},{count:t});case"only_you":return o.intl.formatMessage({id:"hTH6PN",defaultMessage:"{count, plural, one{Only you can view via this link. Expires in a day.} other{Only you can view via this link. Expires in {count} days.}}"},{count:t});default:return ot(e.link_permissions.resolved_visibility)}else switch(e.link_permissions.resolved_visibility){case"password":return o.intl.formatMessage({id:"RwPv2b",defaultMessage:"{count, plural, one{Anyone with this link and the password can view the file. Expires in a day.} other{Anyone with this link and the password can view the file. Expires in {count} days.}}"},{count:t});case"public":return o.intl.formatMessage({id:"VGO9WL",defaultMessage:"{count, plural, one{Anyone with this link can view the file. Expires in a day.} other{Anyone with this link can view the file. Expires in {count} days.}}"},{count:t});case"shared_folder_only":return o.intl.formatMessage({id:"GDSx6k",defaultMessage:"{count, plural, one{Members of the containing shared folder with this link can view the file. Expires in a day.} other{Members of the containing shared folder with this link can view the file. Expires in {count} days.}}"},{count:t});case"team_and_password":return o.intl.formatMessage({id:"Zeh+SK",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link and the password can view the file. Expires in a day.} other{Anyone on your Dropbox team with this link and the password can view the file. Expires in {count} days.}}"},{count:t});case"team_only":return o.intl.formatMessage({id:"eTrJTC",defaultMessage:"{count, plural, one{Anyone on your Dropbox team with this link can view the file. Expires in a day.} other{Anyone on your Dropbox team with this link can view the file. Expires in {count} days.}}"},{count:t});case"no_one":return o.intl.formatMessage({id:"Pa7KCD",defaultMessage:"{count, plural, one{Members of the file with this link can view. Expires in a day.} other{Members of the file with this link can view. Expires in {count} days.}}"},{count:t});case"only_you":return o.intl.formatMessage({id:"hTH6PN",defaultMessage:"{count, plural, one{Only you can view via this link. Expires in a day.} other{Only you can view via this link. Expires in {count} days.}}"},{count:t});default:return ot(e.link_permissions.resolved_visibility)}})()}(e):(e=>(()=>{if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return o.intl.formatMessage({id:"sYUe0C",defaultMessage:"Anyone with this link and password can view the folder."});case"public":return o.intl.formatMessage({id:"ysL13U",defaultMessage:"Anyone with this link can view the folder."});case"shared_folder_only":return o.intl.formatMessage({id:"kKbOL4",defaultMessage:"Members of the folder with this link can view the folder."});case"team_and_password":return o.intl.formatMessage({id:"GmhVIx",defaultMessage:"Anyone on your Dropbox team with this link and the password can view the folder."});case"team_only":return o.intl.formatMessage({id:"82WU9J",defaultMessage:"Anyone on your Dropbox team with this link can view the folder."});case"no_one":return o.intl.formatMessage({id:"XqgOD/",defaultMessage:"Members of the folder with this link can view."});case"only_you":return o.intl.formatMessage({id:"MrEDaY",defaultMessage:"Only you can view via this link."});default:return ot(e.link_permissions.resolved_visibility)}else switch(e.link_permissions.resolved_visibility){case"password":return o.intl.formatMessage({id:"deMB/m",defaultMessage:"Anyone with this link and password can view the file."});case"public":return o.intl.formatMessage({id:"oxZeg7",defaultMessage:"Anyone with this link can view the file."});case"shared_folder_only":return o.intl.formatMessage({id:"a6Ka8X",defaultMessage:"Members of the containing shared folder with this link can view the file."});case"team_and_password":return o.intl.formatMessage({id:"35NLW6",defaultMessage:"Anyone on your Dropbox team with this link and the password can view the file."});case"team_only":return o.intl.formatMessage({id:"xqds9K",defaultMessage:"Anyone on your Dropbox team with this link can view the file."});case"no_one":return o.intl.formatMessage({id:"qcHpky",defaultMessage:"Members of the file with this link can view."});case"only_you":return o.intl.formatMessage({id:"MrEDaY",defaultMessage:"Only you can view via this link."});default:return ot(e.link_permissions.resolved_visibility)}})())(e)};function ot(e){return A.reportStack(`Unknown audience when building link description: ${e}`,{severity:T.SEVERITY.CRITICAL,tags:["sharing"]}),""}const lt=function(e){const t=e.expires?e.expires.getTime():0;if(null!=e.expires){let e=t-(new Date).getTime();return e<0&&(e=0),Math.floor(e/864e5)}return-1},ct=function(e,t){switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"cxrZ5f",defaultMessage:"Anyone with this link and password can edit the file. Downloads disabled."});case"team":return t?o.intl.formatMessage({id:"TQmLgY",defaultMessage:"Anyone on your {trademark_business} team with this link and password can edit the file. Downloads disabled."},{trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"2bSlge",defaultMessage:"Anyone on the {trademark_business} team with this link and password can edit the file. Downloads disabled."},{trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"whxBh0",defaultMessage:"Members of the file with this link and password can edit. Downloads disabled."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"PqLAde",defaultMessage:"Anyone with this link and password can view the file. Downloads disabled."});case"team":return t?o.intl.formatMessage({id:"AJEVeE",defaultMessage:"Anyone on your {trademark_business} team with this link and password can view the file. Downloads disabled."},{trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"aEL0+O",defaultMessage:"Anyone on the {trademark_business} team with this link and password can view the file. Downloads disabled."},{trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"dm25xu",defaultMessage:"Members of the file with this link and password can view. Downloads disabled."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},dt=function(e,t){switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"Y/LBQu",defaultMessage:"Anyone with this link and password can edit the file."});case"team":return t?o.intl.formatMessage({id:"C4C3zD",defaultMessage:"Anyone on your {trademark_business} team with this link and password can edit the file."},{trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"QrSEbK",defaultMessage:"Anyone on the {trademark_business} team with this link and password can edit the file."},{trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"WsbIo+",defaultMessage:"Members of the file with this link and password can edit."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"deMB/m",defaultMessage:"Anyone with this link and password can view the file."});case"team":return t?o.intl.formatMessage({id:"jRW/3Y",defaultMessage:"Anyone on your {trademark_business} team with this link and password can view the file."},{trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"pxf8F/",defaultMessage:"Anyone on the {trademark_business} team with this link and password can view the file."},{trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"gQVZHe",defaultMessage:"Members of the file with this link and password can view."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},ht=function(e,t){switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"EEvTVP",defaultMessage:"Anyone with this link can edit the file. Downloads disabled."});case"team":return t?o.intl.formatMessage({id:"3+mqzE",defaultMessage:"Anyone on your {trademark_business} team with this link can edit the file. Downloads disabled."},{trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"xBbH4N",defaultMessage:"Anyone on the {trademark_business} team with this link can edit the file. Downloads disabled."},{trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"nHOq1c",defaultMessage:"Members of the file with this link can edit. Downloads disabled."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"hgAISZ",defaultMessage:"Anyone with this link can view the file. Downloads disabled."});case"team":return t?o.intl.formatMessage({id:"9j7wtG",defaultMessage:"Anyone on your {trademark_business} team with this link can view the file. Downloads disabled."},{trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"HwbdrG",defaultMessage:"Anyone on the {trademark_business} team with this link can view the file. Downloads disabled."},{trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"vWPrZf",defaultMessage:"Members of the file with this link can view. Downloads disabled."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},pt=function(e,t){switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"a3Sd0R",defaultMessage:"Anyone with this link can edit the file."});case"team":return t?o.intl.formatMessage({id:"d2zmmn",defaultMessage:"Anyone on your {trademark_business} team with this link can edit the file."},{trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"BjuWgM",defaultMessage:"Anyone on the {trademark_business} team with this link can edit the file."},{trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"+csK/m",defaultMessage:"Members of the file with this link can edit."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"oxZeg7",defaultMessage:"Anyone with this link can view the file."});case"team":return t?o.intl.formatMessage({id:"KQwzZb",defaultMessage:"Anyone on your {trademark_business} team with this link can view the file."},{trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"1rEKxF",defaultMessage:"Anyone on the {trademark_business} team with this link can view the file."},{trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"qcHpky",defaultMessage:"Members of the file with this link can view."});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},ut=function(e,t){r.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const s=lt(e);switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"YGF1+m",defaultMessage:"{count, plural, one{Anyone with this link and password can edit the file. Expires in a day.} other{Anyone with this link and password can edit the file. Expires in {count} days.}}"},{count:s});case"team":return t?o.intl.formatMessage({id:"FmMziB",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link and password can edit the file. Expires in a day.} other{Anyone on your {trademark_business} team with this link and password can edit the file. Expires in {count} days.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"xBIzV+",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link and password can edit the file. Expires in a day.} other{Anyone on the {trademark_business} team with this link and password can edit the file. Expires in {count} days.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"Iyx6hS",defaultMessage:"{count, plural, one{Members of the file with this link and password can edit. Expires in a day.} other{Members of the file with this link and password can edit. Expires in {count} days.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"ScWMex",defaultMessage:"{count, plural, one{Anyone with this link and password can view the file. Expires in a day.} other{Anyone with this link and password can view the file. Expires in {count} days.}}"},{count:s});case"team":return t?o.intl.formatMessage({id:"q2skMY",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link and password can view the file. Expires in a day.} other{Anyone on your {trademark_business} team with this link and password can view the file. Expires in {count} days.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"koMmbb",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link and password can view the file. Expires in a day.} other{Anyone on the {trademark_business} team with this link and password can view the file. Expires in {count} days.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"q6m+2V",defaultMessage:"{count, plural, one{Members of the file with this link and password can view. Expires in a day.} other{Members of the file with this link and password can view. Expires in {count} days.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},mt=function(e,t){r.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const s=lt(e);switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"jpA9+q",defaultMessage:"{count, plural, one{Anyone with this link can edit the file. Expires in a day.} other{Anyone with this link can edit the file. Expires in {count} days.}}"},{count:s});case"team":return t?o.intl.formatMessage({id:"aL2iGX",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link can edit the file. Expires in a day.} other{Anyone on your {trademark_business} team with this link can edit the file. Expires in {count} days.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"gbta7Y",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link can edit the file. Expires in a day.} other{Anyone on the {trademark_business} team with this link can edit the file. Expires in {count} days.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"1EdolK",defaultMessage:"{count, plural, one{Members of the file with this link can edit. Expires in a day.} other{Members of the file with this link can edit. Expires in {count} days.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"VGO9WL",defaultMessage:"{count, plural, one{Anyone with this link can view the file. Expires in a day.} other{Anyone with this link can view the file. Expires in {count} days.}}"},{count:s});case"team":return t?o.intl.formatMessage({id:"6+PaTo",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link can view the file. Expires in a day.} other{Anyone on your {trademark_business} team with this link can view the file. Expires in {count} days.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"dShAa9",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link can view the file. Expires in a day.} other{Anyone on the {trademark_business} team with this link can view the file. Expires in {count} days.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"Pa7KCD",defaultMessage:"{count, plural, one{Members of the file with this link can view. Expires in a day.} other{Members of the file with this link can view. Expires in {count} days.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},gt=function(e,t){r.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const s=lt(e);switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"CJtjRk",defaultMessage:"{count, plural, one{Anyone with this link can edit the file. Expires in a day. Downloads disabled.} other{Anyone with this link can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s});case"team":return t?o.intl.formatMessage({id:"5K8k8j",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link can edit the file. Expires in a day. Downloads disabled.} other{Anyone on your {trademark_business} team with this link can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"2c8AqX",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link can edit the file. Expires in a day. Downloads disabled.} other{Anyone on the {trademark_business} team with this link can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"zUmiuz",defaultMessage:"{count, plural, one{Members of the file with this link can edit. Expires in a day. Downloads disabled.} other{Members of the file with this link can edit. Expires in {count} days. Downloads disabled.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"LhLDTC",defaultMessage:"{count, plural, one{Anyone with this link can view the file. Expires in a day. Downloads disabled.} other{Anyone with this link can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s});case"team":return t?o.intl.formatMessage({id:"b/mGhH",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link can view the file. Expires in a day. Downloads disabled.} other{Anyone on your {trademark_business} team with this link can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"YxsBme",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link can view the file. Expires in a day. Downloads disabled.} other{Anyone on the {trademark_business} team with this link can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"9FCQD8",defaultMessage:"{count, plural, one{Members of the file with this link can view. Expires in a day. Downloads disabled.} other{Members of the file with this link can view. Expires in {count} days. Downloads disabled.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},ft=function(e,t){r.assert(!!e.expires,"this function should only be used when there is expiry for linkMetadata");const s=lt(e);switch(e.link_permissions.link_access_level){case"editor":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"9DkYwJ",defaultMessage:"{count, plural, one{Anyone with this link and password can edit the file. Expires in a day. Downloads disabled.} other{Anyone with this link and password can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s});case"team":return t?o.intl.formatMessage({id:"2WlplE",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link and password can edit the file. Expires in a day. Downloads disabled.} other{Anyone on your {trademark_business} team with this link and password can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"01SzRQ",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link and password can edit the file. Expires in a day. Downloads disabled.} other{Anyone on the {trademark_business} team with this link and password can edit the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"i88LS8",defaultMessage:"{count, plural, one{Members of the file with this link and password can edit. Expires in a day. Downloads disabled.} other{Members of the file with this link and password can edit. Expires in {count} days. Downloads disabled.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}case"viewer":switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"/Ke+Ja",defaultMessage:"{count, plural, one{Anyone with this link and password can view the file. Expires in a day. Downloads disabled.} other{Anyone with this link and password can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s});case"team":return t?o.intl.formatMessage({id:"oSMrQu",defaultMessage:"{count, plural, one{Anyone on your {trademark_business} team with this link and password and password can view the file. Expires in a day. Downloads disabled.} other{Anyone on your {trademark_business} team with this link and password can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"iN+FK7",defaultMessage:"{count, plural, one{Anyone on the {trademark_business} team with this link and password can view the file. Expires in a day. Downloads disabled.} other{Anyone on the {trademark_business} team with this link and password can view the file. Expires in {count} days. Downloads disabled.}}"},{count:s,trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"yenocu",defaultMessage:"{count, plural, one{Members of the file with this link and password can view. Expires in a day. Downloads disabled.} other{Members of the file with this link and password can view. Expires in {count} days. Downloads disabled.}}"},{count:s});default:throw Error(`Unknown link audience: ${e.link_permissions.effective_audience}`)}default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}},_t=function(e,t,s){return e.isRighteousLink()?s?function(e,t){return!1===e.link_permissions.allow_download?null!=e.expires?!1===e.link_permissions.require_password?gt(e,t):ft(e,t):!1===e.link_permissions.require_password?ht(e,t):ct(e,t):null!=e.expires?!1===e.link_permissions.require_password?mt(e,t):ut(e,t):!1===e.link_permissions.require_password?pt(e,t):dt(e,t)}(e,t):function(e,t){switch(e.link_permissions.link_access_level){case"editor":return Et(e,t);case"viewer":return St(e,t);default:throw Error(`Unknown link access level: ${e.link_permissions.link_access_level}`)}}(e,t):rt(e)},Et=function(e,t){switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"a3Sd0R",defaultMessage:"Anyone with this link can edit the file."});case"team":return t?o.intl.formatMessage({id:"d2zmmn",defaultMessage:"Anyone on your {trademark_business} team with this link can edit the file."},{trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"BjuWgM",defaultMessage:"Anyone on the {trademark_business} team with this link can edit the file."},{trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"+csK/m",defaultMessage:"Members of the file with this link can edit."});default:return ot(e.link_permissions.effective_audience)}},St=function(e,t){switch(e.link_permissions.effective_audience){case"public":return o.intl.formatMessage({id:"oxZeg7",defaultMessage:"Anyone with this link can view the file."});case"team":return t?o.intl.formatMessage({id:"KQwzZb",defaultMessage:"Anyone on your {trademark_business} team with this link can view the file."},{trademark_business:M.TRADEMARK_BUSINESS}):o.intl.formatMessage({id:"1rEKxF",defaultMessage:"Anyone on the {trademark_business} team with this link can view the file."},{trademark_business:M.TRADEMARK_BUSINESS});case"no_one":return o.intl.formatMessage({id:"qcHpky",defaultMessage:"Members of the file with this link can view."});default:return ot(e.link_permissions.effective_audience)}},Mt=["trackingId","href"];class vt extends r.React$1.Component{render(){return r.React$1.createElement(i.Link,Object.assign({},this.props),this.props.children)}}vt.displayName="TrackedLinkElement";const kt=(e=>{class t extends r.React$1.Component{constructor(){super(...arguments),this.getWhitelistedExtras=()=>{const e={};return Mt.forEach((t=>{this.props.hasOwnProperty(t)&&(e[`element_${t}`]=this.props[t])})),e},this.onClick=()=>{b.logTiburonEvent(this.props.contentInfo,this.props.user.id,k.TiburonEventName.ElementClick,this.getWhitelistedExtras())}}componentDidMount(){b.logTiburonEvent(this.props.contentInfo,this.props.user.id,k.TiburonEventName.ElementView,this.getWhitelistedExtras())}render(){return r.React$1.createElement(e,Object.assign({onClick:this.onClick},this.props))}}return t.displayName=`withSharingTracking(${i.getDisplayName(e)}`,t})(vt);function bt(e,t,s){return"M1V2"===t||"M1V2_LINK_SETTINGS"===t?1===e.paid?`/buy/professional?_tk=${s}`:`/pro/try?_tk=${s}`:(["M1V1","OFF","CONTROL"].indexOf(t)<0&&A.reportException({err:new Error(`Variant is ${t}`),tags:["share_modal_upsell_premium_sharing"],severity:T.SEVERITY.NONCRITICAL}),`/upgrade?oqa=sfp&_tk=${s}`)}class Ct extends r.React$1.Component{componentDidMount(){this.props.hasIncrementedCounter||void 0===this.props.hasSeenCounter||this.props.onSetSeenCounter(this.props.hasSeenCounter+1)}getCTAText(){return 1===this.props.user.paid?o.intl.formatMessage({id:"vFDLgh",defaultMessage:"Try it with Professional"}):o.intl.formatMessage({id:"iPDKbr",defaultMessage:"Try free with Professional"})}render(){return r.React$1.createElement(d.Banner,{showTopCaret:!0},r.React$1.createElement(i.Text,{size:"small",className:"scl-banner__text"},o.intl.formatMessage({id:"R2FTNc",defaultMessage:"Secure this link with a password and expiration."})," ",r.React$1.createElement(kt,{trackingId:"share_modal_pro_upsell_footer",user:this.props.user,contentInfo:this.props.contentInfo,href:bt(this.props.user,this.props.variant,"sharing_modal_upsell"),target:"_blank",rel:"noopener",hasNoUnderline:!0},this.getCTAText())))}}function yt(e){const t=i.COLORS.COLOR_INK_60;return"editor"===e?r.React$1.createElement(I.ColorizedIcon,{color:t},r.React$1.createElement(it,{name:"link-edit"})):r.React$1.createElement(I.ColorizedIcon,{color:t},r.React$1.createElement(it,{name:"link-view"}))}Ct.displayName="SharingModalUpsellPremiumSharing",o.intl.formatMessage({id:"tyzuDO",defaultMessage:"Link copied. Allows editing."}),o.intl.formatMessage({id:"6z63dh",defaultMessage:"Link copied. Allows viewing."});class wt extends r.React$1.Component{constructor(e){super(e),this.copyLink=()=>{R.copyToClipboard(this.getLink(),(()=>(this.props.modalClose(),h.showCopyLinkSuccessSnackbar(this.props.linkMetadata.url,this.props.linkAccessLevel))),(function(){h.sharingNotificationError(o.intl.formatMessage({id:"YHoriR",defaultMessage:"Unable to copy the link, please copy manually"}))}))},this.getSpectrumLinkText=e=>{switch(e){case"editor":return r.React$1.createElement("span",null,r.React$1.createElement("b",null,o.intl.formatMessage({id:"fE8Xhp",defaultMessage:"Can edit"})),r.React$1.createElement("br",null),this.renderLinkDescription());case"viewer":return r.React$1.createElement("span",null,r.React$1.createElement("b",null,o.intl.formatMessage({id:"ReyNxC",defaultMessage:"Can view"})),r.React$1.createElement("br",null),this.renderLinkDescription());default:return this.renderLinkDescription()}},this.getLink=()=>null!=this.props.linkMetadata?this.props.linkMetadata.url:"",this.getSpectrumNoLinkText=e=>{switch(e){case"editor":return r.React$1.createElement("span",null,r.React$1.createElement("b",null,o.intl.formatMessage({id:"fE8Xhp",defaultMessage:"Can edit"})),r.React$1.createElement("br",null),o.intl.formatMessage({id:"QfMy5I",defaultMessage:"No link created yet."}));case"viewer":return r.React$1.createElement("span",null,r.React$1.createElement("b",null,o.intl.formatMessage({id:"ReyNxC",defaultMessage:"Can view"})),r.React$1.createElement("br",null),o.intl.formatMessage({id:"QfMy5I",defaultMessage:"No link created yet."}));default:return o.intl.formatMessage({id:"le+3CZ",defaultMessage:"No link created yet"})}},this.onClickButtonCreateLink=()=>{this.setState({creatingLink:!0},(()=>this.handleCreateLinkClicked()))},this.handleCreateLinkClicked=()=>{this.props.actionHandler&&this.props.actionHandler.createSharedLink(this.props.linkAccessLevel)},this.getSpectrumLoadingText=e=>{switch(e){case"editor":return r.React$1.createElement("span",null,r.React$1.createElement("b",null,o.intl.formatMessage({id:"fE8Xhp",defaultMessage:"Can edit"})),r.React$1.createElement("br",null),o.intl.formatMessage({id:"d3Gvwr",defaultMessage:"Creating edit link..."}),r.React$1.createElement(d.ScooterLoader,null));case"viewer":return r.React$1.createElement("span",null,r.React$1.createElement("b",null,o.intl.formatMessage({id:"ReyNxC",defaultMessage:"Can view"})),r.React$1.createElement("br",null),o.intl.formatMessage({id:"rnuyM8",defaultMessage:"Creating view link..."}),r.React$1.createElement(d.ScooterLoader,null));default:return}},this.handleCopyLinkClicked=()=>{if(!this.state.showingUrl){const e={};if(this.props.linkMetadata){e.visibility=this.props.linkMetadata.link_permissions.resolved_visibility,e.expiration=this.props.linkMetadata.expires;const t=L.getLinkKey(this.props.linkMetadata.url);t.kind!==k.LinkKeyTypes.NONE&&(e[t.kind]=t.val,e.link_type=t.link_type)}this.props.contentInfo&&(b.logTiburonEvent(this.props.contentInfo,this.props.user.id,k.TiburonEventName.ClickTibCopyLink,e),b.logTiburonEvent(this.props.contentInfo,this.props.user.id,k.TiburonEventName.CopySharedLink,e))}return De(this,{showingUrl:!this.state.showingUrl,creatingLink:!1}).then(this.copyLink)},this.state={showingUrl:!1,creatingLink:!1}}getLinkabilityState(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo(),{permissions:t}=this.props;return e&&e.isCloudDoc()?this.getLinkabilityStateForCloudDoc():this.props.isTeamSharedFolder?l.LinkabilityStates.CANT_LINK_TEAM_FOLDER:(e.isFolder()||!e.isMetadataLoaded()||t.canCreateViewLink())&&(this.props.canShareLink||this.props.mode===l.MODES.LINK_ONLY)?l.LinkabilityStates.CAN_LINK:t.canInvite()?l.LinkabilityStates.INVITE_NO_LINK:l.LinkabilityStates.NO_INVITE_NO_LINK}getLinkabilityStateForCloudDoc(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo();return this.props.linkMetadata||"editor"===this.props.linkAccessLevel&&e.permissionsObj().canCreateEditLink()||"viewer"===this.props.linkAccessLevel&&e.permissionsObj().canCreateViewLink()?l.LinkabilityStates.CAN_LINK:l.LinkabilityStates.NO_INVITE_NO_LINK}spectrumClassNames(){return"scl-sharing-modal-footer-link--no-border"}render(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo(),t=this.getLinkabilityState();if(t===l.LinkabilityStates.NO_INVITE_NO_LINK)return this.renderSpectrumCantLinkOrShare();if(t===l.LinkabilityStates.INVITE_NO_LINK)return this.renderSpectrumCantLinkCDM();if(t===l.LinkabilityStates.CANT_LINK_TEAM_FOLDER)return this.renderSpectrumCantLinkTeamFolder();if(this.props.linkMetadata){let t;return t=this.state.showingUrl?this.renderSpectrumCopyLink():this.renderSpectrumLink(),r.React$1.createElement(r.React$1.Fragment,null,t,e.hasCreatedLink()&&this.renderUpsellPremiumSharing())}return this.state.creatingLink?r.React$1.createElement(r.React$1.Fragment,null,this.renderSpectrumLoading(),this.renderUpsellPremiumSharing()):t===l.LinkabilityStates.CAN_LINK?this.renderSpectrumNoLink():null}getSpectrumLinkNoAvailableCloudDocText(e){switch(e){case"editor":return r.React$1.createElement("span",null,r.React$1.createElement("b",null,o.intl.formatMessage({id:"fE8Xhp",defaultMessage:"Can edit"})),r.React$1.createElement("br",null),o.intl.formatMessage({id:"5tpMRl",defaultMessage:"Link not available"}));case"viewer":return r.React$1.createElement("span",null,r.React$1.createElement("b",null,o.intl.formatMessage({id:"ReyNxC",defaultMessage:"Can view"})),r.React$1.createElement("br",null),o.intl.formatMessage({id:"5tpMRl",defaultMessage:"Link not available"}));default:return o.intl.formatMessage({id:"5tpMRl",defaultMessage:"Link not available"})}}renderSpectrumCantLinkOrShare(){return r.React$1.createElement(Xe,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),body:this.getSpectrumLinkNoAvailableCloudDocText(this.props.linkAccessLevel)})}getSpectrumCantLinkCDMCloudDocText(e){switch(e){case"editor":return r.React$1.createElement("span",null,r.React$1.createElement("b",null,o.intl.formatMessage({id:"fE8Xhp",defaultMessage:"Can edit"})),r.React$1.createElement("br",null),o.intl.formatMessage({id:"3VVFir",defaultMessage:"Link not available. To share, invite specific people."}));case"viewer":return r.React$1.createElement("span",null,r.React$1.createElement("b",null,o.intl.formatMessage({id:"ReyNxC",defaultMessage:"Can view"})),r.React$1.createElement("br",null),o.intl.formatMessage({id:"3VVFir",defaultMessage:"Link not available. To share, invite specific people."}));default:return o.intl.formatMessage({id:"3VVFir",defaultMessage:"Link not available. To share, invite specific people."})}}renderSpectrumCantLinkCDM(){const e=r.React$1.createElement("a",{href:"/help/business/team-folders",target:"_blank",rel:"noopener noreferrer"},o.intl.formatMessage({id:"sGKSF8",defaultMessage:"Learn more"}));return r.React$1.createElement(Xe,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),body:this.getSpectrumCantLinkCDMCloudDocText(this.props.linkAccessLevel),actions:e})}renderSpectrumCantLinkTeamFolder(){const e=r.React$1.createElement("a",{href:"/help/business/team-folders",target:"_blank",rel:"noopener noreferrer"},o.intl.formatMessage({id:"sGKSF8",defaultMessage:"Learn more"}));return r.React$1.createElement(Xe,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),body:this.getSpectrumLinkNoAvailableCloudDocText(this.props.linkAccessLevel),actions:e})}renderLinkDescription(){let e;if(this.props.linkMetadata){const t=this.props.actionHandler&&this.props.actionHandler.getSharingInfo();e=_t(this.props.linkMetadata,t.isUserOnOwnerTeam(),!0)}return e}renderSpectrumLink(){const e=r.React$1.createElement("span",{className:"copy-link-button"},o.intl.formatMessage({id:"DhomU6",defaultMessage:"Copy link"}));return r.React$1.createElement(Xe,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),body:this.getSpectrumLinkText(this.props.linkAccessLevel),actions:r.React$1.createElement(i.Button,{className:"button-as-link copy-link-container",key:"copy",variant:"borderless",onClick:this.handleCopyLinkClicked},e)})}renderSpectrumCopyLink(){return r.React$1.createElement(tt,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),sharedLinkUrl:this.getLink(),labelSharedLinkUrl:o.intl.formatMessage({id:"9s4M13",defaultMessage:"Shared link URL"}),textButton:o.intl.formatMessage({id:"CgREwE",defaultMessage:"Hide link"}),onClickButton:this.handleCopyLinkClicked})}renderSpectrumNoLink(){return r.React$1.createElement(et,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),statusNoLinkCreated:this.getSpectrumNoLinkText(this.props.linkAccessLevel),textButtonCreateLink:o.intl.formatMessage({id:"/nFZR2",defaultMessage:"Create link"}),onClickButtonCreateLink:this.onClickButtonCreateLink})}renderSpectrumLoading(){return r.React$1.createElement(Xe,{className:this.spectrumClassNames(),icon:yt(this.props.linkAccessLevel),body:this.getSpectrumLoadingText(this.props.linkAccessLevel)})}renderUpsellPremiumSharing(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo(),t=e=>{this.props.actionHandler&&this.props.actionHandler.setSeenUpsellCounterPref(e)};return e.isShareModalUpsellPremiumSharing()&&e.shareModalUpsellPremiumSharingVariant()&&!e.isCloudDoc()?r.React$1.createElement(Ct,{user:this.props.user,contentInfo:this.props.contentInfo,variant:e.shareModalUpsellPremiumSharingVariant(),hasIncrementedCounter:e.hasIncrementedUpsellCounter(),hasSeenCounter:e.hasSeenUpsellCounter(),onSetSeenCounter:t}):void 0}}wt.displayName="RighteousModalLinkInfo";class It extends r.React$1.Component{constructor(e){super(e),this.onClickButtonCreateLink=e=>{"editor"===e?this.setState({creatingEditLink:!0},(()=>this.handleCreateLinkClicked(e))):this.setState({creatingViewLink:!0},(()=>this.handleCreateLinkClicked(e)))},this.handleCreateLinkClicked=e=>{this.props.actionHandler&&this.props.actionHandler.createSharedLink(e).catch((()=>{"editor"===e&&this.state.creatingEditLink?this.setState({creatingEditLink:!1}):this.setState({creatingViewLink:!1})}))},this.handleClickDeleteLink=e=>{!function({contentInfo:e,client:t,url:s,contentName:n,onDeleteLink:a,onCancel:l,actionHandler:c}){const d=(s,n={})=>{b.logTiburonEvent(e,t.userId,s,n)};n=i.Emstring.em_snippet(n,i.SNIPPET_SIZES.FILENAME);const p=o.intl.formatMessage({id:"gbccCU",defaultMessage:"Delete link to “{name}”?"},{name:n}),u=()=>{i.Modal.close(),l&&l()};i.Modal.showInstance(r.React$1.createElement(i.Modal$1,{"aria-label":p,title:p,open:!0,onRequestClose:u},r.React$1.createElement(i.Modal$1.Header,{hasBottomSpacing:"title-standard"},r.React$1.createElement(i.Modal$1.Title,null,p)),r.React$1.createElement(i.Modal$1.Body,{hasVerticalSpacing:!1},o.intl.formatMessage({id:"poEviS",defaultMessage:"If you want to further restrict access, check the list of people who still have access."})),r.React$1.createElement(i.Modal$1.Footer,null,r.React$1.createElement(i.Button$1,{variant:"opacity",onClick:u},o.intl.formatMessage({id:"gZIlfg",defaultMessage:"Cancel"})),r.React$1.createElement(i.Button$1,{variant:"primary",onClick:()=>{d(k.TiburonEventName.AttemptDeleteSharedLink),C.logBrowseTTS("delete_link");const e=o.intl.formatMessage({id:"NEH57K",defaultMessage:"Deleting link to <st>{name}</st>..."},{st:e=>r.React$1.createElement("strong",null,e),name:n});h.sharingNotificationInProgress(e,!0),t.revokeSharedLink({url:s}).then((()=>{d(k.TiburonEventName.SucceedDeleteSharedLink,{http_status_code:200});const e=o.intl.formatMessage({id:"gfG7zK",defaultMessage:"Deleted link to <st>{name}</st>."},{st:e=>r.React$1.createElement("strong",null,e),name:n});c?h.showDeleteLinkSuccessSnackbar(e,(()=>c.showScreen(i.MANAGE_SCREEN)),"sharing-notification"):h.sharingNotificationSuccess(e),i.Modal.close(),a&&a()})).catch((e=>{if(e instanceof i.ApiError){const t=e;d(k.TiburonEventName.FailDeleteSharedLink,{http_status_code:t.raw&&t.raw.status,error_tag:t.error&&t.error[".tag"]||"undefined_error",error_summary:t.summary})}else d(k.TiburonEventName.FailDeleteSharedLink);throw e}))}},o.intl.formatMessage({id:"cRtuyn",defaultMessage:"Delete"})))))}({contentInfo:this.props.sharingInfo.contentInfo(),client:this.props.client,url:e.url,contentName:e.name,onDeleteLink:()=>{this.props.onDeleteLink(e)},onCancel:this.props.onCancelDeleteLink,actionHandler:this.props.actionHandler})},this.state={creatingEditLink:!1,creatingViewLink:!1}}render(){let e;"editor"===this.props.accessLevel?e=this.props.sharingInfo.editRighteousLink():(e=this.props.sharingInfo.viewRighteousLink(),e||(e=this.props.sharingInfo.shmodelLink()));const t=this.renderLinkPolicy(this.props.accessLevel,e);return r.React$1.createElement("div",{className:"scl-sharing-settings-links-section"},t)}emptyLinkCreateActions(e,t){return t?this.renderCreateLinkLoading(e):this.renderEmptyLinkPolicy(e)}renderLinkPolicy(e,t){if(!t)return"editor"===e?this.emptyLinkCreateActions(e,this.state.creatingEditLink):this.emptyLinkCreateActions(e,this.state.creatingViewLink);const s=this.props.updatedLinkPolicies[t.url],n=Te(t),i=p.isReadOnlyPolicy(n,t.link_permissions);let a;return a=t.isRighteousLink()?r.React$1.createElement(Qe,{linkPolicy:s||n,linkMetadata:t,onPolicyUpdate:this.props.onPolicyUpdate,readOnlyPolicy:i}):r.React$1.createElement(ze,{linkPolicy:s||n,linkMetadata:t,isFolder:t.isFolder(),onPolicyUpdate:this.props.onPolicyUpdate,getPolicyDict:je,readOnlyPolicy:i}),r.React$1.createElement(d.Card,{key:t.url||e,icon:yt(e),title:this.renderTitle(e),actions:this.renderLinkActions(t)},a)}renderLinkActions(e){return r.React$1.createElement(At,{linkMetadata:e,isLinkVisitor:this.props.isLinkVisitor,onClickDeleteLink:this.handleClickDeleteLink,accessLevel:this.props.accessLevel})}renderEmptyLinkPolicy(e){var t,s;const{sharingInfo:n}=this.props,a=this.props.sharingInfo.permissionsObj();let l;return l=p.canCreateLink(e,n.isCloudDoc(),n.isFolder(),n.isTeamSharedFolder(),n.isConfidentialFolder(),a.canInviteEditor(),n.canShareLink(),a.canCreateViewLink(),a.canCreateEditLink(),null===(t=null==n?void 0:n.metadata())||void 0===t?void 0:t.access_type,!!(null===(s=null==n?void 0:n.metadata())||void 0===s?void 0:s.path_lower),n.sharingPrefs().confidential_folder_links_enabled)?r.React$1.createElement("div",null,this.getEmptyLinkMessage(e)," ",r.React$1.createElement(i.Link,{id:"create-link",href:"#",onClick:()=>this.onClickButtonCreateLink(e)},o.intl.formatMessage({id:"F7gl6q",defaultMessage:"Create link"}))):o.intl.formatMessage({id:"DhAXrs",defaultMessage:"Link not available."}),r.React$1.createElement(d.Card,{key:e,icon:yt(e),title:this.renderTitle(e)},r.React$1.createElement("div",{className:"sharing-settings-modal__link-policy"},r.React$1.createElement("div",{className:"sharing-settings-modal__link-policy-text"},l)))}getEmptyLinkMessage(e){return"editor"===e?o.intl.formatMessage({id:"K79TJX",defaultMessage:"There isn’t a link for editing."}):o.intl.formatMessage({id:"B3RLyV",defaultMessage:"There isn’t a link for viewing."})}renderCreateLinkLoading(e){let t;const s=o.intl.formatMessage({id:"MnjJiE",defaultMessage:"Creating link"});return t=r.React$1.createElement("span",null,s,r.React$1.createElement(d.ScooterLoader,null)),r.React$1.createElement(d.Card,{key:e,icon:yt(e),title:this.renderTitle(e)},r.React$1.createElement("div",{className:"sharing-settings-modal__link-policy"},r.React$1.createElement("div",{className:"sharing-settings-modal__link-policy-text"},t)))}renderTitle(e){return"editor"===e?o.intl.formatMessage({id:"jN5OfV",defaultMessage:"People with this link can edit"}):o.intl.formatMessage({id:"xLAQNV",defaultMessage:"People with this link can view"})}}It.displayName="SharingSettingsLinkSection";class At extends r.React$1.Component{constructor(){super(...arguments),this.handleClickDelete=e=>{e.preventDefault(),this.props.onClickDeleteLink(this.props.linkMetadata)}}render(){return this.canDeleteLink()?r.React$1.createElement(i.Link,{id:"delete-link",href:"#",onClick:this.handleClickDelete},o.intl.formatMessage({id:"lDhFjo",defaultMessage:"Delete link"})):null}canDeleteLink(){return("editor"!==this.props.accessLevel||!this.props.isLinkVisitor)&&this.props.linkMetadata.link_permissions.can_revoke}}At.displayName="SharingSettingsLinkActions";const Tt=e=>{i.mountModal(r.React$1.createElement(Lt,Object.assign({},e)))},Lt=e=>{const[t,s]=r.React$1.useState(!0),n=(t=!1)=>{t&&i.logEvent({class:"onboard",action:"dismiss",object:"core_act_docsend_advanced_sharing_modal",properties:{experimentVariant:e.experimentVariant}}),s(!1)};r.reactExports.useEffect((()=>{P.setHasSeenDocsendModalInUserMetadata(i.mustGetActiveUser().id),i.Modal$1.setAppElement(document.body),i.logEvent({class:"onboard",action:"shown",object:"core_act_docsend_advanced_sharing_modal",properties:{experimentVariant:e.experimentVariant}})}),[]);const a=o.intl.formatMessage({id:"uguFZx",defaultMessage:"Secure sharing and analytics to help win new clients"}),l=o.intl.formatMessage({id:"/RJy7d",defaultMessage:"Custom security settings to keep sensitive files safe"}),c=o.intl.formatMessage({id:"YlpLOI",defaultMessage:"Document tracking to see how files are sharing and uncover decision makers"}),d=o.intl.formatMessage({id:"HpttW+",defaultMessage:"In-depth analytics to help refine your closing strategy"}),h=o.intl.formatMessage({id:"8Gobbg",defaultMessage:"Try Docsend"});return r.React$1.createElement(o.Provider,{value:o.intl},r.React$1.createElement(i.Modal$1,{open:t,onAfterClose:i.unmountModal,isCentered:!0},r.React$1.createElement("div",{style:{backgroundColor:"var(--color__inverse__attention__background)",display:"flex"}},r.React$1.createElement("div",{style:{margin:"auto"}},r.React$1.createElement(i.Image$1,{src:r.static_url("/static/metaserver/static/js/sharing/upsells/images/docsend_document_analytics-vflti6T_M.png"),width:"400px",height:"300px",style:{margin:"10px 0px"}}))),r.React$1.createElement(i.Modal$1.Header,{hasBottomSpacing:"title-standard"},r.React$1.createElement(i.Modal$1.Title,null,a)),r.React$1.createElement(i.Modal$1.Body,null,r.React$1.createElement("ul",null,r.React$1.createElement("li",null,l),r.React$1.createElement("li",null,c),r.React$1.createElement("li",null,d))),r.React$1.createElement(i.Modal$1.Footer,null,r.React$1.createElement(i.Button$1,{variant:"transparent",onClick:()=>n(!0)},i.CLOSE_BUTTON_TEXT),r.React$1.createElement("div",null),r.React$1.createElement(i.Button$1,{variant:"primary",onClick:()=>{i.logEvent({class:"onboard",action:"confirm",object:"core_act_docsend_advanced_sharing_modal",properties:{experimentVariant:e.experimentVariant}}),i.unsafe_open_tab(Rt()),n(!1)}},h))))};Lt.displayName="DocsendAdvancedSharingModal";const Rt=()=>new r.URI({scheme:"https",authority:"docsend.com",path:"/signup/dropbox",query:{utm_source:"Dropbox Referral",utm_medium:"Referral",utm_campaign:"core_act_docsend_advanced_sharing",signup_source:"docsend_advanced_sharing_modal"}}),Nt=r.React$1.createElement;class xt extends r.React$1.Component{constructor(e){super(e),this.onAfterModalClose=()=>a.__awaiter(this,void 0,void 0,(function*(){"V1"===this.props.sharingPrefs.core_act_docsend_advanced_sharing&&(yield P.canBeShownDocsendModal(this.props.user.id))&&Tt({experimentVariant:"V1"})})),this.handleSaveLinkSettings=()=>{C.logBrowseTTS("update_file_settings");for(const e of this.props.sharingInfo.sharedLinks()){const t=Te(e),s=this.state.updatedLinkPolicies[e.url]||t;t.audience!==s.audience&&b.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,k.TiburonEventName.ChangeSharedLinkAudience,Object.assign({old_audience:t.audience,new_audience:s.audience,screen:k.ScreenName.SettingsScreen},L.buildExtraFromLinkMetadata(e)))}this.saveLinkSettings()},this.saveLinkSettings=()=>{const e=this.getLinkSettingsToUpdate();e.errors||this.setState({isSubmitting:!0},(()=>{this.props.actionHandler.updateLinkSettings(e.requests).then((()=>{this.setState({isSubmitting:!1}),this.props.onDismiss&&this.props.onDismiss(this.getCurrentTab())})).catch((()=>{this.setState({isSubmitting:!1})}))}))},this.saveFileSettings=()=>{const e=we(this.state.desiredPolicy,this.props.currentPolicy);e&&De(this,{isSubmitting:!0}).then((()=>this.props.client.updatePolicy({contentId:this.props.sharingInfo.contentId(),newPolicy:e,actions:Object.keys(i.ALPHA_FILE_METADATA_PERMISSIONS)}))).catch(i.catchApiError((e=>{this.setState({isSubmitting:!1});const t=e&&e.message;return h.sharingNotificationError(t||o.intl.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."})),Promise.reject()}))).then((e=>{h.sharingNotificationSuccess(o.intl.formatMessage({id:"Hpq9jD",defaultMessage:"File settings updated."})),this.setState({isSubmitting:!1}),this.props.currentPolicy&&this.props.actionHandler.handleUpdateFilePolicy(e,this.props.currentPolicy),this.props.onDismiss&&this.props.onDismiss()})).then((()=>this.props.actionHandler.resetContactValidations()))},this.handleSetFolderPolicy=()=>{const e=we(this.state.desiredPolicy,this.props.currentPolicy),t=t=>{i.Snackbar.complete(o.intl.formatMessage({id:"wGHIQR",defaultMessage:"Folder settings updated."}),"sharing-notification"),null!=t&&(t.policy.shared_link_policy!==this.props.currentPolicy.shared_link_policy&&(this.props.actionHandler.fetchLinkMetadata(),i.getStoreForSharedWith().dispatch(i.sharedLinkDataOutOfDate(this.props.sharingInfo.displayPath()))),this.props.actionHandler.handleUpdateSharingSettings(t),i.dispatcherSingleton.dispatch({type:f.SharePageActionTypes.FETCH_FOLDER_POLICY_SUCCESS,user:this.props.user,sharedFolderMetadata:t,policyUpdate:e}),this.props.onSuccessSharing&&this.props.onSuccessSharing()),this.props.onDismiss&&this.props.onDismiss()},s=this.props.sharingInfo.metadata()&&this.props.sharingInfo.metadata().shared_folder_id;if(s)return this.props.client.updatePolicyAlpha({contentId:s,newPolicy:e,url:null!=this.props.linkMetadata?this.props.linkMetadata.url:void 0}).then(t).then((()=>this.props.actionHandler.resetContactValidations()));{const s=e=>{if(this.props.actionHandler.reportShareFailure)return this.props.actionHandler.reportShareFailure(e)};return this.props.actionHandler.shareIfFileFolder(o.intl.formatMessage({id:"AKdTOF",defaultMessage:"Updating folder settings..."}),e).then(t).then((()=>this.props.actionHandler.resetContactValidations())).catch(s)}},this.saveFolderSettings=()=>{this.props.isTeamSharedFolder||this.props.hasParentSharedFolder?function(e){const t=e.isTeamSharedFolder?N.purify.sanitize(o.intl.formatMessage({id:"p4X4PM",defaultMessage:"Your changes will be applied to this team folder and any folders inside it."})):N.purify.sanitize(o.intl.formatMessage({id:"ImAPkp",defaultMessage:"Your changes will be applied to this folder and any folders inside it."}));i.Modal.showInstance(r.reactExports.createElement(x.UtilityModal,{ariaLabel:o.intl.formatMessage({id:"SoVWmf",defaultMessage:"Save settings?"}),title:o.intl.formatMessage({id:"SoVWmf",defaultMessage:"Save settings?"}),overlayClickClose:!0,primaryAction:o.intl.formatMessage({id:"kTq6n5",defaultMessage:"Save settings"}),secondaryAction:o.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),onPrimaryAction:e.onConfirm,onSecondaryAction:e.onCancel,open:!0,onRequestClose:e.onCancel},t))}({isTeamSharedFolder:this.props.isTeamSharedFolder,onConfirm:this.handleSetFolderPolicy,onCancel:i.Modal.close}):De(this,{isSubmitting:!0}).then((()=>{this.handleSetFolderPolicy().then((()=>{this.setState({isSubmitting:!1})})).catch(i.catchApiError((()=>this.setState({isSubmitting:!1}))))}))},this.handleUnshareFolder=()=>{if(b.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,k.TiburonEventName.AttemptRemoveAllMembers),this.props.sharingInfo.metadata()&&null!=this.props.sharingInfo.metadata().shared_folder_id&&this.props.sharingInfo.permissionsObj().canUnshare()){const e=e=>{i.Snackbar.sync(o.intl.formatMessage({id:"2h4tij",defaultMessage:"Unsharing <st>{folder_name}</st>..."},{st:e=>r.React$1.createElement("strong",null,e),folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)}),!0,"unshare-folder-notification");return this.props.client.unshare({contentId:this.props.sharingInfo.metadata()&&this.props.sharingInfo.metadata().shared_folder_id,leaveACopy:e}).then((()=>{b.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,k.TiburonEventName.SucceedRemoveAllMembers,{http_status_code:200,response_status:"success"}),i.Snackbar.complete(o.intl.formatMessage({id:"tKbyJ8",defaultMessage:"Unshared <st>{folder_name}</st>."},{st:e=>r.React$1.createElement("strong",null,e),folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)}),"unshare-folder-notification"),this.props.actionHandler.refreshSharedWithColumnContentData(),i.Modal.close(),i.dispatcherSingleton.dispatch({type:f.SharePageActionTypes.UNSHARE_FOLDER_SUCCESS,metadata:this.props.sharingInfo.metadata(),user:this.props.user}),xe.emit("onSuccessUnsharing",{isFolder:this.props.sharingInfo.contentInfo().isFolder()})})).catch((e=>(b.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,k.TiburonEventName.FailRemoveAllMembers,{http_status_code:e.raw&&e.raw.status,error_message:e.error[".tag"]?e.error[".tag"]:"undefined_error"}),"too_many_files"===e.error[".tag"]?this.tooManyFilesSnackbar():h.sharingNotificationError(e.message),i.dispatcherSingleton.dispatch({type:f.SharePageActionTypes.UNSHARE_FOLDER_ERROR,metadata:this.props.sharingInfo.metadata(),user:this.props.user}))))};return g.confirmResetAccess({allowLeaveACopy:this.props.sharingInfo.permissionsObj().canLeaveACopy(),contentName:this.props.folderName,isFolder:!0,isNestedSharedFolder:!!this.props.hasParentSharedFolder,onCancel:()=>i.Modal.close(),onConfirm:e})}},this.onSaveSettings=()=>{switch(this.getCurrentTab()){case d.FILE_SETTINGS:return this.saveFileSettings();case d.FOLDER_SETTINGS:return this.saveFolderSettings();case d.EDIT_LINK_SETTINGS:case d.VIEW_LINK_SETTINGS:return this.handleSaveLinkSettings();default:throw new Error("Unknown tab")}},this.onDeleteLink=e=>{this.props.actionHandler.refreshSharedWithColumnLinkData(),this.props.actionHandler.deleteLinkMetadata(e),this.props.onDismiss&&this.props.onDismiss(),this.props.actionHandler.openSharingSettingsModal(this.getCurrentTab())},this.onCancelDeleteLink=()=>{this.props.actionHandler.openSharingSettingsModal(this.getCurrentTab())},this.onUnshare=()=>{this.props.isFolder?this.handleUnshareFolder():this.handleUnshareFile()},this.renderTabGroups=()=>{const e=[];return this.getTabs().forEach((t=>{e.push(r.React$1.createElement(_.Tabs.Tab,{className:"sharing-settings-modal__tabs",id:t.id},t.label))})),r.React$1.createElement(_.Tabs.Group,{justified:!0},e)},this.renderTabPanels=()=>{const e=[];return this.getTabs().forEach((t=>{const s=this.getTabInfo(t.id);e.push(r.React$1.createElement(_.Tabs.Panel,{tabId:t.id},r.React$1.createElement("div",{className:"sharing-settings-modal__banners"},s.banner,s.description),r.React$1.createElement("div",{className:"sharing-settings-modal__tab-content"},s.content)))})),e},this.renderTabs=()=>r.React$1.createElement(_.Tabs,{selectedTab:this.getCurrentTab(),onSelection:this.onTabSelected},this.renderTabGroups(),this.renderTabPanels()),this.render=()=>{return r.React$1.createElement(i.Modal$1,{className:i.cx(this.props.className,"scl-settings-modal"),"aria-label":this.renderTitle(),title:this.renderTitle(),open:!0,isCentered:!0,withCloseButton:"Close",onRequestClose:()=>{i.Modal.close(),this.onAfterModalClose()}},r.React$1.createElement(i.Modal$1.Header,{hasBottomSpacing:"title-standard"},r.React$1.createElement(i.Modal$1.Title,null,this.renderTitle())),r.React$1.createElement(i.Modal$1.Body,{hasVerticalSpacing:!1},this.renderTabs()),r.React$1.createElement(i.Modal$1.Footer,null,this.shouldShowUnshare()?r.React$1.createElement(i.Button$1,{variant:"transparent",onClick:this.onUnshare,"data-testid":"unshare_button"},(e=this.props.isFolder,t=this.props.isFolderInsideTeamFolderTree,e?t?o.intl.formatMessage({id:"11dNm1",defaultMessage:"Reset membership"}):o.intl.formatMessage({id:"qyAR1S",defaultMessage:"Unshare folder"}):o.intl.formatMessage({id:"px+mde",defaultMessage:"Unshare file"}))):void 0,r.React$1.createElement(i.Button$1,{variant:"opacity",onClick:()=>{var e,t;return null===(t=(e=this.props).onDismiss)||void 0===t?void 0:t.call(e,this.getCurrentTab())}},o.intl.formatMessage({id:"pTINM6",defaultMessage:"Cancel"})),this.renderPrimaryAction()));var e,t},this.renderPrimaryAction=()=>r.React$1.createElement(i.Button$1,{className:"confirm-button u-mar-left-s",variant:"primary",disabled:!this.allowSaveSettings()||this.state.isSubmitting,onClick:this.onSaveSettings},this.state.isSubmitting?o.intl.formatMessage({id:"qIDtpl",defaultMessage:"Saving..."}):o.intl.formatMessage({id:"rQzKcA",defaultMessage:"Save"})),this.handlePolicyUpdate=(e,t)=>{this.setState({desiredPolicy:this.state.desiredPolicy.set(e,t)})},this.onTabSelected=e=>{this.setState({currentTab:e}),b.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,k.TiburonEventName.ViewSettingsTab,{settings_tab:e})},this.getCurrentTab=()=>this.state.currentTab||this.getTabs()[0].id,this.handleLinkPolicyUpdate=(e,t)=>{const s=this.state.updatedLinkPolicies;if(s[e.url]=t,this.props.sharingInfo.editRighteousLink()){const e=Te(this.props.sharingInfo.editRighteousLink()).audience;i.isLinkAudienceLowerAccess(t.audience,e)&&this.setState({showDowngradeBanner:!0}),this.setState({showAdvancedSettingsWarning:!!t.expires||!!t.require_password})}this.setState({updatedLinkPolicies:s})},this.hideDowngradeBanner=()=>{this.setState({showDowngradeBanner:!1})},this.openManageAccess=e=>{e.preventDefault(),this.saveAndManageAccess()},this.saveAndManageAccess=()=>{for(const e of this.props.sharingInfo.sharedLinks()){const t=Te(e),s=this.state.updatedLinkPolicies[e.url]||t;t.audience!==s.audience&&b.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,k.TiburonEventName.ChangeSharedLinkAudience,Object.assign({old_audience:t.audience,new_audience:s.audience,screen:k.ScreenName.SettingsScreen},L.buildExtraFromLinkMetadata(e)))}const e=this.getLinkSettingsToUpdate();e.errors||this.setState({isSubmitting:!0},(()=>{this.props.actionHandler.updateLinkSettings(e.requests).then((()=>{this.setState({isSubmitting:!1}),this.props.actionHandler.showScreen(i.MANAGE_SCREEN)})).catch((()=>{this.setState({isSubmitting:!1})}))}))},this.state={currentTab:e.currentTab,isSubmitting:!1,updatedLinkPolicies:{},desiredPolicy:e.currentPolicy,showDowngradeBanner:!1,showAdvancedSettingsWarning:void 0}}componentDidMount(){return a.__awaiter(this,void 0,void 0,(function*(){const e=this.props.sharingInfo.contentInfo();this.setState({isSubmitting:!1}),b.logTiburonEvent(e,this.props.user.id,k.TiburonEventName.ViewSettingsScreen,{settings_tab:this.getCurrentTab()}),b.logTiburonEvent(e,this.props.user.id,k.TiburonEventName.ViewSettingsTab,{settings_tab:this.getCurrentTab()}),b.publishShopModalEvent(i.CampaignEvents.SHARE_MODAL_SETTINGS_OPENED,e,this.props.sharingInfo.getReferrer()),"OFF"!==this.props.sharingPrefs.core_act_docsend_advanced_sharing&&("V1"===this.props.sharingPrefs.core_act_docsend_advanced_sharing&&P.setHasOpenedSharingSettingsInUserMetadata(this.props.user.id),i.logEvent({class:"onboard",action:"shown",object:"core_act_docsend_advanced_sharing_options",properties:{experimentVariant:this.props.sharingPrefs.core_act_docsend_advanced_sharing}}))}))}shouldShowUnshare(){return this.props.sharingInfo.permissionsObj().canUnshare()&&(!this.props.isFolder||!this.props.isInContentManager&&this.props.isSharedFolder)}getLinkSettingsToUpdate(){const e={errors:!1,requests:[]};for(const t of this.props.sharingInfo.sharedLinks()){const s=Te(t),n=this.state.updatedLinkPolicies[t.url],i=Le(t,n||s,s);if(i&&i.settings)e.requests.push(i);else if(null===i){e.errors=!0;break}}return e}tooManyFilesSnackbar(){return i.Snackbar.show(Nt(i.Snackbar,{actionButtonText:o.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),closeButtonText:o.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),onActionClick:()=>i.open_tab("/help/files-folders/unshare-folder#foldersize"),title:o.intl.formatMessage({id:"DWcV9y",defaultMessage:"Unsharing unsuccessful. This folder has too many files."}),variant:"fail"}))}renderTitle(){let e;const t={file_or_folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)};return e=o.intl.formatMessage({id:"NHPru6",defaultMessage:"Settings for “{file_or_folder_name}”"},t),e}handleUnshareFile(){C.logBrowseTTS("unshare_file"),b.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,k.TiburonEventName.AttemptRemoveAllMembers);g.confirmResetAccess({allowLeaveACopy:!1,contentName:this.props.folderName,isFolder:!1,isNestedSharedFolder:!1,onConfirm:()=>(i.Snackbar.sync(o.intl.formatMessage({id:"JopplL",defaultMessage:"Unsharing <st>{file_name}</st>..."},{st:e=>r.React$1.createElement("strong",null,e),file_name:this.props.folderName}),!0,"unshare-file-notification"),this.props.client.unshare({contentId:this.props.sharingInfo.contentId()}).then((()=>{b.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,k.TiburonEventName.SucceedRemoveAllMembers,{http_status_code:200,response_status:"success"});const e=[this.props.sharingInfo.contentId().toString()];i.getStoreForSharedWith().dispatch(i.sharedFileDataOutOfDate(e)),i.Snackbar.complete(o.intl.formatMessage({id:"4fsv5F",defaultMessage:"Unshared <st>{file_name}</st>."},{st:e=>r.React$1.createElement("strong",null,e),file_name:this.props.folderName}),"unshare-file-notification"),i.Modal.close()})).catch((e=>{b.logTiburonEvent(this.props.sharingInfo.contentInfo(),this.props.user.id,k.TiburonEventName.FailRemoveAllMembers,{http_status_code:e.raw&&e.raw.status,error_message:e.error[".tag"]?e.error[".tag"]:"undefined_error"})}))),onCancel:()=>i.Modal.close()})}getTabs(){const e=[];return this.props.currentPolicy&&(this.props.isFolder?e.push({id:d.FOLDER_SETTINGS,label:o.intl.formatMessage({id:"jR9e/q",defaultMessage:"Folder settings"})}):e.push({id:d.FILE_SETTINGS,label:o.intl.formatMessage({id:"TdlC4Q",defaultMessage:"File settings"})})),this.showEditLinkSettingsTab()&&e.push({id:d.EDIT_LINK_SETTINGS,label:o.intl.formatMessage({id:"DIbS2E",defaultMessage:"Link for editing"})}),this.showViewLinkSettingsTab()&&e.push({id:d.VIEW_LINK_SETTINGS,label:o.intl.formatMessage({id:"rvYosE",defaultMessage:"Link for viewing"})}),e}showEditLinkSettingsTab(){return!!this.props.sharingInfo.editRighteousLink()||(this.props.isFolder?this.props.sharingInfo.permissionsObj().canInviteEditor()&&!this.props.isTeamSharedFolder&&!this.props.isInContentManager:!this.props.isInContentManager&&this.props.sharingInfo.permissionsObj().canCreateEditLink())}showViewLinkSettingsTab(){return!this.props.isTeamSharedFolder&&!this.props.isInContentManager}isTeamFolderTree(){return this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree}getFolderSettingsDescription(){let e;if(this.props.sharingInfo.permissionsObj().canChangeOptions()&&!this.props.user.is_team_admin)return e=this.isTeamFolderTree()?o.intl.formatMessage({id:"fYsGwY",defaultMessage:"Only team admins can change these settings."}):this.props.sharingInfo.isOwner()?o.intl.formatMessage({id:"fvfb8u",defaultMessage:"Only the owner (you) can change these settings. Settings apply to all folders in “{folder_name}.”"},{folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)}):o.intl.formatMessage({id:"ZKGUCp",defaultMessage:"Only the owner can change these settings. Settings apply to all folders in “{folder_name}.”"},{folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)}),r.React$1.createElement(E.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"default",message:e})}getFileSettingsDescription(){if(this.props.sharingInfo.permissionsObj().canChangeOptions())return r.React$1.createElement(E.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"default",message:o.intl.formatMessage({id:"JK63j9",defaultMessage:"Anyone with edit access can change these settings."})})}getFileSettingsBanner(){if(this.props.sharingInfo.permissionsObj().canChangeOptions())return;let e;var t,s;return this.props.currentPolicy&&this.props.permissions&&(t=this.props.currentPolicy,s=this.props.permissions,e="enabled"===t.get(d.VIEWER_INFO_POLICY)?s.disable_viewer_info?ye(s.disable_viewer_info.reason):void 0:s.enable_viewer_info?ye(s.enable_viewer_info.reason):void 0),e||(e=o.intl.formatMessage({id:"lxNU0Z",defaultMessage:"You don’t have permission to change the settings on this file."})),r.React$1.createElement(E.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"error",message:e})}shouldRenderContentManagerBridge(){return!this.props.isInContentManager&&(!!v.GoldenGate.hasContentManagerAndSuperAdmin(this.props.user.id)&&(!!this.props.isTeamSharedFolder||!(!this.props.isFolderInsideTeamFolderTree||!this.props.isUserOnOwnerTeam)&&(this.props.currentTab===d.FOLDER_SETTINGS||!this.props.sharingInfo.permissionsObj().canInviteEditor())))}getFolderSettingsBanner(){let e;const t=o.intl.formatMessage({id:"PXwJ3O",defaultMessage:"These settings will apply to all folders inside “{folder_name}”."},{folder_name:this.props.folderName});if(this.props.isInContentManager&&this.isTeamFolderTree())e=t;else if(this.shouldRenderContentManagerBridge()){const t=i.parent_dir(this.props.sharingInfo.fqPath()),s=S.genContentManagerBridgeUri({containingFolder:t,filenameToSelect:this.props.folderName}),n=(o.intl.formatMessage({id:"WWXucR",defaultMessage:"These settings will apply to all folders inside <b>{folder_name}</b>. You can change these settings or manage access in the Admin Console."},{folder_name:this.props.folderName,b:e=>r.React$1.createElement("b",null,e)}),o.intl.formatMessage({id:"+XzGBK",defaultMessage:"These settings will apply to all folders inside “{folder_name}”. You can change these settings in the Admin Console."},{folder_name:this.props.folderName}));e=r.React$1.createElement("div",null,n+" ",r.React$1.createElement("div",null,r.React$1.createElement("a",{href:s.toString(),target:"_blank",rel:"noreferrer"},o.intl.formatMessage({id:"hwq/Wo",defaultMessage:"Go to Admin Console."}))))}else if(this.isTeamFolderTree())e=r.React$1.createElement("div",null,t+" ",r.React$1.createElement("div",null,r.React$1.createElement("a",{href:"/team",target:"_blank"},o.intl.formatMessage({id:"RgAHdC",defaultMessage:"To edit, ask your admin."}))));else{if(this.props.sharingInfo.permissionsObj().canChangeOptions())return this.props.isInContentManager&&!this.isTeamFolderTree()?r.React$1.createElement($e,{isInSharingSettingsModal:!0}):void 0;e=o.intl.formatMessage({id:"7JZv2f",defaultMessage:"Only the owner can change these settings. Settings apply to all folders in “{folder_name}.”"},{folder_name:i.Emstring.em_snippet(this.props.folderName,i.SNIPPET_SIZES.FILENAME)})}return r.React$1.createElement(E.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"error",message:e})}linkControlPolicyWarning(e){const t=this.getCurrentLink(e);if(!t)return;const{link_permissions:s}=t,n=Te(t),i=this.state.updatedLinkPolicies[t.url]||n,a=p.getLinkControlPolicyWarningText(n,i,s,o.intl);return a?r.React$1.createElement(E.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"warn",message:a}):void 0}editFolderLinkSettingWarning(e){if("editor"!==e||!this.props.sharingInfo.isFolder())return;const t=this.getCurrentLink(e);if(t){if(void 0===this.state.showAdvancedSettingsWarning){if(!t.link_permissions.require_password&&!t.expires)return}else if(!this.state.showAdvancedSettingsWarning)return;return r.React$1.createElement(E.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"warn",message:o.intl.formatMessage({id:"NCBSt0",defaultMessage:"This setting won’t apply to people who join this folder to collaborate."}),descriptionLinkUrl:"https://help.dropbox.com/files-folders/share/set-link-permissions",descriptionLinkText:o.intl.formatMessage({id:"TV9B2p",defaultMessage:"Learn More"})})}}getCurrentLink(e){let t;return"editor"===e?t=this.props.sharingInfo.editRighteousLink():(t=this.props.sharingInfo.viewRighteousLink(),t||(t=this.props.sharingInfo.shmodelLink())),t}getLinkSettingsBanner(e){let t=!1;const s=this.getCurrentLink(e);if(!s)return;if(s.isRighteousLink())!1===s.link_permissions.can_use_extended_sharing_controls&&(t=!0);else{const e=s.link_permissions;t=e.audience_options.filter((e=>e.disallowed_reason===i.LinkAudienceDisallowedReason.UserAccountType)).length>0||!1===e.can_disallow_download}if(this.props.sharingInfo&&this.props.sharingInfo.isFamilyUser()&&(t=!1),!t)return;let n,a;1===this.props.user.is_team?(n="/team/upgrade",a=o.intl.formatMessage({id:"TfYT+f",defaultMessage:"Upgrade to {trademark_business} to enable all link settings."},{trademark_business:M.TRADEMARK_BUSINESS})):(n="/upgrade?oqa=sfp&_tk=sg_pro_bundle_header",this.props.sharingInfo&&"OFF"!==this.props.sharingInfo.shareModalUpsellPremiumSharingVariant()&&(n=bt(this.props.user,this.props.sharingInfo.shareModalUpsellPremiumSharingVariant(),"sg_pro_bundle_header")),a=o.intl.formatMessage({id:"VvOgoh",defaultMessage:"Upgrade to Dropbox {trademark_professional} to enable all link settings."},{trademark_professional:M.TRADEMARK_PROFESSIONAL}));const l=r.React$1.createElement("div",null,r.React$1.createElement(kt,{trackingId:"link_settings_pro_upsell",user:this.props.user,contentInfo:this.props.sharingInfo&&this.props.sharingInfo.contentInfo(),href:n,target:"_blank",rel:"noopener noreferrer"},a));return r.React$1.createElement(E.SharingModalBanner,{className:"sharing-settings-modal__banner",type:"default",message:l})}getFolderSettingPolicies(){const e=[];return Boolean(this.props.ownerTeam)&&e.push(d.MEMBER_POLICY),e.push(d.ACL_UPDATE_POLICY),Boolean(this.props.ownerTeam)&&e.push(d.FOLDER_LINK_AUDIENCE_POLICY),this.props.currentPolicy&&(this.props.currentPolicy instanceof i.FilePolicy||this.props.currentPolicy instanceof i.FolderPolicy)&&null!=this.props.currentPolicy.viewer_info_policy&&!this.shouldRenderContentManagerBridge()&&e.push(d.VIEWER_INFO_POLICY),e}getFileSettingPolicies(){const e=[];return this.props.currentPolicy&&(this.props.currentPolicy instanceof i.FilePolicy||this.props.currentPolicy instanceof i.FolderPolicy)&&null!=this.props.currentPolicy.viewer_info_policy&&e.push(d.VIEWER_INFO_POLICY),e}getTabInfo(e){switch(e){case d.FILE_SETTINGS:return{title:o.intl.formatMessage({id:"vTaaOS",defaultMessage:"File settings"}),banner:this.getFileSettingsBanner(),description:this.getFileSettingsDescription(),content:this.getFileFolderSettingsContent(this.getFileSettingPolicies())};case d.FOLDER_SETTINGS:return{title:o.intl.formatMessage({id:"3QmSF8",defaultMessage:"Folder settings"}),banner:this.getFolderSettingsBanner(),description:this.getFolderSettingsDescription(),content:this.getFileFolderSettingsContent(this.getFolderSettingPolicies())};case d.EDIT_LINK_SETTINGS:return{title:o.intl.formatMessage({id:"/0odKW",defaultMessage:"Link for editing"}),banner:this.getLinkSettingsBannerAndWarning("editor"),description:null,content:this.renderLinkSettings("editor")};case d.VIEW_LINK_SETTINGS:return{title:o.intl.formatMessage({id:"O2aovx",defaultMessage:"Link for viewing"}),banner:this.getLinkSettingsBannerAndWarning("viewer"),description:null,content:this.renderLinkSettings("viewer")};default:throw new Error("tabName not found")}}getFileFolderSettingsContent(e){const t=we(this.state.desiredPolicy,this.props.currentPolicy);return r.React$1.createElement(We,{policies:e,policyUpdate:t,isFolder:this.props.isFolder,isTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,ownerTeam:this.props.ownerTeam,onPolicyUpdate:this.handlePolicyUpdate,teamPolicy:this.props.sharingInfo.teamPolicy(),currentPolicy:this.props.currentPolicy,showContentManagerBridge:this.shouldRenderContentManagerBridge(),permissions:this.props.permissions})}renderLinkSettings(e){if(this.props.sharingInfo)return r.React$1.createElement("div",null,this.state.showDowngradeBanner&&this.renderDowngradeBanner(),r.React$1.createElement(It,{client:this.props.client,sharingInfo:this.props.sharingInfo,sharingPrefs:this.props.sharingPrefs,updatedLinkPolicies:this.state.updatedLinkPolicies,onDeleteLink:this.onDeleteLink,onCancelDeleteLink:this.onCancelDeleteLink,onPolicyUpdate:this.handleLinkPolicyUpdate,actionHandler:this.props.actionHandler,accessLevel:e,isLinkVisitor:this.props.isLinkVisitor}))}renderDowngradeBanner(){return r.React$1.createElement(d.SharingModalDowngradeBanner,{header:o.intl.formatMessage(Pt.downgradeBannerHeader),subheader:o.intl.formatMessage(Pt.downgradeBannerSubheader),outlineButtonLabel:o.intl.formatMessage(Pt.downgradeBannerGotIt),transparentButtonLabel:o.intl.formatMessage(Pt.downgradeBannerManageLinks),onClickOutlineButton:this.hideDowngradeBanner,onClickCloseButton:this.hideDowngradeBanner,onClickTransparentButton:this.openManageAccess,showCloseButton:!0})}allowSaveSettings(){return[d.EDIT_LINK_SETTINGS,d.VIEW_LINK_SETTINGS].includes(this.getCurrentTab())?Object.keys(this.state.updatedLinkPolicies).length>0:!this.state.desiredPolicy.equals(this.props.currentPolicy)}getLinkSettingsBannerAndWarning(e){const t=this.linkControlPolicyWarning(e),s=this.editFolderLinkSettingWarning(e),n=this.getLinkSettingsBanner(e);if(s||t||n)return r.React$1.createElement("div",null,s,t,n)}}xt.displayName="SharingSettingsModal";const Pt=o.defineMessages({downgradeBannerHeader:{id:"V2Zurn",defaultMessage:"People who have used this link might still have access"},downgradeBannerSubheader:{id:"rqdCog",defaultMessage:"You can check the list of people with access and remove them."},downgradeBannerGotIt:{id:"YCTkuR",defaultMessage:"Got It"},downgradeBannerManageLinks:{id:"UBFEXr",defaultMessage:"Who still has access?"}}),Ft=i.requireCssWithComponent(xt,["/static/metaserver/static/css/sharing/share_modal-vflClWHjs.css","/static/metaserver/static/css/modal-vflf1hwfZ.css","/static/typescript/component_libraries/spectrum-sharing/src/index.web-vflUPprqa.css"]);class Ot extends r.React$1.Component{constructor(){super(...arguments),this.dismissModal=()=>{i.Modal.close(),this.handleDismissed()},this.handleDismissed=()=>{this.props.onClose&&this.props.onClose()},this.handleNavigateToParentFolder=e=>()=>{i.Modal.close(),this.props.onParentFolderClicked&&this.props.onParentFolderClicked(e.path,this.arePermissionsAllowed(e.permissions))},this.arePermissionsAllowed=e=>e.some((e=>e&&e.allow)),this.getInfoStr=e=>"remove"===this.props.originalAction?o.intl.formatMessage({id:"Wg804T",defaultMessage:"{count, plural, one{To remove them from <b>{content_name}</b>, you'll need to remove them from the parent folder <b>{single_parent_folder_name}</b>.} other{To remove them from <b>{content_name}</b>, you'll need to remove them from the parent folders listed.}}"},Object.assign({count:this.props.memberAccessLevelResult.parentFolders.length},e)):o.intl.formatMessage({id:"u9QEXM",defaultMessage:"{count, plural, one{To change their access to <b>{content_name}</b>, you'll need to change their access to the parent folder <b>{single_parent_folder_name}</b>.} other{To change their access to <b>{content_name}</b>, you'll need to change their access to the parent folders listed.}}"},Object.assign({count:this.props.memberAccessLevelResult.parentFolders.length},e)),this.getSimpleContentInfoStr=e=>"remove"===this.props.originalAction?o.intl.formatMessage({id:"P4ldKD",defaultMessage:"Because they have access to the parent folder, they can't be removed from <b>{content_name}</b>."},e):o.intl.formatMessage({id:"FziuiR",defaultMessage:"Because they can edit the parent folder, their access to <b>{content_name}</b> can't be changed."},e),this.renderParentFolderContent=()=>r.React$1.createElement("div",null,this.getInfoStr({member_name:i.Emstring.em_snippet(this.props.memberDisplayName,i.SNIPPET_SIZES.DISPLAY_NAME),content_name:i.Emstring.em_snippet(this.props.contentInfo.name()||"",i.SNIPPET_SIZES.FILENAME),single_parent_folder_name:i.Emstring.em_snippet(1===this.props.memberAccessLevelResult.parentFolders.length?this.props.memberAccessLevelResult.parentFolders[0].name:"",i.SNIPPET_SIZES.FILENAME),b:e=>r.React$1.createElement("b",null,e)}),r.React$1.createElement("div",{className:"parent-folder-access-modal__folder-list u-mar-top-s"},r.React$1.createElement("ul",{className:"o-list-ui o-list-ui--dividers"},this.props.memberAccessLevelResult.parentFolders.map(this.renderParentFolder)))),this.renderParentFolder=e=>r.React$1.createElement("li",null,r.React$1.createElement("div",{className:"parent-folder-access-modal__parent-folder u-pad-vertical-xs u-pad-horizontal-s",onClick:this.handleNavigateToParentFolder(e)},r.React$1.createElement(F.Flag,{leftAttachment:r.React$1.createElement(O.SharedFolderIcon,null),rightAttachment:this.renderFolderLink(e),spacing:"xs"},r.React$1.createElement("span",{className:"parent-folder-access-modal__folder-name"},i.Emstring.em_snippet(e.name,i.SNIPPET_SIZES.FILENAME))))),this.renderFolderLink=e=>r.React$1.createElement("button",{className:"button-as-link",onClick:this.handleNavigateToParentFolder(e),type:"button"},this.arePermissionsAllowed(e.permissions)?o.intl.formatMessage({id:"IyoET0",defaultMessage:"Manage access"}):o.intl.formatMessage({id:"D3p2Rv",defaultMessage:"View folder"})),this.renderSimpleContent=()=>r.React$1.createElement("div",null,r.React$1.createElement("span",{className:"parent-folder-access-modal__warning"},this.getSimpleContentInfoStr({content_name:i.Emstring.em_snippet(this.props.contentInfo.name()||"",i.SNIPPET_SIZES.FILENAME),b:e=>r.React$1.createElement("b",null,e)})),r.React$1.createElement("div",{className:"u-mar-top-m clearfix"},r.React$1.createElement("div",{className:"u-l-fr"},r.React$1.createElement("button",{className:"c-btn c-btn--primary confirm-button",onClick:this.dismissModal},o.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}))))),this.getTitleStr=()=>"remove"===this.props.originalAction?this.displayParentFolderContent()?o.defineMessage({id:"W05Pm/",defaultMessage:"Couldn't remove {member_name}"}):o.defineMessage({id:"pE8z12",defaultMessage:"Can't remove {member_name}"}):this.displayParentFolderContent()?o.defineMessage({id:"o9ZIdD",defaultMessage:"Couldn't change access for {member_name}"}):o.defineMessage({id:"PR8RwD",defaultMessage:"Can't change access for {member_name}"}),this.displayParentFolderContent=()=>this.props.memberAccessLevelResult.parentFolders&&!this.props.isInContentManager}render(){const e=this.getTitleStr();return r.React$1.createElement(i.Modal,{autoClose:!1,className:"parent-folder-access-modal",buttonComponent:r.React$1.createElement("span",null),onDismissCompleted:this.handleDismissed,title:o.intl.formatMessage(e,{member_name:i.Emstring.em_snippet(this.props.memberDisplayName,i.SNIPPET_SIZES.DISPLAY_NAME)})},r.React$1.createElement("div",{className:"parent-folder-access-modal__contents"},this.displayParentFolderContent()?this.renderParentFolderContent():this.renderSimpleContent()))}}Ot.displayName="ParentFolderAccessModal";const Dt=(e,t,s,n)=>{i.catchApiError((()=>(s&&s(),i.Snackbar.close(n),e instanceof i.ServerError?i.Snackbar.fail(t):i.Modal.close(),N.Notify.error(e.message||o.intl.formatMessage({id:"EQfnGr",defaultMessage:"We were unable to complete your request."})),e)))(e)};class $t{constructor(e,t,s,n){this.initialIsConfidentialFolder=e,this.teamName=s,this.folderName=i.filename(t),this.parentFolderName=n,this.topMostLevelFolder=""===n,this.folderSnippet=i.Emstring.em_snippet(this.folderName,15),this.parentFolderSnippet=i.Emstring.em_snippet(this.parentFolderName,15),this.teamSnippet=i.Emstring.em_snippet(this.teamName,i.SNIPPET_SIZES.DISPLAY_NAME)}getActionString(){const e=i.Emstring.em_snippet(this.teamName,i.SNIPPET_SIZES.DISPLAY_NAME),t=this.topMostLevelFolder?o.intl.formatMessage({id:"xbrdNQ",defaultMessage:"Share with {team_name}"},{team_name:e}):o.intl.formatMessage({id:"CcpVyl",defaultMessage:"Share"});return this.initialIsConfidentialFolder?t:o.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"})}getTitleContent(){let e;return e=this.initialIsConfidentialFolder?this.topMostLevelFolder?o.intl.formatMessage({id:"XmdmiQ",defaultMessage:"Share “{folder_name}” with everyone at {team_name}?"},{folder_name:this.folderSnippet,team_name:this.teamSnippet}):o.intl.formatMessage({id:"o2uL8S",defaultMessage:"Share “{folder_name}” with everyone who can access “{parent_folder_name}”?"},{folder_name:this.folderSnippet,parent_folder_name:this.parentFolderSnippet}):this.topMostLevelFolder?o.intl.formatMessage({id:"fYJ2Zy",defaultMessage:"Remove members of {team_name}?"},{team_name:this.teamSnippet}):o.intl.formatMessage({id:"qioX4z",defaultMessage:"Remove members of “{folder_name}” folder?"},{folder_name:this.parentFolderSnippet}),e}getBodyContent(){let e;return e=this.initialIsConfidentialFolder?this.topMostLevelFolder?o.intl.formatMessage({id:"+yGlTj",defaultMessage:"<strong>{folder_name}</strong> won’t be shared privately any more. Everyone at {team_name} will have access to this folder."},{team_name:this.teamSnippet,folder_name:this.folderSnippet,strong:e=>r.React$1.createElement("strong",{style:{fontWeight:500}},e)}):o.intl.formatMessage({id:"qc2+KU",defaultMessage:"Everyone who can access <strong>{parent_folder_name}</strong> will be able to access this folder."},{parent_folder_name:this.parentFolderSnippet,strong:e=>r.React$1.createElement("strong",{style:{fontWeight:500}},e)}):this.topMostLevelFolder?o.intl.formatMessage({id:"EFGwFd",defaultMessage:"Members of {team_name} won’t be able to access <strong>{folder_name}</strong>."},{team_name:this.teamSnippet,folder_name:this.folderSnippet,strong:e=>r.React$1.createElement("strong",{style:{fontWeight:500}},e)}):o.intl.formatMessage({id:"8x9N0T",defaultMessage:"Members of <strong>{parent_folder_name}</strong> folder won’t be able to access <strong>{folder_name}</strong>."},{parent_folder_name:this.parentFolderSnippet,folder_name:this.folderSnippet,strong:e=>r.React$1.createElement("strong",{style:{fontWeight:500}},e)}),r.React$1.createElement("div",null,r.React$1.createElement("div",{className:"confirmation-modal__content"},e),r.React$1.createElement("br",null))}syncSnackMessage(e){return e?o.intl.formatMessage({id:"YFmCHZ",defaultMessage:"Removing members from <strong>{folder_name}</strong>…"},{folder_name:this.folderSnippet,strong:e=>r.React$1.createElement("strong",{style:{fontWeight:500}},e)}):this.topMostLevelFolder?o.intl.formatMessage({id:"4xzuPe",defaultMessage:"Sharing <strong>{folder_name}</strong> with everyone…"},{folder_name:this.folderSnippet,strong:e=>r.React$1.createElement("strong",{style:{fontWeight:500}},e)}):o.intl.formatMessage({id:"DI9fEf",defaultMessage:"Sharing <strong>{folder_name}</strong> with members of <strong>{parent_folder_name}</strong>…"},{folder_name:this.folderSnippet,parent_folder_name:this.parentFolderSnippet,strong:e=>r.React$1.createElement("strong",{style:{fontWeight:500}},e)})}completeSnackMessage(e){return e?o.intl.formatMessage({id:"r445sC",defaultMessage:"Members removed from <strong>{folder_name}</strong>."},{folder_name:this.folderSnippet,strong:e=>r.React$1.createElement("strong",{style:{fontWeight:500}},e)}):this.topMostLevelFolder?o.intl.formatMessage({id:"a5EQjJ",defaultMessage:"<strong>{folder_name}</strong> shared with everyone."},{folder_name:this.folderSnippet,strong:e=>r.React$1.createElement("strong",{style:{fontWeight:500}},e)}):o.intl.formatMessage({id:"67McYW",defaultMessage:"<strong>{folder_name}</strong> shared with members of <strong>{parent_folder_name}</strong>."},{folder_name:this.folderSnippet,parent_folder_name:this.parentFolderSnippet,strong:e=>r.React$1.createElement("strong",{style:{fontWeight:500}},e)})}failSnackMessage(e){return e?o.intl.formatMessage({id:"otsE6R",defaultMessage:"Too many members to restrict access. Try adding specific people to a new folder."}):o.intl.formatMessage({id:"Z4c55e",defaultMessage:"Couldn’t share folder. Try sharing again."})}}class Bt{constructor(e,t,s,n,i,a,l){this.getButtonText=()=>this.isDowngrading?o.intl.formatMessage({id:"/sfVvH",defaultMessage:"Change access"}):this.isTsdPlusOne?o.intl.formatMessage({id:"g7vg1d",defaultMessage:"Remove everyone"}):o.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"}),this.getConfirmModalTitleString=()=>this.isRelinquishment?o.intl.formatMessage({id:"amnrJj",defaultMessage:"Remove yourself from “{parent_folder}”?"},{parent_folder:this.parentFolderName}):this.isDowngrading?o.intl.formatMessage({id:"x01mJ5",defaultMessage:"Change how members can access “{current_folder}”?"},{current_folder:this.currentFolderName}):this.isTsdPlusOne?o.intl.formatMessage({id:"sSJ+PD",defaultMessage:"Remove everyone at {team_name}?"},{team_name:this.teamName}):o.intl.formatMessage({id:"F23jdQ",defaultMessage:"Remove a member of “{parent_folder}”?"},{parent_folder:this.parentFolderName}),this.getConfirmModalContent=()=>{const e={member_name:this.memberName,parent_folder:this.parentFolderName,current_folder:this.currentFolderName,team_name:this.teamName,b:e=>r.React$1.createElement("b",{style:{fontWeight:500}},e),br:r.React$1.createElement("br",null)};let t;return t=this.isRelinquishment?o.defineMessage({id:"hfMe4J",defaultMessage:"You won’t be able to see future changes to this shared folder, and new members of <b>{parent_folder}</b> won’t have access to this folder automatically."}):this.isTsdPlusOne?this.isDowngrading?o.defineMessage({id:"xO44hJ",defaultMessage:"{member_name} will only be able to view this folder, and new {team_name} members won’t be able to access it automatically.{br}{br}To add more people to this folder in the future, you’ll need to invite them directly."}):o.defineMessage({id:"8bNVGs",defaultMessage:"{team_name} members won’t be able to see future changes to <b>{current_folder}</b> automatically.{br}{br}To give people access to this folder in the future, you’ll need to invite them directly."}):this.isDowngrading?o.defineMessage({id:"eo+uWg",defaultMessage:"{member_name} will only be able to view this folder, and new members of <b>{parent_folder}</b> won’t be able to access it automatically.{br}{br}To add more people to this folder in the future, you’ll need to invite them directly."}):o.defineMessage({id:"zDnrtL",defaultMessage:"{member_name} and new members of the <b>{parent_folder}</b> folder won’t be able to see future changes to this shared folder.{br}{br}To add more people to this folder in the future, you’ll need to invite them directly."}),o.intl.formatMessage(t,e)},this.getSnackBarRemovingString=()=>{const e={b:e=>r.React$1.createElement("b",{style:{fontWeight:500}},e),current_folder:this.currentFolderName},t=this.isDowngrading?o.defineMessage({id:"0Lmb+Y",defaultMessage:"Changing access for <b>{current_folder}</b>…"}):this.memberIsGroup?o.defineMessage({id:"hpOZFA",defaultMessage:"Removing members from <b>{current_folder}</b>…"}):o.defineMessage({id:"tbN3jw",defaultMessage:"Removing member from <b>{current_folder}</b>…"});return o.intl.formatMessage(t,e)},this.getSnackBarCompleteString=()=>{const e={b:e=>r.React$1.createElement("b",{style:{fontWeight:500}},e),current_folder:this.currentFolderName},t=this.isDowngrading?o.defineMessage({id:"srndH4",defaultMessage:"Access changed for <b>{current_folder}</b>."}):this.memberIsGroup?o.defineMessage({id:"bnI+zs",defaultMessage:"Members removed from <b>{current_folder}</b>."}):o.defineMessage({id:"GWzQpn",defaultMessage:"Member removed from <b>{current_folder}</b>."});return o.intl.formatMessage(t,e)},this.getSnackBarFailString=()=>this.isDowngrading?o.intl.formatMessage({id:"5Yzfj9",defaultMessage:"Couldn’t change access. Try changing access again."}):this.memberIsGroup?o.intl.formatMessage({id:"NCQATi",defaultMessage:"Couldn’t remove members. Try removing them again."}):o.intl.formatMessage({id:"jHXRss",defaultMessage:"Couldn’t remove member. Try removing them again."}),this.isDowngrading=e,this.teamName=t,this.parentFolderName=s,this.currentFolderName=n,this.memberName=i,this.isTsdPlusOne=""===s,this.memberIsGroup=a,this.isRelinquishment=l}}i.injectInternalStyle("metaserver/static/js/sharing/views/inherited_members.module.out.css",(e=>"._inherited-members-modal-overlay_1sp0k_1{z-index:501}"));const Ut="_inherited-members-modal-overlay_1sp0k_1";class Ht extends r.React$1.Component{constructor(e){super(e),this.onToggleShowMemberList=()=>{0!==this.props.members.length&&this.setState({areMembersExpanded:!this.state.areMembersExpanded})},this.handleToggleInheritanceClick=e=>{this.props.actionHandler.handleSetConfidentialClick(!1,this.props.ownerTeamName)},this.state={areMembersExpanded:!1}}renderMembersList(){return this.state.areMembersExpanded?r.React$1.createElement("div",null,r.React$1.createElement("div",{className:"u-mar-top-xs u-mar-horizontal-xs u-pad-top-xs inherited-member-list__divider"}),r.React$1.createElement("div",null,r.React$1.createElement("ul",{className:"u-pad-horizontal-s u-pad-vertical-xs inherited-member-list__member"},this.props.children))):void 0}renderRemoveButton(){return this.props.canUpdateConfidentiality?r.React$1.createElement(i.Button,{className:"inherited-member-list__remove-button button-as-link",onClick:this.handleToggleInheritanceClick,variant:"styleless"},o.intl.formatMessage({id:"aPhz2c",defaultMessage:"Remove"})):void 0}renderTriangle(){return 0===this.props.members.length?r.React$1.createElement("div",{className:"u-pad-horizontal-xs"}):r.React$1.createElement(i.Button,{className:"u-pad-horizontal-xxs o-flag__fix inherited-member-list__triangle button-as-link",onClick:this.onToggleShowMemberList,variant:"styleless"},r.React$1.createElement(i.Sprite,{alt:o.intl.formatMessage({id:"Bcpu+z",defaultMessage:"Toggle whether inherited members are displayed or hidden"}),group:"web",name:this.state.areMembersExpanded?"triangle_open_1x":"triangle_closed_1x"}))}render(){const e=this.props.actionHandler.getSharingInfo().parentFolderName(),t=""===e?o.intl.formatMessage({id:"6fi/fQ",defaultMessage:"Everyone at {team_name}"},{team_name:i.Emstring.em_snippet(this.props.ownerTeamName,i.SNIPPET_SIZES.DISPLAY_NAME)}):o.intl.formatMessage({id:"U5hJI+",defaultMessage:"People with access to “{folder_name}” folder"},{folder_name:i.Emstring.em_snippet(e,i.SNIPPET_SIZES.FILENAME)});let s=0,n=null;this.props.memberCounts&&(n=this.props.contentInfo.isSharedFolder()?this.props.memberCounts.total_unique_inherited_members:this.props.memberCounts.total_unique_users),null!=n&&0!==n?s=n:this.props.members.forEach((e=>{e instanceof i.GroupMembershipInfo?s+=e.member_count:s++}));const a=o.intl.formatMessage({id:"ECZFz/",defaultMessage:"{count, plural, one{{count} member} other{{count} members}}"},{count:s}),l=i.cx([{"u-mar-bottom-xs":!0,"inherited-member-list__outer-expanded":this.state.areMembersExpanded,"inherited-member-list__outer-closed":!this.state.areMembersExpanded,"inherited-member-list__outer-spectrum":!0}]),c=i.cx([{"inherited-member-list__inner":!this.state.areMembersExpanded}]);return r.React$1.createElement("div",{className:l},r.React$1.createElement("div",{className:c},r.React$1.createElement("div",{className:"o-flag inherited-member-list__toggle-show-member",onClick:this.onToggleShowMemberList},this.renderTriangle(),r.React$1.createElement("div",{className:"o-flag__flex u-pad-vertical-xs u-pad-right-s"},r.React$1.createElement("div",{className:"o-flag"},r.React$1.createElement("div",{className:"o-flag__fix"},r.React$1.createElement(i.IconContent,{name:"folder_shared-small"})),r.React$1.createElement("div",{className:"o-flag__flex u-pad-left-s"},r.React$1.createElement("div",{className:"inherited-member-list__member-str u-font-strong"},t),r.React$1.createElement("div",{className:"inherited-member-list__member-count-str u-font-meta"},a)),r.React$1.createElement("div",{className:"o-flag__fix u-pad-right-xxs"},this.renderRemoveButton())))),r.React$1.createElement("div",null,this.renderMembersList())))}}Ht.displayName="InheritedMembers";class Vt extends r.React$1.Component{constructor(e){super(e),this.onConfirm=()=>{this._onToggleConfidentialFolder(!1),this.props.onClose()},this.state={isAccepting:!1};const t=e.actionHandler.getSharingInfo().displayPath(),s=e.actionHandler.getSharingInfo().parentFolderName();this.contentGenerator=new $t(e.initialIsConfidentialFolder,t,e.teamName,s)}_onToggleConfidentialFolder(e){const t=!e,s=e===this.props.initialIsConfidentialFolder;e||this.setState({isAccepting:!0});const{actionHandler:n,contentInfo:a}=this.props;i.Snackbar.sync(this.contentGenerator.syncSnackMessage(s),!0,"share-folder-notification");const l=a.isSharedFolder();return n.handleSetConfidential(s).then((e=>{n.fetchDataAndShowShareModal(),s&&i.WebUserActionLog.log(this.props.userId,t?i.WebUserActionLogEvent.CONF_BY_MANAGE_ACCESS:i.WebUserActionLogEvent.CONF_BY_UNDO_AFTER_RESTORE_ACCESS,{ns_id:e.shared_folder_id,original_folder_type:l?i.WebUserActionLogExtraValue.SHARED_FOLDER:i.WebUserActionLogExtraValue.FILE_FOLDER})})).then((()=>{const e=this.contentGenerator.completeSnackMessage(s);t?i.Snackbar.show(r.React$1.createElement(i.Snackbar,{title:e,timeoutDelayMs:1e4,actionButtonText:o.intl.formatMessage({id:"OfxyEk",defaultMessage:"Undo"}),onActionClick:()=>this._onToggleConfidentialFolder(!0),closeButtonText:o.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),variant:"complete",id:"share-folder-notification"})):i.Snackbar.complete(e,"share-folder-notification")})).catch((e=>Dt(e,this.contentGenerator.failSnackMessage(s),(()=>this.setState({isAccepting:!1})),"share-folder-notification")))}render(){return r.React$1.createElement(i.Modal$1,{"aria-label":this.contentGenerator.getTitleContent(),onRequestClose:this.props.onClose,overlayClassName:Ut,open:!0},r.React$1.createElement(i.Modal$1.Header,{hasBottomSpacing:"title-standard"},r.React$1.createElement(i.Modal$1.Title,null,this.contentGenerator.getTitleContent())),r.React$1.createElement(i.Modal$1.Body,null,this.contentGenerator.getBodyContent()),r.React$1.createElement(i.Modal$1.Footer,null,r.React$1.createElement(i.Button$1,{"data-testid":"cancel-button",variant:"opacity",onClick:this.props.onClose},o.intl.formatMessage({id:"euRey+",defaultMessage:"Cancel"})),r.React$1.createElement(i.Button$1,{"data-testid":"confirm-button",variant:"primary",onClick:this.onConfirm},this.contentGenerator.getActionString())))}}Vt.displayName="SetInheritedMembersUIConfidentialModal";class Gt extends r.React$1.Component{constructor(e){super(e),this.onConfirm=()=>{this.changeConfidentialAccess(),this.props.actionHandler.openShareModal()},this.actionCompleteCallback=()=>{const{actionHandler:e}=this.props;h.sharingNotificationSuccess(this.contentGenerator.getSnackBarCompleteString()),this.setState({removing:!1}),e.fetchDataAndShowShareModal()},this.removeTheSelectedMember=()=>{const{member:e,actionHandler:t,isUserSelf:s}=this.props,n=t.getContentInfo().id;return s?t.relinquishMembershipSimple(n,!1):t.removeMemberSimple(n,e.memberId(),!1)},this.changeAccessOfSelectedMember=()=>{const{newAccessLevel:e,actionHandler:t,member:s}=this.props,n=e;return t.changeMemberAccessSimple(t.getContentInfo().id,s.memberId(),n)},this.changeConfidentialAccess=()=>{const{actionHandler:e,userId:t,isSharedFolder:s,isDowngrading:n}=this.props;this.setState({removing:!0});return e.shareIfFileFolder(this.contentGenerator.getSnackBarRemovingString()).then((()=>e.handleSetConfidential(!0,!0).then((()=>this.logWebUserAction(t,n,e.getContentInfo().id,s))))).then((()=>n?this.changeAccessOfSelectedMember():this.removeTheSelectedMember())).then(this.actionCompleteCallback).catch((e=>Dt(e,this.contentGenerator.getSnackBarFailString(),(()=>this.setState({removing:!1})))))},this.state={removing:!1};const{member:t,teamName:s,parentFolderName:n,currentFolderName:a,isDowngrading:r,isUserSelf:o}=this.props;this.contentGenerator=new Bt(r,s,n,a,t.displayName()||"",t instanceof i.GroupMembershipInfo,o)}render(){return r.React$1.createElement(i.Modal$1,{"aria-label":this.contentGenerator.getConfirmModalTitleString(),onRequestClose:this.props.actionHandler.openShareModal,overlayClassName:Ut,open:!0},r.React$1.createElement(i.Modal$1.Header,{hasBottomSpacing:"title-standard"},r.React$1.createElement(i.Modal$1.Title,null,this.contentGenerator.getConfirmModalTitleString())),r.React$1.createElement(i.Modal$1.Body,null,this.renderBody()),r.React$1.createElement(i.Modal$1.Footer,null,r.React$1.createElement(i.Button$1,{"data-testid":"cancel-button",variant:"opacity",onClick:this.props.actionHandler.openShareModal},o.intl.formatMessage({id:"euRey+",defaultMessage:"Cancel"})),r.React$1.createElement(i.Button$1,{"data-testid":"confirm-button",variant:"primary",onClick:this.onConfirm},this.contentGenerator.getButtonText())))}renderBody(){return r.React$1.createElement("div",null,r.React$1.createElement("div",{className:"confirmation-modal__content"},this.contentGenerator.getConfirmModalContent()),r.React$1.createElement("br",null))}logWebUserAction(e,t,s,n){i.WebUserActionLog.log(e,t?i.WebUserActionLogEvent.CONF_BY_DOWNGRADE_MEMBER:i.WebUserActionLogEvent.CONF_BY_REMOVE_MEMBER,{ns_id:s,original_folder_type:n?i.WebUserActionLogExtraValue.SHARED_FOLDER:i.WebUserActionLogExtraValue.FILE_FOLDER})}}Gt.displayName="SingleInheritedUserAccessChangeModal";const Wt={state:D.ContactTokenState.invalid,msg:b.CONTACT_ERROR_MESSAGES.SINGLE_INVALID};class Kt{constructor(e){this.validationStopWatchName="async_contact_server_side_validation",this.client=e,i.JSStopwatch.create_stopwatch_if_not_exist(this.validationStopWatchName)}validate(e,t,s,n,r){return a.__awaiter(this,void 0,void 0,(function*(){const a={};r.filter((e=>e.invalid)).forEach((e=>a[e.getKey()]=Wt));const o=r.filter((e=>!e.invalid));if(0===o.length)return a;const l=i.JSStopwatch.startSpan("validation",{stopwatchName:this.validationStopWatchName,async:!0});let c;try{b.logTiburonEvent(s,e,k.TiburonEventName.AttemptTargetValidation),c=yield this.client.validateMembers({contentId:t,accessLevel:n,members:i.contactsToMembers(o,!0)})}catch(t){b.logTiburonEvent(s,e,k.TiburonEventName.FailTargetValidation,{error:t.error?t.error[".tag"]:"unknown server error"});let n=[];try{n=o.map((e=>{const t=e.getContactID()||"";return{mtype:i.contactToMember(e,!0)[".tag"],ctype:e.type,value:`${t.slice(0,1)}__${t.slice(-3)}`,valLen:t.length}}))}catch(e){}A.reportStack("server error in contact validation",{severity:T.SEVERITY.NONCRITICAL,tags:["sharing"],exc_extra:{contactsDebug:n}})}if(!c)return a;b.logTiburonEvent(s,e,k.TiburonEventName.SucceedTargetValidation);const{results:d}=c,h={};return r.forEach((e=>{h[this.selectorToScalarKey(i.contactToMember(e,!0))]=e.getKey()})),d.forEach((e=>{const t=h[this.selectorToScalarKey(e.member)],s=e.target_invite_eligibility;a[t]=Object.assign(Object.assign({},this.calculateValidation(e.result)),{inviteAfterSharingEligibility:s})})),i.JSStopwatch.endSpan("validation",{stopwatchName:this.validationStopWatchName,spanId:l}),setTimeout((()=>i.JSStopwatch.flush_current_data()),0),a}))}selectorToScalarKey(e){const t=e[".tag"];return`${t}-${c.get(e,t)}`}calculateValidation(e){const t=e[".tag"];switch(t){case"allowed":const s=e.allowed[".tag"];switch(s){case"no_warning":return{state:D.ContactTokenState.ok,msg:null};case"outside_of_team":return{state:D.ContactTokenState.warn,msg:b.CONTACT_ERROR_MESSAGES.OUT_OF_TEAM};case"not_dropbox_user":return{state:D.ContactTokenState.warn,msg:"NOT_DROPBOX_USER"};default:return A.reportStack("New allowed warning type without handling",{tags:["sharing"],severity:T.SEVERITY.CRITICAL,exc_extra:{warning:s}}),{state:D.ContactTokenState.ok,msg:null}}case"disallowed":const n=e.disallowed[".tag"];switch(n){case"invalid_member":return{state:D.ContactTokenState.invalid,msg:b.CONTACT_ERROR_MESSAGES.SINGLE_INVALID};case"outside_of_team":return{state:D.ContactTokenState.invalid,msg:b.CONTACT_ERROR_MESSAGES.OUT_OF_TEAM};case"target_is_individual":return{state:D.ContactTokenState.invalid,msg:b.CONTACT_ERROR_MESSAGES.NONGROUP_INVITEE};case"no_permission":return{state:D.ContactTokenState.invalid,msg:b.CONTACT_ERROR_MESSAGES.NO_PERMISSION};default:return A.reportStack("New disallowed error type without handling",{tags:["sharing"],severity:T.SEVERITY.CRITICAL,exc_extra:{error:n}}),{state:"invalid",msg:b.CONTACT_ERROR_MESSAGES.NO_PERMISSION}}default:const i="Unpredicted state in client validation API response";throw A.reportStack(i,{tags:["sharing"],severity:T.SEVERITY.CRITICAL,exc_extra:{state:t}}),new Error(i)}}}const zt="sharing-notification";var qt;!function(e){e.RECORD_VIDEO_SNACKBAR_SHOWN="pg_snackbar_record_video_view",e.RECORD_VIDEO_SNACKBAR_TRY_CLICK="pg_snackbar_record_video_click",e.RECORD_VIDEO_SNACKBAR_DISMISS_CLICK="pg_snackbar_record_video_dismiss"}(qt||(qt={}));const jt="capture-record-video-menu-button",Yt=e=>{i.ProEventsLogger.log(qt.RECORD_VIDEO_SNACKBAR_TRY_CLICK,{user_id:e.userId});const t=document.getElementById(jt);t&&t.click(),i.Snackbar.close(zt)},Zt=()=>({name:"capture_record_video",icon:i.VideoLine,text:o.intl.formatMessage({id:"rzdYhe",defaultMessage:"Add commentary with video"}),onClick:Yt,dataUxaLog:"post_share_snackbar_record_video_click"}),Qt="sharing-notification";var Jt;!function(e){e.ESIGN_SNACKBAR_SHOWN="pg_snackbar_esign_view",e.ESIGN_SNACKBAR_TRY_CLICK="pg_snackbar_esign_click",e.ESIGN_SNACKBAR_DISMISS_CLICK="pg_snackbar_esign_dismiss"}(Jt||(Jt={}));const Xt=t=>{return Promise.all([new Promise((function(t,s){e(["./c_integrations_hellosign_deep_integration_launcher"],t,s)})),(s=t,a.__awaiter(void 0,void 0,void 0,(function*(){const{userId:e,filePath:t}=s,n=new i.UserApiV2Client;try{return(yield n.ns("files").rpc("get_metadata",{path:t},{subjectUserId:e})).id}catch(e){return A.reportException({err:new Error("Failed to get file id"),severity:T.SEVERITY.CRITICAL,exc_extra:{e:e},tags:["rich_snackbar","product-growth","post-sharing-eisgn-rich-snackbar"]}),Promise.reject(e)}})))]).then((([{getLauncher:e},s])=>{const{userId:n,filePath:a}=t;i.ProEventsLogger.log(Jt.ESIGN_SNACKBAR_TRY_CLICK,{user_id:n});const r=e();return r.init({entryPoint:"post_sharing_snackbar",file:{file_id:s,fq_path:a},source:"dropbox-file-hover-overflow-menu-send-for-esign"}),r})).then((e=>(e.launch(),e))).finally((()=>{i.Snackbar.close(Qt)}));var s},es=(e,t,s,n,a,l,c,d)=>{i.Snackbar.close(Qt);let h=l?void 0:o.intl.formatMessage({id:"ACOoAR",defaultMessage:"Did you know you can get this file signed, right in Dropbox?"});const p=o.intl.formatMessage({id:"NAMRb1",defaultMessage:"Send for signature"}),u=[{name:"send_for_signature",icon:i.SendLine,text:p,onClick:Xt,dataUxaLog:"post_share_snackbar_esign_click"}];return c&&(u.push(Zt()),h=void 0),r.React$1.createElement(i.Snackbar,{title:t,id:Qt,variant:"complete",onCloseClick:()=>{d(),i.ProEventsLogger.log(Jt.ESIGN_SNACKBAR_DISMISS_CLICK,{user_id:n})},onShown:()=>{i.ProEventsLogger.log(Jt.ESIGN_SNACKBAR_SHOWN,{user_id:n})},richSnackbarProps:{actionBarAlignment:"left",actions:u,helperText:h,clickHandlerArgs:{userId:n,filePath:s||e,ns_id:a}}})};function ts(e,t){return e.filter((e=>void 0!==e.email)).map((e=>({email:e.email,checkForInvite:t})))}function ss(e){return["member_invite_expand_eligibility","member_suggestion_expand_eligibility"].includes(e)}function ns(e){return e.formatMessage({id:"K/i5x+",defaultMessage:"Password required"})}function is(e,t){const s=function(e){const t=e.expires?e.expires.getTime():0,s=864e5;if(null!=e.expires){let e=t-(new Date).getTime();return e<0&&(e=0),Math.floor(e/s)}return-1}(t);return e.formatMessage({id:"fp7TGs",defaultMessage:"{count, plural, one{Expires in a day} other{Expires in {count} days}}"},{count:s})}function as(e,t){const s=[],n=p.getAudienceForLink(t.link_permissions),i=t.link_permissions.require_password||"password"===n,a=t.expires,r=!t.link_permissions.allow_download;return i&&s.push(ns(e)),a&&s.push(is(e,t)),r&&s.push(function(e){return e.formatMessage({id:"KjJiVt",defaultMessage:"Download disabled"})}(e)),s}class rs extends r.reactExports.Component{render(){return this.shouldRenderCopyLinkEducationTooltip()?r.reactExports.createElement(i.Tooltip,{triggerRef:this.props.linkRef,placement:"top",className:"scl-copy-link-education-tooltip",title:this.renderLinkSettingsTooltipContent()},this.props.children):this.props.children}renderLinkSettingsTooltipContent(){const e=as(this.props.intl,this.props.sharedLink),t=e.length;return r.reactExports.createElement(r.reactExports.Fragment,null,this.props.intl.formatMessage({id:"LLktNG",defaultMessage:"Link settings:"}),t>1?this.renderListOfSettings(e):this.renderOneSetting(e))}renderOneSetting(e){return r.reactExports.createElement(r.reactExports.Fragment,null," ",r.reactExports.createElement("span",null,e[0]))}renderListOfSettings(e){const t=[];return e.forEach((e=>{t.push(r.reactExports.createElement("li",null,e))})),r.reactExports.createElement(r.reactExports.Fragment,null,r.reactExports.createElement("ul",null,t))}shouldRenderCopyLinkEducationTooltip(){return as(this.props.intl,this.props.sharedLink).length>0}}rs.displayName="CopyLinkEducationTooltip";const os=r.React$1.createContext({logEvent:()=>{},experiments:{}}),ls=e=>{const t=r.React$1.useMemo((()=>({logEvent:e.logEvent,experiments:e.experiments})),[e.logEvent,e.experiments]);return r.React$1.createElement(os.Provider,{value:t},e.children)};ls.displayName="ShareModalEvolutionContextProvider";const cs=e=>{const t=e.getSharingInfo();return t&&t.sharingPrefs?t.sharingPrefs().core_act_docsend_advanced_sharing:"OFF"},ds="share-modal-evolution-share-screen",hs=()=>{const e=document.createElement("input");e.value="sharing is caring",document.body.appendChild(e),e.select();const t=document.queryCommandEnabled("copy");return document.body.removeChild(e),t};class ps extends r.React$1.Component{constructor(e){super(e),this.linkRef=r.React$1.createRef(),this.handleCopyLinkClicked=e=>{e.preventDefault();const t=this.props.getEmailTokenCountFn();this.context.logEvent(k.TiburonEventName.CopySharedLink,this.props.sharedLink,{tokenized_contact_count:t}),R.copyToClipboard(this.props.sharedLink.url,(()=>this.handleClipboardSuccess()),(()=>this.copyLinkToClipboardRetryUsingNativeAPI()))},this.renderCopyLink=e=>r.React$1.createElement("div",{className:"sharing-modal-footer-link-div"},r.React$1.createElement(rs,{key:"copy-link-education-tooltip",intl:o.intl,sharedLink:this.props.sharedLink,linkRef:this.linkRef},r.React$1.createElement(i.Text,{size:this.props.size},r.React$1.createElement(i.Link,{key:"linkCopyToClipboard",href:"#",hasNoUnderline:!0,className:"copy-link-button",onClick:this.handleCopyLinkClicked,isBold:!0,ref:this.linkRef,"data-uxa-log":"sharing-modal-footer-copy-link"},r.React$1.createElement(i.UIIcon,{src:i.LinkLine,size:this.props.size,"aria-label":""}),e))),this.renderBanner()),this.renderBanner=()=>{const e=this.getLinkRestrictions();return e?r.React$1.createElement(i.Text,{color:"faint"},r.React$1.createElement("span",{className:"sharing-modal-footer-link-margin"},e),r.React$1.createElement("span",{className:"sharing-modal-footer-restrictions-margin"},"·"),r.React$1.createElement(i.Link,{className:"sharing-modal-footer-restrictions-text",inverse:!0,href:"#",onClick:this.props.handleSettingsButtonClick},o.intl.formatMessage({id:"BypDcT",defaultMessage:"Modify"}))):""},this.focusOnInput=()=>{this.inputRef.current&&this.inputRef.current.select()},this.handleCopyLink=()=>{const e=this.props.getEmailTokenCountFn();this.context.logEvent(k.TiburonEventName.CopySharedLink,this.props.sharedLink,{tokenized_contact_count:e}),R.copyToClipboard(this.props.sharedLink.url,(()=>this.handleClipboardSuccess()),(()=>this.copyLinkToClipboardRetryUsingNativeAPI()))},this.renderViewedLinkCopiedText=()=>{const e="editor"===this.props.accessLevel;return r.React$1.createElement("div",{className:`${ds}-footer-link__link-copied`},r.React$1.createElement(i.UIIcon,{className:`${ds}-footer-link__link-copied-icon`,src:i.CheckmarkCircleLine}),r.React$1.createElement(i.Text,{tagName:"p",isBold:!0},e?o.intl.formatMessage({id:"dmwGjM",defaultMessage:"Edit link copied"}):o.intl.formatMessage({id:"opUQcS",defaultMessage:"View link copied"})))},this.inputRef=r.React$1.createRef(),this.state={copySuccess:!1}}componentDidUpdate(e){this.props.createdLink&&this.props.sharedLink&&e!==this.props&&hs()&&this.handleCopyLink()}render(){const e=o.intl.formatMessage({id:"t0Frp1",defaultMessage:"Copy link"});return this.props.createdLink&&this.state.copySuccess&&hs()?this.renderViewedLinkCopiedText():this.renderCopyLink(e)}handleClipboardSuccess(){this.setState({copySuccess:!0},(()=>{h.showCopyLinkSuccessSnackbar(this.props.sharedLink.url,this.props.accessLevel)})),b.trackUserLeapEvent(b.SharingUserLeapEvent.SHARE_LINK_COPY_SUCCESS,i.SHARE_ACTION_ORIGIN_TYPE.SHARE_LINK_MODAL),"V1"===cs(this.props.actionHandler)&&P.setIsEligibleForDocsendSplitShareItemInUserMetadata(this.props.user.id)}copyLinkToClipboardRetryUsingNativeAPI(){navigator.clipboard?navigator.clipboard.writeText(this.props.sharedLink.url).then((()=>this.handleClipboardSuccess()),(()=>this.handleClipboardFailureNativeAPI())):this.handleClipboardFailureNativeAPI()}handleClipboardFailureNativeAPI(){this.context.logEvent(k.TiburonEventName.CopySharedLinkFailure,this.props.sharedLink,{tokenized_contact_count:this.props.getEmailTokenCountFn(),error:"failed_copy_to_clipboard"}),this.setState({copySuccess:!1}),h.showCopyLinkErrorSnackbar(this.props.sharedLink.url,this.props.accessLevel)}getLinkRestrictions(){const e=this.props.sharedLink,t=p.getAudienceForLink(e.link_permissions),s=e.link_permissions.require_password||"password"===t,n=e.expires;return s&&n?o.intl.formatMessage({id:"RVzGyv",defaultMessage:"Restrictions apply"}):s?ns(o.intl):n?is(o.intl,e):void 0}}var us;function ms(){const e=i.Viewer.get_viewer().work_user;if(!e)throw new Error("No active work user");return new i.DefaultUserApiV2Client(e)}ps.displayName="CopyLinkSection",ps.contextType=os,t.GuestPassExpireAction=void 0,(us=t.GuestPassExpireAction||(t.GuestPassExpireAction={})).OFFBOARD="offboard",us.CONVERT="convert";const gs=r.React$1.createElement,fs=new Set;class _s{constructor(e,t,s,n,c,p,u){this.groupSeenStateInfo=null,this.linkSeenStateInfo=null,this.presentAccountIds=null,this.hasLoggedSet={},this.setUrl=null,this.hasLoggedApprovalFormShown=!1,this.hasModalUnmounted=!1,this.changeAccess=(e,t,s=!1)=>{let n=Promise.resolve({});const a=e.memberId(),r=this.getContentInfo(),c=r.id,d=this.sharingInfo.isNonUserRelativeContext();if(t===i.MEMBER_ACTION.REMOVE)a!==this.user.account_id||d?n=(r.isFileFolder()?this.client.getParentFolderAccess({contentId:this.sharingInfo.parentSharedFolderId(),memberId:a}):this.removeMember(c,e,s,r.isFolder())).then((t=>{this.showParentFolderAccessModalIfQualified("remove",e,t)})):this.relinquishMembership(c,s);else if(t===i.ACCESS_LEVEL.OWNER)n=this.client.transferContent({contentId:c,memberId:a}).then((()=>{this.dispatch(l.ShareModalActionTypes.TRANSFER_OWNER_SUCCESS),h.sharingNotificationSuccess(o.intl.formatMessage({id:"sAxJWH",defaultMessage:"Made {name} the owner"},{name:e.displayName()})),this.fetchDataAndShowShareModal()}));else{let s;if(r.isFileFolder()&&t===i.ACCESS_LEVEL.READER)s=this.client.getParentFolderAccess({contentId:this.sharingInfo.parentSharedFolderId(),memberId:a,accessLevel:t});else{const n=this.getContentInfo().isFileFolder();n&&this.dispatch(l.ShareModalActionTypes.MEMBER_ACTION_PENDING,{member:e});const a=e.is_inherited&&t===i.ACCESS_LEVEL.READER&&e.inherited_access_type!==i.ACCESS_LEVEL.READER;s=this.shareIfFileFolder(a?void 0:o.intl.formatMessage({id:"xYinYM",defaultMessage:"Updating member access..."})).then((()=>(n&&this.dispatch(l.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:e}),this.changeMemberAccess(this.getContentInfo().id,e,t)))).catch((t=>{this.reportShareFailure(t),n&&this.dispatch(l.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:e})}))}n=s.then((t=>{this.fetchInitialData(),this.handleShowParentFolderAccessModal(e,t)}))}return n.then(this.refreshSharedWithColumnContentData)},this.handleShowParentFolderAccessModal=(e,t)=>{this.isMemberAccessLevelQualified(t)&&(this.showParentFolderAccessModal("update",e,t),i.Snackbar.close())},this.changeRecipientAccess=e=>a.__awaiter(this,void 0,void 0,(function*(){this.dispatch(l.ShareModalActionTypes.CHANGE_RECIPIENT_ACCESS,{newAccess:e}),yield this.validateContacts(this.getSharingInfo().recipientTokens())})),this.changeLinkRecipientAccess=e=>{this.dispatch(l.ShareModalActionTypes.CHANGE_LINK_RECIPIENT_ACCESS,{newAccess:e})},this.changeEmailRecipientAccess=e=>a.__awaiter(this,void 0,void 0,(function*(){this.dispatch(l.ShareModalActionTypes.CHANGE_EMAIL_RECIPIENT_ACCESS,{newAccess:e}),yield this.validateContacts(this.getSharingInfo().recipientTokens())})),this.changeRecipientMessage=e=>{this.dispatch(l.ShareModalActionTypes.CHANGE_RECIPIENT_MESSAGE,{message:e})},this.appendToRecipientMessage=e=>{this.dispatch(l.ShareModalActionTypes.APPEND_TO_RECIPIENT_MESSAGE,{messageToAppend:e})},this.changeMainSectionExpandedAccordionPanels=e=>{this.dispatch(l.ShareModalActionTypes.CHANGE_MAIN_SECTION_EXPANDED_ACCORDION_PANELS,{newPanels:e})},this.changeCreateCommentCheckbox=e=>{this.dispatch(l.ShareModalActionTypes.CHANGE_CREATE_COMMENT_CHECKBOX,{checked:e})},this.logShownApprovalForm=()=>{var e;this.hasLoggedApprovalFormShown||(this.hasLoggedApprovalFormShown=!0,null===(e=this.approvalClient)||void 0===e||e.logger.logShownRequestForm(this.sharingInfo.contentId().toString(),"share_modal"))},this.toggleAutomationOption=()=>{this.sharingInfo.automationOptionChecked()?B.PapLogger.logDeselectAutoFolderSetupCheckbox({actionSurface:"share_modal"}):B.PapLogger.logSelectAutoFolderSetupCheckbox({actionSurface:"share_modal"}),this.dispatch(l.ShareModalActionTypes.TOGGLE_OPEN_AUTOMATIONS)},this.toggleSendApproval=()=>{this.dispatch(l.ShareModalActionTypes.TOGGLE_SEND_APPROVAL)},this.changeNeedsAllApprovers=e=>{this.dispatch(l.ShareModalActionTypes.CHANGE_NEEDS_ALL_APPROVERS,{needsAllApprovers:e})},this.createApproval=e=>a.__awaiter(this,void 0,void 0,(function*(){var t,s;if(!this.approvalClient)return;const n="flows-approval-snackbar",a=this.getSharingInfo().getInitialProps(),r=this.sharingInfo.contentId().toString(),c=this.sharingInfo.recipientTokens(),d=c.length,h=this.sharingInfo.needsAllApprovers(),p=this.sharingInfo.recipientMessage(),u=this.sharingInfo.isDTLSM1Enabled()?this.sharingInfo.emailRecipientAccess():this.sharingInfo.recipientAccess();if(i.Snackbar.sync(o.intl.formatMessage({id:"rfZeo4",defaultMessage:"Sharing file and sending approval {numApprovers, plural, one {email} other {emails}}..."},{numApprovers:d}),!0,n),this.dispatch(l.ShareModalActionTypes.CREATE_APPROVAL_REQUEST),yield this.recipientsChange(e.getContacts()),yield this.validateContacts(this.sharingInfo.recipientTokens()),this.sharingInfo.contactsError().level===b.ContactsErrorLevel.Error)return void this.log(k.TiburonEventName.FailInbandShare,{error_message:void 0,error_tag:"contacts_error"});let m="";try{this.approvalClient.logger.logSubmitApprovalRequest({actionSurface:"share_modal",approvalDetailsLength:p.length,entryPoint:this.getContentInfo().extras.origin,fileId:r,numApprovers:c.length,requiresAll:h});const{comment_id:e}=yield this.approvalClient.createApproval(r,p,c.map((({email:e})=>({email:e}))),h);this.approvalClient.logger.logSubmitApprovalSuccess(r,"share_modal",p.length,JSON.stringify(c.map((({dbx_account_id:e})=>e))),h,c.length,e),this.dispatch(l.ShareModalActionTypes.CREATE_APPROVAL_SUCCESS)}catch(e){m=(null===(t=e.error)||void 0===t?void 0:t[".tag"])||"unknown",i.Snackbar.fail(o.intl.formatMessage({id:"NvrwMd",defaultMessage:"Couldn't share file or send approval request."},{numApprovers:d}),n),this.approvalClient.logger.logSubmitApprovalFailure({actionSurface:"share_modal",fileId:r,errorReason:m}),this.dispatch(l.ShareModalActionTypes.CREATE_APPROVAL_FAILURE)}if(m)return;let g=!1;try{yield this.sendShare(e,{keepModalOpen:!1,suppressAllSnackbars:!0,suppressSuccessSnackbar:!0,suppressNotifications:!0})}catch(e){u!==i.ACCESS_LEVEL.READER&&(g=!0)}null===(s=a.onCreateApprovalSuccess)||void 0===s||s.call(a),g?i.Snackbar.fail(o.intl.formatMessage({id:"8l0aUb",defaultMessage:"Sent approval request, but couldn't share the file with edit access."},{numApprovers:d}),n):i.Snackbar.complete(o.intl.formatMessage({id:"l4nAAD",defaultMessage:"File shared and approval request sent."}),n)})),this.enableNamespaceCreation=e=>this.getContentInfo().isFileFolder()&&"editor"===e&&this.getSharingInfo().fetchMetadataStatus()!==l.FETCH_METADATA_STATUS.FAIL,this.createNamespaceIfNeeded=(e,t)=>{if(!this.enableNamespaceCreation(e))return Promise.resolve({});if(void 0===t)return Promise.resolve({});if(this.sharingInfo.shareFolderPromise())return this.sharingInfo.shareFolderPromise();let s;return null!=this.sharingInfo.shouldSyncThisFolder()&&(s=this.sharingInfo.shouldSyncThisFolder()?"default":"not_synced"),this.shareFolderSimple(this.getFqPath(),this.sharingInfo.shareAsConfidential(),s)},this.getCreateSharedLinkTTI=e=>Date.now()-e,this.buildExtraFieldForCreateSharedLinkEvents=(e,t,s)=>({is_alpha:!0,access:s,include_ns_creation:e,timing:this.getCreateSharedLinkTTI(t)}),this.createSharedLink=(e,t,s)=>{const n=Date.now(),a=this.enableNamespaceCreation(e),r=e||"viewer";this.log(k.TiburonEventName.ClickTibCreateLink),this.log(k.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:r}),this.dispatch(l.ShareModalActionTypes.CREATE_LINK_REQUEST),"editor"===e?i.Snackbar.sync(o.intl.formatMessage({id:"OvEApa",defaultMessage:"Creating edit link..."}),!1,"sharing-notification"):i.Snackbar.sync(o.intl.formatMessage({id:"8PPImn",defaultMessage:"Creating view link..."}),!1,"sharing-notification");const c={};e&&(c.access=e),t&&(c.audience=t);const d=this.getContentInfo(),p=d.fileId()||d.displayPath();return this.client.createSharedLink({fileIdOrPath:p,settings:c}).then((t=>{this.dispatch(l.ShareModalActionTypes.CREATE_LINK_SUCCESS,{linkMetadata:t}),this.refreshSharedWithColumnLinkData(),this.log(k.TiburonEventName.SucceedCreateSharedLinkWithSettings,Object.assign(Object.assign({http_status_code:200,response_status:"success"},this.buildExtraFieldForCreateSharedLinkEvents(a,n,r)),L.buildExtraFromLinkMetadata(t))),b.trackUserLeapEvent(b.SharingUserLeapEvent.SHARE_LINK_CREATE_SUCCESS,i.SHARE_ACTION_ORIGIN_TYPE.SHARE_LINK_MODAL);const c=this.getSharingInfo().modalInfoState().recipientAccess,d=c?c===i.ACCESS_LEVEL.WRITER?"editor":"viewer":e,h=e!==d;s===l.LINK_CREATION_SURFACE.COPY_OR_CREATE_LINK_SECTION&&hs()&&!h||("editor"===e?i.Snackbar.complete(o.intl.formatMessage({id:"JtONmB",defaultMessage:"Edit link created."}),"sharing-notification"):i.Snackbar.complete(o.intl.formatMessage({id:"ufl8ka",defaultMessage:"View link created."}),"sharing-notification"))})).catch(i.catchApiError((e=>(e instanceof i.AppError&&e.error&&"access_denied"===e.error[".tag"]?this.getContentInfo().isFolder()?h.sharingNotificationError(o.intl.formatMessage({id:"/ivxG2",defaultMessage:"You don’t have permission to create a link to this folder"})):h.sharingNotificationError(o.intl.formatMessage({id:"p1EB+W",defaultMessage:"You don’t have permission to create a link to this file"})):e instanceof i.AppError&&e.error&&"banned_member"===e.error[".tag"]&&e.message?(i.Snackbar.close(),h.failBannerWithHelpCenter(b.convertIfHTML(e.message),b.ABUSE_HELP_ARTICLE_LINK)):this.showStandardError(e),e.error&&"shared_link_already_exists"===e.error[".tag"]?this.log(k.TiburonEventName.SucceedCreateSharedLinkWithSettings,Object.assign({http_status_code:e.raw&&e.raw.status,response_status:"success"},this.buildExtraFieldForCreateSharedLinkEvents(a,n,r))):this.log(k.TiburonEventName.FailCreateSharedLinkWithSettings,Object.assign({http_status_code:e.raw&&e.raw.status,error_tag:e.error&&e.error[".tag"]||"undefined_error",error_summary:e&&e.summary,fail_at:"link_creation"},this.buildExtraFieldForCreateSharedLinkEvents(a,n,r))),this.dispatch(l.ShareModalActionTypes.CREATE_LINK_FAILURE),Promise.reject(e)))))},this.fetchMetadataForFile=e=>l.SharingActions.loadFileMetadata({user:this.user,contentId:e.id,sourceUrl:e.url(),client:this.client}).catch(i.catchApiError((t=>{this.handleLoadingError(t,e)}))),this.fetchMetadataForFileFolder=e=>{const t=i.MEMBER_ACTION.ALL,s=i.VALIDATE_PATH_PERMISSIONS_CONFIDENTIAL_AWARE,n={actions:Object.keys(s),listMembersArg:{actions:t},shouldParseMetadataFromError:!0};let r,o;const l=!!this.sharingInfo.isNonUserRelativeContext();return l&&!this.user.is_cdm_member?(r=e=>a.__awaiter(this,void 0,void 0,(function*(){const t=this.contentManagerValidateFolderPath(e);return this.client.validatePathContinue(t,!1)})),o={nsId:e.nsId(),nsPath:e.nsPath()}):(r=this.client.validateFqPath,o={fqPath:e.displayPath(),shareAsConfidential:this.sharingInfo.shareAsConfidential()}),r(Object.assign(Object.assign({},o),n)).then((({metadata:e,inheritedMembers:t})=>{this.handleGetMetadataSuccess(e);const s=this.getContentInfo();this.listMembers({contentId:s.id,url:s.url(),members:s.isFileFolder()&&t||void 0,isNonUserRelativeContext:l})})).catch(i.catchApiError((t=>{this.handleLoadingError(t,e)})))},this.fetchMetadataForSharedFolder=e=>this.client.getMetadata({contentId:e.id,isInSharedFolder:e.isInSharedFolder(),actions:Object.keys(i.ALPHA_FOLDER_METADATA_PERMISSIONS)}).then(this.handleGetMetadataSuccess).catch(i.catchApiError((t=>{this.handleLoadingError(t,e)}))),this.handleSetConfidentialClick=(e,t)=>{i.Modal.showInstance(r.React$1.createElement(Vt,{actionHandler:this,initialIsConfidentialFolder:e,contentInfo:this.getContentInfo(),teamName:t,onClose:this.openShareModal,userId:this.user.id}))},this.handleInheritedMemberAccessChange=(e,t,s,n)=>{const a=this.getContentInfo(),o=this.getSharingInfo();i.Modal.showInstance(r.React$1.createElement(Gt,{actionHandler:this,member:e,teamName:t,userId:this.user.id,isSharedFolder:a.isSharedFolder(),parentFolderName:o.parentFolderName(),currentFolderName:o.name(),isUserSelf:e.memberId()===this.user.account_id,isDowngrading:s,newAccessLevel:n}))},this.handleMemberAccessChange=(e,t)=>{var s;const n=e.displayName();if(t===i.MEMBER_ACTION.REMOVE||t===i.ACCESS_LEVEL.OWNER){const a=t===i.MEMBER_ACTION.REMOVE&&e.memberId()===this.user.account_id,l=this.getContentInfo().isFolder(),c=this.getContentInfo().isNestedSharedFolder(),d=e instanceof i.UserMembershipInfo&&!0===(null===(s=e.account)||void 0===s?void 0:s.disabled),h=e.permissions.leave_a_copy&&e.permissions.leave_a_copy.allow&&!d,p=s=>{this.changeAccess(e,t,!0===s)},u=this.openManageAccessModal,m=()=>{i.Modal.close(void 0,Fe)},f=this.getSharingInfo().parentFolderName(),_=this.getSharingInfo().isConfidentialFolder(),E=e.type()===i.MembershipType.GROUPS,S=this.getSharingInfo().isNonUserRelativeContext(),M=this.getSharingInfo().isFolderInsideTeamFolderTree(),v=t===i.MEMBER_ACTION.REMOVE&&e.is_inherited;a?g.showRelinquishMembershipConfirmationModal(l,c,p,u,h,_):v&&l&&!M?this.changeAccess(e,t):function(e="",t,s,n,a=!1,l,c,d=!1,h,p,u=!1){let m,f,_,E,S;const M=i.Emstring.em_snippet(e,40);let v=null;t===i.MEMBER_ACTION.REMOVE?(_=o.intl.formatMessage({id:"sIVZG2",defaultMessage:"Remove {name}?"},{name:M}),s?(m=n&&!d?p?o.intl.formatMessage({id:"ru4Qhg",defaultMessage:"If you remove <strong>{name}</strong>, they won’t be able to see future changes to this shared folder. Keep in mind that anyone who can access <strong>{parentname}</strong> will still be able to access this folder."},{strong:e=>r.React$1.createElement("strong",null,e),name:M,parentname:p}):o.intl.formatMessage({id:"8rlotY",defaultMessage:"If you remove <strong>{name}</strong>, they won’t be able to see future changes to this shared folder. Keep in mind that anyone who can access the parent folder will still be able to access this folder."},{strong:e=>r.React$1.createElement("strong",null,e),name:M}):o.intl.formatMessage({id:"03tbWi",defaultMessage:"If you remove <strong>{name}</strong>, they won’t be able to see future changes to this shared folder."},{strong:e=>r.React$1.createElement("strong",null,e),name:M}),a&&(v=o.intl.formatMessage({id:"RB9i4M",defaultMessage:"Let {name} keep a copy of this shared folder"},{name:M}))):(m=u?o.intl.formatMessage({id:"D0n7tP",defaultMessage:"Keep in mind, if group members have a shared link to this file, they might still be able to view or edit it."}):o.intl.formatMessage({id:"nAwKbF",defaultMessage:"Keep in mind, if they have a shared link to this file, they might still be able to view or edit it."}),E=o.intl.formatMessage({id:"S+RxKh",defaultMessage:"More about links"}),S=()=>i.open_tab("https://help.dropbox.com/files-folders/share/remove-link")),f=o.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"})):(h?(_=o.intl.formatMessage({id:"Px//wf",defaultMessage:"Make {name} the owner of this folder and all contained files and folders?"},{name:M}),m=o.intl.formatMessage({id:"gek9SL",defaultMessage:"Settings for this folder will now be managed by {name}. Keep in mind, if they’re not on your Dropbox team, you won’t be able to manage this folder here anymore."},{name:M})):(_=o.intl.formatMessage({id:"khEZSl",defaultMessage:"Make {name} the owner of this folder?"},{name:M}),m=o.intl.formatMessage({id:"y7GDnJ",defaultMessage:"{name} will become the owner of all items in this folder. Only they will be able to unshare or change folder settings."},{name:M})),f=o.intl.formatMessage({id:"+ZJXxL",defaultMessage:"Make owner"}));i.Modal.showInstance(r.React$1.createElement(g.ConfirmWithOptionModal,{confirmText:f,cancelText:o.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),link:E,onConfirm:l,onCancel:c,onClickLink:S,optionLabel:v,showOption:null!=v,title:_},m),!0,Fe)}(n,t,l,c,h,p,m,_,S,f,E)}else this.changeAccess(e,t)},this.handleGetMetadataSuccess=e=>{this.dispatch(l.ShareModalActionTypes.FETCH_METADATA_SUCCESS,{metadata:e}),i.dispatcherSingleton.dispatch({type:f.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:this.user})},this.handleLinkSettingsClick=(e={isLinkOnly:!0,linkAccessLevel:"viewer"})=>{i.TeamsWebActionsLogger.log("open_link_settings_modal");let t,s=d.VIEW_LINK_SETTINGS;"editor"===e.linkAccessLevel&&(s=d.EDIT_LINK_SETTINGS),this.log(k.TiburonEventName.OpenLinkSettingsModal,{settings_tab:s}),e.isLinkOnly||(t=this.sharingInfo.isFolder()?this.sharingInfo.folderPolicy():this.sharingInfo.filePolicy()),i.Modal.showInstance(r.React$1.createElement(Ft,{actionHandler:this,sharingInfo:this.sharingInfo,sharingPrefs:this.sharingInfo.sharingPrefs(),client:this.client,currentTab:s,currentPolicy:t,folderName:this.sharingInfo.name(),isFolder:this.sharingInfo.isFolder(),isSharedFolder:this.getContentInfo().isSharedFolder(),isFolderInsideTeamFolderTree:this.sharingInfo.isFolderInsideTeamFolderTree(),isInContentManager:this.getSharingInfo().isNonUserRelativeContext(),isTeamSharedFolder:this.sharingInfo.isTeamSharedFolder(),isUserOnOwnerTeam:this.sharingInfo.isUserOnOwnerTeam(),linkMetadata:this.sharingInfo.linkMetadata(),onDismiss:()=>i.Modal.close(),permissions:this.sharingInfo.permissions(),ownerTeam:this.sharingInfo.ownerTeam(),user:this.user,isLinkVisitor:Re(this.user.account_id,this.linkSeenStateInfo)}))},this.handleLoadingError=(e,t)=>{var s,n,a;if(e instanceof i.AppError){if("not_a_member"===(null===(s=e.error)||void 0===s?void 0:s[".tag"])||"no_access"===(null===(n=e.error)||void 0===n?void 0:n[".tag"]))h.sharingNotificationError(o.intl.formatMessage({id:"O4CWz2",defaultMessage:"You don’t have permission to share this folder"})),i.Modal.close();else if("invalid_id"===(null===(a=e.error)||void 0===a?void 0:a[".tag"]))h.sharingNotificationError(o.intl.formatMessage({id:"4GGEvb",defaultMessage:"This folder can’t be shared"})),i.Modal.close();else if(e.error&&e.error.too_many_mounts&&t.isFolder()&&!t.extras.exists){const t=b.NSF_HELP_ARTICLE_LINK;(e.error.too_many_mounts[".tag"]===l.NS_LIMIT_ERROR.TOTAL_MOUNTS_EXCEEDED||e.error.too_many_mounts[".tag"]===l.NS_LIMIT_ERROR.HOME_MOUNTS_EXCEEDED||e.error.too_many_mounts[".tag"]===l.NS_LIMIT_ERROR.TREE_SIZE_EXCEEDED)&&h.failSnackbarWithHelpCenter(b.namespaceLimitExceededFailCreateSharedFolderSnackbarMsg(e),t),i.Modal.close()}const r=e.error&&e.error.bad_path&&e.error.bad_path[".tag"],c=e.error&&e.error.too_many_mounts&&e.error.too_many_mounts[".tag"];this.dispatch(l.ShareModalActionTypes.FETCH_METADATA_FAILURE,{reason:r||c,countExceedNsLimit:c&&b.getExceededCountInfo(e)})}else this.showStandardError(e),i.Modal.close()},this.handleSetConfidential=(e,t=!1)=>{const s=this.getContentInfo(),n=s.isSharedFolder()?s.sharedFolderId().toString():void 0,a=e=>(this.handleGetMetadataSuccess(e),e),r=(e,t,s)=>this.client.setConfidentiality({contentId:e,confidential:t,keepInheritedMembers:s}).then(a);return n?r(n,e,t):this.client.share({fqPath:this.getFqPath(),confidential:e}).then(a).catch((s=>{if(s instanceof i.AppError&&s.error&&s.error.bad_path&&"already_shared"===s.error.bad_path[".tag"]){const n=i.folderMetadataApiToRecord(s.error.bad_path);this.handleGetMetadataSuccess(n);const a=this.getContentInfo().sharedFolderId();return r(a.toString(),e,t)}return Promise.reject(s)}))},this.openShareModal=()=>{i.Modal.showInstance(gs(this.shareModalClass,{actionHandler:this}))},this.openSharingSettingsModal=e=>{i.Modal.showInstance(gs(this.shareModalClass,{actionHandler:this,initialScreen:i.SETTINGS_SCREEN,initialCurrentTab:e}))},this.showScreen=(e,t)=>{switch(e){case i.SHARE_SCREEN:this.openShareModal();break;case i.SETTINGS_SCREEN:{const e=this.getSharingInfo().isFolder()?d.FOLDER_SETTINGS:d.FILE_SETTINGS,s=t||e;this.openSharingSettingsModal(s);break}case i.MANAGE_SCREEN:this.openManageAccessModal();break;default:this.openShareModal()}},this.openManageAccessModal=()=>{i.Modal.showInstance(gs(this.shareModalClass,{actionHandler:this,initialScreen:i.MANAGE_SCREEN}))},this.recipientsChange=(e,t="")=>Promise.resolve({}).then((()=>this.dispatch(l.ShareModalActionTypes.CHANGE_RECIPIENTS,{recipientTokens:e,recipientRawInput:t}))).then((()=>this.validateContacts(e))),this.redirectToPath=(e,t)=>{if(null!=this.setUrl&&this.getSharingInfo().getInitialProps().content&&this.getSharingInfo().fqPath()){const s=e=>{t&&Promise.resolve().then((function(){return Xa})).then((({showShareModal:t})=>t(this.user,e,{origin:i.SHARE_ACTION_ORIGIN_TYPE.PARENT_FOLDER_MODAL},this.setUrl)))};if(e!==this.getSharingInfo().fqPath()){const t=i.browse_uri_for_fq_path(this.user,e);t.updateQuery({[i.BrowseQueryArg.share_manage_access]:"true"}),i.browserRedirectWrapper(t,!0)}else s(this.getSharingInfo().getInitialProps().content)}else{const s=i.browse_uri_for_fq_path(this.user,e);t&&s.updateQuery({shareoptions:"1"}),i.browserRedirectWrapper(s,!0)}},this.refreshSharedWithColumnContentData=()=>{if(this.getContentInfo().isFolder())i.getStoreForSharedWith().dispatch(i.sharedFolderDataOutOfDate());else{const e=[this.getContentInfo().id.toString()];i.getStoreForSharedWith().dispatch(i.sharedFileDataOutOfDate(e))}},this.shareIfFileFolder=(e,t)=>{if(this.getSharingInfo().shouldCloseImmediately()?i.Modal.close():null!=e&&i.Snackbar.sync(e,!0,"sharing-notification"),!this.getContentInfo().isFileFolder())return Promise.resolve({});if(this.sharingInfo.shareFolderPromise())return this.sharingInfo.shareFolderPromise();let s;return null!=this.sharingInfo.shouldSyncThisFolder()&&(s=this.sharingInfo.shouldSyncThisFolder()?"default":"not_synced"),this.shareFolderSimple(this.getFqPath(),this.sharingInfo.shareAsConfidential(),s,t)},this.reportShareFailure=e=>{e instanceof i.RateLimitError?h.failSnackbarWithHelpCenter(o.intl.formatMessage({id:"/sRvdA",defaultMessage:"Folder updates in progress — please try again later."}),"/help/9259"):e instanceof i.AppError&&"too_many_files"===e.error[".tag"]?h.failSnackbarWithHelpCenter(o.intl.formatMessage({id:"Js1Gcw",defaultMessage:"Couldn’t share. If this folder has a lot of files, try sharing fewer files."}),"/support",b.getContactSupportMessage()):e instanceof i.AppError&&"internal_error"===e.error[".tag"]?h.failSnackbarWithHelpCenter(o.intl.formatMessage({id:"7/f5Vp",defaultMessage:"Couldn’t share, but it might work if you reload the page and try again."}),"/support",b.getContactSupportMessage()):e instanceof i.AppError&&"banned_member"===e.error[".tag"]&&e.message?(i.Snackbar.close(),h.failBannerWithHelpCenter(b.convertIfHTML(e.message),b.ABUSE_HELP_ARTICLE_LINK)):b.isTotalMountsExceededError(e)||b.isTreeSizeExceededError(e)||b.isHomeMountsExceededError(e)?h.failSnackbarWithHelpCenter(b.namespaceLimitExceededFailCreateSharedFolderSnackbarMsg(e),b.NSF_HELP_ARTICLE_LINK):i.Snackbar.fail(b.convertIfHTML(b.genAddMemberErrorMessage(e)),"sharing-notification")},this.showParentFolderAccessModalIfQualified=(e,t,s)=>{this.isMemberAccessLevelQualified(s)&&this.showParentFolderAccessModal(e,t,s)},this.showParentFolderAccessModal=(e,t,s)=>{this.log(k.TiburonEventName.OpenParentFolderAccessModal,{num_parent_folders:s.parentFolders&&s.parentFolders.length||0}),i.Modal.showInstance(r.React$1.createElement(Ot,{contentInfo:this.getContentInfo(),memberAccessLevelResult:s,memberDisplayName:t.displayName()||"",originalAction:e,isInContentManager:this.sharingInfo.isNonUserRelativeContext(),onClose:this.openShareModal,onParentFolderClicked:this.redirectToPath}))},this.parseParentFolderAccessError=e=>{let t=e.error;if("member_error"===e.error[".tag"]&&(t=e.error.member_error),"no_explicit_access"===t[".tag"])return i.memberAccessLevelApiToRecord(this.user.id,t);this.showStandardError(e)},this.changeLinkAudienceSelection=(e,t)=>{this.dispatch(l.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_SELECTION,{accessLevel:e,audience:t})},this.removeLinkAudienceSelection=e=>{this.dispatch(l.ShareModalActionTypes.REMOVE_LINK_AUDIENCE_SELECTION,{accessLevel:e})},this.updateLinkSettings=e=>Promise.all(e.map((e=>this.client.modifySharedLinkSettings(e)))).then((e=>{h.sharingNotificationSuccess(o.intl.formatMessage({id:"8TOykk",defaultMessage:"Settings saved."}));const t=[];for(const s of this.sharingInfo.sharedLinks()){const n=e.find((e=>(s.link_permissions.link_access_level||"viewer")===(e.link_permissions.link_access_level||"viewer")));t.push(n||s)}this.setSharedLinks(t),this.refreshSharedWithColumnLinkData()})).catch((()=>(h.sharingNotificationError(o.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."})),Promise.reject()))),this.waitForAllMembersLoaded=()=>{if(this.sharingInfo.areMembersFullyLoaded())return Promise.resolve({});const e=this.sharingInfo.fetchingMembersRequest();return e&&e.promise||Promise.resolve({})},this.onPageNavigationAttempt=e=>{if(fs.size>0)return this.log(k.TiburonEventName.AttemptNavigateAwayDuringShare),e.preventDefault(),e.returnValue="",""},this.onPageNavigationAway=e=>{fs.size>0&&this.log(k.TiburonEventName.SucceedNavigateAwayDuringShare)},this.getShopModalPrereqs=()=>{const e=this.getContentInfo();let t={},s=!1;return e.isFile()&&e.name()&&(t=b.getShopModalCtx(e,this.getSharingInfo().getReferrer()),s=i.hasEventInHistory(i.CampaignEvents.SHARE_MODAL_SETTINGS_OPENED,t)),{contextData:t,shouldShowShopModal:s}},this.client=e,this.asyncContactValidator=new Kt(this.client),this.user=t,this.shareModalClass=s,this.setUrl=n||null,this.contentManagerValidateFolderPath=c,this.openSettingsFromTheExternalSharePageQuickActions=p,this.approvalClient=u}initializeShareModal(e,t={}){const s=e.contentInfo;return i.dispatcherSingleton.dispatch({type:l.ShareModalActionTypes.SHARE_MODAL_OPEN,data:{initialProps:t,shareModalInfoAttrs:e},contentIds:l.getContentIdsForContentInfo(s),user:this.user}),this.sharingInfo=l.sharingInfoStore.getSharingInfo(this.user.id,s.id),this.fetchInitialData()}fetchDataAndShowShareModal(){this.fetchInitialData(),this.openShareModal()}fetchInitialData(){const e=this.sharingInfo.contentInfo(),t=this.sharingInfo.isNonUserRelativeContext();this.beginTime=Date.now(),this.isSendForSignatureEnabled=V.isSendForSignatureEnabled(this.getIntegrationStoreState(this.user.id)),this.fetchPassInfo();const s=[];return e.isFileFolder()?s.push(this.fetchMetadataForFileFolder(e)):(s.push(this.listMembers({contentId:e.id,url:e.url(),isNonUserRelativeContext:t})),e.isFile()?s.push(this.fetchMetadataForFile(e)):e.isSharedFolder()&&s.push(this.fetchMetadataForSharedFolder(e))),s.push(this.fetchMemberCounts()),s.push(this.fetchCurrentAccount()),s.push(this.fetchSharingPrefs()),this.sharingInfo.shouldFetchLinkMetadata()&&s.push(this.fetchLinkMetadata()),this.shouldFetchDocsendAnalyticsLink()&&s.push(this.fetchDocsendAnalyticsLink()),Promise.all(s)}fetchPassInfo(){this.sharingInfo.shouldBlockMemberListOnPassLoad()&&setTimeout((()=>this.dispatch(l.ShareModalActionTypes.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD)),4e3);const{shouldFetchPass:e,fileId:t}=this.getPassFetchingInfo();if(!e||!t)return;this.clearCachedPassInfo();const s=l.passStore.passFetchingStatus(t);if(i.fetchingStatusIsSuccessful(s)){const{groupSeenStateInfo:e,linkSeenStateInfo:s}=l.passStore.getLinkAndGroupSeenStateInfo(t);this.groupSeenStateInfo=e,this.linkSeenStateInfo=s,this.presentAccountIds=l.passStore.presence(t)}else s===i.PassFetchingStatus.NOT_YET_KNOWN&&l.PassHelpers.setup({user:this.user,fileData:this.getFileData(),prevFileData:null,shouldWritePresence:!1,skipSharingEndpoints:!0})}getIntegrationStoreState(e){return i.initStoreForIntegration(e).getState()}getAsyncContactValidator(){return this.asyncContactValidator}getSharingInfo(){return this.sharingInfo}clearCachedPassInfo(){[this.groupSeenStateInfo,this.linkSeenStateInfo,this.presentAccountIds]=[null,null,null]}getPassInfo(){const e=this.getContentInfo();if(e.isFolder())return{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:i.PassFetchingStatus.ERROR};if(this.groupSeenStateInfo&&this.linkSeenStateInfo&&this.presentAccountIds)return{groupSeenStateInfo:this.groupSeenStateInfo,linkSeenStateInfo:this.linkSeenStateInfo,presentAccountIds:this.presentAccountIds,passFetchingStatus:i.PassFetchingStatus.PASS_SUCCESS};{const t=this.getPassFetchingInfo().fileId;if(!t)return[this.groupSeenStateInfo,this.presentAccountIds]=[{},[],[]],{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:i.PassFetchingStatus.ERROR};const s=l.passStore.getPassPermissions(t),n=l.passStore.passFetchingStatus(t);if(!i.fetchingStatusIsComplete(n))return{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:i.PassFetchingStatus.FETCHING};if(null==s||!s.canReadPresence)return{groupSeenStateInfo:{},linkSeenStateInfo:[],presentAccountIds:[],passFetchingStatus:i.PassFetchingStatus.ERROR};const{linkSeenStateInfo:a,groupSeenStateInfo:r}=l.passStore.getLinkAndGroupSeenStateInfo(t);return this.linkSeenStateInfo=a,this.groupSeenStateInfo=r,this.presentAccountIds=[...l.passStore.presence(t)||[]],this.isContentInfoForFilePreview(e)&&this.presentAccountIds.indexOf(this.user.account_id)<0&&this.presentAccountIds.push(this.user.account_id),{groupSeenStateInfo:this.groupSeenStateInfo,linkSeenStateInfo:this.linkSeenStateInfo,presentAccountIds:this.presentAccountIds,passFetchingStatus:n}}}getCachedLinkSeenStateInfo(){var e;return null!==(e=this.linkSeenStateInfo)&&void 0!==e?e:[]}getPassFetchingInfo(){const e=this.getContentInfo();if(e.extras.origin&&["BROWSE_FILE_ACTIONS","BROWSE_FILE_FACEPILE","BROWSE_FILE_ROW","PREVIEW_PAGE","PREVIEW_PAGE_FACEPILE","PAPER_INTEGRATION","GOOGLE_DSS"].indexOf(e.extras.origin)>=0&&e.isFile()){const{fileId:t}=e.extras,s=this.isContentInfoForFilePreview(e);return{shouldFetchPass:!!t&&!s&&e.isFile(),fileId:t}}return{shouldFetchPass:!1}}getUrl(){const e=this.sharingInfo.linkMetadata();return e?e.url:void 0}getFileData(e){const{fileId:t=null}=this.getPassFetchingInfo();return{file:{file_id:t},url:e}}getContentInfo(){return this.sharingInfo.contentInfo()}getOpenSettingsFromTheExternalSharePageQuickActions(){return this.openSettingsFromTheExternalSharePageQuickActions}dispatch(e,t={}){i.dispatcherSingleton.dispatch({type:e,data:t,contentIds:[this.getContentInfo().id],user:this.user})}changeMemberAccessSimple(e,t,s){return this.client.updateMember({contentId:e,memberId:t,accessLevel:s})}changeMemberAccess(e,t,s){const n=t.access_type;return this.log(k.TiburonEventName.SelectChangeMemberPermission,{new_access:s,old_access:n}),this.dispatch(l.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_REQUEST,{member:t,newAccess:s}),this.changeMemberAccessSimple(e,t.memberId(),s).then((e=>{if(this.log(k.TiburonEventName.SucceedChangeMemberPermission,{http_status_code:200,response_status:"success",is_alpha:!1}),e.access_level&&e.warning)return this.dispatch(l.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:e.access_level}),e;i.Snackbar.complete(o.intl.formatMessage({id:"x5Je3g",defaultMessage:"Member access updated."}),"sharing-notification")})).catch(i.catchApiError((e=>{const s=e.error&&e.error[".tag"];return this.log(k.TiburonEventName.FailChangeMemberPermission,{http_status_code:e.raw&&e.raw.status,error_tag:s||"undefined",is_alpha:!1}),this.dispatch(l.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:n}),this.parseParentFolderAccessError(e)})))}_constructSearchResults(e){return e.map((e=>{if("group_id"in e)return new i.Contact({type:i.ContactTypes.NEW_STYLE_GROUP,group_id:e.group_id,name:e.name,members:e.members,on_team:e.dbx_team_id===this.user.team_dbtid,group_size:e.group_size});if("dbx_account_id"in e)return new i.Contact({type:i.ContactTypes.EMAIL,dbx_account_id:e.dbx_account_id,dbx_team_id:e.dbx_team_id,name:e.name,email:e.email,photo_url:e.photo_url,on_team:e.dbx_team_id===this.user.team_dbtid});throw new Error("Could not parse contact result.")}))}suggestTargets(e,t){return this.client.targetsSearch(e,t).then((e=>{this.log(k.TiburonEventName.AttemptTargetSearch);const t=this._constructSearchResults(e.entries);return this.log(k.TiburonEventName.SucceedTargetSearch),t})).catch(i.catchApiError((e=>{t&&t.aborted||(this.log(k.TiburonEventName.AttemptTargetSearch),this.log(k.TiburonEventName.FailTargetSearch,{error:e.message}),this.showStandardError(e))}))).catch((e=>{this.log(k.TiburonEventName.FailTargetSearch,{error:e.message})}))}validateContacts(e){return a.__awaiter(this,void 0,void 0,(function*(){return yield this._validateContacts(e,!1)}))}resetContactValidations(){return a.__awaiter(this,void 0,void 0,(function*(){return yield this._validateContacts(this.getSharingInfo().recipientTokens(),!0)}))}_validateContacts(e,t=!1){return a.__awaiter(this,void 0,void 0,(function*(){const s=this.getSharingInfo(),n=s.isDTLSM1Enabled()?s.emailRecipientAccess():s.recipientAccess(),i=s.recipientValidation()[n]||{},a=t?e:e.filter((e=>!i[e.getKey()]));if(0===a.length)return;let r={};if(s.sharingPrefs().in_server_side_contact_validation_settings){const e=s.contentInfo(),t=e.isFileFolder()?this.getFqPath():String(e.id);r=yield this.getAsyncContactValidator().validate(this.user.id,t,e,n,a)}else r=this.localValidation(a);this.dispatch(l.ShareModalActionTypes.UPDATE_RECIPIENT_VALIDATION,{recipientValidation:{[n]:r},resetCurrentValidations:t})}))}localValidation(e){const t=this.getSharingInfo(),s={};return e.forEach((e=>s[e.getKey()]=b.validateContact(e,this.user,t.ownerTeam(),t.folderPolicy(),t.isTeamSharedFolder(),t.isFolderInsideTeamFolderTree(),t.memberCountWithRecipients()))),s}fetchLinkMetadata(){return"/"!==this.getContentInfo().displayPath()?(this.dispatch(l.ShareModalActionTypes.FETCH_LINK_METADATA_REQUEST),this.client.sharedLinkInfo({fileIdOrPath:this.getContentInfo().idForLink()}).then((e=>{this.dispatch(l.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,{sharedLinks:e})})).catch((()=>{this.dispatch(l.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE);this.isContentInfoForPaper(this.getContentInfo())||this.sharingInfo.isNonUserRelativeContext()||(this.showStandardError(),i.Modal.close())}))):Promise.resolve({})}fetchMemberCounts(){const e=this.getContentInfo();return e.isFile()?l.SharingActions.fetchFileMemberCount({user:this.user,contentId:e.id,limit:i.FETCH_FILE_MEMBER_COUNT_LIMIT}):e.isSharedFolder()||e.isFolder()&&e.isInSharedFolder()?l.SharingActions.fetchFolderMemberCount({user:this.user,contentId:e.isSharedFolder()?e.sharedFolderId():e.nsId(),client:this.client}):Promise.resolve({})}fetchSharingPrefs(){return this.dispatch(l.ShareModalActionTypes.FETCH_SHARING_PREFS_REQUEST),this.client.getSharingPrefs().then((e=>{this.dispatch(l.ShareModalActionTypes.FETCH_SHARING_PREFS_SUCCESS,{sharingPrefs:e})}))}setLastSeenTeamPolicyAudience(e){return this.client.setSharingPrefs({last_seen_team_policy_audience:e})}setSeenUpsellCounterPref(e){return this.dispatch(l.ShareModalActionTypes.SET_UPSELL_COUNTER_PREF),this.client.setSharingPrefs({has_seen_share_modal_upsell_premium_sharing_counter:e}).then((()=>{this.dispatch(l.ShareModalActionTypes.SET_UPSELL_COUNTER_PREF_SUCCESS)}))}setHasSeenPostSharingEsignPref(){return this.client.setSharingPrefs({has_seen_esign_post_sharing:!0})}setLastSeenPostSharingEsignTsPref(){return this.client.setSharingPrefs({is_in_esign_post_sharing_exclusion_period:!0})}onShareModalUnmount(e){var t;this.teardownPass();const s=e&&e.serializeInputData()||{};this.dispatch(l.ShareModalActionTypes.SHARE_MODAL_CLOSE,s);const n=this.getSharingInfo().getInitialProps();null===(t=n.onClose)||void 0===t||t.call(n),this.hasModalUnmounted=!0}fetchCurrentAccount(){return this.dispatch(l.ShareModalActionTypes.FETCH_CURRENT_ACCOUNT_REQUEST),this.client.getLightweightAccountCached().then((e=>{this.dispatch(l.ShareModalActionTypes.FETCH_CURRENT_ACCOUNT_SUCCESS,{teamPolicy:e.team_policies,isFamilyUser:e.is_family_user})}))}getAccountInfo(){return this.client.getCurrentAccountCached()}handleContentNameChange(e){const t="SIMPLIFIED_WIZARD_UI::CONTENT_NAME_CHANGE";this.hasLoggedSet[t]||(this.sharingExperimentsLog(t),this.hasLoggedSet[t]=!0),this.dispatch(l.ShareModalActionTypes.HANDLE_CONTENT_NAME_CHANGE,{name:e})}handleUpdateFilePolicy(e,t){this.handleUpdateSharingSettings(e);const s=this.getSharingInfo().filePolicy(),{fileId:n}=this.getPassFetchingInfo();if(n)if(s.viewer_info_policy===i.ViewerInfoPolicy.disabled&&t.viewer_info_policy===i.ViewerInfoPolicy.enabled)this.clearCachedPassInfo(),l.PassActions.resetPassInfo(n),l.PassActions.fetchPassError(n),this.dispatch(l.ShareModalActionTypes.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO);else{const e=s.audience===i.LinkAudience.members!=(t.audience===i.LinkAudience.members),a=s.viewer_info_policy===i.ViewerInfoPolicy.enabled&&t.viewer_info_policy===i.ViewerInfoPolicy.disabled;if(e||a){this.clearCachedPassInfo();const e=this.getUrl();a&&this.listMembers({contentId:n,url:e,isNonUserRelativeContext:this.sharingInfo.isNonUserRelativeContext()});const t=this.isContentInfoForFilePreview(this.getContentInfo());l.PassHelpers.setup({user:this.user,fileData:this.getFileData(e),prevFileData:null,shouldWritePresence:t,skipSharingEndpoints:!0})}}}handleUpdateSharingSettings(e){this.dispatch(l.ShareModalActionTypes.UPDATE_SHARING_SETTINGS_SUCCESS,{metadata:e})}listMembers({contentId:e,url:t,members:s,isNonUserRelativeContext:n=!1}){return l.SharingActions.listMembers({user:this.user,contentId:e,isFolder:this.sharingInfo.isFolder(),url:t,members:s,client:this.client,isNonUserRelativeContext:n})}addMembers(e,t,s=!1,n){const a=e.map((e=>({member:i.createUnionScalar(e.contactType(),e.contactId()),access_level:i.accessLevelConstToApi(e.access_type)})));return this.client.addMembersWithAccessLevel({contentId:t,members:a,customMessage:n,quiet:s})}isContentInfoForFilePreview(e){return("PREVIEW_PAGE"===e.extras.origin||"PREVIEW_PAGE_FACEPILE"===e.extras.origin)&&!e.isFolder()}isContentInfoForPaper(e){return e.extras&&"PAPER_INTEGRATION"===e.extras.origin}log(e,t={}){b.logTiburonEvent(this.getContentInfo(),this.user.id,e,t)}logIfHaventBefore(e,t={},s=!0){this.hasLoggedSet[e]||(this.hasLoggedSet[e]=!0,s&&(t.timing=Date.now()-this.beginTime),this.log(e,t))}redirectToBrowseUrl(e){if(null!=this.setUrl)this.setUrl({path:e});else{const t=i.browse_uri_for_fq_path(this.user,e);i.browserRedirectWrapper(t)}}redirectToUpgrade(){i.browserRedirectWrapper("/upgrade?oqa=spw")}refreshSharedWithColumnLinkData(){i.getStoreForSharedWith().dispatch(i.sharedLinkDataOutOfDate(this.getContentInfo().displayPath()))}relinquishMembershipSimple(e,t){return this.client.relinquishMembership({contentId:e,leaveACopy:t}).then((()=>{i.Modal.close(),this.redirectToBrowseUrl("/")}))}relinquishMembership(e,t){const s=this.getContentInfo();return this.relinquishMembershipSimple(e,t).then((()=>{s.isFolder()?h.sharingNotificationSuccess(o.intl.formatMessage({id:"CD+ZYc",defaultMessage:"Folder access removed."})):h.sharingNotificationSuccess(o.intl.formatMessage({id:"GTNg67",defaultMessage:"File access removed."}))}))}removeMemberSimple(e,t,s){return this.client.removeMember({contentId:e,memberId:t,leaveACopy:s})}removeMember(e,t,s,n){return this.dispatch(l.ShareModalActionTypes.MEMBER_ACTION_PENDING,{member:t}),this.log(k.TiburonEventName.AttemptRemoveMember),this.removeMemberSimple(e,t.memberId(),s).then((e=>(this.log(k.TiburonEventName.SucceedRemoveMember,{http_status_code:200}),this.fetchInitialData().then((()=>{if(e&&null!=e.access_level&&null!=e.warning)return this.dispatch(l.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS,{member:t,access:e.access_level}),e;n?h.sharingNotificationSuccess(o.intl.formatMessage({id:"CD+ZYc",defaultMessage:"Folder access removed."})):h.sharingNotificationSuccess(o.intl.formatMessage({id:"GTNg67",defaultMessage:"File access removed."})),this.dispatch(l.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS,{member:t}),this.fetchMemberCounts()}))))).catch((e=>{if(e instanceof i.ApiError){const s=e;return this.log(k.TiburonEventName.FailRemoveMember,{http_status_code:s.raw&&s.raw.status,error_tag:s.error&&s.error[".tag"]||"undefined_error",error_summary:s.summary}),this.dispatch(l.ShareModalActionTypes.MEMBER_ACTION_COMPLETE,{member:t}),this.parseParentFolderAccessError(s)}throw this.log(k.TiburonEventName.FailRemoveMember),e}))}setContentNameAndSendShare(e){const t=this.sharingInfo.contentNameInputValue(),s=i.parent_dir(this.sharingInfo.fqPath()),n=b.getNewFolderPathFromContentName(t,s);let a=!this.sharingInfo.isNonUserRelativeContext();this.getSharingInfo().shouldSuppressRedirectToBrowse()&&(a=!1);let r=a&&!i.shouldUseReactRouter();return this.getSharingInfo().shouldCloseImmediately()&&(r=!0),new Promise(((s,o)=>{new m.SharingApi(this.user).validate_new_sf_path(t,n,(()=>{this.dispatch(l.ShareModalActionTypes.VALIDATE_CONTENT_NAME_SUCCESS,{newFolderPath:n}),this.sendShare(e,{keepModalOpen:a,suppressSuccessSnackbar:r}).then((()=>{var e;if(this.sharingInfo.shareAsConfidential()&&i.WebUserActionLog.log(this.user.id,i.WebUserActionLogEvent.CONF_BY_CREATE_CONFIDENTIAL_FOLDER,{ns_id:this.sharingInfo.contentId(),who_has_access:i.WebUserActionLogExtraValue.SPECIFIC_PEOPLE,location:this.sharingInfo.isNonUserRelativeContext()?i.WebUserActionLogExtraValue.CONTENT_MANAGER:i.WebUserActionLogExtraValue.BROWSE}),a){const t=i.browse_uri_for_fq_path(this.user,n);t.updateQuery("show_share_success_snackbar","1"),this.sharingInfo.automationOptionChecked()&&(i.shouldUseReactRouter()&&(i.browserRedirectWrapper(t),H.asyncLaunchAddOrEditAutoFolderModal({fqPath:n,nsId:null===(e=this.sharingInfo.metadata())||void 0===e?void 0:e.nsId(),user:this.user,entryPoint:"share_modal",source:"add_from_folder_creation"}),s()),t.updateQuery("automations","from_share")),i.browserRedirectWrapper(t)}s()}))}),(e=>{this.sharingExperimentsLog("SIMPLIFIED_WIZARD_UI::INVALID_CONTENT_NAME");const t=m.extractErrors(e.responseText),s=t.folder_name&&t.folder_name.message_text;this.dispatch(l.ShareModalActionTypes.VALIDATE_CONTENT_NAME_ERROR,{errorMsg:s}),o(s)}))}))}setSharedLinks(e){this.dispatch(l.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS,{sharedLinks:e})}deleteLinkMetadata(e){this.dispatch(l.ShareModalActionTypes.DELETE_LINK_METADATA_SUCCESS,{deletedLink:e})}enableImmediateModalClose(e){const{inviteEligibleNotSeenContacts:t}=this.sharingInfo.getEligibleInviteAfterSharingContacts(),s=this.sharingInfo.sharingPrefs().invite_after_sharing_modal_variant;return e||0===t.length||"not_enabled"===s}sendShare(e,t={keepModalOpen:!1,suppressSuccessSnackbar:!1,suppressAllSnackbars:!1,suppressNotifications:!1}){var s;const n={outcomeHasBeenLogged:!1},c=(e,t)=>{this.log(e,t),n.outcomeHasBeenLogged=!0},d=this.getContentInfo().isFileFolder(),p=this.getSharingInfo().getInitialProps(),u=this.sharingInfo.contentInfo().id,m=this.sharingInfo.isDTLSM1Enabled()?this.sharingInfo.emailRecipientAccess():this.sharingInfo.recipientAccess();null===(s=p.onShareClick)||void 0===s||s.call(p,this.getSharingInfo().recipientTokens(),m);const g=fs.has(u);this.log(k.TiburonEventName.ClickInbandShareButton,{in_progress:g,access_level:m});const f=Date.now();let _,E;return this.recipientsChange(e.getContacts()).then((()=>this.validateContacts(this.sharingInfo.recipientTokens()))).then((()=>{if(E=this.sharingInfo.contactsError().level,E===b.ContactsErrorLevel.Error)return Promise.reject({});this.enableImmediateModalClose(t.keepModalOpen)&&(this.closeShareModal(),this.log(k.TiburonEventName.CloseShareModal,{time_modal_opened:Date.now()-f})),window.addEventListener("beforeunload",this.onPageNavigationAttempt),window.addEventListener("unload",this.onPageNavigationAway),fs.add(u),this.dispatch(l.ShareModalActionTypes.SEND_SHARE_REQUEST),_=i.contactsToMembers(this.sharingInfo.recipientTokens());const e=this.sharingInfo.contentInfo().extras.origin;return e!==i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS&&e!==i.SHARE_ACTION_ORIGIN_TYPE.WIZARD||i.WebUserActionLog.log(this.user.id,i.WebUserActionLogEvent.NEW_FOLDER_ADD_MEMBER,{num_invites:_.length}),this.shareIfFileFolder(t.suppressAllSnackbars?void 0:o.intl.formatMessage({id:"lhzBKS",defaultMessage:"Sharing <st>{folder_name}</st>..."},{st:e=>r.React$1.createElement("strong",null,e),folder_name:i.Emstring.em_snippet(this.sharingInfo.name(),i.SNIPPET_SIZES.FILENAME)}))})).then((()=>this.client.addMembers({accessLevel:m,contentId:this.sharingInfo.contentInfo().id,customMessage:this.sharingInfo.recipientMessage(),members:_,addMessageAsComment:!!this.sharingInfo.recipientMessage()&&this.sharingInfo.isShareMessageAsCommentChecked()&&this.sharingInfo.permissionsObj().canShareMessageAsComment(),quiet:t.suppressNotifications||!1}))).catch((e=>{if(e instanceof i.ApiError){const s=e.error&&e.error[".tag"];this.dispatch(l.ShareModalActionTypes.SEND_SHARE_FAILURE),t.suppressAllSnackbars||this.reportShareFailure(e),c(k.TiburonEventName.FailInbandShare,{http_status_code:e.raw&&e.raw.status,error_tag:s||"undefined",error_summary:"summary"in e?e.summary:"message"in e?e.message:"undefined",timing:Date.now()-f,num_recipients:_.length,access_level:m})}else c(k.TiburonEventName.FailInbandShare,{error_message:e.message,error_tag:E===b.ContactsErrorLevel.Error?"contacts_error":null,access_level:m});return Promise.reject({})})).then((()=>{var e,s,n,u,g,E,S,M;if(c(k.TiburonEventName.SucceedInbandShare,{timing:Date.now()-f,num_recipients:_.length,access_level:m}),this.dispatch(l.ShareModalActionTypes.SEND_SHARE_SUCCESS),this.sharingInfo.isShowingFileUploadToolkitCampaign())i.publishEvent(i.CampaignEvents.FILE_SHARE_SUCCESS,{context:{file_name:this.sharingInfo.name(),file_extension:i.file_extension(this.sharingInfo.name()),file_path:this.sharingInfo.fqPath()}}),h.showInBandShareSuccessSnackbar(this.sharingInfo.name());else{xe.emit("onSuccessSharing",{origin:this.sharingInfo.contentInfo().extras.origin,wasFileFolder:d}),this.fetchMemberCounts();const l=this.sharingInfo.contentInfo().extras.origin,{contextData:c,shouldShowShopModal:m}=this.getShopModalPrereqs();if(!t.suppressSuccessSnackbar&&!t.suppressAllSnackbars){const e=this.sharingInfo.name(),t=(M=this.getSharingInfo().sharingPrefs().capture_sdk_integration_voice_overs_variant,!!document.getElementById(jt)&&"V2"===M);if(this.shouldShowEsignDiscoveryUpsell()&&!m){const s=this.sharingInfo.hasSeenEsignPostSharing();s||this.setHasSeenPostSharingEsignPref(),((e,t,s,n,a,r,o,l)=>{i.Snackbar.show(es(e,t,s,n,a,r,o,l))})(e,h.formatSuccessMessageForFolder(e),this.sharingInfo.fqPath(),this.user.id,Number(this.sharingInfo.contentId()),s,t,(()=>{this.setLastSeenPostSharingEsignTsPref()}))}else t&&!m?(u=e,g=h.formatSuccessMessageForFolder(e),E=this.sharingInfo.fqPath(),S=this.user.id,i.Snackbar.close(zt),i.Snackbar.show(r.React$1.createElement(i.Snackbar,{title:g,id:zt,variant:"complete",onCloseClick:()=>{i.ProEventsLogger.log(qt.RECORD_VIDEO_SNACKBAR_DISMISS_CLICK,{user_id:S})},onShown:()=>{i.ProEventsLogger.log(qt.RECORD_VIDEO_SNACKBAR_SHOWN,{user_id:S})},richSnackbarProps:{actionBarAlignment:"left",actions:[Zt()],helperText:o.intl.formatMessage({id:"OcVFQv",defaultMessage:"Did you know you can record a voice-over and attach it to your file?"}),clickHandlerArgs:{userId:S,filePath:E||u}}}))):h.showInBandShareSuccessSnackbar(this.sharingInfo.name());i.UserSurvey.addAttribute("isFolder",String(this.sharingInfo.isFolder())),b.trackUserLeapEvent(b.SharingUserLeapEvent.SHARE_SUCCESS,l)}if(l!==i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS&&l!==i.SHARE_ACTION_ORIGIN_TYPE.WIZARD||i.WebUserActionLog.log(this.user.id,i.WebUserActionLogEvent.NEW_SHARED_FOLDER_SUCCESS,{}),null===(e=p.onSuccessSharing)||void 0===e||e.call(p),this.sharingInfo.automationOptionChecked()&&H.asyncLaunchAddOrEditAutoFolderModal({fqPath:this.sharingInfo.fqPath(),nsId:null===(s=this.sharingInfo.metadata())||void 0===s?void 0:s.nsId(),user:this.user,entryPoint:"share_modal",source:"add_from_folder_creation"}),this.refreshSharedWithColumnContentData(),!t.keepModalOpen){const{inviteEligibleNotSeenContacts:e,inviteEligibleSeenContacts:t}=this.sharingInfo.getEligibleInviteAfterSharingContacts(),s=this.getSharingInfo().sharingPrefs().invite_after_sharing_modal_variant;if(function(e,t){const s=e.length>0&&(function(e){return["admin_invite_after_move","admin_invite_expand_eligibility"].includes(e)}(t)||ss(t));return Boolean(s)}(e,s)){this.closeShareModal();const i=(n=t,[...ts(e,!0),...ts(n,!1)]);if("admin_invite_expand_eligibility"===s&&1===i.length){const e=i[0],t=Date.now(),n=this.loadShowGuestPassAdminInviteAfterSharingModal(),r=this.loadShowAdminInviteAfterSharingModal();(function(e){return a.__awaiter(this,void 0,void 0,(function*(){const t=ms(),s={guest_email:e};try{return!!(yield t.ns("guest_pass").rpc("get_invite_eligibility",s,{})).eligible}catch(e){throw new Error(e.error[".tag"])}}))})(e.email).then((e=>{e?n.then((e=>{e({eligibleUser:i[0],modalOrigin:l})})):r.then((e=>{e({eligibleUsers:i,adminModalVariant:s,modalOrigin:l,modalLoadingStartTime:t})}))}))}else if("admin_invite_expand_eligibility"===s){const e=Date.now();this.loadShowAdminInviteAfterSharingModal().then((t=>{t({eligibleUsers:i,adminModalVariant:s,modalOrigin:l,modalLoadingStartTime:e})}))}else if(ss(s)){const e=Date.now();this.loadShowMemberInviteAfterSharingModal().then((t=>{t({eligibleUsers:i,memberModalVariant:s,sharingOrigin:l,modalLoadingStartTime:e})}))}}else if(m){const e=b.getShopModalLoggingParams(this.getContentInfo(),this.getSharingInfo().getReferrer());i.publishEvent(i.CampaignEvents.SHARE_MODAL_CLOSED,{context:c,loggingParams:e})}else this.closeShareModal()}"V1"===this.sharingInfo.sharingPrefs().core_act_docsend_advanced_sharing&&P.setIsEligibleForDocsendSplitShareItemInUserMetadata(this.user.id)}return Promise.resolve()})).finally((()=>{n.outcomeHasBeenLogged||this.log(k.TiburonEventName.InconclusiveInbandShare),fs.delete(u)}))}closeShareModal(){this.hasModalUnmounted||i.Modal.close()}loadShowAdminInviteAfterSharingModal(){return a.__awaiter(this,void 0,void 0,(function*(){const{showAdminInviteAfterSharingModal:t}=yield new Promise((function(t,s){e(["./c_modals_invite_after_sharing_admin_invite_after_sharing_modal"],t,s)}));return t}))}loadShowGuestPassAdminInviteAfterSharingModal(){return a.__awaiter(this,void 0,void 0,(function*(){const{showGuestPassAdminInviteAfterSharingModal:t}=yield new Promise((function(t,s){e(["./c_modals_guest_pass_guest_pass_admin_invite_after_sharing_modal"],t,s)}));return t}))}loadShowMemberInviteAfterSharingModal(){return a.__awaiter(this,void 0,void 0,(function*(){const{showMemberInviteAfterSharingModal:t}=yield new Promise((function(t,s){e(["./c_modals_invite_after_sharing_member_invite_after_sharing_modal"],t,s)}));return t}))}shareFolderSimple(e,t=!1,s,n){const a=e=>{this.dispatch(l.ShareModalActionTypes.SHARE_FOLDER_SUCCESS,{metadata:e}),i.dispatcherSingleton.dispatch({type:f.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:e,user:this.user})},r={fqPath:e,confidential:t,syncSetting:s,folderPolicy:n||null},o=this.client.share(r);return this.dispatch(l.ShareModalActionTypes.SHARE_FOLDER_REQUEST,{promise:o}),o.then(a).catch((e=>{if(e instanceof i.AppError&&e.error&&e.error.bad_path&&"already_shared"===e.error.bad_path[".tag"]){const t=i.folderMetadataApiToRecord(e.error.bad_path);return a(t)}return this.dispatch(l.ShareModalActionTypes.SHARE_FOLDER_FAILURE),Promise.reject(e)}))}getFqPath(){let e;return e=this.sharingInfo.isNonUserRelativeContext()&&!this.user.is_cdm_member?`ns:${this.getContentInfo().nsId()}${this.getContentInfo().nsPath()}`:this.getContentInfo().displayPath(),e}isMemberAccessLevelQualified(e){return null!=e}sharingExperimentsLog(e,t={}){const s=this.getContentInfo().extras.modalSessionId;t.modalSessionId=t.modalSessionId||s,i.SharingExperimentsLogger.log(this.user.id,e,t)}teardownPass(){this.clearCachedPassInfo(),this.getPassFetchingInfo().shouldFetchPass&&l.PassHelpers.teardown({user:this.user,fileData:this.getFileData(),async:!0,shouldWritePresence:!1})}showStandardError(e){const t=e&&e.message;h.sharingNotificationError(t||o.intl.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."}))}shouldShowEsignDiscoveryUpsell(){return U.HELLOSIGN_SUPPORTED_EXTENSIONS.includes("."+i.file_extension(this.sharingInfo.name()))&&!this.sharingInfo.isInEsignPostSharingExclusionPeriod()&&this.isSendForSignatureEnabled&&!$.is_supported_mobile_browser()}shouldFetchDocsendAnalyticsLink(){var e;const t=this.sharingInfo.contentInfo(),s=W.getDocsendAnalyticsAddOnConfig(this.user,this.sharingInfo.getInitialProps().docsendAnalyticsAddOn);return s.coreSharingModal.fetchAnalyticsLink&&s.isSupportedFile((null===(e=this.sharingInfo.sharingInfoState().linkMetadata)||void 0===e?void 0:e.file_size)||0,i.file_extension(t.name()))&&"string"==typeof this.sharingInfo.contentInfo().id}fetchDocsendAnalyticsLink(){return a.__awaiter(this,void 0,void 0,(function*(){const e=this.sharingInfo.contentInfo(),t=i.file_extension(e.name());this.dispatch(l.ShareModalActionTypes.DOCSEND_ANALYTICS_LINK_REQUEST);const s=yield G.getLink(this.client,e.id,t,"share_modal",{subjectUserId:this.user.id});s?this.dispatch(l.ShareModalActionTypes.DOCSEND_ANALYTICS_LINK_SUCCESS,{linkData:{link:s.link,hasNewerFileVersion:s.file_has_newer_version,fileTimestampMicro:s.file_hlc_unix_micros}}):this.dispatch(l.ShareModalActionTypes.DOCSEND_ANALYTICS_LINK_FAILURE)}))}}function Es(){const e=new i.PermissionSetting({allow:!1});return new i.MemberPermissions({make_editor:e,make_viewer:e,make_owner:e,remove:e})}function Ss(e){const t=i.AnonymousViewerUtils.getAnonymousUserIds(e),s=o.intl.formatMessage({id:"+s6D7j",defaultMessage:"Guest"});return t.map((e=>new i.UserMembershipInfo({access_type:"reader",account:new i.BasicAccount({account_id:e,display_name:s,familiar_name:s,given_name:s,surname:""}),account_id:e,initials:i.AnonymousViewerUtils.getAnonymousViewerInitials(s),is_inherited:!1,permissions:Es(),same_team:!1,time_last_seen:null})))}class Ms{static activityUserToContact(e,t=0){return{dbx_account_id:e.unique_id,fname:e.fname,lname:e.lname,name:e.display_name,name_tokens:[e.fname,e.lname],email:e.email,type:i.ContactTypes.DBX_ID,priority:t,photo_url:e.photo_circle_url}}static teamGroupInfoToContact(e){return new i.Contact({group_id:e.id,group_size:e.group_size,type:i.ContactTypes.NEW_STYLE_GROUP,name:e.name,on_team:!0,pending:!1})}}const vs={TOP:"top",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM:"bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",RIGHT:"right",RIGHT_TOP:"right-top",RIGHT_BOTTOM:"right-bottom",LEFT:"left",LEFT_TOP:"left-top",LEFT_BOTTOM:"left-bottom"};class ks extends r.React$1.Component{constructor(){super(...arguments),this._renderArrow=()=>null!=this.props.arrow?[r.React$1.createElement("div",{className:"react-bubble-box__arrow-border",key:"arrow-border"}),r.React$1.createElement("div",{className:"react-bubble-box__arrow",key:"arrow"})]:[]}UNSAFE_componentWillMount(){if("undefined"!=typeof window&&null!==window)return N.require_css("/static/metaserver/static/css/react/bubble_box-vflhusCtq.css")}render(){const e=["react-bubble-box",`react-bubble-box--arrow-${this.props.arrow}`,this.props.className],t=c.assignIn({},c.omit(this.props,["arrow","className"]),{className:e.join(" ")});return r.React$1.createElement("div",Object.assign({},t),this._renderArrow(),this.props.children)}}ks.displayName="Bubble",ks.ARROW=vs,ks.propTypes={arrow:i.PropTypes.oneOf(c.values(vs)),className:i.PropTypes.string},ks.defaultProps={arrow:null,className:""};class bs extends r.React$1.Component{render(){return this.props.isFolder?this.renderFolder():this.renderFile()}renderFile(){const e={file:{type:i.FileTypes.FILE,fq_path:this.props.filename},className:this.props.className,variant:"small"};return r.React$1.createElement(j.FileIcon,Object.assign({},e))}renderFolder(){let e=i.FileTypes.FOLDER;this.props.pathExists&&(this.props.isTeamSharedFolder?e=i.FileTypes.TEAM_SHARED_FOLDER:this.props.isSharedFolder&&(e=i.FileTypes.SHARED_FOLDER));const t=Y.spectrumFolderIcon({fileType:e,isViewOnly:this.props.isViewOnly,isInTeamFolderTree:this.props.isFolderInsideTeamFolderTree,size:Y.SpectrumIconSize.Small,isConfidential:this.props.isConfidentialFolder||!1,iconPostfix:this.props.isConfidentialFolder?"_admin_view":""});return r.React$1.createElement(i.IconContent,{name:t,"aria-label":this.props.alt,role:"img",className:this.props.className})}}bs.displayName="ShareModalIcon";class Cs extends r.React$1.Component{constructor(e){super(e),this.handleContentNameFocus=()=>{this.setState({isFocusOnContentName:!0})},this.handleContentNameBlur=()=>{this.setState({isFocusOnContentName:!1})},this.state={isFocusOnContentName:this.props.isContentNameFocused},this.headerInputRef=r.React$1.createRef()}selectContentNameInput(){var e;this.headerInputRef&&(null===(e=this.headerInputRef.current)||void 0===e||e.select())}render(){return this.props.isCreatingNewFolder?r.React$1.createElement(d.SharingModalHeaderInput,{inputAutoFocus:void 0===this.props.initialContentName,forwardedRef:this.headerInputRef,icon:r.React$1.createElement(O.SharedFolderIcon,null),inputAriaLabel:this.props.contentNameMessage,inputPlaceholder:this.state.isFocusOnContentName?void 0:o.intl.formatMessage({id:"ss4CO0",defaultMessage:"Folder name"}),defaultValue:this.props.initialContentName,onClickCloseButton:this.props.onModalCloseClick,onInputChange:this.props.onContentNameInputChange,onInputFocus:this.handleContentNameFocus,onInputBlur:this.handleContentNameBlur,onInputKeyUp:this.props.onContentNameInputKeyUp,isContentNameFocused:this.state.isFocusOnContentName},this.shouldShowContentNameBubble()&&this.renderContentNameBubble()):r.React$1.createElement(d.SharingModalHeaderTitle,{closeButtonVisible:!0,icon:this.getIcon(),subTitle:!this.props.isLoading&&(this.props.subTitle||this.getMemberCountsString()),onClickCloseButton:this.props.onModalCloseClick,onClickSettingsButton:this.props.onSettingsButtonClick,settingsButtonVisible:this.props.isMetadataLoaded&&this.isContentSettingsEnabled(),title:this.getHeaderTitle()})}getHeaderTitle(){return this.props.initialContentName?this.props.initialContentName:i.Emstring.em_snippet(this.props.sharingInfo.name(),i.SNIPPET_SIZES.FILENAME)}isContentNameInputError(){return this.props.contentNameMessageLevel===l.CONTENT_NAME_MESSAGE_LEVELS.ERROR}shouldShowContentNameBubble(){return this.props.contentNameMessage&&(this.state.isFocusOnContentName||this.isContentNameInputError())}renderContentNameBubble(){return r.React$1.createElement(ks,{arrow:ks.ARROW.TOP,className:i.cx("unified-share-modal__content-name__tooltip","u-pad-xs","u-font-strong",{"unified-share-modal__content-name__tooltip-error":this.isContentNameInputError()})},this.props.contentNameMessage)}getIcon(){const e=this.props.contentInfo;if(e.isFolder()){if(!e.extras.exists)return r.React$1.createElement(O.SharedFolderIcon,null);if(!this.props.isMetadataLoaded)return e.isTeamSharedFolder()||e.isFolderInsideTeamFolderTree()?r.React$1.createElement(O.TeamFolderIcon,null):e.isSharedFolder()?r.React$1.createElement(O.SharedFolderIcon,null):r.React$1.createElement(O.SimpleFolderIcon,null)}return r.React$1.createElement(bs,{alt:"",className:"unified-share-modal__title-icon",filename:this.props.sharingInfo.name(),isSharedFolder:e.isSharedFolder(),isFolder:e.isFolder(),isTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:!0===this.props.isFolderInsideTeamFolderTree,isViewOnly:!this.props.canEdit,isConfidentialFolder:this.props.isInContentManager&&this.props.isConfidentialFolder,pathExists:e.pathExists()})}getSharingMemberCountsString(e){return this.ifAnyNonSelfMembers(e)?o.intl.formatMessage({id:"CQ2ZaT",defaultMessage:"Only you can access"}):o.intl.formatMessage({id:"bFyJSY",defaultMessage:"Shared with other people"})}ifAnyNonSelfMembers(e){const t=this.props.sharingInfo.members(),s=t.groups.count(),n=t.users.count(),i=this.props.sharingInfo.hasDirectMemberSelf(),a=this.props.sharingInfo.memberCounts().total_unique_users,r=0===s&&i;if(null===a||a<=1){const e=t.isOnlyMemberInAllGroups();return s>0&&e?0===n||i:r}return!1}getMemberCountsString(){const e=this.props.sharingInfo.memberNum();if(e&&!this.props.isSendingForSignature)return this.getSharingMemberCountsString(e)}isContentSettingsEnabled(){return this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings}}Cs.defaultProps={isLoading:!1},Cs.displayName="ShareModalHeaderSection";const ys={[i.ACCESS_LEVEL.OWNER]:o.intl.formatMessage({id:"if8xIl",defaultMessage:"Owner"}),[i.ACCESS_LEVEL.WRITER]:o.intl.formatMessage({id:"ywqz2g",defaultMessage:"Can edit"}),[i.ACCESS_LEVEL.READER]:o.intl.formatMessage({id:"Gz5ABt",defaultMessage:"Can view"}),[i.ACCESS_LEVEL.READER_NO_COMMENT]:o.intl.formatMessage({id:"vQquJX",defaultMessage:"View-only"})};i.ACCESS_LEVEL.OWNER,o.intl.formatMessage({id:"if8xIl",defaultMessage:"Owner"}),i.ACCESS_LEVEL.WRITER,o.intl.formatMessage({id:"ywqz2g",defaultMessage:"Can edit"}),i.ACCESS_LEVEL.READER,o.intl.formatMessage({id:"Cgg/GQ",defaultMessage:"Can comment"}),i.ACCESS_LEVEL.READER_NO_COMMENT,o.intl.formatMessage({id:"Gz5ABt",defaultMessage:"Can view"});const ws={[i.MEMBER_ACTION.MAKE_EDITOR]:o.intl.formatMessage({id:"l98l5t",defaultMessage:"People can edit, delete, comment, and add the files to their Dropbox"}),[i.MEMBER_ACTION.MAKE_VIEWER]:o.intl.formatMessage({id:"b2gULy",defaultMessage:"People can view, download, and comment"}),[i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]:o.intl.formatMessage({id:"SS1NPa",defaultMessage:"People can only view and download the files"})},Is={[i.MEMBER_ACTION.MAKE_EDITOR]:o.intl.formatMessage({id:"p1FXFw",defaultMessage:"People can edit, delete, comment, and add the file to their Dropbox"}),[i.MEMBER_ACTION.MAKE_VIEWER]:o.intl.formatMessage({id:"b2gULy",defaultMessage:"People can view, download, and comment"}),[i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]:o.intl.formatMessage({id:"EYJ3Li",defaultMessage:"People can only view and download the file"})},As={[i.MEMBER_ACTION.MAKE_EDITOR]:o.intl.formatMessage({id:"65RS70",defaultMessage:"People can edit and comment"}),[i.MEMBER_ACTION.MAKE_VIEWER]:o.intl.formatMessage({id:"9zXodW",defaultMessage:"People can view and comment"})};i.MEMBER_ACTION.MAKE_EDITOR,o.intl.formatMessage({id:"UFB0OU",defaultMessage:"Lets them view, comment, and edit."}),i.MEMBER_ACTION.MAKE_VIEWER,o.intl.formatMessage({id:"dLWWVm",defaultMessage:"Lets them view and comment, but not edit."}),i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT,o.intl.formatMessage({id:"Fp+s39",defaultMessage:"Lets them view only. They can’t see comments."}),i.MEMBER_ACTION.MAKE_EDITOR,o.intl.formatMessage({id:"UFB0OU",defaultMessage:"Lets them view, comment, and edit."}),i.MEMBER_ACTION.MAKE_VIEWER,o.intl.formatMessage({id:"dLWWVm",defaultMessage:"Lets them view and comment, but not edit."}),i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT,o.intl.formatMessage({id:"Fp+s39",defaultMessage:"Lets them view only. They can’t see comments."});const Ts=({className:e,variant:t="default"})=>r.reactExports.createElement("svg",{className:e,xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",viewBox:"0 0 9 5"},r.reactExports.createElement("path",{fill:"none",fillRule:"evenodd",stroke:"highlighted"===t?"#0269D9":"#3E3E3E",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M8 1L4.5 4 1 1"})),Ls=({className:e,variant:t="default"})=>r.reactExports.createElement("svg",{className:e,width:"12px",height:"6px",viewBox:"0 0 12 6",xmlns:"http://www.w3.org/2000/svg"},r.reactExports.createElement("g",{stroke:"highlighted"===t?"#0269D9":"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",fillOpacity:"0.8"},r.reactExports.createElement("g",{fill:"#000000"},r.reactExports.createElement("polygon",{points:"6 5.01369863 11.4626866 0 12 0.493150685 6 6 0 0.493150685 0.537313433 0"})))),Rs=({className:e})=>r.reactExports.createElement("svg",{className:e,width:"7px",height:"4px",viewBox:"0 0 7 4",xmlns:"http://www.w3.org/2000/svg"},r.reactExports.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},r.reactExports.createElement("g",{transform:"translate(-509.000000, -24.000000)",fill:"#637282"},r.reactExports.createElement("g",{transform:"translate(444.000000, 16.000000)"},r.reactExports.createElement("polygon",{points:"65 8 72 8 68.5 12"}))))),Ns=({className:e})=>r.reactExports.createElement("svg",{className:e,width:"7px",height:"4px",viewBox:"0 0 7 4",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},r.reactExports.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},r.reactExports.createElement("g",{transform:"translate(-509.000000, -128.000000)",fill:"#007AF5"},r.reactExports.createElement("polygon",{id:"Arrow",points:"509 128 516 128 512.5 132"}))));Ts.displayName="IconDropdownCaretOsx",Ls.displayName="IconDropdownCaretWin",Rs.displayName="IconDropdownCaretWeb",Ns.displayName="IconDropdownCaretBlueWeb";const xs=e=>{var{children:t,className:s,ref:n,disabled:o,fullWidth:l,variant:c="secondary"}=e,d=a.__rest(e,["children","className","ref","disabled","fullWidth","variant"]);const h=i.cx("mc-dropdown-menu-button","mc-button-styleless","mc-button-aria-wrapper",{"mc-button-full-width":l},s),p=d;return o&&(p.tabIndex=-1),r.reactExports.createElement(ee.dist.Button,Object.assign({tag:"button",type:"button",className:h,disabled:o},p),r.reactExports.createElement(se.DropdownButton,{tagName:"span",disabled:o,fullWidth:l,variant:c},t))};xs.displayName="DropdownMenuButton",xs.displayName="DropdownMenuButton";const Ps=e=>{var{children:t,className:s,disabled:n,fullWidth:o,onSelection:l,ref:c}=e,d=a.__rest(e,["children","className","disabled","fullWidth","onSelection","ref"]);const h=i.cx("mc-dropdown-menu",s,{"mc-dropdown-menu-full-width":o});let p=t;return t&&(p=r.reactExports.Children.map(t,(e=>{if(r.reactExports.isValidElement(e)&&e.type===xs){const t={disabled:n};return r.reactExports.cloneElement(e,t)}return e}))),r.reactExports.createElement(ee.dist.Wrapper,Object.assign({className:h,onSelection:e=>{l&&l(e)},ref:c},d),p)};Ps.displayName="DropdownMenu",Ps.displayName="DropdownMenu";const Fs=e=>{var{className:t,ref:s,children:n}=e,o=a.__rest(e,["className","ref","children"]);const l=i.cx("mc-menu",t);return r.reactExports.createElement(ee.dist.Menu,Object.assign({tag:"ul",className:l,ref:s},o),n)};Fs.displayName="Menu",Fs.displayName="Menu";const Os=e=>{var{children:t,className:s,disabled:n,ref:o,selected:l,value:c}=e,d=a.__rest(e,["children","className","disabled","ref","selected","value"]);const h=i.cx("mc-menu-item",s,{"mc-menu-item-disabled":n,"mc-menu-item-selected":l});return n?r.reactExports.createElement("li",Object.assign({className:h},d),r.reactExports.createElement(i.Button,{tagName:"span",variant:"styleless",className:"mc-menu-item-button",disabled:n},t)):r.reactExports.createElement(ee.dist.MenuItem,Object.assign({tag:"li",className:h,value:c},d),r.reactExports.createElement(i.Button,{variant:"styleless",className:"mc-menu-item-button"},t))};Os.displayName="MenuItem",Os.displayName="MenuItem";const Ds=e=>{var{className:t}=e,s=a.__rest(e,["className"]);const n=i.cx(t,"scl-sharing-menu");return r.reactExports.createElement(Fs,Object.assign({className:n},s))};Ds.displayName="SharingMenu";const $s=e=>{var{value:t,label:s,description:n,selected:o,variant:l="default"}=e,c=a.__rest(e,["value","label","description","selected","variant"]);return r.reactExports.createElement(Os,Object.assign({className:i.cx({"scl-sharing-menu-item-border":"border"===l}),key:t,value:t,text:s,selected:o},c),o&&r.reactExports.createElement(ne.IconDropdownSelectedBlue,{className:"scl-sharing-menu-item-selected-icon"}),r.reactExports.createElement("div",{className:i.cx("scl-sharing-menu-item-wrapper",{"scl-sharing-menu-item-wrapper-selected":o})},r.reactExports.createElement("div",{className:i.cx("scl-sharing-menu-item-label",{"scl-sharing-menu-item-label-default":"default"===l,"scl-sharing-menu-item-label-red":"red"===l})},s),r.reactExports.createElement("div",{className:"scl-sharing-menu-item-description"},n)))},Bs="scl-sharing-portal-dropdown-button";class Us extends r.reactExports.PureComponent{constructor(e){super(e),this.dropdownId=i.generateUUID("portalDropdown"),this.handleResizeEvent=()=>{this.state.isOpen&&this.resolvePortalPosition()},this.handleScrollEvent=()=>{this.state.isOpen&&this.resolvePortalPosition()},this.onMenuToggle=({isOpen:e})=>{e||this.positionedPortalEl.hidePortal(),this.setState({isOpen:e})},this.handlePortalDidShow=()=>{ee.dist.openMenu(this.dropdownId,{focusMenu:!0})},this.state={isOpen:!1}}componentDidUpdate(e,t){this.state.isOpen&&this.positionedPortalEl?(this.mountListeners(),this.resolvePortalPosition()):this.positionedPortalEl&&this.unMountListeners()}componentWillUnmount(){this.unMountListeners()}mountListeners(){document.addEventListener("scroll",this.handleScrollEvent,!1),window.addEventListener("resize",this.handleResizeEvent,!1)}unMountListeners(){document.removeEventListener("scroll",this.handleScrollEvent,!1),window.removeEventListener("resize",this.handleResizeEvent,!1)}resolvePortalPosition(){if(this.positionedPortalEl&&this.positionedPortalEl.portalInstance.portalContentElementRef){const e=r.reactDomExports.findDOMNode(this.positionedPortalEl);if(!(e instanceof Element))throw new Error("Unable to find PositionedPortal DOM node - check if this SharingPortalDropdown is still mounted");{const t=e.getElementsByClassName(Bs);if(!t.length)throw new Error("Unable to find SharingPortalDropdownButton - check if this SharingPortalDropdown is still mounted");{const e=t[0],s=this.positionedPortalEl.portalInstance.portalContentElementRef,n=e.getBoundingClientRect(),i=s.getBoundingClientRect(),a=10;let r={top:0,left:0};r=n.bottom+i.height>window.innerHeight?{top:n.top-i.height-a,left:n.left+n.width-i.width}:{top:n.top+n.height+a,left:n.left+n.width-i.width},s.style.top=r.top+"px",s.style.left=r.left+"px"}}}}render(){const{optionGroup:e,onSelection:t}=this.props;return r.reactExports.createElement(te.PositionedPortal,{closeOnBlur:!1,ref:e=>this.positionedPortalEl=e,renderContent:()=>r.reactExports.createElement(ee.dist.Wrapper,{id:this.dropdownId,onSelection:t,onMenuToggle:this.onMenuToggle},r.reactExports.createElement(ee.dist.Button,{className:"scl-sharing-portal-dropdown-button-invisible"},e.label),r.reactExports.createElement(Ds,{className:"scl-sharing-portal-menu"},r.reactExports.createElement(r.reactExports.Fragment,null,e.options.map((t=>r.reactExports.createElement($s,{description:t.tooltip,key:t.apiId,label:t.label,selected:e.selectedApiId===t.apiId,value:t.apiId,variant:t.variant,disabled:t.disabled})))))),role:"sharing-dropdown",showOnMouseMove:!1,showOnClick:!0,onDidShow:this.handlePortalDidShow},r.reactExports.createElement(i.Button,{className:i.cx(Bs,{"scl-sharing-portal-dropdown-button-expanded":this.state.isOpen}),variant:"styleless"},e.label,(()=>this.state.isOpen?r.reactExports.createElement(Ns,{className:"scl-sharing-portal-dropdown-icon scl-sharing-portal-dropdown-icon-web"}):r.reactExports.createElement(Rs,{className:"scl-sharing-portal-dropdown-icon scl-sharing-portal-dropdown-icon-web"}))()))}}Us.displayName="SharingPortalDropdown";class Hs extends r.reactExports.PureComponent{constructor(){super(...arguments),this.handleDropdownChange=e=>{const{id:t,onChange:s,optionGroup:n}=this.props;!s||n&&n.selectedApiId===e||s(t,e)}}render(){const{className:e,variant:t="default",position:s="default",tag:n}=this.props,a=n||"li",o=i.cx(e,{"scl-member-row":!0,"scl-member-row-borderless":"borderless"===t,"scl-member-row-default":"default"===t,"scl-member-row-narrow":"narrow"===t},{"scl-member-row-positioned":"bottom"===s||"middle"===s,"scl-member-row-bottom":"bottom"===s});return r.reactExports.createElement(a,{className:o},r.reactExports.createElement("div",{className:"scl-member-row-outer"},this.renderAvatar(),r.reactExports.createElement("div",{className:"scl-member-row-info"},this.renderDisplayName(),this.renderMemberDetails())),this.renderRightSideElement())}renderAvatar(){const{avatarHidden:e,avatarUrl:t,avatarElement:s,displayName:n,id:i,initials:a,initialAvatarShape:o}=this.props;return e?r.reactExports.createElement("div",{className:"scl-member-row-avatar-empty"}):s||(t?r.reactExports.createElement(X.Avatar,{src:t,className:"scl-member-row-avatar"}):r.reactExports.createElement(d.SharingAvatarInitials,{avatarSize:32,backgroundColor:X.avatarColorForUserIdentifier(n||i),className:"scl-member-row-avatar",shape:o},a))}renderRightSideElement(){const{id:e,loadingSpinnerVisible:t,optionGroup:s}=this.props;let n=null;return t?n=r.reactExports.createElement(d.ScooterLoader,null):s&&(n=1===s.options.length&&s.selectedApiId===s.options[0].apiId?r.reactExports.createElement("div",null," ",s.label," "):r.reactExports.createElement(Us,{id:e,optionGroup:s,onSelection:this.handleDropdownChange})),n}renderDisabledMessage(){return this.props.disabledMessage?[r.reactExports.createElement("span",{key:0,className:"u-font-meta dot"}," · "),r.reactExports.createElement("span",{key:1,className:"u-font-danger"}," ",this.props.disabledMessage)]:null}renderNameTitleAndText(){return r.reactExports.createElement("span",{className:"scl-member-row-info-display-name-title",title:this.props.displayName},this.props.truncatedDisplayName||this.props.displayName)}renderPASSDot(){return this.props.passString?r.reactExports.createElement("span",{className:"scl-member-row-dot"}," · "):null}renderOffTeamDot(){return this.props.offTeamMessage&&this.props.description?r.reactExports.createElement("span",{className:"u-font-meta"}," · "):null}renderPASS(){const{present:e,passString:t}=this.props;if(t){const s=i.cx({"scl-member-row-last-seen":!0,"scl-member-row-last-seen-not-present":!e});return r.reactExports.createElement("span",{className:s},t)}return null}renderDisplayName(){return r.reactExports.createElement("div",{className:"scl-member-row-display-name"},r.reactExports.createElement("span",{className:this.props.onClickDisplayName?"scl-member-row-pointer":"",onClick:this.props.onClickDisplayName},this.renderNameTitleAndText(),this.renderDisabledMessage(),this.renderPASSDot(),this.renderPASS()))}renderOffTeamMessage(e){return e?r.reactExports.createElement("span",{className:"u-font-meta"},e):null}renderMemberDetails(){const{description:e,offTeamMessage:t,truncatedDescription:s}=this.props;return r.reactExports.createElement("div",{className:"scl-member-row-details"},r.reactExports.createElement("span",{className:this.props.onClickDetails?"scl-member-row-pointer":"",onClick:this.props.onClickDetails},r.reactExports.createElement("span",{className:"scl-member-row-details-span",title:e},s||e),this.renderOffTeamDot(),this.renderOffTeamMessage(t)))}}Hs.displayName="MemberRow";class Vs extends r.React$1.Component{constructor(){super(...arguments),this.popoverGroup=new ke,this.onMemberRowChange=(e,t)=>{this.props.onAccessChangeInBubbleMenu(t)},this.openProfileCard=()=>{this.popoverRef&&this.popoverRef.openProfileCard()}}shouldLinkToGroup(){return this.props.member instanceof i.GroupMembershipInfo&&(!!this.props.member.same_team&&(!!this.props.user.is_team_admin||!!this.props.member.is_member&&this.props.member.group_management_type!==i.GroupManagementType.system_managed))}linkToGroup(e,t,s){const n=`/team#groups/${e.group_id}`,a=i.cx({"u-font-meta":!s,"sharing-member-info__group-name-link":!0,"sharing-member-info__display-name-title":s});return r.React$1.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:a,title:e.group_name},t)}renderAvatar(e,t){const s=this.props.member.displayName()||"",n=this.getAvatarInitials(),a=t?"SQUARE":"CIRCLE",{member:l,user:c,contentInfo:d,isPresent:h,isProfileCardEnabled:p}=this.props,u=i.AnonymousViewerUtils.isAnonymousUserId(l.memberId())?l.memberId():s,m=r.React$1.createElement("div",{className:"o-flag__fix"},r.React$1.createElement(Z.AvatarWithDefault,{dimension:Q.AvatarSize.MEDIUM,photoUrl:e,shape:a,defaultAvatar:r.React$1.createElement(Z.InitialsAvatarWithColorDerivedFromName,{dimension:Q.AvatarSize.MEDIUM,shape:a,initials:n,name:u,alt:""})}));if(p){const t=i.initStoreForIntegration(this.props.user.id);let s,n;if(l instanceof i.GroupMembershipInfo){const e=l;let t="";this.shouldRenderGroupCount()&&(t=o.intl.formatMessage({id:"ECZFz/",defaultMessage:"{count, plural, one{{count} member} other{{count} members}}"},{count:l.member_count})),s={avatarType:"group",targetGroup:{gid:e.group_id,groupName:e.displayName(),message:t}}}else if(l instanceof i.InviteeMembershipInfo){const t=l;s={avatarType:"invited_person",targetUser:{accountId:t.contact,displayName:t.displayName(),familiarName:t.displayName(),accessType:ys[t.access_type],email:t.contact,photoUrl:e||void 0}}}else if(l instanceof i.UserMembershipInfo){const t=l;s={avatarType:"joined_member",targetUser:{accountId:t.account_id,displayName:t.displayName()||t.email()||"",familiarName:t.displayName(),accessType:ys[t.access_type],isViewer:t.account_id===this.props.user.account_id,email:t.email(),photoUrl:e||void 0}},n=t.time_last_seen}const a={".tag":d.isFolder()?"folder":"file",id:i.fulfilled(d.idForLink()),name:d.name()};if(s)return r.React$1.createElement(ie.ProfileCardPopover,{popoverRef:e=>this.popoverRef=e,popoverGroup:this.popoverGroup,integrationStore:t,avatarInfo:s,entryPoint:"share_sheet",file:this.props.hasLinkMetadata?a:void 0,seenState:h?this.getPresentText():this.getLastSeenText(n),viewerId:c.id,positioning:"right",upsellPositioning:"right",portalParentElement:document.querySelector("body")||void 0,maxCalendarEventsToRender:1,autoRePosition:!0},r.React$1.createElement(i.Button,{variant:"circular"},m))}return m}getDisplayName(e,t){let s;this.props.member.displayName()&&(s=this.props.member.displayName()),s=void 0!==s?s:"";let n=this.getLastSeenText(e);this.props.isPresent?n=this.getPresentText():e&&(n=this.getLastSeenText(e));const a=this.getDisabledMessage(t);let r=0,o=0;n&&(r=new i.Emstring(`  ·  ${n}`).length),a&&(o=new i.Emstring(`  ·  ${a}`).length);const l=i.SNIPPET_SIZES.DISPLAY_NAME-r-o,c=i.Emstring.em_snippet(s,l);return this.shouldLinkToGroup()&&!this.shouldRenderGroupCount()?this.linkToGroup(this.props.member,c,!0):c}getAvatarInitials(){const e=this.props.member.displayName()||"";return i.getInitials(e)}getPresentText(){return o.intl.formatMessage({id:"BMhlbR",defaultMessage:"Viewing now"})}getLastSeenText(e){let t="";return e&&(t=o.intl.formatMessage({id:"uIg+ju",defaultMessage:"Viewed {time_str}"},{time_str:i.ago(e)})),t}getDisabledMessage(e){let t="";return e&&e.disabled&&(t=o.intl.formatMessage({id:"RBvabN",defaultMessage:"Deleted"})),t}getOffTeamMessage(e){let t="";const s=e&&!e.email;return!this.props.user.is_team||this.props.member.same_team||s||(t=o.intl.formatMessage({id:"x48gqV",defaultMessage:"Outside your Dropbox team"})),t}getMemberDetails(e,t){let s;return e?s=this.shouldLinkToGroup()?this.linkToGroup(this.props.member,e,!1):e:t&&t.email&&t.email_verified&&(s=t.email),s}isAllowedToRelinquishMembership(){return this.props.member.memberId()===this.props.user.account_id&&this.props.canRelinquishMembership}getOptionGroup(){let e=[],t="";const s=ys[this.props.member.access_type],n=(a=this.isAllowedToRelinquishMembership(),[[i.MEMBER_ACTION.MAKE_EDITOR,{value:i.ACCESS_LEVEL.WRITER,title:ys[i.ACCESS_LEVEL.WRITER],folder_description:ws[i.MEMBER_ACTION.MAKE_EDITOR],file_description:Is[i.MEMBER_ACTION.MAKE_EDITOR]}],[i.MEMBER_ACTION.MAKE_VIEWER,{value:i.ACCESS_LEVEL.READER,title:ys[i.ACCESS_LEVEL.READER],folder_description:ws[i.MEMBER_ACTION.MAKE_VIEWER],file_description:Is[i.MEMBER_ACTION.MAKE_VIEWER]}],[i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT,{value:i.ACCESS_LEVEL.READER_NO_COMMENT,title:ys[i.ACCESS_LEVEL.READER_NO_COMMENT],folder_description:ws[i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT],file_description:Is[i.MEMBER_ACTION.MAKE_VIEWER_NO_COMMENT]}],[i.MEMBER_ACTION.MAKE_OWNER,{value:i.ACCESS_LEVEL.OWNER,title:o.intl.formatMessage({id:"+ZJXxL",defaultMessage:"Make owner"})}],[i.MEMBER_ACTION.REMOVE,{value:"remove",title:a?o.intl.formatMessage({id:"eTtbKw",defaultMessage:"Remove my access"}):o.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"})}],[i.MEMBER_ACTION.MANAGE_LINK_ACCESS,{value:"manage_link_access",title:o.intl.formatMessage({id:"qG3VMJ",defaultMessage:"Manage access"})}]]);var a;for(const s of n){const n=s[0],i=s[1];this.props.member.access_type===i.value&&(t=i.value);const a=this.getOptionGroupOption(n,i);a&&e.push(a)}const r=e.find((e=>e.apiId===i.MEMBER_ACTION.MANAGE_LINK_ACCESS));return r&&(e=[r]),{id:`optionGroup${this.props.member.memberId()}`,label:s,options:e,selectedApiId:t,enabled:!this.props.isMemberActionPending}}getOptionGroupOption(e,t){var s;if(t.value===i.MEMBER_ACTION.MANAGE_LINK_ACCESS&&this.props.isLinkVisitor)return{apiId:t.value,label:t.title,tooltip:o.intl.formatMessage({id:"Ja6XYU",defaultMessage:"Change or remove their access in link settings"}),disabled:!1};if(function(e,t,s,n,a,r){return t===s||n&&n.get(e)&&n.get(e).allow&&(!a||e===i.MEMBER_ACTION.REMOVE)||t===i.MEMBER_ACTION.REMOVE&&r}(e,t.value,this.props.member.access_type,this.props.member.permissions,this.props.member instanceof i.UserMembershipInfo&&!0===(null===(s=this.props.member.account)||void 0===s?void 0:s.disabled),this.isAllowedToRelinquishMembership())){const e=this.props.contentInfo.isFolder()?t.folder_description:t.file_description,s=t.value===i.MEMBER_ACTION.REMOVE?"red":t.value===i.ACCESS_LEVEL.READER?"border":"default";return{apiId:t.value,label:t.title,tooltip:e||"",variant:s}}}renderSeenStateInfo(e,t){const s=o.intl.formatDate(t,{day:"numeric",month:"short",year:"numeric"}),n=o.intl.formatTime(t,{hour:"numeric",minute:"numeric"});return r.React$1.createElement(J.TitleBubble,{content:r.React$1.createElement("div",null,s,n&&r.React$1.createElement("br",null),n),className:"timestamp-tooltip",children:r.React$1.createElement("span",null,e),position:re.StickyPosition.BOTTOM,isTargetPositionFixed:!0})}shouldRenderGroupCount(){return this.props.member instanceof i.GroupMembershipInfo&&this.props.member.member_count}render(){const{member:e}=this.props;let t,s,n,a,l,c=!1,d="";if(e instanceof i.UserMembershipInfo){if(d=e.account_id,s=e.account,!s)return null;n=s.profile_photo_url,t=e.time_last_seen}else e instanceof i.GroupMembershipInfo&&(d=e.group_id,c=!0,"team"===e.group_type&&(n=r.static_url("/static/metaserver/static/images/icons/team_24@2x-vflR8kGKs.png")),this.shouldRenderGroupCount()&&(a=o.intl.formatMessage({id:"ECZFz/",defaultMessage:"{count, plural, one{{count} member} other{{count} members}}"},{count:e.member_count})));return this.props.wrappedGroupViewersElement&&this.props.wrappedGroupViewersElement.element?l=this.props.wrappedGroupViewersElement.element:this.props.isPresent?l=this.getPresentText():t&&(l=this.renderSeenStateInfo(this.getLastSeenText(t),t)),r.React$1.createElement(Hs,{id:d,avatarUrl:n||"",avatarElement:this.renderAvatar(n,c),initialAvatarShape:c?"square":"circle",displayName:this.getDisplayName(t,s),disabledMessage:this.getDisabledMessage(s),description:this.getMemberDetails(a,s),passString:l,offTeamMessage:this.getOffTeamMessage(s),present:this.props.isPresent,initials:this.getAvatarInitials(),loadingSpinnerVisible:this.props.isMemberActionPending,optionGroup:this.getOptionGroup(),onChange:this.onMemberRowChange,variant:this.props.isInheritedMember?"borderless":"default",onClickDetails:this.props.isProfileCardEnabled?this.openProfileCard:void 0,onClickDisplayName:this.props.isProfileCardEnabled?this.openProfileCard:void 0})}}Vs.displayName="SharingMemberListItemElement",Vs.defaultProps={canInviteMembers:!1,canRelinquishMembership:!1,disabled:!1,isPresent:!1,isViewOnly:!1};const Gs=i.connect((e=>({isProfileCardEnabled:V.isProfileCardInShareSheetEnabled(e)})))(Vs);class Ws{constructor(e){e.when_last_seen&&(this.time_last_seen=new Date(1e3*e.when_last_seen));const t=e.seen_state_user;this.account_id=t.user_id,this.display_name=t.display_name,this.email=t.email,this.photo_circle_url=t.photo_circle_url,this.same_team=!0}displayName(){return this.display_name}memberId(){return this.account_id}}var Ks,zs;!function(e){function t(e,t){const s=t.has(e.account_id)?o.intl.formatMessage({id:"BMhlbR",defaultMessage:"Viewing now"}):i.ago(e.time_last_seen);return[r.React$1.createElement("tr",null,r.React$1.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__member-name"},i.Emstring.em_snippet(e.displayName(),i.SNIPPET_SIZES.DISPLAY_NAME)),r.React$1.createElement("td",{className:"group-tooltip__viewers-table-cell dot"},"·"),r.React$1.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__seen-string"},s))]}e.make=function(e,s){const n=o.intl.formatMessage({id:"4joFvJ",defaultMessage:"{count, plural, one{{count} viewer} other{{count} viewers}}"},{count:e.length}),i=e.length<=10,a=i?e.length:9;let l=t(e[0],s);for(let n=1;n<a;n++)l=l.concat(t(e[n],s));if(!i){const t=e.length-a,s=o.intl.formatMessage({id:"6gF5ZF",defaultMessage:"{count, plural, one{and {count} other} other{and {count} others}}"},{count:t});l=l.concat(r.React$1.createElement("tr",null,r.React$1.createElement("td",{className:"group-tooltip__viewers-table-cell group-tooltip__member-name"},s)))}return{element:r.React$1.createElement(J.TitleBubble,{content:r.React$1.createElement("table",{className:"group-tooltip__viewers-table"},r.React$1.createElement("tbody",null,l)),className:"group-tooltip",children:r.React$1.createElement("span",{className:"u-font-meta sharing-member-info__viewer-count-text"},n),position:re.StickyPosition.BOTTOM,isTargetPositionFixed:!0}),elementText:n}}}(Ks||(Ks={})),function(e){e[e.RemoveAccess=0]="RemoveAccess",e[e.DowngradeAccess=1]="DowngradeAccess"}(zs||(zs={}));class qs extends r.React$1.Component{constructor(){super(...arguments),this.renderMembersListItem=(e,t,s)=>{const n=e.memberKey(),a=this.isLinkVisitor(e,t),o=this.props.groupSeenStateInfo[e.memberId()]?this.renderWrappedGroupViewersElement(e):void 0,l=this.props.canUpdateConfidentiality&&e.is_inherited,c=!!l||!this.props.contentInfo.isFileFolder()&&this.props.canRelinquishMembership;return r.React$1.createElement(Gs,{hasLinkMetadata:this.props.hasLinkMetadata,canInviteMembers:this.props.canInviteMembers,canRelinquishMembership:c,contentInfo:this.props.contentInfo,wrappedGroupViewersElement:o,isInheritedMember:s,isMemberActionPending:this.props.pendingMemberAction.has(n),isPresent:this.props.shouldShowPassUI&&this.isMemberCurrentlyViewing(e),key:n,member:e,user:this.props.user,onAccessChangeInBubbleMenu:t=>{const s=t===i.MEMBER_ACTION.REMOVE,n=t===i.MEMBER_ACTION.MANAGE_LINK_ACCESS,r=!s&&i.isLowerAccess(e.access_type,t),o=this.props.contentInfo.isSharedFolder()?e.inherited_access_type:e.access_type,c=s||r&&o&&i.isLowerAccess(o,t);if((s||r)&&this.props.onShowSecurityBanner){const e=s?zs.RemoveAccess:zs.DowngradeAccess;this.props.onShowSecurityBanner(e)}if(l&&c){const s=this.props.ownerTeamName,n={new_access:t,old_access:e.access_type,inherited_access:o};return b.logTiburonEvent(this.props.contentInfo,this.props.user.id,k.TiburonEventName.SelectChangeMemberPermission,n),this.props.actionHandler.handleInheritedMemberAccessChange(e,s,r,r?t:void 0)}if(n&&a){const t="writer"===e.access_type?"editor":"viewer",s={access_level:t};return b.logTiburonEvent(this.props.contentInfo,this.props.user.id,k.TiburonEventName.ClickManageAccess,s),this.props.actionHandler.handleLinkSettingsClick({isLinkOnly:!1,linkAccessLevel:t})}return this.props.actionHandler.handleMemberAccessChange(e,t)},isLinkVisitor:a})}}render(){const e=b.makeMemberSortCmp(this.props.user,this.props.presentAccountIds||i.immutableExports.Set(),this.shouldSortUsingPassRules()),t=this.membersByInheritance();let s=t.get(!1);s&&(s=s.sort(e));let n=t.get(!0);n&&(n=n.sort(e));let a=null;return this.props.areMembersFullyLoaded||(a=r.React$1.createElement("div",{className:"sharing-member-list__loading c-loader u-mar-horizontal-auto u-l-b"},o.intl.formatMessage({id:"A0CVFo",defaultMessage:"Loading more members..."}))),r.React$1.createElement(i.Provider,{store:i.initStoreForIntegration(this.props.user.id)},r.React$1.createElement("div",{className:"sharing-member-list"},this.renderInheritedUI(s,n),a))}shouldSortUsingPassRules(){const e=l.passStore.getPassPermissions(this.props.contentInfo.extras.fileId);return null!=e&&(e.canReadPresence||e.canReadSeenState)}renderInheritedUI(e,t){const s=i.immutableExports.Set(this.getLinkVisitors()),n=this.renderInheritedMembers(s,t);let a=null;e&&e.count()>0&&(a=r.React$1.createElement("div",null,e.map((e=>this.renderMembersListItem(e,s))).toArray()));const o=i.cx({"o-list-ui":!0});return r.React$1.createElement("ul",{className:o},n,a)}renderInheritedMembers(e,t){const{isConfidentialFolder:s,ownerTeamName:n}=this.props;if(this.shouldShowInherited()&&n&&!s)return r.React$1.createElement(Ht,{actionHandler:this.props.actionHandler,canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,memberCounts:this.props.memberCounts,members:t?t.toArray():[],ownerTeamName:n},t&&t.map((t=>this.renderMembersListItem(t,e,!0))))}getLinkVisitors(){return this.props.linkMembers.concat(this.props.guestMembers)}isLinkVisitor(e,t){return e instanceof i.UserMembershipInfo&&t.contains(e)}isMemberCurrentlyViewing(e){return!this.memberIsAssumed(e)&&(e instanceof i.UserMembershipInfo&&this.props.presentAccountIds&&this.props.presentAccountIds.has(e.account_id))}memberIsAssumed(e){return e instanceof i.UserMembershipInfo&&e.account_id===this.props.user.account_id&&i.Viewer.get_viewer().is_assume_user_session}dedupUsersAndLinkVisitors(e,t){let s=i.immutableExports.Map();return t.forEach((e=>{s=s.set(e.memberKey(),e)})),s.merge(e)}membersByInheritance(){const e=this.getLinkVisitors(),t=e=>this.shouldShowInherited()&&e.is_inherited,{membership:s}=this.props;if(!s)return e.length>0?i.immutableExports.List(e).groupBy(t):i.immutableExports.Map();const{groups:n,invitees:a,users:r}=s,o=this.dedupUsersAndLinkVisitors(r,e);return n.valueSeq().concat(a.valueSeq(),o.valueSeq()).groupBy(t)}shouldShowInherited(){const e=this.props.actionHandler.getSharingInfo(),t=!!e.parentSharedFolderId();return e.isUserOnOwnerTeam()&&t}extractGroupSeenStateAndViewers(e){const t=this.props.groupSeenStateInfo[e.memberId()];let s=[];return this.props.presentAccountIds&&(s=t.map((e=>new Ws(e))).filter((e=>null!=e.time_last_seen||this.props.presentAccountIds.has(e.account_id)))),{singleGroupSeenStateInfo:t,viewers:s}}renderWrappedGroupViewersElement(e){const{viewers:t}=this.extractGroupSeenStateAndViewers(e);return t.length?Ks.make(t,this.props.presentAccountIds):{element:null,elementText:""}}}qs.displayName="SharingMemberList",qs.defaultProps={disabled:!1,groupSeenStateInfo:{},guestMembers:[],linkMembers:[]};const js="scl-sharing-dropdown-menu",Ys=e=>{const{position:t,className:s}=e,n=a.__rest(e,["position","className"]),o=i.cx(js,s,{[`${js}--right`]:"right"===t});return r.reactExports.createElement(Ps,Object.assign({className:o},n))};Ys.displayName="SharingDropdownMenu";const Zs="scl-sharing-dropdown-menu-button";class Qs extends r.reactExports.PureComponent{render(){const e=this.props,{children:t,className:s}=e,n=a.__rest(e,["children","className"]),o=i.cx(Zs,s);return r.reactExports.createElement(xs,Object.assign({className:o},n),t,r.reactExports.createElement(Ts,{className:`${Zs}__icon ${Zs}__icon--osx`}),r.reactExports.createElement(Ls,{className:`${Zs}__icon ${Zs}__icon--win`}))}}Qs.displayName="SharingDropdownMenuButton";const Js="scl-sharing-dropdown-menu-item",Xs=e=>{var{description:t,label:s,selected:n,value:o}=e,l=a.__rest(e,["description","label","selected","value"]);return r.reactExports.createElement(Os,Object.assign({className:Js,key:o,value:o,text:s,selected:n},l),n&&r.reactExports.createElement(ne.IconDropdownSelected,{className:`${Js}__selected-icon`}),r.reactExports.createElement("div",{className:i.cx(`${Js}__wrapper`,{[`${Js}__wrapper-selected`]:n})},r.reactExports.createElement("div",{className:`${Js}__label`},s),t&&r.reactExports.createElement("div",{className:`${Js}__description`},t)))};Xs.displayName="SharingDropdownMenuItem";const en="scl-sharing-modal-contacts-field";class tn extends r.reactExports.Component{constructor(e){super(e),this.renderDropdown=()=>{const{labelledAccessTypes:e,selectedAccessType:t,showNoEditTooltip:s,noEditText:n}=this.props,i=t?t.label:void 0,a=r.reactExports.createElement(Ys,{position:"right",onSelection:this.handleChange},r.reactExports.createElement(Qs,{disabled:s},i),r.reactExports.createElement(Fs,null,r.reactExports.createElement(r.reactExports.Fragment,null,e.map((e=>r.reactExports.createElement(Xs,{"aria-label":e.ariaLabel,description:e.details,key:e.apiId,label:e.label,selected:t&&t.apiId===e.apiId,value:e.apiId}))))));return s?r.reactExports.createElement(oe.Tooltip,{positioning:"below",tooltipContent:n},a):a},this.handleChange=e=>{this.props.onAccessTypeChange&&this.props.onAccessTypeChange(e)}}render(){const{className:e,toLabel:t}=this.props,s=i.cx(en,e);return r.reactExports.createElement("div",{className:s},r.reactExports.createElement("div",{className:`${en}__left`},r.reactExports.createElement("div",{className:`${en}__to-label`},t),r.reactExports.createElement("div",{className:`${en}__input`},this.props.contactsField)),r.reactExports.createElement("div",{className:`${en}__right`},this.renderDropdown()))}}tn.displayName="SharingModalContactsField";class sn extends r.reactExports.PureComponent{render(){const{avatarUrl:e,displayName:t,validation:s}=this.props,n=r.reactExports.createElement("div",{style:{display:"flex",maxWidth:"200px"}},e&&r.reactExports.createElement(X.Avatar,{size:16,src:e}),r.reactExports.createElement("div",{style:{flex:"auto",marginLeft:"5px",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},t));return s&&"invalid"===s.state?r.reactExports.createElement(oe.Tooltip,{tooltipContent:s.msg?s.msg:""},n):n}}sn.displayName="SharingContactToken";const nn=64,an=10,rn=1,on="mc-suggestions-list",ln="mc-suggestions-list-suggestion";class cn extends r.reactExports.Component{constructor(e){super(e),this.requestedNextPage=!1,this.updatedFromNextPage=!1,this.culledListInstance=null,this.renderSuggestionRow=(e,t,s)=>{const{selectedIndex:n=0,listItemHeight:a=nn,id:o,assignActivedescendant:l,onSelect:c,renderSuggestion:d}=this.props,h=Array.isArray(a)?a[t]:a,p=t===n?i.cx(ln,"selected"):i.cx(ln);return r.reactExports.createElement("li",{id:l&&o&&l(o,t),key:t,role:"option","aria-selected":t===n,onClick:()=>c(e,t),className:p,style:{position:"absolute",top:s,height:h}},d(e))},this.onRangeInView=(e,t)=>{const{onNextPageRequested:s,suggestionsBuffer:n=an,suggestions:i}=this.props;i.length-1-t<=n&&!this.requestedNextPage&&s&&(this.updatedFromNextPage=!0,s(),this.requestedNextPage=!0)},this.cachedSuggestions=e.suggestions}UNSAFE_componentWillUpdate(e){const{suggestions:t}=this.props;this.cachedSuggestions=e.suggestions,t.length!==e.suggestions.length&&(this.requestedNextPage=!1);const s=t!==e.suggestions,n=this.props.selectedIndex!==e.selectedIndex;!s&&n&&(this.cachedSuggestions=[...this.cachedSuggestions])}componentDidUpdate(){if(this.culledListInstance){const e=r.reactDomExports.findDOMNode(this.culledListInstance);if(e instanceof Element){const{listItemHeight:t=nn,selectedIndex:s=0}=this.props;let n=0,i=0;if(Array.isArray(t)){for(let e=0;e<s;e++)n+=t[e];i=n+t[s]}else n=t*s,i=t*(s+1);const a=i-(e.scrollTop+this.props.height);a>0&&(e.scrollTop+=a);const r=e.scrollTop-n;this.updatedFromNextPage||r>0&&(e.scrollTop=e.scrollTop-r)}}this.updatedFromNextPage=!1}getRenderHeightForList(){const{suggestions:e,height:t,listItemHeight:s=nn}=this.props;if(0===e.length)return 0;let n=0;if(Array.isArray(s)){for(const e of s)if(n+=e,n>=t)break}else n=s*e.length;return Math.min(n,t)}render(){const{dig2retrofit:e,listItemHeight:t=nn,suggestionsBuffer:s=an,scrollThreshold:n=rn,className:a,id:o,"aria-labelledby":l}=this.props,c=i.cx(on,a,{[`${on}-dig2`]:e});return r.reactExports.createElement("div",{className:c,onMouseDown:e=>{e.preventDefault()}},r.reactExports.createElement(de.CulledList,{ref:e=>this.culledListInstance=e,className:"mc-suggestions-list-culled-list","aria-labelledby":l,id:o,role:"listbox",items:this.cachedSuggestions,listItemHeight:t,shouldUseWindowAsScrollContainer:!1,onRangeInView:this.onRangeInView,renderRow:this.renderSuggestionRow,scrollThreshold:n,itemBuffer:s,viewportHeight:this.getRenderHeightForList()}))}}cn.displayName="SuggestionsList";const dn=e=>{let t,s;const{children:n,className:o,dig2retrofit:l,focused:c=!1,onClose:d,onClick:h,onKeyDown:p,onFocus:u,onBlur:m,selected:g=!1,variant:f="default",tabIndex:_=-1,tooltipContent:E}=e,S=a.__rest(e,["children","className","dig2retrofit","focused","onClose","onClick","onKeyDown","onFocus","onBlur","selected","variant","tabIndex","tooltipContent"]),M=i.cx(o,{"mc-token":!0,"mc-token-error":"error"===f,"mc-token-focused":c,"mc-token-selected":g,"mc-token-warning":"warning"===f,"mc-token-dig2":l}),v=e.id?"tooltip-for-"+e.id:void 0,k=r.reactExports.createElement("svg",{width:13,height:13,viewBox:"0 0 24 24",className:"mc-token-close-icon"},r.reactExports.createElement("title",null,"Delete Token"),r.reactExports.createElement("path",{className:"mc-token-close-icon-x",d:"M12 10.586l-4.95-4.95L5.636 7.05l4.95\n        4.95-4.95 4.95 1.414 1.414 4.95-4.95\n        4.95 4.95 1.414-1.414-4.95-4.95\n        4.95-4.95-1.414-1.414z",fillRule:"evenodd"}));return r.reactExports.createElement("div",Object.assign({className:M,onKeyDown:e=>{const{key:t}=e;"Backspace"===t&&d&&(e.preventDefault(),d(e)),"Enter"===t&&h&&h(e),p&&p(e)},role:"button",onClick:e=>{const s=e.target;t===s||t.contains(s)||h&&h(e)},onFocus:e=>{const n=e.target;t===n||t.contains(n)||(u&&u(e),s&&s.showTooltip())},onBlur:e=>{m&&m(e),s&&s.hideTooltip()},tabIndex:_},S),r.reactExports.createElement(oe.Tooltip,{tooltipContent:E,ref:e=>s=e,id:v},r.reactExports.createElement("div",{className:"mc-token-inner-wrapper"},r.reactExports.createElement("div",{className:"mc-token-content"},n),r.reactExports.createElement("button",{className:"mc-token-close",onClick:e=>{d&&d(e)},tabIndex:-1,ref:e=>t=e},k))))};dn.displayName="Token";const hn=e=>{const{key:t}=e;if("ArrowRight"===t){const t=e.currentTarget.nextElementSibling;t&&t.focus()}if("ArrowLeft"===t){const t=e.currentTarget.previousElementSibling;t&&t.focus()}},pn=e=>{const{className:t,dig2retrofit:s,inputElement:n,inputProps:a,tokens:o}=e,l=i.cx(t,{"mc-tokenized-input":!0,"mc-tokenized-input-dig2":s}),c=o.map((e=>r.reactExports.cloneElement(e,{onKeyDown:hn})));return r.reactExports.createElement("div",{className:l},c,r.reactExports.cloneElement(n,a))};pn.defaultProps={inputElement:r.reactExports.createElement("input",{className:"mc-tokenized-input-input","aria-label":"typeAhead input",onKeyDown:e=>{const t=e.currentTarget.selectionStart,s=e.currentTarget.selectionEnd,{key:n}=e;if(0===t&&s===t&&("ArrowLeft"===n||"Backspace"===n)){e.preventDefault();const t=e.currentTarget.previousElementSibling;t&&t.focus()}},placeholder:"Type here"}),tokens:[]},pn.displayName="TokenizedInput";const un="typeahead";class mn extends r.reactExports.Component{constructor(){super(...arguments),this.confirmedId=this.props.id||i.generateUUID(un),this.state={suggestionsListSelectedIndex:0,selectedToken:{content:null,key:"",variant:"default"},suggestionListVisible:!1,inputValue:""},this.handleOnClick=e=>{this.setState({selectedToken:e})},this.handleOnTokenBlur=()=>{this.setState({selectedToken:{content:null,key:"",variant:"default"}})},this.handleInputBlur=()=>{this.setState({suggestionListVisible:!1})},this.handleInputFocus=()=>{this.setState({suggestionListVisible:!0})},this.handleTokenFocus=e=>{this.setState({selectedToken:e})},this.handleOnSelect=(e,t)=>{this.props.onSelect(e,t,this.state.inputValue),this.setState({inputValue:""})},this.handleKeyDown=e=>{const{suggestions:t,tokenizeKeyCodes:s}=this.props,{suggestionsListSelectedIndex:n}=this.state,i=e.currentTarget.selectionStart,a=e.currentTarget.selectionEnd,{key:r,which:o}=e;if(0===i&&a===i&&("ArrowLeft"===r||"Backspace"===r)){e.preventDefault();const t=e.currentTarget.previousElementSibling;t&&t.focus()}(!s&&"Enter"===r||s&&-1!==s.indexOf(o))&&(e.preventDefault(),t.length?this.handleOnSelect(t[n],n):this.handleOnSelect(null,-1),this.setState({suggestionsListSelectedIndex:0})),"ArrowUp"===r&&this.setState({suggestionsListSelectedIndex:Math.max(n-1,0)}),"ArrowDown"===r&&this.setState({suggestionsListSelectedIndex:Math.min(n+1,t.length-1)})},this.handleOnChange=e=>{const t=e.currentTarget.value;this.setState({suggestionsListSelectedIndex:0,inputValue:t}),this.props.onChange(t)},this.handleOnRemove=(e,t)=>{this.setState({selectedToken:{content:null,key:"",variant:"default"}}),this.props.onRemoveToken(t.content);const s=e.currentTarget.previousElementSibling,n=e.currentTarget.nextElementSibling;s?s.focus():n&&n.focus()}}UNSAFE_componentWillReceiveProps(e){const{suggestions:t}=e;0===t.length&&this.setState({suggestionsListSelectedIndex:0}),this.props.id!==e.id&&(this.confirmedId=e.id||i.generateUUID(un))}renderTokens(){return this.props.tokens.map((e=>r.reactExports.createElement(dn,Object.assign({},this.props.tokenProps,{dig2retrofit:this.props.dig2retrofit,key:e.key,onClick:()=>this.handleOnClick(e),onClose:t=>this.handleOnRemove(t,e),onBlur:this.handleOnTokenBlur,onFocus:()=>this.handleTokenFocus(e),selected:e.key===this.state.selectedToken.key,variant:e.variant}),this.props.renderTokenContent(e.content))))}renderSuggestionsList(){const{suggestions:e,renderSuggestion:t,height:s,onNextPageRequested:n,listItemHeight:i,"aria-labelledby":a,assignActivedescendant:o}=this.props,{suggestionsListSelectedIndex:l}=this.state;if(this.shouldRenderSuggestionsList())return r.reactExports.createElement(cn,{id:this.confirmedId,"aria-labelledby":a,suggestions:e,onSelect:(e,t)=>this.handleOnSelect(e,t),renderSuggestion:t,height:s,listItemHeight:i,selectedIndex:l,onNextPageRequested:n,assignActivedescendant:o,dig2retrofit:this.props.dig2retrofit})}shouldRenderSuggestionsList(){return this.state.suggestionListVisible&&this.props.suggestions.length>0}render(){const{className:e="",dig2retrofit:t,inputElement:s,inputProps:n,"aria-labelledby":a,assignActivedescendant:o}=this.props,{inputValue:l,suggestionsListSelectedIndex:c}=this.state;return r.reactExports.createElement("div",{className:i.cx("mc-typeahead",e),role:"combobox","aria-owns":this.confirmedId,"aria-expanded":this.shouldRenderSuggestionsList(),"aria-haspopup":"listbox"},r.reactExports.createElement(pn,{dig2retrofit:t,inputElement:s,tokens:this.renderTokens(),inputProps:Object.assign(Object.assign({},n),{"aria-labelledby":a,"aria-activedescendant":o&&this.confirmedId&&o(this.confirmedId,c),"aria-autocomplete":"list","aria-controls":this.confirmedId,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,onChange:this.handleOnChange,onKeyDown:this.handleKeyDown,value:l})}),this.renderSuggestionsList())}}mn.displayName="Typeahead";const gn=ce.ContactsTokenizer(i.Contact);class fn{constructor(){}getKey(){return"expand-importer"}}class _n{constructor({provider:e,connected:t}){this.provider=e,this.connected=t}getKey(){return`third-party-import${this.provider}`}}class En extends r.reactExports.Component{constructor(e){super(e),this.updateRecipientData=()=>{this.props.actionHandler.recipientsChange(this.props.typeaheadTokens,this.typeaheadInput.value)},this.filterContacts=e=>this.props.filterContacts?this.props.filterContacts(e):e.email!==this.props.user.email,this.handleTypeaheadOnChange=e=>{const t=gn.tokenizeDelimitedInputs(e);if(t.length>0)return this.validateAndAddTokens(t),void this.typeahead.setState({inputValue:""});this.showSuggestions(e),this.updateRecipientData()},this.handleExpandImport=()=>{this.tokenizeRawInput();const e=[];Array.from(he.ProfileServicesConstants.importable_contact_services()).map((t=>{if(this.profile_services){const s=new _n({provider:t,connected:this.profile_services.service_is_connected(t)});e.push(s)}})),this.setState({typeaheadSuggestions:e})},this.handleThirdPartyImport=e=>{let t;if(r.assert((t=e.provider,Array.from(he.ProfileServicesConstants.importable_contact_services()).includes(t)),`invalid party contact provider ${e.provider}`),!this.profile_services||!this.profile_services.service_is_connected(e.provider))return this.link_handler.auth_service_with_user(e.provider,this.props.user.id,(e=>pe.ProfileServicesLinkingHandler.show_import_notifications(e)));{const t=o.intl.formatMessage({id:"D/rjjz",defaultMessage:"You’re already connected to {service_name}"},{service_name:he.ProfileServicesConstants.to_name(e.provider)});N.Notify.success(t)}},this.handleTypeaheadSelect=(e,t,s)=>{if(e||s)if(e instanceof fn)this.handleExpandImport();else if(e instanceof _n)this.handleThirdPartyImport(e);else{e&&this._logTokenSelect(e,t,s);const n=e?[e]:gn.tokenizeAllRawInputs(s);this.validateAndAddTokens(n),this.setState({typeaheadSuggestions:[]})}},this.handleTypeaheadRemoveToken=e=>{const t=this.props.typeaheadTokens.filter((t=>t!==e));this._logTokenChangeEvent(e,!0),this.props.onTypeaheadTokensChange(t)},this.renderTypeaheadTokenContent=e=>{const t=this._getValidation(e);let s=e.name||e.email;"ok"!==t.state&&t.msg===b.CONTACT_ERROR_MESSAGES.OUT_OF_TEAM&&(s=e.email);return this._logTokenChangeEvent(e,!1,{did_select_suggestion:!1}),r.reactExports.createElement(sn,{avatarUrl:e.photo_url,displayName:s,validation:t})},this.setTypeaheadRef=e=>{this.typeahead=e},this.setTypeaheadInputRef=e=>{this.typeaheadInput=e},this.finishLogging=e=>{const t=this.contactsDataSource.getStats().numLocalContacts;if(this._flush_unfinished_queries_cache(),this.shouldLogSearch())return this.contact_search_logger.log_records(this.props.user.id,e,t)},this._logTokenSelect=(e,t,s)=>{const n={search_expr:s,selected_pos:t||0,num_query_results:this.state.typeaheadSuggestions.length,did_select_suggestion:!0};this._logTokenChangeEvent(e,!1,n)},this._logTokenChangeEvent=(e,t=!1,s={})=>{if(this.contact_search_logger&&e){if(!t){const t={context:this._getLoggingContext(),contact_type:e.type,contact_id:e.getContactID(),contact_name:e.name,sort_variant:null,event_ts:window.performance.now()};for(const e in s)s[e]&&(t[e]=s[e]);return this.contact_search_logger.add_record(t)}{const t=e.getContactID();if(t)return this.contact_search_logger.flag_record_as_removed(t)}}},this._logSearchComplete=(e,t,s=!0)=>{if(!this.shouldLogSearch()||!e)return;const n=window.performance.now();let i=this.unfinished_contact_search_queries[e];if(!i)return;const a=i.begin_time;!("ttfr"in i)&&t>0&&(i.ttfr=Math.floor(n-a)),s?(i.local_duration=Math.floor(n-a),i.num_local_results=t):(i.remote_duration=Math.floor(n-a),i.num_additional_remote_results=t),i.num_results+=t;return(()=>this.contactsDataSource.isSearchLocalOnly()&&s||!s)()?(i=this._prepareSearchStatsForLogging(i,e,n,!0),this.contact_search_logger.add_timing_record(i),this.contact_search_logger.count_search(i.is_slow),delete this.unfinished_contact_search_queries[e]):void 0},this._logSearchBegin=e=>{if(!this.shouldLogSearch()||!e)return;const t=window.performance.now();return this._flush_unfinished_queries_cache(t),this.unfinished_contact_search_queries[e]={begin_time:t,num_results:0}},this._flush_unfinished_queries_cache=e=>{if(this.shouldLogSearch()){null==e&&(e=window.performance.now());for(const t in this.unfinished_contact_search_queries)if(this.unfinished_contact_search_queries[t]){let s=this.unfinished_contact_search_queries[t];e&&e-s.begin_time<le.CONTACTS_SEARCH_PREEMPTED_THRESHOLD&&(s.is_preempted=!0),s=this._prepareSearchStatsForLogging(s,t,e,!1),this.contact_search_logger.add_timing_record(s),this.contact_search_logger.count_search(s.is_slow)}return this.unfinished_contact_search_queries={}}},this._prepareSearchStatsForLogging=(e,t,s,n)=>{const i=e.begin_time;e.duration=Math.floor(s-i),"ttfr"in e?e.is_slow=e.ttfr>100:n&&0===e.num_results?e.is_slow=!1:e.is_slow=e.duration>100;const a=this.contactsDataSource.getStats().localContactsDownloadedTime;return e.started_before_download=null==a||i<a,"is_preempted"in e||(e.is_preempted=!1),e.context=this._getLoggingContext(),e.query_length=t.length,e.is_finished=n,e},this._getLoggingContext=()=>{let e="spectrum_tokenizer";return null!=this.props.context&&(e+=`_${this.props.context}`),e},this.state={typeaheadSuggestions:[]},this.link_handler=new pe.ProfileServicesLinkingHandler,this.profile_services=null,this.props.teamGroupInfo||this.props.showContactImport&&this.props.user&&(this.profile_services=pe.LinkedProfileServices.get_linked_profile_services_for_user(this.props.user.id))}getContacts(){return this.tokenizeRawInput(),this.props.typeaheadTokens}focusTypeaheadInput(){r.reactDomExports.findDOMNode(this.typeaheadInput).focus()}addExternalContacts(e){this.validateAndAddTokens(e)}componentDidMount(){this.contactsDataSource=this.initContactsDataSource(this.props.user,this.filterContacts),this.props.shouldLogContactSearch&&(this.contact_search_logger=new i.ContactSearchLogger(this._getLoggingContext(),this.contactsDataSource.searchModeName),this.unfinished_contact_search_queries={}),this.props.initialTypeaheadTokens&&this.props.initialTypeaheadTokens.length>0&&this.validateAndAddTokens(this.props.initialTypeaheadTokens),this.props.focusOnMount&&this.focusTypeaheadInput(),this.props.actionHandler.suggestTargets({force_refresh:!0})}componentDidUpdate(e,t){if(this.contactsDataSource=this.initContactsDataSource(this.props.user,this.filterContacts),this.state.typeaheadSuggestions.length>0){const e=this.state.typeaheadSuggestions[0]instanceof fn,s=this.state.typeaheadSuggestions[0]instanceof _n;t.typeaheadSuggestions===this.state.typeaheadSuggestions||e?(e||s)&&this.typeahead.setState({suggestionsListSelectedIndex:-1}):this.typeahead.setState({suggestionsListSelectedIndex:0})}e.typeaheadTokens!==this.props.typeaheadTokens&&this.updateRecipientData()}tokenizeRawInput(){const e=this.typeaheadInput.value;if(""!==e){const t=gn.tokenizeAllRawInputs(e);this.validateAndAddTokens(t),this.typeahead.setState({inputValue:""})}}getSuggestionRenderer(){return this.props.renderTypeaheadSuggestion}getSuggestions(){return this.state.typeaheadSuggestions}render(){return r.reactExports.createElement(mn,{ref:this.setTypeaheadRef,className:this.props.className,height:160,inputProps:{ref:this.setTypeaheadInputRef,disabled:this.props.disabledInput,placeholder:this.props.typeaheadTokens.length>0?"":this.props.typeaheadPlaceholder,"aria-label":o.intl.formatMessage({id:"rQOIK5",defaultMessage:"Contact name"})},listItemHeight:48,onChange:this.handleTypeaheadOnChange,onRemoveToken:this.handleTypeaheadRemoveToken,onSelect:this.handleTypeaheadSelect,renderSuggestion:this.getSuggestionRenderer(),renderTokenContent:this.renderTypeaheadTokenContent,suggestions:this.getSuggestions(),suggestionsBuffer:0,tokens:this.createTypeaheadTokenObjects()})}initContactsDataSource(e,t){return new le.ContactsDataSourceV2(e,t,!1)}_getValidation(e){const t=this.props.actionHandler.getSharingInfo().recipientAccess(),s=this.props.actionHandler.getSharingInfo().recipientValidation()[t]||{},n=e.getKey();return s[n]?s[n]:{state:"pending",msg:null}}getVariantForTypeaheadToken(e){const t=this._getValidation(e);return"invalid"===t.state?"error":"warn"===t.state?"warning":"default"}createTypeaheadTokenObjects(){return this.props.typeaheadTokens.map((e=>({key:e.getKey(),variant:this.getVariantForTypeaheadToken(e),content:e})))}filterExistingTokens(e){if(!e)return[];const t=this.props.typeaheadTokens.map((e=>e.getKey()));return e.filter((e=>!t.includes(e.getKey())))}suggestSharingTargets(e){this.props.actionHandler.suggestTargets({query:e}).then((e=>{e?this.setSuggestions(this.filterExistingTokens(e.filter((e=>this.filterContacts(e))))):this.typeahead.setState({suggestionsListSelectedIndex:-1})}))}is_server_side_contact_search_on(){return"ON"===this.props.actionHandler.getSharingInfo().sharingPrefs().in_server_side_contact_search_settings}showSuggestions(e){if(this.is_server_side_contact_search_on())return this.suggestSharingTargets(e);this._logSearchBegin(e);const t=[];this.contactsDataSource.search(e,(s=>{t.push(...this.filterExistingTokens(s)),this.setSuggestions(t),this._logSearchComplete(e,(null!=s?s.length:void 0)||0,!0)}),(s=>{const n=this.filterExistingTokens(s);e===this.typeaheadInput.value&&n.length>0&&(t[t.length-1]instanceof fn?t.push(...n.concat(t.pop())):t.push(...n),this.setState({typeaheadSuggestions:t})),this._logSearchComplete(e,s.length,!1)}))}setSuggestions(e){const t=e;this.props.teamGroupInfo?t.push(Ms.teamGroupInfoToContact(this.props.teamGroupInfo)):this.props.showContactImport&&t.push(new fn),this.setState({typeaheadSuggestions:t})}validateAndAddTokens(e){const t=e.reduce(((e,t)=>(t.pending&&t.query&&e.push(t.query),e)),[]),s=t=>{const{onTypeaheadTokensChange:s,typeaheadTokens:n}=this.props,i=[],a=n.map((e=>e.getKey()));for(const s of e){let e=s;if(e.pending&&e.query){const s=this.contactsDataSource.normalizeQuery(e.query),n=this.determineQueryMatch(s,t[s]);n&&(e=n)}const n=e.getKey();a.includes(n)||(a.push(n),i.push(e))}s(n.concat(i))};if(!this.is_server_side_contact_search_on())return this.contactsDataSource.searchBatch(t,s,s);{const t=this.props.typeaheadTokens.map((e=>e.getKey())),s=[];for(const n of e){const e=n.getKey();t.includes(e)||(t.push(e),s.push(n))}this.props.onTypeaheadTokensChange(this.props.typeaheadTokens.concat(s))}}determineQueryMatch(e,t){if(!t||!e)return null;const s={email:[],name:[]};for(const n of t){const t=n.email?this.contactsDataSource.normalizeQuery(n.email):null,i=n.name?this.contactsDataSource.normalizeQuery(n.name):null;e===t?s.email.push(n):e===i&&s.name.push(n)}for(const e of["email","name"])if(1===s[e].length)return s[e][0];return null}shouldLogSearch(){return!this.is_server_side_contact_search_on()&&this.props.shouldLogContactSearch&&null!=this.contact_search_logger}}En.displayName="ShareContactsTokenizer",En.defaultProps={disabledInput:!1,shouldLogContactSearch:!1,renderTypeaheadSuggestion:e=>{return e instanceof fn?r.reactExports.createElement("div",{className:"typeahead-option"},r.reactExports.createElement(F.Flag,{leftAttachment:r.reactExports.createElement(i.Image$1,{className:"u-pad-right-s",src:r.static_url("/static/metaserver/static/images/icons/icon-import-vflOL9sCs.png"),srcHiRes:r.static_url("/static/metaserver/static/images/icons/icon-import@2x-vfluE8TBO.png")})},r.reactExports.createElement("div",{className:"option-primary option-only"},o.intl.formatMessage({id:"H3lmrv",defaultMessage:"Import contacts"})))):e instanceof _n?(t=e,r.reactExports.createElement(Sn,{import:t})):(e=>{const t=e.name||e.email,s=e.group_id?(e=>{const t=e.toUpperCase().split(" ");return`${t[0][0]}${t.length>1?t[t.length-1][0]:""}`})(e.name):i.getInitials(t),n=e.group_id?o.intl.formatMessage({id:"XMHn5C",defaultMessage:"{count, plural, one{# member} other{# members}}"},{count:e.group_size||0}):e.email;return r.reactExports.createElement(Hs,{id:e.getKey(),initials:s,avatarUrl:e.photo_url,description:n,displayName:t,tag:"div",variant:"narrow"})})(e);var t}};class Sn extends r.reactExports.PureComponent{constructor(e){super(e),this.show_contact_import_spinner=e=>{if(this.props.import.provider===e.provider)return this.setState({showLoading:!0})},this.state={showLoading:!1}}componentDidMount(){return this.authCompleteListenerToken=pe.addAuthCompleteListener(this.show_contact_import_spinner)}componentWillUnmount(){return pe.removeAuthCompleteListener(this.authCompleteListenerToken)}render(){const{provider:e,connected:t}=this.props.import,s=he.ProfileServicesConstants.to_img_legacy(e);let n=he.ProfileServicesConstants.to_name(e);n=!t&&this.state.showLoading?o.intl.formatMessage({id:"3dBlC+",defaultMessage:"Importing {service_name} Contacts"},{service_name:n}):o.intl.formatMessage({id:"T+Ryks",defaultMessage:"Sign in with {service_name} to import contacts"},{service_name:n});const a=t?o.intl.formatMessage({id:"2/+46g",defaultMessage:"Connected"}):"";return r.reactExports.createElement("div",{className:"typeahead-option"},r.reactExports.createElement(F.Flag,{leftAttachment:r.reactExports.createElement(i.Image$1,{className:"u-pad-right-s",src:r.static_url(s[0]),srcHiRes:r.static_url(s[1])})},r.reactExports.createElement("div",{className:"option-primary"},n),r.reactExports.createElement("div",{className:"option-secondary u-font-meta"},a)))}}Sn.displayName="ThirdPartyImportOption";class Mn extends r.React$1.Component{constructor(e){super(e),this.finishLogging=e=>this.shareContactsTokenizerRef.finishLogging(e),this.setShareContactsTokenizerRef=e=>{this.shareContactsTokenizerRef=e},this.onTypeaheadTokensChange=e=>{this.setState({typeaheadTokens:e})},this.handleAccessTypeChange=e=>{this.props.actionHandler.changeRecipientAccess(e)},this.filterContacts=e=>this.props.isTeamSharedFolder?!!e.group_id:this.props.isInContentManager||e.email!==this.props.user.email,this.state={typeaheadTokens:[]}}getContacts(){return this.shareContactsTokenizerRef.getContacts()}focusTypeaheadInput(){return this.shareContactsTokenizerRef.focusTypeaheadInput()}addExternalContacts(e){return this.shareContactsTokenizerRef.addExternalContacts(e)}render(){const e=this.props.isTeamSharedFolder?o.intl.formatMessage({id:"aTEm56",defaultMessage:"Add groups:"}):o.intl.formatMessage({id:"bLfZ53",defaultMessage:"To:"}),t=o.intl.formatMessage({id:"CIbq3r",defaultMessage:"This file type can only be shared with view access"});return r.React$1.createElement(tn,{contactsField:this.renderContactsField(),labelledAccessTypes:this.getAccessTypes(),onAccessTypeChange:this.handleAccessTypeChange,selectedAccessType:this.getSelectedAccessType(),toLabel:e,showNoEditTooltip:this.props.contentInfo.isFile()&&!this.props.canInviteEditor,noEditText:t})}getAccessTypes(){const e=[],t=e=>o.intl.formatMessage({id:"+f5spv",defaultMessage:"change permission for users to {label}"},{label:e}),s=ys,n=this.props.contentInfo&&this.props.contentInfo.isFolder()?ws:this.props.actionHandler.getSharingInfo().isCloudDoc()?As:Is;return this.props.canInviteEditor&&e.push({apiId:i.ACCESS_LEVEL.WRITER,ariaLabel:t(i.ACCESS_LEVEL.WRITER),label:s[i.ACCESS_LEVEL.WRITER],details:n[i.MEMBER_ACTION.MAKE_EDITOR]}),this.props.canInviteViewer&&e.push({apiId:i.ACCESS_LEVEL.READER,ariaLabel:t(i.ACCESS_LEVEL.READER),label:s[i.ACCESS_LEVEL.READER],details:n[i.MEMBER_ACTION.MAKE_VIEWER]}),e}getSelectedAccessType(){const e=this.props.actionHandler.getSharingInfo(),t=this.getAccessTypes();let s;for(const n of t)n.apiId===e.recipientAccess()&&(s=n);return s}renderContactsField(){return r.React$1.createElement(En,{ref:this.setShareContactsTokenizerRef,actionHandler:this.props.actionHandler,typeaheadTokens:this.state.typeaheadTokens,onTypeaheadTokensChange:this.onTypeaheadTokensChange,context:this.props.context,focusOnMount:this.props.focusOnMount,initialTypeaheadTokens:this.props.initialTypeaheadTokens,typeaheadPlaceholder:this.props.typeaheadPlaceholder,user:this.props.user,filterContacts:this.filterContacts,shouldLogContactSearch:this.props.shouldLogContactSearch,showContactImport:this.props.showContactImport,teamGroupInfo:this.props.teamGroupInfo})}}Mn.displayName="ShareModalContactsSection";const vn="scl-sharing-modal-footer-link-list";class kn extends r.reactExports.PureComponent{render(){const e=i.cx(vn,this.props.className);return r.reactExports.createElement("div",{className:e},r.reactExports.createElement("div",{className:`${vn}__header`},r.reactExports.createElement("div",{className:`${vn}__title`},this.props.title),r.reactExports.createElement("div",{className:`${vn}__actions`},this.props.actions)),r.reactExports.createElement("div",{className:`${vn}__items`},this.props.children))}}kn.displayName="SharingModalFooterLinkList";class bn extends r.React$1.Component{constructor(){super(...arguments),this.onClickButtonLinkSettings=()=>{this.props.mode===l.MODES.LINK_ONLY?this.props.actionHandler.handleLinkSettingsClick():this.props.onLinkSettingsClick()}}renderSharedLinks(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo();if(e.isCloudDoc()){let t,s;return e&&e.sharedLinks()&&(t=e.editRighteousLink(),s=e.viewRighteousLink(),s||(s=e.shmodelLink())),[this.renderModalLinkInfo(t,"editor"),this.renderModalLinkInfo(s,"viewer")]}{const t=e.shmodelLink();return this.renderModalLinkInfo(t,"viewer")}}renderModalLinkInfo(e,t){return r.React$1.createElement(wt,{key:t,actionHandler:this.props.actionHandler,contentInfo:this.props.contentInfo,linkMetadata:e,linkAccessLevel:t,mode:this.props.mode,user:this.props.user,isLinkMetadataLoaded:this.props.isLinkMetadataLoaded,isTeamSharedFolder:this.props.isTeamSharedFolder,canShareLink:this.props.canShareLink,permissions:this.props.permissions,modalClose:this.props.closeModalHandler})}renderActions(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo();if(e.sharedLinks()&&e.sharedLinks().length>0&&(!e.isCloudDoc()||e.permissionsObj().canCreateEditLink()||e.permissionsObj().canCreateViewLink()))return r.React$1.createElement(i.Button,{variant:"borderless",onClick:this.onClickButtonLinkSettings},o.intl.formatMessage({id:"zxECIJ",defaultMessage:"Link settings"}))}render(){const e=this.props.actionHandler&&this.props.actionHandler.getSharingInfo();return r.React$1.createElement("div",{className:i.cx({"unified-share-modal-two-link-model":!0,"unified-share-modal-two-link-model--upsell-enabled":e.isShareModalUpsellPremiumSharing()})},(()=>this.props.isLinkMetadataLoaded?r.React$1.createElement(kn,{className:i.cx({"scl-sharing-modal-footer-link-list--no-border":this.props.mode===l.MODES.LINK_ONLY}),title:o.intl.formatMessage({id:"gzuZCm",defaultMessage:"Share a link"}),actions:this.renderActions()},this.renderSharedLinks()):void 0)())}}bn.displayName="ShareModalFooterLinkSection";class Cn extends r.React$1.Component{constructor(){super(...arguments),this.handleCopyLinkClicked=()=>{R.copyToClipboard(this.getLinkUrl(),(()=>h.sharingNotificationSuccess(o.intl.formatMessage({id:"z1RKgB",defaultMessage:"Link copied to clipboard"}))),(()=>h.sharingNotificationError(o.intl.formatMessage({id:"zMYKz7",defaultMessage:"Unable to copy the link, please copy manually"})))),this.logCopyEvent()}}render(){const{className:e,sharingInfo:t,onClickCloseButton:s}=this.props;return r.React$1.createElement("div",{className:e},r.React$1.createElement(d.SharingModalHeaderTitle,{closeButtonVisible:!0,icon:r.React$1.createElement(i.IconContent,{name:"dlink-small"}),onClickCloseButton:s,title:t.name()}),r.React$1.createElement(tt,{labelSharedLinkUrl:o.intl.formatMessage({id:"vLmOAd",defaultMessage:"Shared link URL"}),isIconHidden:!0,inputProps:{autoFocus:!1},onClickButton:this.handleCopyLinkClicked,sharedLinkUrl:this.getLinkUrl(),textButton:o.intl.formatMessage({id:"L4Tupd",defaultMessage:"Copy link"})}))}getLinkUrl(){return this.props.sharingInfo.isLinkMetadataLoaded()?this.props.sharingInfo.sharedLinks()[0].url:""}logCopyEvent(){const e=this.props.sharingInfo.user(),t=this.props.sharingInfo.contentInfo();b.logTiburonEvent(t,e.id,k.TiburonEventName.CopySharedLink,{type:"pointer"})}}function yn({level:e="defaultLevel",message:t}){if(!t)return null;const s={[b.ContactsErrorLevel.Error]:"error",[b.ContactsErrorLevel.Warn]:"warn",defaultLevel:"default"}[e];return r.React$1.createElement(E.SharingModalBanner,{className:"contacts-error-banner",type:s,message:t})}Cn.displayName="ShareModalPointerMode";class wn extends r.React$1.Component{constructor(){super(...arguments),this.getNoPermissionMessage=()=>this.props.isTeamSharedFolder?this.getTeamSharedFolderMessage():this.props.isFolder?o.intl.formatMessage({id:"7nUdHD",defaultMessage:"You don’t have permission to manage membership of this folder"}):o.intl.formatMessage({id:"Bg4C2n",defaultMessage:"You don’t have permission to manage membership of this file"})}render(){return r.React$1.createElement(E.SharingModalBanner,{message:this.getNoPermissionMessage()})}getTeamSharedFolderMessage(){return this.renderTeamFolderNoPermissionMessage()?o.intl.formatMessage({id:"Ia9tjc",defaultMessage:"This folder is automatically shared with all members of {team_name}"},{team_name:this.props.teamName}):o.intl.formatMessage({id:"6Vgz8b",defaultMessage:"Only <admin_link>admins</admin_link> and <group_link>group managers</group_link> can change team folder membership."},{admin_link:e=>r.React$1.createElement("a",{href:"/team?_tk=left_nav_team",target:"_blank",rel:"noreferrer"},e),group_link:e=>r.React$1.createElement("a",{href:"/help/7232#transfer",target:"_blank",rel:"noreferrer"},e)})}renderTeamFolderNoPermissionMessage(){return c.get(this.props,"members.groups",{}).some((e=>"team"===e.group_type&&c.get(e,"permissions.make_editor.allow")&&c.get(e,"permissions.make_viewer.allow")))}}wn.displayName="SharingModalNoPermissionsSection";class In extends r.reactExports.Component{constructor(){super(...arguments),this.restoreAccessToConfidentialFolder=()=>{const{teamName:e,onRestoreAccessClick:t}=this.props;t(!0,e)}}render(){const{intl:e,teamName:t,parentFolderName:s,isRestoreAccessEnabled:n}=this.props;let a,o;""!==s?(a=e.formatMessage({id:"V1N9tG",defaultMessage:'This folder isn’t shared with everyone who has access to parent folder "{parent}".'},{parent:d.Emstring.em_snippet(s,i.SNIPPET_SIZES.FILENAME)}),o=e.formatMessage({id:"R+Gy+p",defaultMessage:"Share with everyone"})):(a=e.formatMessage({id:"z87QTd",defaultMessage:"This folder isn’t shared with everyone on {team_name}."},{team_name:d.Emstring.em_snippet(t,i.SNIPPET_SIZES.DISPLAY_NAME)}),o=e.formatMessage({id:"R+Gy+p",defaultMessage:"Share with everyone"}));const l=r.reactExports.createElement("div",{className:"confidential-folder-section"},a," ",n&&r.reactExports.createElement(i.Button$1,{className:"button-as-link","aria-label":o,key:"restore access",variant:"transparent",size:"small",hasNoUnderline:!0,onClick:this.restoreAccessToConfidentialFolder},o));return r.reactExports.createElement(E.SharingModalBanner,{type:"dark",message:l})}}In.displayName="ConfidentialFolderSection";class An extends r.reactExports.PureComponent{render(){const{className:e,children:t,onChange:s,value:n,placeholder:a}=this.props,o=i.cx("scl-sharing-modal-message-field",e);return r.reactExports.createElement("div",{className:o},r.reactExports.createElement("textarea",{"aria-label":a,className:"scl-textarea",placeholder:a,onChange:s,value:n}),t)}}An.displayName="SharingModalMessageField";let Tn=class extends r.React$1.Component{constructor(){super(...arguments),this.handleSettingsButtonClick=e=>{e.preventDefault(),this.props.onSettingsButtonClick(),this.context.logEvent(k.TiburonEventName.ClickSettingsGear,void 0,{screen:k.ScreenName.ManageAccessScreen})}}render(){return r.React$1.createElement(d.SharingModalHeaderWithBackButton,{autoFocus:!0,closeButtonVisible:!0,settingsButtonVisible:!0,onClickBackButton:this.props.onBackButtonClick,onClickCloseButton:this.props.onCloseButtonClick,onClickSettingsButton:this.handleSettingsButtonClick,label:o.intl.formatMessage({id:"oMWVkR",defaultMessage:"Back"})})}};Tn.displayName="HeaderSection",Tn.contextType=os;const Ln={".tag":"public"},Rn={".tag":"team_only"},Nn={".tag":"password"},xn={".tag":"team_and_password"},Pn={".tag":"shared_folder_only"},Fn={".tag":"no_one"},On={".tag":"only_you"},Dn={".tag":"other"},$n={".tag":"day_1"},Bn={".tag":"day_180"},Un={".tag":"day_3"},Hn={".tag":"day_30"},Vn={".tag":"day_7"},Gn={".tag":"day_90"},Wn={".tag":"none"},Kn={".tag":"year_1"},zn={".tag":"other"},qn={".tag":"allowed"},jn={".tag":"not_allowed"},Yn={".tag":"other"},Zn={".tag":"optional"},Qn={".tag":"required"},Jn={".tag":"other"},Xn=e=>e.type===i.ContactTypes.EMAIL?e.name&&e.name.length?Object.assign(Object.assign({".tag":"user",dbx_team_id:e.dbx_team_id||""},void 0!==e.photo_url?{photo_url:e.photo_url}:{}),{name:e.name,sort_key:e.name,dbx_account_id:e.dbx_account_id||"",email:e.email||""}):d.createFromEmail(e.email||""):e.type===i.ContactTypes.NEW_STYLE_GROUP?{".tag":"group",dbx_team_id:e.dbx_team_id||"",members:e.members||"",name:e.name,sort_key:e.name,group_id:e.group_id||"",group_size:e.group_size||0}:e.type===i.ContactTypes.DBX_ID?Object.assign(Object.assign({".tag":"user",dbx_team_id:e.dbx_team_id||""},void 0!==e.photo_url?{photo_url:e.photo_url}:{}),{name:e.name,sort_key:e.name,dbx_account_id:e.dbx_account_id||"",email:e.email||""}):d.createFromEmail(""),ei=e=>"email"===e[".tag"]?i.Contact.buildFromRawEmail(e.email):"group"===e[".tag"]?new i.Contact({type:i.ContactTypes.NEW_STYLE_GROUP,dbx_team_id:e.dbx_team_id,members:e.members,name:e.name,group_id:e.group_id,group_size:e.group_size}):"user"===e[".tag"]?e.dbx_account_id?new i.Contact(Object.assign(Object.assign({type:i.ContactTypes.EMAIL,dbx_team_id:e.dbx_team_id},void 0!==e.photo_url?{photo_url:e.photo_url}:{}),{name:e.name,invalid:!i.validateEmail(e.email),dbx_account_id:e.dbx_account_id,email:e.email})):i.Contact.buildFromRawEmail(e.email):d.exhausts(e,i.Contact.buildFromRawEmail("")),ti=e=>"invalid"===e.state?{".tag":"disallowed",disallowed:{".tag":"other"}}:"ok"===e.state?{".tag":"allowed",allowed:{".tag":"no_warning"}}:"warn"===e.state?{".tag":"allowed",allowed:{".tag":"other"}}:{".tag":"other"},si=e=>"owner"===e?d.OWNER:"reader"===e?d.VIEWER$1:"writer"===e?d.EDITOR$1:"reader_no_comment"===e?d.VIEWER_NO_COMMENT:d.OTHER$1,ni=e=>void 0===e?d.OTHER:"editor"===e?d.EDITOR:"viewer"===e?d.VIEWER:d.exhausts(e,d.OTHER),ii=e=>"editor"===e.link_access_level?d.EDITOR:"viewer"===e.link_access_level?d.VIEWER:d.exhausts(e.link_access_level,d.OTHER),ai=e=>"public"===e?Ln:"team_only"===e?Rn:"password"===e?Nn:void 0,ri=e=>"public"===e?d.PUBLIC:"team"===e?d.TEAM:"password"===e?d.PASSWORD:"no_one"===e?d.NO_ONE:d.OTHER$2,oi=e=>{var t,s,n,i,a,r,o,l,c,d,h,p,u;const m=[];return void 0===e||(void 0!==(null===(t=e.change_options)||void 0===t?void 0:t.allow)&&m.push({action:{".tag":"change_options"},allow:e.change_options.allow}),void 0!==(null===(s=e.disable_viewer_info)||void 0===s?void 0:s.allow)&&m.push({action:{".tag":"disable_viewer_info"},allow:e.disable_viewer_info.allow}),void 0!==(null===(n=e.edit_contents)||void 0===n?void 0:n.allow)&&m.push({action:{".tag":"edit_contents"},allow:e.edit_contents.allow}),void 0!==(null===(i=e.enable_viewer_info)||void 0===i?void 0:i.allow)&&m.push({action:{".tag":"enable_viewer_info"},allow:e.enable_viewer_info.allow}),void 0!==(null===(a=e.invite_editor)||void 0===a?void 0:a.allow)&&m.push({action:{".tag":"invite_editor"},allow:e.invite_editor.allow}),void 0!==(null===(r=e.invite_viewer)||void 0===r?void 0:r.allow)&&m.push({action:{".tag":"invite_viewer"},allow:e.invite_viewer.allow}),void 0!==(null===(o=e.invite_viewer_no_comment)||void 0===o?void 0:o.allow)&&m.push({action:{".tag":"invite_viewer_no_comment"},allow:e.invite_viewer_no_comment.allow}),void 0!==(null===(l=e.leave_a_copy)||void 0===l?void 0:l.allow)&&m.push({action:{".tag":"leave_a_copy"},allow:e.leave_a_copy.allow}),void 0!==(null===(c=e.relinquish_membership)||void 0===c?void 0:c.allow)&&m.push({action:{".tag":"relinquish_membership"},allow:e.relinquish_membership.allow}),void 0!==(null===(d=e.update_confidentiality)||void 0===d?void 0:d.allow)&&m.push({action:{".tag":"update_confidentiality"},allow:e.update_confidentiality.allow}),void 0!==(null===(h=e.unmount)||void 0===h?void 0:h.allow)&&m.push({action:{".tag":"unmount"},allow:e.unmount.allow}),void 0!==(null===(p=e.unshare)||void 0===p?void 0:p.allow)&&m.push({action:{".tag":"unshare"},allow:e.unshare.allow}),void 0!==(null===(u=e.create_link)||void 0===u?void 0:u.allow)&&m.push({action:{".tag":"create_link"},allow:e.create_link.allow})),m},li=e=>{var t,s,n,i,a,r,o,l,c,d,h,p,u,m,g;const f=[];return void 0===e||(void 0!==(null===(t=e.create_edit_link)||void 0===t?void 0:t.allow)&&f.push({action:{".tag":"create_edit_link"},allow:e.create_edit_link.allow}),void 0!==(null===(s=e.create_view_link)||void 0===s?void 0:s.allow)&&f.push({action:{".tag":"create_view_link"},allow:e.create_view_link.allow}),void 0!==(null===(n=e.change_options)||void 0===n?void 0:n.allow)&&f.push({action:{".tag":"change_options"},allow:e.change_options.allow}),void 0!==(null===(i=e.disable_viewer_info)||void 0===i?void 0:i.allow)&&f.push({action:{".tag":"disable_viewer_info"},allow:e.disable_viewer_info.allow}),void 0!==(null===(a=e.edit_contents)||void 0===a?void 0:a.allow)&&f.push({action:{".tag":"edit_contents"},allow:e.edit_contents.allow}),void 0!==(null===(r=e.enable_viewer_info)||void 0===r?void 0:r.allow)&&f.push({action:{".tag":"enable_viewer_info"},allow:e.enable_viewer_info.allow}),void 0!==(null===(o=e.invite_viewer)||void 0===o?void 0:o.allow)&&f.push({action:{".tag":"invite_viewer"},allow:e.invite_viewer.allow}),void 0!==(null===(l=e.invite_editor)||void 0===l?void 0:l.allow)&&f.push({action:{".tag":"invite_editor"},allow:e.invite_editor.allow}),void 0!==(null===(c=e.invite_viewer_no_comment)||void 0===c?void 0:c.allow)&&f.push({action:{".tag":"invite_viewer_no_comment"},allow:e.invite_viewer_no_comment.allow}),void 0!==(null===(d=e.relinquish_membership)||void 0===d?void 0:d.allow)&&f.push({action:{".tag":"relinquish_membership"},allow:e.relinquish_membership.allow}),void 0!==(null===(h=e.remove_download_policy)||void 0===h?void 0:h.allow)&&f.push({action:{".tag":"remove_download_policy"},allow:e.remove_download_policy.allow}),void 0!==(null===(p=e.set_download_policy)||void 0===p?void 0:p.allow)&&f.push({action:{".tag":"set_download_policy"},allow:e.set_download_policy.allow}),void 0!==(null===(u=e.unshare)||void 0===u?void 0:u.allow)&&f.push({action:{".tag":"unshare"},allow:e.unshare.allow}),void 0!==(null===(m=e.create_link)||void 0===m?void 0:m.allow)&&f.push({action:{".tag":"create_link"},allow:e.create_link.allow}),void 0!==(null===(g=e.share_message_as_comment)||void 0===g?void 0:g.allow)&&f.push({action:{".tag":"share_message_as_comment"},allow:e.share_message_as_comment.allow})),f},ci=e=>di(e.metadata(),!0===e.contentInfo().isFolderInsideTeamFolderTree(),!0===e.contentInfo().isTeamSharedFolder()),di=(e,t,s)=>{var n,i,a,r,o,l,c,d;if(void 0===e)throw new Error("Adapter error.");if(e.isFolder()){if(e.isNewSharedFolder()){const n=e;return Object.assign(Object.assign({".tag":"file_folder",access_type:si(e.access_type),is_inside_team_folder:t,is_team_folder:s,owner_team:n.owner_team,parent_shared_folder_id:n.parent_shared_folder_id?String(n.parent_shared_folder_id):void 0,path_lower:n.path_lower,parent_folder_name:n.parent_folder_name},void 0!==n.is_confidential?{is_confidential:n.is_confidential}:{}),{name:e.name,policy:{member_policy:n.policy.member_policy?{".tag":n.policy.member_policy}:void 0,resolved_member_policy:n.policy.resolved_member_policy?{".tag":n.policy.resolved_member_policy}:void 0,acl_update_policy:n.policy.acl_update_policy?{".tag":n.policy.acl_update_policy}:{".tag":"other"},shared_link_policy:n.policy.shared_link_policy?{".tag":n.policy.shared_link_policy}:{".tag":"other"},viewer_info_policy:n.policy.viewer_info_policy?{".tag":n.policy.viewer_info_policy}:void 0},permissions:oi(e.permissions),members_cursor:e.members_cursor})}{const i=e;return Object.assign(Object.assign({".tag":"shared_folder",access_type:si(e.access_type),is_inside_team_folder:t,is_team_folder:s,owner_team:i.owner_team,parent_shared_folder_id:i.parent_shared_folder_id?String(i.parent_shared_folder_id):void 0,path_lower:i.path_lower,parent_folder_name:i.parent_folder_name},void 0!==i.is_confidential?{is_confidential:i.is_confidential}:{}),{name:e.name,permissions:oi(e.permissions),policy:{member_policy:i.policy.member_policy?{".tag":i.policy.member_policy}:void 0,resolved_member_policy:i.policy.resolved_member_policy?{".tag":i.policy.resolved_member_policy}:void 0,acl_update_policy:i.policy.acl_update_policy?{".tag":i.policy.acl_update_policy}:{".tag":"other"},shared_link_policy:i.policy.shared_link_policy?{".tag":i.policy.shared_link_policy}:{".tag":"other"},download_policy:i.policy.download_policy?{".tag":i.policy.download_policy}:{".tag":"other"},viewer_info_policy:i.policy.viewer_info_policy?{".tag":i.policy.viewer_info_policy}:void 0},preview_url:i.preview_url||"",shared_folder_id:i.shared_folder_id.toString(),time_invited:(null===(n=i.time_invited)||void 0===n?void 0:n.toString())||"",folder_size:i.folder_size,can_mount:i.can_mount,invite_info:i.invite_info})}}{const t=e;return{".tag":"file",access_type:si(t.access_type),download_policy:{".tag":"other"},id:t.id,name:t.name,owner_team:t.owner_team,parent_shared_folder_id:t.parent_shared_folder_id?String(t.parent_shared_folder_id):void 0,path_display:t.path_display,path_lower:t.path_lower,permissions:li(t.permissions),policy:{member_policy:(null===(i=t.policy)||void 0===i?void 0:i.member_policy)?{".tag":t.policy.member_policy}:void 0,resolved_member_policy:(null===(a=t.policy)||void 0===a?void 0:a.resolved_member_policy)?{".tag":t.policy.resolved_member_policy}:void 0,acl_update_policy:(null===(r=t.policy)||void 0===r?void 0:r.acl_update_policy)?{".tag":t.policy.acl_update_policy}:{".tag":"other"},shared_link_policy:(null===(o=t.policy)||void 0===o?void 0:o.shared_link_policy)?{".tag":t.policy.shared_link_policy}:{".tag":"other"},download_policy:(null===(l=t.policy)||void 0===l?void 0:l.download_policy)?{".tag":t.policy.download_policy}:{".tag":"other"},viewer_info_policy:(null===(c=t.policy)||void 0===c?void 0:c.viewer_info_policy)?{".tag":t.policy.viewer_info_policy}:void 0},preview_url:t.preview_url||"",time_invited:null===(d=t.time_invited)||void 0===d?void 0:d.toString(),is_cloud_doc:t.is_cloud_doc}}},hi=e=>{const t=e.user();return{id:t.id,email:t.email,is_team:!!t.is_team,is_team_admin:t.is_team_admin,account_id:t.account_id,team_dbtid:t.team_dbtid}},pi=e=>{switch(e){case i.LinkAudienceDisallowedReason.DeleteAndRecreate:return d.DISALLOWED_REASON_DELETE_AND_RECREATE;case i.LinkAudienceDisallowedReason.RestrictedBySharedFolder:return d.DISALLOWED_REASON_RESTRICTED_BY_SHARED_FOLDER;case i.LinkAudienceDisallowedReason.RestrictedByTeam:return d.DISALLOWED_REASON_RESTRICTED_BY_TEAM;case i.LinkAudienceDisallowedReason.UserAccountType:return d.DISALLOWED_REASON_USER_ACCOUNT_TYPE;case i.LinkAudienceDisallowedReason.UserNotOnTeam:return d.DISALLOWED_REASON_USER_NOT_ON_TEAM;case i.LinkAudienceDisallowedReason.PermissionDenied:return d.DISALLOWED_REASON_PERMISSION_DENIED;default:return}},ui=e=>{if(void 0!==e)return e.map((e=>({audience:ri(e.audience),allowed:e.allowed,disallowed_reason:pi(e.disallowed_reason)})))},mi=e=>{switch(e){case"day_1":return $n;case"day_180":return Bn;case"day_3":return Un;case"day_30":return Hn;case"day_7":return Vn;case"day_90":return Gn;case"none":return Wn;case"year_1":return Kn;case"other":return zn;default:return}},gi=e=>{switch(e){case"allow":return qn;case"not_allowed":return jn;case"other":return Yn;default:return}},fi=e=>{switch(e){case"optional":return Zn;case"required":return Qn;case"other":return Jn;default:return}},_i=e=>({id:e.id,name:e.name}),Ei=e=>{var t;var s,n,i;return{".tag":e.file_type,url:e.url,id:e.id,name:e.name,expires:null===(t=e.expires)||void 0===t?void 0:t.toString(),path_lower:e.path_lower,link_permissions:(n=e.link_permissions,{resolved_visibility:n.resolved_visibility?(i=n.resolved_visibility,"public"===i?Ln:"team_only"===i?Rn:"password"===i?Nn:"team_and_password"===i?xn:"shared_folder_only"===i?Pn:"no_one"===i?Fn:"only_you"===i?On:d.exhausts(i,Dn)):void 0,requested_visibility:n.requested_visibility?ai(n.requested_visibility):void 0,can_revoke:n.can_revoke,visibility_policies:[],can_set_expiry:n.can_set_expiry,can_remove_expiry:n.can_remove_expiry,allow_download:n.allow_download,can_allow_download:n.can_allow_download,can_disallow_download:n.can_disallow_download,restricting_shared_folder_path:n.restricting_shared_folder_path,allow_comments:n.allow_comments,team_restricts_comments:n.team_restricts_comments,effective_audience:n.effective_audience?ri(n.effective_audience):void 0,audience_options:ui(n.audience_options),link_access_level:ni(n.link_access_level),can_set_password:n.can_set_password,can_remove_password:n.can_remove_password,require_password:n.require_password,can_use_extended_sharing_controls:n.can_use_extended_sharing_controls,days_to_expire_policy:mi(n.days_to_expire_policy),change_shared_link_expiration_policy:gi(n.change_shared_link_expiration_policy),enforce_shared_link_password_policy:fi(n.enforce_shared_link_password_policy)}),team_member_info:e.team_member_info?(s=e.team_member_info,{team_info:_i(s.team_info),display_name:s.display_name,member_id:s.member_id}):void 0,content_owner_team_info:e.content_owner_team_info?_i(e.content_owner_team_info):void 0,preview_type:e.preview_type}},Si=e=>{const t=e.sharedLinks();if(void 0===t)throw new Error("Adapt error");const s=[];for(const e of t)s.push(Ei(e));return{links:s,has_more:!1}},Mi=e=>{switch(e){case"admin_invite_expand_eligibility":return d.INVITE_AFTER_SHARING_MODAL_ADMIN_INVITE_EXPAND_ELIGIBILITY;case"member_suggestion_expand_eligibility":return d.INVITE_AFTER_SHARING_MODAL_MEMBER_SUGGESTION_EXPAND_ELIGIBILITY;case"member_invite_expand_eligibility":return d.INVITE_AFTER_SHARING_MODAL_MEMBER_INVITE_EXPAND_ELIGIBILITY;default:return d.INVITE_AFTER_SHARING_MODAL_NOT_ENABLED}},vi=e=>{const t=e.sharingPrefs();if(void 0===t)throw new Error("Adapt error");return{in_server_side_contact_validation_settings:t.in_server_side_contact_validation_settings,in_server_side_contact_search_settings:t.in_server_side_contact_search_settings,create_nested_shared_folder_variant:t.create_nested_shared_folder_variant,confidential_folder_links_enabled:t.confidential_folder_links_enabled,in_share_modal_upsell_premium_sharing:t.in_share_modal_upsell_premium_sharing,in_share_modal_upsell_premium_sharing_variant:t.in_share_modal_upsell_premium_sharing_variant,has_seen_share_modal_upsell_premium_sharing_counter:t.has_seen_share_modal_upsell_premium_sharing_counter,invite_after_sharing_modal_variant:Mi(t.invite_after_sharing_modal_variant),exp_links_in_member_list:t.exp_links_in_member_list,has_seen_esign_post_sharing:t.has_seen_esign_post_sharing,links_in_member_list_in_paper_share_modal_variant:t.links_in_member_list_in_paper_share_modal,links_in_member_list_in_sdk_share_modal_variant:t.links_in_member_list_in_sdk_share_modal,is_in_esign_post_sharing_exclusion_period:t.is_in_esign_post_sharing_exclusion_period,sharing_sdk_tokenizer_variant:t.sharing_sdk_tokenizer_variant,bsx_organize_around_people:t.bsx_organize_around_people,core_act_receiver_red_carpet_variant:t.core_act_receiver_red_carpet_variant,is_showing_file_upload_toolkit_campaign:t.is_showing_file_upload_toolkit_campaign,default_sharing_access_level_setting:t.default_sharing_access_level_setting,default_sharing_link_audience_setting:t.default_sharing_link_audience_setting,user_level_sharing_settings_client_variant:t.user_level_sharing_settings_client_variant,user_level_sharing_settings_m2_client_variant:t.user_level_sharing_settings_m2_client_variant,last_seen_team_policy_audience:t.last_seen_team_policy_audience,capture_sdk_integration_voice_overs_variant:t.capture_sdk_integration_voice_overs_variant,core_act_docsend_advanced_sharing:t.core_act_docsend_advanced_sharing,default_to_link_sharing_m1_variant:t.default_to_link_sharing_m1_variant}},ki=({user:e,contentInfo:t,children:s,linkAccessLevel:n,metadata:a,objectMetadata:l,linkMetadata:c,objectIdentifier:h,sharingPrefs:p})=>{const u=r.React$1.useCallback((e=>{"TEAMS_WEB"===e.type&&i.TeamsWebActionsLogger.log(e.payload.name,e.payload.extra)}),[]),m=r.React$1.useMemo((()=>d.initializeSdk(e)),[e]),g=r.React$1.useMemo((()=>null!=l?l:di(a,!0===t.isFolderInsideTeamFolderTree(),!0===t.isTeamSharedFolder())),[a,t,l]);return r.React$1.createElement(d.Provider,{intl:o.intl,sdk:m,loggingSink:u,redirectWindowToken:ue.REDIRECT_WINDOW_TOKEN,platform:d.Platforms.METASERVER,origin:t.extras.origin},r.React$1.createElement(d.MetadataProvider,{shareModalSessionId:t.extras.modalSessionId,sharingAccessLevel:n,sharingObjectMetadata:g,sharingLinkMetadata:c,sharingObjectIdentifier:h,sharingPrefs:p},s))};ki.displayName="SharingSdkProviderWithLoggingContext";class bi extends r.reactExports.Component{constructor(e){super(e),this.state={objectMetadata:ci(this.props.actionHandler.getSharingInfo()),linksMetadata:Si(this.props.actionHandler.getSharingInfo()),sharingPrefs:vi(this.props.actionHandler.getSharingInfo())}}render(){return r.reactExports.createElement(d.ShareModalManageLinksInner,{linksMetadata:this.state.linksMetadata,objectMetadata:this.state.objectMetadata,sharingPrefs:this.state.sharingPrefs,onViewLinkSettingsClick:this.props.onViewLinkSettingsClick,onEditLinkSettingsClick:this.props.onEditLinkSettingsClick})}}bi.displayName="SharingSdkLinksInMemberList";const Ci=o.defineMessages({downgradeBannerHeader:{id:"YBKCoS",defaultMessage:"People who can view could still edit via link"},removeBannerHeader:{id:"w/RnTZ",defaultMessage:"People might still have access via link"},downgradeBannerSubheader:{id:"iYhJt/",defaultMessage:"You can delete the link to further restrict access."},downgradeBannerGotIt:{id:"YCTkuR",defaultMessage:"Got It"},downgradeBannerManageLinks:{id:"J9wEBS",defaultMessage:"Manage Links"}}),yi=o.defineMessages({peopleTab:{id:"kUwFiX",defaultMessage:"People"},linksTab:{id:"Iv9euZ",defaultMessage:"Links"}});let wi=class extends r.React$1.Component{constructor(e){super(e),this.setSelectedTab=e=>{this.setState({selectedTab:e}),this.context.logEvent(k.TiburonEventName.ViewManageAccessTab,void 0,{manage_access_tab:e,manually_switch_tab:!0})},this.getCurrentTab=()=>this.state.selectedTab,this.isMemberListEmpty=()=>{const e=this.props.membership,t=this.props.memberListProps.linkMembers,s=this.props.memberListProps.guestMembers,{groups:n,invitees:i,users:a}=e;return(!t||0===t.length)&&(!s||0===s.length)&&n.isEmpty()&&i.isEmpty()&&a.isEmpty()},this.handleViewLinkSettingsButtonClick=()=>{this.props.onLinkSettingsTextClick(d.VIEW_LINK_SETTINGS)},this.handleEditLinkSettingsButtonClick=()=>{this.props.onLinkSettingsTextClick(d.EDIT_LINK_SETTINGS)},this.enableSecurityBanner=e=>{this.setState({showSecurityBanner:!0,securityBannerType:e})},this.hideSecurityBanner=()=>{this.setState({showSecurityBanner:!1})},this.openLinkSettings=e=>{e.preventDefault(),this.props.actionHandler.openSharingSettingsModal("edit_link_settings")};const t=this.isMemberListEmpty()?k.ManageAccessTabName.ManageLinksTab:k.ManageAccessTabName.ManagePeopleTab;this.state={showSecurityBanner:!1,securityBannerType:zs.DowngradeAccess,selectedTab:this.props.currentTab||t}}componentDidMount(){this.shouldRenderLinksInMemberList()?(this.context.logEvent(k.TiburonEventName.ViewManageAccessScreen,void 0,{manage_access_tab:this.getCurrentTab(),is_member_list_empty:this.isMemberListEmpty(),lml_variant:this.props.actionHandler.getSharingInfo().sharingPrefs().exp_links_in_member_list}),this.context.logEvent(k.TiburonEventName.ViewManageAccessTab,void 0,{manage_access_tab:this.getCurrentTab(),manually_switch_tab:!1})):this.context.logEvent(k.TiburonEventName.ViewManageAccessScreen,void 0,{lml_variant:this.props.actionHandler.getSharingInfo().sharingPrefs().exp_links_in_member_list})}render(){return this.shouldRenderLinksInMemberList()?this.renderManageAccessListWithLinksList():this.renderManageAccessList()}renderManageAccessList(){return r.React$1.createElement(d.ActionContainer,{header:this.getTitle(),headerSize:"small",banner:this.renderBanner(),showBorder:!0},this.isMemberListEmpty()?this.renderEmptyMemberList():r.React$1.createElement(qs,Object.assign({},this.props.memberListProps,{onShowSecurityBanner:this.enableSecurityBanner})))}renderMemberList(){return this.isMemberListEmpty()?this.renderEmptyMemberList():this.renderNotEmptyMemberList()}renderEmptyMemberList(){const e=this.props.actionHandler.getContentInfo().isFile(),t=this.props.actionHandler.getContentInfo().isFileFolder();return r.React$1.createElement(d.EmptyMemberList,{isFile:e,isFileFolder:t,canInviteMembers:this.props.canInviteMembers})}renderNotEmptyMemberList(){return r.React$1.createElement(qs,Object.assign({},this.props.memberListProps,{onShowSecurityBanner:this.enableSecurityBanner}))}shouldRenderLinksInMemberList(){return this.props.actionHandler.getSharingInfo().sharingPrefs().exp_links_in_member_list===l.EXP_LINK_IN_MEMBER_LIST_VARIANT.ON}renderManageAccessListWithLinksList(){const e=o.intl.formatMessage(yi.peopleTab),t=o.intl.formatMessage(yi.linksTab);return r.React$1.createElement(d.ActionContainer,{header:this.getTitle(),headerSize:"small",banner:this.renderBanner(),showBorder:!1},r.React$1.createElement(_.Tabs,{selectedTab:this.getCurrentTab(),onSelection:this.setSelectedTab},r.React$1.createElement(_.Tabs.Group,null,r.React$1.createElement(_.Tabs.Tab,{id:k.ManageAccessTabName.ManagePeopleTab},e),r.React$1.createElement(_.Tabs.Tab,{id:k.ManageAccessTabName.ManageLinksTab},t)),r.React$1.createElement(_.Tabs.Panel,{tabId:k.ManageAccessTabName.ManagePeopleTab},r.React$1.createElement("div",{style:{border:"1px solid var(--color__faint__border)",marginTop:"18px",height:"250px",paddingTop:this.isMemberListEmpty()?"0px":"13px",overflowY:"auto"}},this.renderMemberList())),r.React$1.createElement(_.Tabs.Panel,{tabId:k.ManageAccessTabName.ManageLinksTab},r.React$1.createElement("div",{style:{marginTop:"18px"}},r.React$1.createElement(ki,{user:this.props.user,contentInfo:this.props.actionHandler.getContentInfo(),metadata:this.props.actionHandler.getSharingInfo().metadata()},r.React$1.createElement(bi,{actionHandler:this.props.actionHandler,onViewLinkSettingsClick:this.handleViewLinkSettingsButtonClick,onEditLinkSettingsClick:this.handleEditLinkSettingsButtonClick}))))))}getTitle(){const e={fileName:i.Emstring.em_snippet(this.props.fileName,i.SNIPPET_SIZES.SHARE_ME_MANAGE_ACCESS_FILE_FOLDER_TITLE)};return this.shouldRenderLinksInMemberList()?o.intl.formatMessage({id:"ptXJuT",defaultMessage:"Access to <s>{fileName}</s>"},{fileName:e.fileName,s:e=>r.React$1.createElement("span",null,e)}):o.intl.formatMessage({id:"IQ37US",defaultMessage:"Who can access <s>{fileName}</s>"},{fileName:e.fileName,s:e=>r.React$1.createElement("span",null,e)})}noPermissionsSectionProps(){return{isFolder:this.props.isFolder,isTeamSharedFolder:this.props.isTeamSharedFolder,members:this.props.membership,teamName:this.props.ownerTeamName}}renderBanner(){if(!this.isMemberListEmpty()){if(!this.props.canInviteMembers)return r.React$1.createElement(wn,Object.assign({},this.noPermissionsSectionProps()));if(this.props.editLinkExists&&this.state.showSecurityBanner){let e;switch(this.state.securityBannerType){case zs.RemoveAccess:e=Ci.removeBannerHeader;break;case zs.DowngradeAccess:default:e=Ci.downgradeBannerHeader}return r.React$1.createElement(d.SharingModalDowngradeBanner,{header:o.intl.formatMessage(e),subheader:o.intl.formatMessage(Ci.downgradeBannerSubheader),outlineButtonLabel:o.intl.formatMessage(Ci.downgradeBannerGotIt),transparentButtonLabel:o.intl.formatMessage(Ci.downgradeBannerManageLinks),onClickOutlineButton:this.hideSecurityBanner,onClickTransparentButton:this.openLinkSettings})}}}};wi.displayName="MainSection",wi.contextType=os,i.requireCssWithComponent(wi,["/static/metaserver/static/css/sharing/share_modal_evolution-vfl8CQtFl.css"]);class Ii extends r.React$1.Component{componentDidMount(){const e=this.props.lmlExperimentVariant;if(e===l.EXP_LINK_IN_MEMBER_LIST_VARIANT.ON||e===l.EXP_LINK_IN_MEMBER_LIST_VARIANT.CONTROL){const e=parseInt(localStorage.getItem("manageAccessPageViewsCount")||"[]");e?2!=e&&localStorage.setItem("manageAccessPageViewsCount",(e+1).toString()):localStorage.setItem("manageAccessPageViewsCount",1..toString())}}componentWillUnmount(){const e=this.props.lmlExperimentVariant;2===parseInt(localStorage.getItem("manageAccessPageViewsCount")||"[]")&&(e===l.EXP_LINK_IN_MEMBER_LIST_VARIANT.ON&&b.trackUserLeapEvent(b.SharingUserLeapEvent.SHARE_LINK_MEMBER_LIST_ON,this.props.lmlSprigSurveyOrigin),e===l.EXP_LINK_IN_MEMBER_LIST_VARIANT.CONTROL&&b.trackUserLeapEvent(b.SharingUserLeapEvent.SHARE_LINK_MEMBER_LIST_CONTROL,this.props.lmlSprigSurveyOrigin))}render(){return r.React$1.createElement("div",{className:"share-modal-evolution__manage-access-page"},r.React$1.createElement(Tn,{onBackButtonClick:this.props.onBackButtonClick,onCloseButtonClick:this.props.onCloseButtonClick,onSettingsButtonClick:this.props.onSettingsButtonClick}),r.React$1.createElement(wi,{canInviteMembers:this.props.canInviteMembers,fileName:this.props.fileName,isFolder:this.props.isFolder,isTeamSharedFolder:this.props.isTeamSharedFolder,memberListProps:this.props.memberListProps,membership:this.props.membership,ownerTeamName:this.props.ownerTeamName,actionHandler:this.props.actionHandler,editLinkExists:this.props.editLinkExists,onLinkSettingsTextClick:this.props.onLinkSettingsTextClick,user:this.props.user,currentTab:this.props.currentTab}))}}Ii.displayName="ManageAccessModal";const Ai=i.requireCssWithComponent(Ii,["/static/metaserver/static/css/sharing/share_modal_evolution-vfl8CQtFl.css"]);class Ti extends r.React$1.Component{constructor(){super(...arguments),this.handleSettingsButtonClick=e=>{e.preventDefault(),this.props.onSettingsButtonClick(e),this.context.logEvent(k.TiburonEventName.ClickSettingsGear,void 0,{screen:k.ScreenName.ShareScreen})}}render(){const e=this.getSubTitle();return r.React$1.createElement(d.SharingModalHeaderTitle,{closeButtonVisible:!0,icon:this.getIcon(),subTitle:e,onClickCloseButton:this.props.onCloseButtonClick,onClickSettingsButton:this.handleSettingsButtonClick,settingsButtonVisible:this.props.contentInfo.isFolder()||this.props.showPassFileSettings,title:this.getHeaderTitle()})}getHeaderTitle(){return i.Emstring.em_snippet(this.props.sharingInfo.name(),i.SNIPPET_SIZES.FILENAME)}getIcon(){const{contentInfo:e}=this.props;return r.React$1.createElement(bs,{alt:"",filename:this.props.sharingInfo.name(),isSharedFolder:e.isSharedFolder(),isFolder:e.isFolder(),isTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isViewOnly:!this.props.canEdit,isConfidentialFolder:this.props.isConfidentialFolder,pathExists:e.pathExists()})}getNumberOfPeopleShared(){const{membership:e,linkMembers:t,guestMembers:s}=this.props,{total_unique_users:n}=this.props.sharingInfo.memberCounts();return(n||e.getTotalMemberCount([]))+t.length+s.length}canViewInheritedMembers(){return!this.props.contentInfo.isFile()||this.props.membership.hasInheritedUsers()}getFinalNumberShared(){const e=this.props.sharingInfo.memberCounts();return e&&e.exceeds_count?this.props.sharingInfo.memberNum():this.getNumberOfPeopleShared()}hasExistingLink(){return 0!=this.props.sharingInfo.sharedLinks().length}showOnlyYouCanAccess(){if(this.props.sharingInfo.sharingPrefs().exp_links_in_member_list==l.EXP_LINK_IN_MEMBER_LIST_VARIANT.ON&&this.hasExistingLink())return!1;const e=this.getFinalNumberShared();return this.canViewInheritedMembers()&&(0===e||1===e)}disableManageAccessLink(){return this.showOnlyYouCanAccess()}getHeaderSubtitleDescription(){return this.showOnlyYouCanAccess()?o.intl.formatMessage({id:"CQ2ZaT",defaultMessage:"Only you can access"}):o.intl.formatMessage({id:"Yxc2O3",defaultMessage:"Who can access"})}getSubTitle(){const e=this.getHeaderSubtitleDescription(),t=this.disableManageAccessLink();return r.React$1.createElement(i.Text,{color:"faint",size:"small"},t?r.React$1.createElement("span",null,e):r.React$1.createElement(i.Link,{href:"#",hasNoUnderline:!0,onClick:e=>{e.preventDefault(),this.props.onManageAccessClick()}},e))}}function Li(e){const t=o.intl.formatMessage({id:"YNOPIK",defaultMessage:"To create the view link, add this folder to Dropbox"});return!1==!!e.contentMetadata.path_lower&&e.contentMetadata.access_type===i.ACCESS_LEVEL.WRITER&&e.contentMetadata.isFolder()?r.React$1.createElement(i.Text,{size:e.size,color:"disabled",isBold:!0},r.React$1.createElement(i.UIIcon,{src:i.LinkLine,size:e.size,"aria-label":""}),o.intl.formatMessage({id:"m9qOdI",defaultMessage:"Create and copy link"}),r.React$1.createElement(d.HelpInfo,{id:"cannotCopyLinkInfo",text:t})):r.React$1.createElement(i.Text,{size:e.size,color:"disabled",isBold:!0},r.React$1.createElement(i.UIIcon,{src:i.LinkLine,size:e.size,"aria-label":""}),o.intl.formatMessage({id:"t0Frp1",defaultMessage:"Copy link"}),r.React$1.createElement(d.HelpInfo,{id:"cannotCopyLinkInfo",text:o.intl.formatMessage({id:"CqPhXv",defaultMessage:"You can only email this link"})}))}Ti.displayName="HeaderSection",Ti.contextType=os;class Ri extends r.React$1.Component{constructor(e){super(e),this.handleCreateLinkClick=e=>{e.preventDefault(),this.setState({isCreatingLink:!0},(()=>{this.props.onCreateLinkClick().finally((()=>{this.setState({isCreatingLink:!1})}))}))},this.state={isCreatingLink:!1}}render(){return this.state.isCreatingLink?this.renderCreatingLinkLoading():this.renderCreateLink()}renderCreatingLinkLoading(){return r.React$1.createElement(me.SharingSpinner,{ariaValue:"Loading xsmall",message:o.intl.formatMessage({id:"g7It2O",defaultMessage:"Creating link..."}),textSize:this.props.size})}renderCreateLink(){const{canCreateLink:e}=this.props,t=e=>r.React$1.createElement(i.Link,{key:"toCreateALink",id:"create-link",href:"#",hasNoUnderline:!0,onClick:this.handleCreateLinkClick,"aria-label":o.intl.formatMessage({id:"lCKMha",defaultMessage:"Create link"}),style:{paddingRight:"0"}},e);return e?r.React$1.createElement(i.Text,{size:this.props.size,isBold:!0},r.React$1.createElement(i.UIIcon,{src:i.LinkLine,size:this.props.size,"aria-label":""}),r.React$1.createElement("div",{style:{whiteSpace:"pre",display:"flex"}},o.intl.formatMessage({id:"DW0r0G",defaultMessage:"<link>Create</link> and copy link"},{link:t}))):r.React$1.createElement(Li,{contentMetadata:this.props.contentMetadata,size:this.props.size})}}Ri.displayName="CreateLinkSection",Ri.contextType=os;class Ni extends r.React$1.Component{constructor(e){super(e),this.handleCreateLinkClick=()=>("V1"===cs(this.props.actionHandler)&&P.setIsEligibleForDocsendSplitShareItemInUserMetadata(this.props.user.id),this.props.actionHandler.createSharedLink(this.props.accessLevel,this.props.selectedAudience,l.LINK_CREATION_SURFACE.COPY_OR_CREATE_LINK_SECTION)),this.handleSettingsButtonClick=e=>{let t;e.preventDefault(),"editor"===this.props.accessLevel?(this.props.actionHandler.openSharingSettingsModal("edit_link_settings"),t=k.SettingsTabName.EditLinkSettingsTab):(this.props.actionHandler.openSharingSettingsModal("view_link_settings"),t=k.SettingsTabName.ViewLinkSettingsTab),this.context.logEvent(k.TiburonEventName.OpenLinkSettingsModal,this.props.sharedLink,{settings_tab:t})},this.state={createdLink:!1}}componentDidUpdate(e){!e.sharedLink&&this.props.sharedLink&&e.accessLevel===this.props.accessLevel&&(this.setState({createdLink:!0}),setTimeout((()=>{this.setState({createdLink:!1})}),5e3))}render(){return this.props.sharedLink?r.React$1.createElement(ps,{accessLevel:this.props.accessLevel,modalClose:this.props.modalClose,sharedLink:this.props.sharedLink,getEmailTokenCountFn:this.props.getEmailTokenCountFn,size:this.props.size,handleSettingsButtonClick:this.handleSettingsButtonClick,createdLink:this.state.createdLink,isFolder:this.props.isFolder,user:this.props.user,actionHandler:this.props.actionHandler}):r.React$1.createElement(Ri,{onCreateLinkClick:this.handleCreateLinkClick,canCreateLink:this.props.canCreateLink,size:this.props.size,contentMetadata:this.props.contentMetadata})}}Ni.defaultProps={size:"small"},Ni.contextType=os,Ni.displayName="CopyOrCreateLinkSection";class xi extends r.reactExports.Component{constructor(e){super(e),this.cache={},this.getContacts=()=>this.state.contacts,this.finishLogging=()=>{},this.onInviteTargetsChange=e=>{this.cache=e.reduce(((e,t)=>{const s=d.getUniqueId(t),n=this.cache[s]||ei(t);return Object.assign(Object.assign({},e),{[s]:n})}),{});const t=e.map((e=>this.cache[d.getUniqueId(e)]||ei(e)));this.setState(Object.assign(Object.assign({},this.state),{contacts:t,inviteTargets:e})),this.props.onTypeaheadTokensChange(t),this.props.actionHandler.recipientsChange(t,"")},this.state={objectMetadata:ci(this.props.actionHandler.getSharingInfo()),user:hi(this.props.actionHandler.getSharingInfo()),inviteTargets:this.props.initialTypeaheadTokens.map(Xn),contacts:this.props.initialTypeaheadTokens,isImportContactsExpanded:!1,isImportContactsLoading:!1},this.props.initialTypeaheadTokens&&this.props.initialTypeaheadTokens.length>0&&this.props.actionHandler.recipientsChange(this.props.initialTypeaheadTokens,"")}componentDidUpdate(e,t){e.typeaheadTokens!==this.props.typeaheadTokens&&this.state.contacts!==this.props.typeaheadTokens&&this.onInviteTargetsChange(this.props.typeaheadTokens.map(Xn))}render(){var e;const t=ni(this.props.accessLevel),s=ni(this.props.selectedEmailAccessLevel),n=((null===(e=this.props.emailAccessLevelOptions)||void 0===e?void 0:e.map(ii))||[]).filter((e=>e!==d.OTHER)),i=((e,t)=>{const s=t.isDTLSM1Enabled()?t.emailRecipientAccess():t.recipientAccess(),n=t.recipientValidation()[s]||{},i=e.map(ei).map((e=>e.getKey())),a=e.map(d.getUniqueId),r=a.reduce(((e,t,s)=>Object.assign({[t]:n[i[s]]},e)),{});return a.reduce(((e,t)=>{const s=r[t];if(!s)return e;const n={member:{".tag":"other"},result:ti(s),target_invite_eligibility:{".tag":"other"}};return Object.assign(Object.assign({},e),{[t]:n})}),{})})(this.state.inviteTargets,this.props.actionHandler.getSharingInfo());return r.reactExports.createElement(d.TargetsTokenizer,{accessLevel:t,user:this.state.user,inviteTargets:this.state.inviteTargets,inviteTargetValidation:i,objectMetadata:this.state.objectMetadata,onInviteTargetsChange:this.onInviteTargetsChange,selectedEmailAccessLevel:s,onEmailAccessLevelChange:this.props.onSelectedEmailAccessLevelChange,emailAccessLevelOptions:n})}}xi.displayName="SharingSdkTokenizer";const Pi="/groups_ajax";function Fi(e={}){return new Promise(((t,s)=>{!function(e){const t=Pi+"/"+e.method,s=e.reload_contacts||!1,n=i.Viewer.get_viewer().work_user,a=function(t){const i=JSON.parse(t);if(i.ok&&(e.success(i.data),Oi()),s){le.getSearchConfigForUser(n).localCacheStore.getOrCreateForUser(n).load_contacts(!0)}},r=function(t){const s=t.responseText;e.error&&(e.error(s.slice(4)),Oi())};i.WebRequest$2({url:t,type:"post",data:e.data,subject_user:n,success:a,error:r})}({method:"get_group_info",data:e,success:e=>{t(e)},error:e=>{s(e)}})}))}const Oi=()=>{const e=document.querySelector(".error_msg");e&&(e.style.display="none")};class Di{static initClass(){this.MAX_GROUP_NAME_LEN=100,this.MAX_ROWS_PER_PAGE=15,this.MAX_ROWS_TO_FETCH_FROM_SERVER=50}static isGroupDeleted(e){let t;return t=-1!==e.responseText.indexOf("group has been deleted"),t}static redirectToGroupsPage(e){let t;return t=e?"/":"groups",i.set_hash(t)}}Di.initClass();i.injectInternalStyle("metaserver/static/js/business_space/browse/components/education_tag/education_tag.module.out.css",(e=>"._tag-section-tooltip_mo40d_1{color:var(--color__faint__text);display:block}._section-group-education-tag_mo40d_6{align-items:center;display:flex}"));const $i="_tag-section-tooltip_mo40d_1",Bi="_section-group-education-tag_mo40d_6",Ui=()=>{const[e,t]=r.reactExports.useState(!1),s=r.reactExports.useRef(null);return r.reactExports.createElement(i.Text,{variant:"paragraph",size:"small",color:"faint",className:Bi},o.intl.formatMessage({id:"kmebBo",defaultMessage:"What are groups?"}),r.reactExports.createElement(i.IconButton,{id:"toggletip-button",size:"standard",variant:"transparent",ref:s,onClick:()=>t(!e)},r.reactExports.createElement(i.UIIcon,{className:$i,src:i.HelpLine,size:"standard","aria-label":"What are groups?"})),r.reactExports.createElement(i.Tooltip.Control,{open:e,triggerRef:s,auto:!0,placement:"top-end"},r.reactExports.createElement(i.Text,{tagName:"p",color:"standard",inverse:!0},o.intl.formatMessage({id:"gw/WIP",defaultMessage:"Groups allow you to quickly and easily share a folder or file to all group members. "}),r.reactExports.createElement("a",{href:"https://help.dropbox.com/teams-admins/team-member/groups",target:"_blank",rel:"noopener"},o.intl.formatMessage({id:"6gh7Br",defaultMessage:"Learn More"})))))};Ui.displayName="EducationTag";i.injectInternalStyle("metaserver/static/js/business_space/browse/group_suggestion/group_suggestion_section.module.out.css",(e=>"._section-group-suggestion_1rfvu_1{display:flex;flex-direction:row;justify-content:space-between}._section-manage-your-groups-link_1rfvu_7{display:flex}"));const Hi="_section-group-suggestion_1rfvu_1",Vi="_section-manage-your-groups-link_1rfvu_7",Gi=(e,t)=>e.length>1&&e.every((e=>!e.group_id&&(e.on_team||e.dbx_team_id&&e.dbx_team_id===t.team_dbtid))),Wi=()=>{const e=document.querySelector(".server-error");e&&(e.style.display="none")},Ki=e=>{const t=t=>{const s=e.user.is_team_admin?"/team/admin/groups?role=work#/":"/team#groups/";return()=>{i.open_tab(s+t)}},[s,n]=r.reactExports.useState(!1),[l,c]=r.reactExports.useState([]),[d,h]=r.reactExports.useState([]),[p,u]=r.reactExports.useState(!1),[m,g]=r.reactExports.useState(!1),f=e=>{const t=e.filter((e=>!!e.group_id));h(t)},_=t=>{n(t),e.setIsGroupCreationInProgress(t)};r.reactExports.useEffect((()=>{if(e.expBsxOrganizeAroundPeople){new le.ContactsDataSourceV2(e.user,void 0,!1).getAll(f)}}),[e.user]),r.reactExports.useEffect((()=>{if(c([]),g(!1),Gi(e.contacts,e.user)&&e.expBsxOrganizeAroundPeople){const t=[],s=d.filter((t=>t.group_size===e.contacts.length+1&&!!t.group_id)).map((e=>{return s={group_id:e.group_id},a.__awaiter(void 0,void 0,void 0,(function*(){try{const a=yield Fi(s);return E(a)&&(t.push(e),c(t),i.logEvent({class:"organize_around_people",action:"shown",object:"match_group_suggestion",properties:n})),a}catch(t){if(console.error(`Error on geting group info for group ${e.group_id}.`,t),Wi(),"Actor must be in the group"===t)return null;throw A.reportException({err:t,tags:["get_group_info_failed"],severity:"non-critical"}),t}var n}));var s})),n=e=>{var t;S()&&!e.length&&i.logEvent({class:"organize_around_people",action:"shown",object:"create_group_suggestion",properties:t})};s.length?(u(!0),Promise.all(s).then((e=>{n(t)})).catch((e=>{g(!0)})).finally((()=>{u(!1),Wi()}))):n(t)}}),[e.contacts,d]);const E=t=>{const s=e.contacts.map((e=>e.email));s.push(e.user.email);const n=new Set(t.users.map((e=>e.email)));return s.every((e=>n.has(e)))},S=()=>{var t;return e.user.is_team_admin||"admins_and_members"===(null===(t=e.teamPolicy)||void 0===t?void 0:t.group_creation_policy)};return p?r.React$1.createElement(i.ProgressBar,{in:!0,isIndeterminate:!0}):r.React$1.createElement(r.React$1.Fragment,null,e.expBsxOrganizeAroundPeople&&Gi(e.contacts,e.user)&&0===l.length&&S()&&!m&&r.React$1.createElement("div",{className:Hi},r.React$1.createElement(i.Button$1,{variant:"opacity",onClick:()=>((s,n)=>{let a="";const r=n.map((e=>e.name.split(" ")[0])).concat(s.fname);for(let e=0;e<r.length;e++){const t=r[e];if(0===e)a+=t;else{if(!((a+", "+t).length<=Di.MAX_GROUP_NAME_LEN-3)){a+="...";break}a+=", "+t}}const l=n.map((e=>({email:e.email,is_owner:!1})));var c;_(!0),i.Snackbar.sync(o.intl.formatMessage({id:"Ko1UZV",defaultMessage:"Creating group..."}),!1,"group-suggestion"),i.logEvent({class:"organize_around_people",action:"click",object:"create_group_suggestion",properties:c}),i.WebRequest$1({url:"/groups_ajax/make_new_group_with_users",data:{name:a,members:JSON.stringify([{name:s.display_name,email:s.email,is_owner:!0},...l]),is_admin_managed:!1},subject_user:s,success:(s,r)=>{const l=JSON.parse(r).data.id;e.updateGroupSelection(new i.Contact({type:i.ContactTypes.NEW_STYLE_GROUP,name:a,group_id:l,group_size:n.length+1,members:a,on_team:!0})),i.Snackbar.complete(o.intl.formatMessage({id:"2o8/E+",defaultMessage:"Group created and saved."}),"group-suggestion",{actionButtonText:o.intl.formatMessage({id:"H3Nuk5",defaultMessage:"Manage group"}),onActionClick:t(l),closeButtonText:o.intl.formatMessage({id:"Js0Z4W",defaultMessage:"Close"})}),_(!1)},error:()=>{i.Snackbar.fail(o.intl.formatMessage({id:"Pn6eNL",defaultMessage:"Error creating group."}),"group-suggestion"),_(!1)},complete:()=>{_(!1)}})})(e.user,e.contacts),isLoading:s},o.intl.formatMessage({id:"tyM1vU",defaultMessage:"Save as group"})),r.React$1.createElement(Ui,null)),e.expBsxOrganizeAroundPeople&&l.length>0&&r.React$1.createElement(r.React$1.Fragment,null,l.map((t=>r.React$1.createElement(i.ChoiceChip,{onClick:()=>(t=>{var s;i.logEvent({class:"organize_around_people",action:"click",object:"match_group_suggestion",properties:s}),e.updateGroupSelection(t)})(t)},t.name)))),e.expBsxOrganizeAroundPeople&&e.contacts.some((e=>e.group_id))&&r.React$1.createElement("div",{className:Vi},r.React$1.createElement(i.Text,{size:"standard"},r.React$1.createElement(i.Link,{href:"#",onClick:()=>{e.user.is_team_admin?i.open_tab("/team/admin/groups?role=work"):i.open_tab("/team#groups")},hasNoUnderline:!0},o.intl.formatMessage({id:"EMZfdS",defaultMessage:"Manage your groups"})))))},zi="share-modal-evolution-contacts-field",qi={[b.ContactsErrorLevel.Error]:"error",[b.ContactsErrorLevel.Warn]:"warn",defaultLevel:"default"};class ji extends r.React$1.Component{constructor(e){super(e),this.updateGroupSelection=e=>{this.setState({typeaheadTokens:[e]})},this.getIsSharingSdkTokenizerEnabled=()=>{const e=this.props.actionHandler.getSharingInfo();return!(!e||!e.sharingPrefs)&&"ON"===e.sharingPrefs().sharing_sdk_tokenizer_variant},this.getIsExpBsxOrganizeAroundPeopleEnabled=()=>{const e=this.props.actionHandler.getSharingInfo();return!!e&&e.isExpBsxOrganizeAroundPeopleEnabled()},this.setIsGroupCreationInProgress=e=>{this.setState({isGroupCreationInProgress:e})},this.finishLogging=e=>this.shareContactsTokenizerRef.finishLogging(e),this.onTypeaheadTokensChange=e=>{this.setState({typeaheadTokens:e}),this.props.emailCountChangeCallback(e.length)},this.setShareContactsTokenizerRef=e=>{null!==e&&(this.shareContactsTokenizerRef=e)},this.filterContacts=e=>this.props.isTeamSharedFolder?!!e.group_id:e.email!==this.props.user.email,this.includeGroupTokens=()=>this.state.typeaheadTokens.some((({group_id:e})=>!!e)),this.shouldDisableApprovalCheckbox=()=>this.includeGroupTokens(),this.shouldCreateApproval=()=>{const{showApproval:e,sendApproval:t}=this.props;return e&&!this.shouldDisableApprovalCheckbox()&&t},this.renderApprovalTypeRadioButtons=()=>{const{actionHandler:e,showApproval:t,needsAllApprovers:s,sendApproval:n}=this.props,{typeaheadTokens:i}=this.state;return!t||!n||this.shouldDisableApprovalCheckbox()||i.length<2?null:r.React$1.createElement(ge.ApprovalTypeRadioButtonGroup,{needsAllApprovers:s,onChange:e.changeNeedsAllApprovers})},this.renderApprovalCheckbox=()=>{const{actionHandler:e,showApproval:t,sendApproval:s,recipientMessage:n}=this.props;if(!t||0===this.state.typeaheadTokens.length&&0===n.length)return null;const i=this.shouldDisableApprovalCheckbox();return r.React$1.createElement(ge.ApprovalCheckboxInShare,{disabled:i,checked:!i&&s,onChange:e.toggleSendApproval,onMount:e.logShownApprovalForm})},this.footerContent=()=>{var e;const t=this.props.accessLevel,s=this.props.sharedLink,n=this.props.canCreateLink,i=null===(e=this.props.actionHandler.getSharingInfo())||void 0===e?void 0:e.isDTLSM1Enabled();return r.React$1.createElement(r.React$1.Fragment,null,this.shouldRenderPostNoteAsComment()&&this.renderPostNoteAsComment(),!i&&r.React$1.createElement(Ni,{size:"standard",accessLevel:t,actionHandler:this.props.actionHandler,modalClose:this.props.modalClose,sharedLink:s,getEmailTokenCountFn:this.props.getEmailTokenCountFn,canCreateLink:n,isFolder:this.props.isFolder,contentMetadata:this.props.contentMetadata,user:this.props.user}))},this.onEmailLinkButtonClick=()=>{var e;return(null===(e=this.props.actionHandler.getSharingInfo())||void 0===e?void 0:e.isDTLSM1Enabled())||this.logClickShareButtonLinkSettingsStatus(),this.shouldCreateApproval()?this.props.actionHandler.createApproval(this):this.props.actionHandler.sendShare(this)},this.onCheckboxToggled=()=>{this.props.actionHandler.changeCreateCommentCheckbox(!this.props.isPostNoteAsCommentChecked)},this.state={typeaheadTokens:this.props.initialTypeaheadTokens,isGroupCreationInProgress:!1}}getContacts(){return this.shareContactsTokenizerRef.getContacts()}render(){var e;const{contactsError:t,disabledContactsInput:s,creatingApprovalRequest:n}=this.props,a=i.cx(["email-share",s?`${zi}__typeahead--disabled`:`${zi}__typeahead`,t&&t.level===b.ContactsErrorLevel.Error?"contacts-input-error":void 0]);return(null===(e=this.props.actionHandler.getSharingInfo())||void 0===e?void 0:e.isDTLSM1Enabled())?r.React$1.createElement(d.ActionContainer,{style:{marginLeft:"0px",marginRight:"0px",marginTop:"6px"}},this.renderContactsError(),r.React$1.createElement(d.ActionSection,{footerContent:this.footerContent(),footerActions:r.React$1.createElement("span",{className:"scl-sharing-modal-footer"},r.React$1.createElement(i.Button$1,{isLoading:n,disabled:this.shouldDisableShareButton(),onClick:this.onEmailLinkButtonClick,variant:"primary",className:"email-link-button","data-uxa-log":"sharing-modal-footer-button-send-email"},this.getShareButtonText())),isHeaderBold:!1,className:"email-accordion-section"},this.renderContactTokenizer(a),this.renderApprovalTypeRadioButtons(),this.shouldRenderMessageField()&&this.renderMessageField(),this.renderApprovalCheckbox())):r.React$1.createElement(d.ActionSection,{footerContent:this.footerContent(),footerActions:r.React$1.createElement("span",{className:"scl-sharing-modal-footer"},r.React$1.createElement(i.Button$1,{isLoading:n,disabled:this.shouldDisableShareButton(),onClick:this.onEmailLinkButtonClick,variant:"primary",className:"email-link-button","data-uxa-log":"sharing-modal-footer-button-send-email"},this.getShareButtonText())),isHeaderBold:!1},this.renderContactTokenizer(a),this.renderApprovalTypeRadioButtons(),this.shouldRenderMessageField()&&this.renderMessageField(),this.renderApprovalCheckbox())}shouldRenderMessageField(){return this.state.typeaheadTokens.length>0||this.props.recipientMessage.length>0}shouldDisableShareButton(){return this.props.isEmailSending||this.props.isTokenizerEmpty||this.props.contactsError&&this.props.contactsError.level===b.ContactsErrorLevel.Error||this.state.isGroupCreationInProgress}shouldRenderPostNoteAsComment(){return this.props.showPostNoteAsComment&&this.props.recipientMessage.length>0&&this.shouldRenderMessageField()}getTypeaheadPlaceholder(){return this.props.isTeamSharedFolder?o.intl.formatMessage({id:"VMGE6I",defaultMessage:"Group names"}):this.props.user.is_team?o.intl.formatMessage({id:"+nKRfb",defaultMessage:"Add an email, name, or group"}):o.intl.formatMessage({id:"bdV6O3",defaultMessage:"Add an email or name"})}getShareButtonText(){const e=o.intl.formatMessage({id:"vJGcTi",defaultMessage:"Share file"}),t=o.intl.formatMessage({id:"cHEg6H",defaultMessage:"Share folder"}),s=o.intl.formatMessage({id:"Qd1iC2",defaultMessage:"Sharing..."}),n=this.props.isFolder?t:e;return this.props.isEmailSending?s:n}getMessageType(){const e=this.props.contactsError.level||"defaultLevel";return qi[e]}renderContactsError(){const e=this.props.contactsError.message?"share-modal-evolution__contacts-error-banner-on":"share-modal-evolution__contacts-error-banner-off";return r.React$1.createElement("div",{className:e},r.React$1.createElement(d.FormValidationMessage,{message:this.props.contactsError.message,variant:this.getMessageType()}))}renderContactTokenizer(e){var t;let s;return s=this.getIsSharingSdkTokenizerEnabled()?(null===(t=this.props.actionHandler.getSharingInfo())||void 0===t?void 0:t.isDTLSM1Enabled())?r.React$1.createElement(ki,{user:this.props.user,contentInfo:this.props.actionHandler.getContentInfo(),metadata:this.props.actionHandler.getSharingInfo().metadata()},r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(xi,{accessLevel:this.props.accessLevel,className:e,ref:this.setShareContactsTokenizerRef,actionHandler:this.props.actionHandler,disabledInput:this.props.disabledContactsInput,focusOnMount:!this.props.disabledContactsInput,initialTypeaheadTokens:this.props.initialTypeaheadTokens,typeaheadTokens:this.state.typeaheadTokens,onTypeaheadTokensChange:this.onTypeaheadTokensChange,shouldLogContactSearch:!0,typeaheadPlaceholder:this.getTypeaheadPlaceholder(),user:this.props.user,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.teamGroupInfo,filterContacts:this.filterContacts,selectedEmailAccessLevel:this.props.selectedEmailAccessLevel,onSelectedEmailAccessLevelChange:this.props.onSelectedEmailAccessLevelChange,emailAccessLevelOptions:this.props.emailAccessLevelOptions}),r.React$1.createElement(Ki,{contacts:this.state.typeaheadTokens,user:this.props.user,expBsxOrganizeAroundPeople:this.getIsExpBsxOrganizeAroundPeopleEnabled(),updateGroupSelection:this.updateGroupSelection,teamPolicy:this.props.teamPolicy,setIsGroupCreationInProgress:this.setIsGroupCreationInProgress}))):r.React$1.createElement(ki,{user:this.props.user,contentInfo:this.props.actionHandler.getContentInfo(),metadata:this.props.actionHandler.getSharingInfo().metadata()},r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(xi,{accessLevel:this.props.accessLevel,className:e,ref:this.setShareContactsTokenizerRef,actionHandler:this.props.actionHandler,disabledInput:this.props.disabledContactsInput,focusOnMount:!this.props.disabledContactsInput,initialTypeaheadTokens:this.props.initialTypeaheadTokens,typeaheadTokens:this.state.typeaheadTokens,onTypeaheadTokensChange:this.onTypeaheadTokensChange,shouldLogContactSearch:!0,typeaheadPlaceholder:this.getTypeaheadPlaceholder(),user:this.props.user,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.teamGroupInfo,filterContacts:this.filterContacts}),r.React$1.createElement(Ki,{contacts:this.state.typeaheadTokens,user:this.props.user,expBsxOrganizeAroundPeople:this.getIsExpBsxOrganizeAroundPeopleEnabled(),updateGroupSelection:this.updateGroupSelection,teamPolicy:this.props.teamPolicy,setIsGroupCreationInProgress:this.setIsGroupCreationInProgress}))):r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(En,{className:e,ref:this.setShareContactsTokenizerRef,actionHandler:this.props.actionHandler,disabledInput:this.props.disabledContactsInput,focusOnMount:!this.props.disabledContactsInput,initialTypeaheadTokens:this.props.initialTypeaheadTokens,typeaheadTokens:this.state.typeaheadTokens,onTypeaheadTokensChange:this.onTypeaheadTokensChange,shouldLogContactSearch:!0,typeaheadPlaceholder:this.getTypeaheadPlaceholder(),user:this.props.user,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.teamGroupInfo,filterContacts:this.filterContacts}),r.React$1.createElement(Ki,{contacts:this.state.typeaheadTokens,user:this.props.user,expBsxOrganizeAroundPeople:this.getIsExpBsxOrganizeAroundPeopleEnabled(),updateGroupSelection:this.updateGroupSelection,teamPolicy:this.props.teamPolicy,setIsGroupCreationInProgress:this.setIsGroupCreationInProgress})),this.props.disabledContactsInput?r.React$1.createElement(i.Tooltip,{id:"tooltip-button",title:o.intl.formatMessage({id:"0S6iYY",defaultMessage:"This can only be shared with the link"})},r.React$1.createElement("div",{id:"contact_tokenizer_with_tooltip"},s)):s}renderMessageField(){return r.React$1.createElement("div",{className:"share-modal-evolution-message-field"},r.React$1.createElement(i.TextArea,{placeholder:o.intl.formatMessage({id:"30bVmM",defaultMessage:"Add a note"}),"aria-label":o.intl.formatMessage({id:"30bVmM",defaultMessage:"Add a note"}),onChange:this.props.handleMessageChanged,value:this.props.recipientMessage}))}renderPostNoteAsComment(){const e=o.intl.formatMessage({id:"Jfn0Wa",defaultMessage:"Post this note as a comment"});return r.React$1.createElement(d.CheckboxWithLabel,{onCheckboxToggled:this.onCheckboxToggled,isChecked:this.props.isPostNoteAsCommentChecked,label:e,isCheckboxDisabled:""===this.props.recipientMessage,fontSize:"small"})}logClickShareButtonLinkSettingsStatus(){let e=!1,t=!1,s=!1;if(this.props.sharedLink){const n=p.getAudienceForLink(this.props.sharedLink.link_permissions);e=this.props.sharedLink.link_permissions.require_password||"password"===n,t=!!this.props.sharedLink.expires,s=!this.props.sharedLink.link_permissions.allow_download}this.context.logEvent(k.TiburonEventName.ClickShareButtonLinkSettingsStatus,this.props.sharedLink,{password:e,expiration:t,disable_download:s})}}ji.contextType=os,ji.displayName="EmailShare";class Yi extends r.React$1.Component{constructor(e){super(e),this.state={numEmailTokens:this.props.initialTypeaheadTokens.length}}render(){return r.React$1.createElement(ji,{actionHandler:this.props.actionHandler,contactsError:this.props.contactsError,isEmailSending:this.props.isEmailSending,disabledContactsInput:!this.props.canInviteByEmail,handleMessageChanged:this.props.handleMessageChanged,modalClose:this.props.modalClose,recipientMessage:this.props.recipientMessage,sharedLink:this.props.sharedLink,showPostNoteAsComment:this.props.showPostNoteAsComment,isFolder:this.props.isFolder,isPostNoteAsCommentChecked:this.props.isPostNoteAsCommentChecked,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,initialTypeaheadTokens:this.props.initialTypeaheadTokens,user:this.props.user,emailCountChangeCallback:this.updateEmailTokenCount.bind(this),accessLevel:this.props.accessLevel,getEmailTokenCountFn:this.getEmailTokenCount.bind(this),canCreateLink:this.props.canCreateLink,contentMetadata:this.props.contentMetadata,canCreateViewLinkForFolder:this.props.canCreateViewLinkForFolder,viewLinkForFolder:this.props.viewLinkForFolder,showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest,teamPolicy:this.props.teamPolicy})}updateEmailTokenCount(e){this.setState({numEmailTokens:e})}getEmailTokenCount(){return this.state.numEmailTokens}}Yi.displayName="ShareLinkSection",Yi.contextType=os;class Zi extends r.React$1.Component{constructor(e){super(e)}render(){return r.React$1.createElement(Yi,{key:"shareLinkSection",accessLevel:this.props.accessLevel,actionHandler:this.props.actionHandler,canCreateLink:this.props.canCreateLink,canInviteByEmail:this.props.canInviteByEmail,contactsError:this.props.contactsError,isEmailSending:this.props.isEmailSending,handleMessageChanged:this.props.handleMessageChanged,modalClose:this.props.modalClose,recipientMessage:this.props.recipientMessage,sharedLink:this.props.sharedLink,isPostNoteAsCommentChecked:this.props.isPostNoteAsCommentChecked,isFolder:this.props.isFolder,showPostNoteAsComment:this.props.showPostNoteAsComment,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,initialTypeaheadTokens:this.props.initialTypeaheadTokens,user:this.props.user,contentMetadata:this.props.contentMetadata,canCreateViewLinkForFolder:this.props.canCreateViewLinkForFolder,viewLinkForFolder:this.props.viewLinkForFolder,showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest,teamPolicy:this.props.teamPolicy})}}Zi.displayName="LinkSection",Zi.contextType=os;class Qi extends r.React$1.Component{render(){return r.React$1.createElement(d.Banner,{variant:"transparent-left"},r.React$1.createElement(i.Text,null,this.getNoPermissionsText()))}getNoPermissionsText(){return"editor"===this.props.accessLevel?this.props.isFolder?o.intl.formatMessage({id:"dooCWY",defaultMessage:"You can only share a link for viewing for this folder."}):o.intl.formatMessage({id:"XbAqHv",defaultMessage:"You can only share a link for viewing for this type of file."}):o.intl.formatMessage({id:"X+IYXP",defaultMessage:"This link type isn’t supported."})}}Qi.displayName="NoPermissionsBanner";const Ji=o.intl.formatMessage({id:"jAzCAz",defaultMessage:"can edit"}),Xi=o.intl.formatMessage({id:"GKgRRt",defaultMessage:"can edit"}),ea=o.intl.formatMessage({id:"wZejJ8",defaultMessage:"can view"}),ta=o.intl.formatMessage({id:"eCFw0p",defaultMessage:"can view"});function sa(e,t){return"public"===e?"editor"===t?Ji:ea:"editor"===t?Xi:ta}function na(e,t,s){return"default_no_one"===e||"members"===t?"no_one":"team_only"!==e&&"default_team_only"!==e||s&&"public"!==s?null!=s?s:"public":"team"}function ia(e,t,s,n,i,a,r,o){var l;return t||(s?p.getAudienceForLink(s.link_permissions):e?null!==(l=function(e,t,s,n,i){if(t&&"members"===t.shared_link_policy)return"no_one";if(e){const t=e.shared_folder_link_restriction_policy,a=e.shared_link_create_policy;if(n){if(function(e,t,s){return"default_no_one"===e||"members"===t||"no_one"===s?!(("default_no_one"===e||"members"===t)&&"no_one"===s):("team_only"===e||"default_team_only"===e||"team"===s)&&!(("team_only"===e||"default_team_only"===e)&&"team"===s)}(a,t,s)){const n=na(a,t,s);if(i){const r=function(e,t){return"members"===t||"default_no_one"===e?"NO_ONE":"team_only"===e||"default_team_only"===e?"TEAM":"PUBLIC"}(a,t);i({userDefaultLinkAudience:s?s.toUpperCase():"",teamDefaultLinkAudience:r,finalAudience:n.toUpperCase(),isTeamUser:!!e})}return n}return s}if("members"===t)return"no_one";if("team_only"===a||"default_team_only"===a)return"team";if("default_no_one"===a)return"no_one"}return s||"public"}(n,i,a,r,o))&&void 0!==l?l:"public":"no_one")}const aa="share-modal-evolution-access-level-dropdown";class ra extends r.React$1.Component{constructor(){super(...arguments),this.renderDropdownOptions=e=>e.map((e=>r.React$1.createElement(i.Menu.SelectItem,{key:e.label,value:e.link_access_level,selected:this.props.selectedAccessLevel===e.link_access_level,disabled:!e.allowed},sa(this.props.selectedAudience,e.link_access_level)))),this.handleSelectedAccessLevelChange=e=>{this.props.selectedAccessLevel!==e&&this.props.onSelectedAccessLevelChange(e)}}render(){const e=this.props.linkAccessLevelOptions,t=1===e.length?" ":": ",s=i.cx([`${aa}`,e.length>1?`${aa}__with-menu`:void 0]);return r.React$1.createElement("div",{className:s},r.React$1.createElement(i.Text,{className:`${aa}__audience-text`},this.getAudienceText(),t),1===e.length?this.getCurrentAccessLevelText():this.renderAccessMenu(e))}getAudienceText(){const{contentMetadata:e,selectedAudience:t}=this.props;return function(e,t){switch(e){case"public":return o.intl.formatMessage({id:"vAFlk4",defaultMessage:"Anyone with this link"});case"team":return t?o.intl.formatMessage({id:"tOfnIZ",defaultMessage:"{team_name} members with this link"},{team_name:i.Emstring.em_snippet(t.name,i.SNIPPET_SIZES.COMPANY_NAME,1)}):o.intl.formatMessage({id:"wrE9Wi",defaultMessage:"Team Members with this link"});case"password":return o.intl.formatMessage({id:"QI5Jkq",defaultMessage:"People with the password for this link"});case"no_one":return o.intl.formatMessage({id:"SnIjdP",defaultMessage:"Only people invited"})}}(t,e.owner_team)}getCurrentAccessLevelText(){return r.React$1.createElement(i.Text,{className:`${aa}__audience-text`,isBold:!0},sa(this.props.selectedAudience,this.props.selectedAccessLevel))}renderAccessMenu(e){return r.React$1.createElement(i.Menu.Wrapper,{onSelection:this.handleSelectedAccessLevelChange,isPortaled:!1,className:`${aa}__unportaled-menu`},(({getContentProps:t,getTriggerProps:s})=>r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(i.Button$1,Object.assign({},s(),{variant:"transparent",withDropdownIcon:!0}),sa(this.props.selectedAudience,this.props.selectedAccessLevel)),r.React$1.createElement(i.Menu.Content,Object.assign({},t(),{placement:"bottom-end"}),r.React$1.createElement(i.Menu.Segment,null,this.renderDropdownOptions(e))))))}}ra.displayName="AccessLevelDropdown";let oa=class extends r.React$1.Component{constructor(){super(...arguments),this.handleSettingsButtonClick=e=>{let t;e.preventDefault(),"editor"===this.props.selectedAccessLevel?(this.props.openSharingSettingsModal("edit_link_settings"),t=k.SettingsTabName.EditLinkSettingsTab):(this.props.openSharingSettingsModal("view_link_settings"),t=k.SettingsTabName.ViewLinkSettingsTab),this.context.logEvent(k.TiburonEventName.ClickSettingsText,this.props.sharedLink,{settings_tab:t})}}render(){const{canCreateLink:e,contentMetadata:t,linkAccessLevelOptions:s,onSelectedAccessLevelChange:n,selectedAccessLevel:a,selectedAudience:o,sharedLink:l,teamPolicy:c,defaultSharingLinkAudience:h,isUlssEnabled:p,onLogDefaultAudienceConflict:u}=this.props,m=this.enableSettingsButton();return r.React$1.createElement(d.ActionSection,{layout:"columns"},r.React$1.createElement(ra,{selectedAccessLevel:a,linkAccessLevelOptions:s,contentMetadata:t,selectedAudience:ia(e,o,l,c,t.policy,h,p,u),onSelectedAccessLevelChange:n}),r.React$1.createElement(i.Text,{size:"standard",color:m?"standard":"disabled"},this.renderSettingsButton(m)))}enableSettingsButton(){return this.props.canCreateLink||void 0!==this.props.sharedLink}renderSettingsButton(e){const t=o.intl.formatMessage({id:"Q8t9EL",defaultMessage:"Settings"});return e?r.React$1.createElement(i.Link,{href:"#",hasNoUnderline:!0,onClick:this.handleSettingsButtonClick},t):r.React$1.createElement(r.React$1.Fragment,null,t)}};oa.displayName="AccessLevelSection",oa.contextType=os;var la={expandedPanels:new Set([]),variant:"standard",headerTagName:"h1"},ca=r.reactExports.createContext(la),da=r.reactExports.createContext({itemId:"",isDisabled:!1,headerA11yProps:{id:"",ariaControls:""},setHeaderA11yProps:()=>{}}),ha=r.reactExports.createContext({size:"medium"}),pa=({className:e,children:t,variant:s="standard",expandedPanel:n="",expandedPanels:a=[],headerTagName:o="h2",...l})=>{const c=i.cx("dig-Accordion",`dig-Accordion--${s}`,e);return r.reactExports.createElement(ca.Provider,{value:{expandedPanels:"blades"===s?new Set([n]):new Set(a),variant:s,headerTagName:o}},r.reactExports.createElement("div",{className:c,...l},t))};pa.displayName="Accordion",pa.Item=({itemId:e,className:t,isDisabled:s=!1,children:n,...a})=>{const{expandedPanels:o}=r.reactExports.useContext(ca),[l,c]=r.reactExports.useState({id:"",ariaControls:""}),d=o.has(e),h=i.cx("dig-Accordion-item",{"dig-Accordion-item--isActive":d,"dig-Accordion-item--disabled":s},t);return r.reactExports.createElement(da.Provider,{value:{itemId:e,isDisabled:s,headerA11yProps:l,setHeaderA11yProps:c}},r.reactExports.createElement("div",{className:h,...a},n))},pa.Header=({size:e="medium",spacing:t="medium",id:s,"aria-controls":n,className:a,children:o,...l})=>{const{expandedPanels:c,headerTagName:d}=r.reactExports.useContext(ca),{itemId:h,isDisabled:p,setHeaderA11yProps:u}=r.reactExports.useContext(da),m=c.has(h),g=i.cx("dig-Accordion-header",`dig-Accordion-header-size--${e}`,`dig-Accordion-header-spacing--${t}`,a),f=r.reactExports.useMemo((()=>s||(e=>`${e}-header-id`)(h)),[h,s]),_=r.reactExports.useMemo((()=>n||(e=>`${e}-panel-id`)(h)),[h,n]);return r.reactExports.useEffect((()=>{u({id:f,ariaControls:_})}),[f,_,u]),r.reactExports.createElement(ha.Provider,{value:{size:e}},r.reactExports.createElement(d,{className:g},r.reactExports.createElement("button",{className:"dig-Accordion-header-trigger",id:f,"aria-controls":_,...l,tabIndex:0,"aria-expanded":m,"aria-disabled":p,disabled:p},o)))},pa.HeaderContent=({withTitle:e,withLeftAccessory:t,withTitleRightAccessory:s,withSubtitle:n})=>{const{variant:a,expandedPanels:o}=r.reactExports.useContext(ca),{itemId:l,isDisabled:c}=r.reactExports.useContext(da),{size:d}=r.reactExports.useContext(ha),h=o.has(l),p=r.reactExports.useMemo((()=>"medium"===d?"standard":d),[d]),u=r.reactExports.useMemo((()=>c?"disabled":"blades"!==a||h?"standard":"faint"),[c,a,h]),m=r.reactExports.useMemo((()=>c?"disabled":"faint"),[c]);return r.reactExports.createElement(r.reactExports.Fragment,null,t&&r.reactExports.createElement("div",{className:"dig-Accordion-header-left-accessory"},t),r.reactExports.createElement("div",{className:"dig-Accordion-header-title-container"},r.reactExports.createElement("div",{className:"dig-Accordion-header-title-badge-container"},r.reactExports.createElement(i.Text,{isBold:!0,size:p,variant:"label",className:"dig-Accordion-header-title",color:u},e),s&&r.reactExports.createElement("div",{className:"dig-Accordion-header-title-right-accessory"},s)),r.reactExports.createElement(i.Text,{size:p,color:m,variant:"label",className:"dig-Accordion-header-subtitle"},n)),"standard"===a&&r.reactExports.createElement("div",{className:"dig-Accordion-header-chevron"},r.reactExports.createElement(i.UIIcon,{src:h?i.ChevronUpLine:i.ChevronDownLine,size:"small"})))},pa.Panel=({children:e,spacing:t="medium",className:s,...n})=>{const{itemId:a,headerA11yProps:o}=r.reactExports.useContext(da),{expandedPanels:l}=r.reactExports.useContext(ca),c=l.has(a),d=i.cx("dig-Accordion-panel",`dig-Accordion-panel-spacing--${t}`,s);return r.reactExports.createElement("div",{className:d,...n,role:"region",id:o.ariaControls,"aria-labelledby":o.id,"aria-hidden":!c,hidden:!c},e)};const ua=(e,t,s)=>"public"===t[".tag"]?"editor"===s[".tag"]?(e=>e.formatMessage({id:"jAzCAz",defaultMessage:"can edit"}))(e):(e=>e.formatMessage({id:"wZejJ8",defaultMessage:"can view"}))(e):"editor"===s[".tag"]?(e=>e.formatMessage({id:"GKgRRt",defaultMessage:"can edit"}))(e):(e=>e.formatMessage({id:"eCFw0p",defaultMessage:"can view"}))(e),ma=({currentAccessLevel:e,enableViewOption:t,enableEditOption:s,linkAudience:n,ownerTeamName:a,onAccessLevelChange:l})=>{const c=o.useIntl(),h=!s||!t,p="editor"===e[".tag"]?d.EDITOR:d.VIEWER;return r.reactExports.createElement("div",{style:{minWidth:"auto",display:"flex",alignItems:"baseline",whiteSpace:"pre-wrap"},"data-testid":"access-level-section"},r.reactExports.createElement(i.Text,null,((e,t,s)=>"public"===t[".tag"]?e.formatMessage({id:"vAFlk4",defaultMessage:"Anyone with this link"}):"team"===t[".tag"]?void 0!==s?e.formatMessage({id:"tOfnIZ",defaultMessage:"{team_name} members with this link"},{team_name:d.Emstring.em_snippet(s,i.SNIPPET_SIZES.COMPANY_NAME,1)}):e.formatMessage({id:"wrE9Wi",defaultMessage:"Team Members with this link"}):"password"===t[".tag"]?e.formatMessage({id:"QI5Jkq",defaultMessage:"People with the password for this link"}):"no_one"===t[".tag"]?e.formatMessage({id:"SnIjdP",defaultMessage:"Only people invited"}):"")(c,n,a),h?" ":": "),h?r.reactExports.createElement(i.Text,{isBold:!0},ua(c,n,p)):r.reactExports.createElement(i.Menu.Wrapper,{onSelection:t=>{t!==e[".tag"]&&l&&l(t)},isPortaled:!1,"data-testid":"access-level-section-dropdown",style:{verticalAlign:"bottom",whiteSpace:"nowrap"}},(({getContentProps:a,getTriggerProps:o})=>r.reactExports.createElement(r.reactExports.Fragment,null,r.reactExports.createElement(i.Button$1,Object.assign({},o(),{variant:"transparent",hasNoUnderline:!0,withDropdownIcon:!0,"data-testid":"access-level-section-button",style:{position:"relative"}}),ua(c,n,p)),r.reactExports.createElement(i.Menu.Content,Object.assign({"data-sharing-sdk":"1"},a(),{placement:"bottom-end"}),r.reactExports.createElement(i.Menu.Segment,null,t?r.reactExports.createElement(i.Menu.SelectItem,{key:"view",value:"viewer","data-testid":"access-level-section-dropdown-view-item",selected:"editor"!==e[".tag"]},ua(c,n,d.VIEWER)):null,s?r.reactExports.createElement(i.Menu.SelectItem,{key:"edit",value:"editor","data-testid":"access-level-section-dropdown-edit-item",selected:"editor"===e[".tag"]},ua(c,n,d.EDITOR)):null))))))};ma.displayName="AccessLevelSection";const ga=({isPasswordRequired:e,daysUntilExpiration:t,onClickModify:s})=>{const n=o.useIntl();if(!e&&!t)return null;const a=((e,t,s)=>s&&t?(e=>e.formatMessage({id:"P+LC9Y",defaultMessage:"Restrictions apply"}))(e):t?(e=>e.formatMessage({id:"K/i5x+",defaultMessage:"Password required"}))(e):s?((e,t)=>e.formatMessage({id:"fp7TGs",defaultMessage:"{count, plural, one{Expires in a day} other{Expires in {count} days}}"},{count:t}))(e,s):"")(n,e,t);if(!a)return null;return r.reactExports.createElement(i.Text,{color:"faint","data-testid":"link-restrictions-section"},r.reactExports.createElement("span",{style:{marginLeft:"4px"}},a),r.reactExports.createElement("span",{style:{margin:"0 4px"}},"-"),r.reactExports.createElement(i.Link,{style:{display:"inline"},inverse:!0,href:"#",onClick:e=>{e.preventDefault(),s()}},(e=>e.formatMessage({id:"fnpXzr",defaultMessage:"Modify"}))(n)))};ga.displayName="LinkRestrictionsSection";const fa=r.reactExports.forwardRef((({linkUrl:e,canCreateLink:t,onCopyLink:s},n)=>{const a=o.useIntl();if(e){const t=e=>{e.preventDefault(),e.currentTarget.select()},o=a.formatMessage({id:"lWpTxV",defaultMessage:"Shared link"});return r.reactExports.createElement(i.TextInput,{style:{paddingTop:"6px",paddingBottom:"5px"},value:e,"aria-label":o,onFocus:t,onClick:t,onCopy:s,readOnly:!0,ref:n})}{const e=t?a.formatMessage({id:"4881zw",defaultMessage:"To start sharing, create a link."}):a.formatMessage({id:"sGKQsn",defaultMessage:"Cannot create a shared link."});return r.reactExports.createElement(i.TextArea,{style:{background:"#f7f5f2ff"},value:e,disabled:!0,rows:1,resizable:"auto"})}}));fa.displayName="LinkTextField";const _a=({state:e,onClick:t})=>{const s=o.useIntl();let n,a;return"create_and_copy_link"===e?(a=r.reactExports.createElement(i.UIIcon,{src:i.LinkLine}),n=s.formatMessage({id:"9+AL0f",defaultMessage:"Create and copy link"})):"creating_link"===e?(a=r.reactExports.createElement(i.Spinner,{style:{transform:"scale(0.8)"},size:"xsmall",monochromatic:!0,inverse:!0}),n=s.formatMessage({id:"KI+3D4",defaultMessage:"Creating link"})):"link_copied"===e?(a=r.reactExports.createElement(i.UIIcon,{src:i.CheckmarkCircleLine}),n=s.formatMessage({id:"HMOjIo",defaultMessage:"Link copied"})):n=s.formatMessage({id:"ZpmkR8",defaultMessage:"Copy link"}),r.reactExports.createElement(i.Button$1,{variant:"primary",onClick:t,withIconLeft:a,disabled:"disabled"===e},n)};_a.displayName="CreateOrCopyLinkButton";const Ea=e=>e.formatMessage({id:"LLktNG",defaultMessage:"Link settings:"}),Sa=({isPasswordRequired:e,daysUntilExpiration:t,areDownloadsDisabled:s,triggerRef:n,children:a})=>{const l=o.useIntl(),c=((e,t,s,n)=>{const i=[];return t&&i.push((e=>e.formatMessage({id:"K/i5x+",defaultMessage:"Password required"}))(e)),s&&i.push(((e,t)=>e.formatMessage({id:"fp7TGs",defaultMessage:"{count, plural, one{Expires in a day} other{Expires in {count} days}}"},{count:t}))(e,s)),n&&i.push((e=>e.formatMessage({id:"KjJiVt",defaultMessage:"Download disabled"}))(e)),i})(l,e,t,s);return 0===c.length?a:r.reactExports.createElement(i.Tooltip,{"data-testid":"link-restrictions-tooltip","data-sharing-sdk":"1",triggerRef:n,placement:"top",title:r.reactExports.createElement(r.reactExports.Fragment,null,Ea(l),c.length>1?r.reactExports.createElement("ul",{style:{paddingLeft:15,margin:0}},c.map(((e,t)=>r.reactExports.createElement("li",{key:t.toString()},e)))):r.reactExports.createElement(r.reactExports.Fragment,null," ",r.reactExports.createElement("span",null,c[0])))},a)};Sa.displayName="LinkRestrictionsTooltip";const Ma=e=>e.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."}),va=(e,t)=>"editor"===t[".tag"]?e.formatMessage({id:"yBVXDT",defaultMessage:"Creating edit link…"}):e.formatMessage({id:"wKz45D",defaultMessage:"Creating view link…"}),ka=(e,t)=>"file"===t[".tag"]?e.formatMessage({id:"p1EB+W",defaultMessage:"You don’t have permission to create a link to this file"}):e.formatMessage({id:"/ivxG2",defaultMessage:"You don’t have permission to create a link to this folder"}),ba=e=>e.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."}),Ca=(e,t,s)=>"editor"===s[".tag"]?((e,t)=>e.formatMessage({id:"YJc3aM",defaultMessage:"Link copied. Allows editing.{br}{copiedUrlDisplay}"},{br:r.reactExports.createElement("br",null),copiedUrlDisplay:r.reactExports.createElement(wa,{url:t,intl:e})}))(e,t):((e,t)=>e.formatMessage({id:"EK/q5b",defaultMessage:"Link copied. Allows viewing.{br}{copiedUrlDisplay}"},{br:r.reactExports.createElement("br",null),copiedUrlDisplay:r.reactExports.createElement(wa,{url:t,intl:e})}))(e,t),ya={display:"block",maxWidth:"500px",width:"100%",fontSize:"10px",textOverflow:"ellipsis",borderRadius:0,backgroundColor:"transparent",border:"none",outline:"none",color:"inherit"},wa=({url:e,intl:t})=>{const s=e=>{e.preventDefault(),e.currentTarget.select()};return r.reactExports.createElement("span",null,r.reactExports.createElement("input",{style:ya,readOnly:!0,type:"text","aria-label":t.formatMessage({id:"ExhGkl",defaultMessage:"Shared link URL"}),value:e,onClick:s,onFocus:s}))};wa.displayName="Url";const Ia=(e,t)=>e.formatMessage({id:"/a2n+f",defaultMessage:"Couldn't copy the link, but we think it was a fluke. Try copying again.{br}{copiedUrlDisplay}"},{br:r.reactExports.createElement("br",null),copiedUrlDisplay:r.reactExports.createElement(wa,{url:t,intl:e})}),Aa=(e,t)=>"editor"===t[".tag"]?e.formatMessage({id:"JtONmB",defaultMessage:"Edit link created."}):e.formatMessage({id:"ufl8ka",defaultMessage:"View link created."}),Ta=e=>e.formatMessage({id:"PZU3lT",defaultMessage:"Link settings"}),La=({store:e})=>{const t=d.useStore(e.$linkMetadataAtCurrentAccessLevel),s=d.useStore(e.$creatingLinkAccessLevel),n=d.useStore(e.$linkAccessLevel),i=d.useStore(e.$recentlyCopiedLinkAccessLevel),l=d.useStore(e.$linkAtCurrentAccessLevelExistsOrCanBeCreated),c=d.useStore(e.$linkAtCurrentAccessLevelRequiresPassword),h=d.useStore(e.$linkAtCurrentAccessLevelDaysUntilExpiration),p=d.useStore(e.$linkAtCurrentAccessLevelHasDownloadsDisabled),u=d.useStore(e.$isDataBeingUpdated),m=r.reactExports.useRef(null),g=(e=>{const t=o.useIntl(),s=d.useLogger(),n=d.useSnackbar();return r.reactExports.useCallback((()=>a.__awaiter(void 0,void 0,void 0,(function*(){var i,a;s("SHARE_MODAL_SHARE__COPY_LINK__CLICK",{});const r=e.$linkMetadataAtCurrentAccessLevel.get(),o=e.$linkAccessLevel.get();if(null===r)return;const{url:l}=r;if("failure"===(yield d.copy(l))[".tag"])return n.showFailure({intl:t,message:Ia(t,l)}),void s("SHARE_MODAL_SHARE__COPY_LINK__COPY_ERROR",null);e.$recentlyCopiedLinkAccessLevel.set(o),setTimeout((()=>{e.$recentlyCopiedLinkAccessLevel.get()===o&&e.$recentlyCopiedLinkAccessLevel.set(null)}),5e3),s("SHARE_MODAL_SHARE__COPY_LINK__COPY_SUCCESS",null),null===(a=null===(i=e.sharedLinkFieldRef)||void 0===i?void 0:i.current)||void 0===a||a.select(),n.showCompleted({intl:t,message:Ca(t,l,o)})}))),[e,n,t,s])})(e),f=(e=>{const t=o.useIntl(),s=d.useSnackbar(),n=d.useLogger(),i=d.useEndpoint(d.createSharedLink),l=d.useAction(d.action),c=d.usePlatform();return r.reactExports.useCallback((()=>a.__awaiter(void 0,void 0,void 0,(function*(){var a,r,o,l,h,p,u,m;n("SHARE_MODAL_SHARE__CREATE_LINK__CLICK",null);const g=e.$linkAccessLevel.get();if(null!==e.$creatingLinkAccessLevel.get()||e.$isDataBeingUpdated.get())return n("SHARE_MODAL_SHARE__CREATE_LINK__CANCELLED",null),void s.showFailure({intl:t,message:Ma(t)});const f=e.$linkAudience.get();d.batch((()=>{e.$creatingLinkAccessLevel.set(g),e.$isDataBeingUpdated.set(!0)}));const _=c!==d.Platforms.DESKTOP?s.showInProgress({intl:t,message:va(t,g)}):()=>{},E=e.$objectIdentifier.get(),S=d.getContentIdOrPathFromObjectIdentifier(E);n("SHARE_MODAL_SHARE__CREATE_LINK__API_START",{input:{path:S,settings:{access:g,audience:f}}});const M=yield i({path:S,settings:{access:g}});if(_(),"ERROR"===M.status)return n("SHARE_MODAL_SHARE__CREATE_LINK__API_ERROR",{response:M}),"shared_link_already_exists"===M.error[".tag"]&&(yield null===(r=(a=e.$props.get()).onSharedLinkAlreadyExistsError)||void 0===r?void 0:r.call(a)),_(),d.batch((()=>{e.$creatingLinkAccessLevel.set(null),e.$isDataBeingUpdated.set(!1)})),"access_denied"===M.error[".tag"]?void s.showFailure({intl:t,message:ka(t,E)}):void s.showFailure({intl:t,message:ba(t)});if("FATAL"===M.status)return n("SHARE_MODAL_SHARE__CREATE_LINK__API_FATAL",{response:M}),_(),d.batch((()=>{e.$creatingLinkAccessLevel.set(null),e.$isDataBeingUpdated.set(!1)})),void s.showFailure({intl:t,message:ba(t)});if(n("SHARE_MODAL_SHARE__CREATE_LINK__API_SUCCESS",{response:M}),e.$creatingLinkAccessLevel.set(null),null===(l=(o=e.$props.get()).onSucceedCreateLink)||void 0===l||l.call(o,M.output),d.getIsBrowserCopyEnabled()){const i=yield d.copy(M.output.url);"success"===i[".tag"]?(n("SHARE_MODAL_SHARE__CREATE_LINK__COPY_START",{linkMetadata:M.output,copyMethod:i.copyMethod}),e.$recentlyCopiedLinkAccessLevel.set(g),setTimeout((()=>{e.$recentlyCopiedLinkAccessLevel.get()===g&&e.$recentlyCopiedLinkAccessLevel.set(null)}),5e3),null===(p=null===(h=e.sharedLinkFieldRef)||void 0===h?void 0:h.current)||void 0===p||p.select(),s.showCompleted({intl:t,message:Ca(t,M.output.url,g)})):(n("SHARE_MODAL_SHARE__CREATE_LINK__COPY_ERROR",null),s.showFailure({intl:t,message:Ia(t,M.output.url)}))}else s.showCompleted({intl:t,message:Aa(t,g)});n("SHARE_MODAL_SHARE__CREATE_LINK__REFRESH_START",null),yield null===(m=(u=e.$props.get()).onCreateLinkRefresh)||void 0===m?void 0:m.call(u),n("SHARE_MODAL_SHARE__CREATE_LINK__REFRESH_COMPLETE",null),e.$isDataBeingUpdated.set(!1)}))),[n,e,c,s,t,i,l])})(e);return s===n?r.reactExports.createElement(_a,{state:"creating_link"}):i===n?r.reactExports.createElement(_a,{state:"link_copied"}):t?r.reactExports.createElement(Sa,{isPasswordRequired:c,daysUntilExpiration:h,areDownloadsDisabled:p,triggerRef:m},r.reactExports.createElement("span",{ref:m},r.reactExports.createElement(_a,{state:"copy_link",onClick:g}))):!l||u||null!==s?r.reactExports.createElement(_a,{state:"disabled"}):r.reactExports.createElement(_a,{state:"create_and_copy_link",onClick:f})};La.displayName="CreateOrCopyLinkSection";const Ra=({store:e})=>{const t=o.useIntl(),s=d.useStore(e.$linkAtCurrentAccessLevelExistsOrCanBeCreated),n=(e=>{const t=d.useLogger();return r.reactExports.useCallback((s=>{s.preventDefault(),t("SHARE_MODAL_SHARE__SETTINGS_LINK__CLICK",null),e.$props.get().onLinkSettingsClick()}),[e,t])})(e);return r.reactExports.createElement(i.Text,{size:"standard",color:s?"standard":"disabled",style:{marginTop:-6}},s?r.reactExports.createElement(i.Link,{href:"#",hasNoUnderline:!0,onClick:n},Ta(t)):r.reactExports.createElement(r.reactExports.Fragment,null,Ta(t)))};Ra.displayName="LinkSettingsLink";const Na=({store:e})=>{var t;const s=d.useStore(e.$linkAccessLevel),n=d.useStore(e.$canCreateViewLink),i=d.useStore(e.$canCreateEditLink),a=d.useStore(e.$linkAudience),o=d.useStore(e.$objectMetadata),l=d.useStore(e.$linkMetadataAtCurrentAccessLevel),c=d.useStore(e.$linkAtCurrentAccessLevelRequiresPassword),h=d.useStore(e.$linkAtCurrentAccessLevelDaysUntilExpiration),p=d.useStore(e.$canCreateLinkAtCurrentAccessLevel),u=d.useStore(e.$shouldDisplayAudienceConflictBanner),m=(e=>{const t=d.useLogger();return r.reactExports.useCallback((s=>{var n,i;const a=e.$linkAccessLevel.get();t("SHARE_MODAL_SHARE__LINK_ACCESS_LEVEL__CHANGE",{previous:a,next:{".tag":s}}),null===(i=(n=e.$props.get()).onLinkAccessLevelChange)||void 0===i||i.call(n,s)}),[t,e.$linkAccessLevel,e.$props])})(e),g=(e=>{const t=d.useLogger();return r.reactExports.useCallback((()=>{var s,n;t("SHARE_MODAL_SHARE__MODIFY_LINK__CLICK",null),null===(n=(s=e.$props.get()).onLinkSettingsClick)||void 0===n||n.call(s)}),[t,e])})(e),f=(()=>{const e=d.useLogger();return r.reactExports.useCallback((()=>{e("SHARE_MODAL_SHARE__COPY_LINK__CLICK",{copyMethod:"manual"})}),[e])})();return r.reactExports.createElement(d.ActionSection,{footerContent:r.reactExports.createElement(ga,{isPasswordRequired:c,daysUntilExpiration:h,onClickModify:g}),footerActions:r.reactExports.createElement(La,{store:e})},u&&r.reactExports.createElement(d.AudienceConflictBanner,null),r.reactExports.createElement(d.ActionSection,{layout:"columns"},r.reactExports.createElement(ma,{currentAccessLevel:s,enableViewOption:n,enableEditOption:i,linkAudience:a,ownerTeamName:null===(t=o.owner_team)||void 0===t?void 0:t.name,onAccessLevelChange:m}),r.reactExports.createElement(Ra,{store:e})),r.reactExports.createElement(fa,{linkUrl:null==l?void 0:l.url,canCreateLink:p,onCopyLink:f,ref:e.sharedLinkFieldRef}))};Na.displayName="DefaultToLinkSharingSectionInner";const xa=e=>{const t=(e=>{const t=r.reactExports.useRef(null);return d.useInitStore(e,(e=>{const s=d.proxy((()=>e.get().objectIdentifier)),n=d.proxy((()=>e.get().objectMetadata)),i=d.proxy((()=>e.get().sharingPrefs)),a=d.proxy((()=>e.get().linkAudience)),r=d.proxy((()=>e.get().linkAccessLevel),(t=>{var s,n;return null===(n=(s=e.get()).onLinkAccessLevelChange)||void 0===n?void 0:n.call(s,t[".tag"])})),o=d.proxy((()=>{const e=d.isConfidentialFolderLinksEnabled(i.get());return d.getCanCreateLink(n.get(),{".tag":"viewer"},e)})),l=d.proxy((()=>{const e=d.isConfidentialFolderLinksEnabled(i.get());return d.getCanCreateLink(n.get(),{".tag":"editor"},e)})),c=d.proxy((()=>"viewer"===r.get()[".tag"]?o.get():"editor"===r.get()[".tag"]&&l.get())),h=d.proxy((()=>e.get().linkMetadataAtCurrentAccessLevel)),p=d.proxy((()=>c.get()||null!==h.get())),u=d.proxy((()=>{const e=h.get();if(null!==e){const t=d.getCurrentAudience(e);return e.link_permissions.require_password||"password"===t[".tag"]}return!1})),m=d.proxy((()=>{const e=h.get();return null!==e?d.getDaysUntilExpiration(e):null})),g=d.proxy((()=>{var e;const t=h.get();return!0!==(null===(e=null==t?void 0:t.link_permissions)||void 0===e?void 0:e.allow_download)})),f=d.store(null),_=d.store(!1),E=d.store(null),S=d.proxy((()=>e.get().shouldDisplayAudienceConflictBanner));return{$objectIdentifier:s,$objectMetadata:n,$sharingPrefs:i,$linkAudience:a,$linkAccessLevel:r,$canCreateViewLink:o,$canCreateEditLink:l,$canCreateLinkAtCurrentAccessLevel:c,$linkMetadataAtCurrentAccessLevel:h,$linkAtCurrentAccessLevelExistsOrCanBeCreated:p,$linkAtCurrentAccessLevelRequiresPassword:u,$linkAtCurrentAccessLevelDaysUntilExpiration:m,$linkAtCurrentAccessLevelHasDownloadsDisabled:g,$creatingLinkAccessLevel:f,$isDataBeingUpdated:_,$recentlyCopiedLinkAccessLevel:E,$shouldDisplayAudienceConflictBanner:S,$props:e,sharedLinkFieldRef:t}}))})(e);return r.reactExports.createElement(Na,{store:t})};xa.displayName="DefaultToLinkSharingSection";const Pa=({actionHandler:e,selectedAudience:t,linkAccessLevel:s,linkMetadata:n,shouldDisplayAudienceConflictBanner:o})=>{var c,d;const h=e.getSharingInfo(),p=h.contentInfo(),u=e.getSharingInfo().user(),m=h.metadata(),g=null!==(c=p.isFolderInsideTeamFolderTree())&&void 0!==c&&c,f=null!==(d=p.isTeamSharedFolder())&&void 0!==d&&d,_=r.reactExports.useMemo((()=>vi(e.getSharingInfo())),[e]),E=r.reactExports.useMemo((()=>ni(s)),[s]),S=r.reactExports.useMemo((()=>n?Ei(n):null),[n]),M=r.reactExports.useMemo((()=>ri(t)),[t]),v=r.reactExports.useMemo((()=>(e=>{var t,s;return e.isSharedFolder()?{".tag":"shared_folder",sharedFolderId:String(e.sharedFolderId())}:e.isFileFolder()?{".tag":"file_folder",name:e.name(),path:null!==(t=e.displayPath())&&void 0!==t?t:""}:{".tag":"file",fileId:null!==(s=e.fileId())&&void 0!==s?s:""}})(p)),[p]),k=r.reactExports.useMemo((()=>di(m,g,f)),[m,g,f]),b=(e=>r.reactExports.useCallback((t=>{e.changeLinkRecipientAccess("editor"===t?i.ACCESS_LEVEL.WRITER:i.ACCESS_LEVEL.READER)}),[e]))(e),C=((e,t)=>r.reactExports.useCallback((()=>{e.openSharingSettingsModal("editor"===t?"edit_link_settings":"view_link_settings")}),[e,t]))(e,s),y=((e,t)=>r.reactExports.useCallback((s=>{const n=i.linkMetadataApiToRecordTyped(s);i.dispatcherSingleton.dispatch({type:l.ShareModalActionTypes.CREATE_LINK_SUCCESS,data:{linkMetadata:n},contentIds:[e.getContentInfo().id],user:t}),e.refreshSharedWithColumnLinkData()}),[e,t]))(e,u),w=(e=>r.reactExports.useCallback((()=>a.__awaiter(void 0,void 0,void 0,(function*(){yield e.fetchLinkMetadata()}))),[e]))(e),I=((e,t)=>r.reactExports.useCallback((s=>{const n=i.folderMetadataApiToRecordTyped(s);i.dispatcherSingleton.dispatch({type:l.ShareModalActionTypes.SHARE_FOLDER_SUCCESS,data:{metadata:n},contentIds:[e.getContentInfo().id],user:t})}),[e,t]))(e,u);return r.reactExports.createElement(ki,{user:u,contentInfo:p,metadata:m,linkAccessLevel:E,objectMetadata:k,linkMetadata:null!=S?S:void 0,objectIdentifier:v},r.reactExports.createElement(xa,{objectIdentifier:v,objectMetadata:k,sharingPrefs:_,linkMetadataAtCurrentAccessLevel:S,linkAccessLevel:E,linkAudience:M,shouldDisplayAudienceConflictBanner:o,onLinkAccessLevelChange:b,onLinkSettingsClick:C,onSucceedCreateLink:y,onSharedLinkAlreadyExistsError:w,onSucceedCreateNamespace:I}))};Pa.displayName="SharingSdkDefaultToLinkSharingSection";const Fa={[b.ContactsErrorLevel.Error]:"error",[b.ContactsErrorLevel.Warn]:"warn",defaultLevel:"default"};class Oa extends r.React$1.Component{constructor(e){super(e),this.hasCheckedForLastSeenUpdate=!1,this.hasLoggedDefaultAudienceConflict=!1,this.handleAccordionClick=e=>{let t=[];const s=!this.props.expandedAccordionPanels.includes(e);t=s?[...this.props.expandedAccordionPanels,e]:this.props.expandedAccordionPanels.filter((t=>t!==e)),this.context.logEvent(k.TiburonEventName.ToggleEmailAccordion,void 0,{is_accordion_open:s}),this.props.actionHandler.changeMainSectionExpandedAccordionPanels(t)},this.onTabSelected=e=>{this.props.actionHandler.changeRecipientAccess("editor"===e?i.ACCESS_LEVEL.WRITER:i.ACCESS_LEVEL.READER);const t="editor"===e?k.ShareTabName.EditTab:k.ShareTabName.ViewTab;this.context.logEvent(k.TiburonEventName.ViewShareTab,void 0,{share_tab:t})},this.onEmailTabSelected=e=>{this.props.actionHandler.changeEmailRecipientAccess("editor"===e?i.ACCESS_LEVEL.WRITER:i.ACCESS_LEVEL.READER)}}componentDidMount(){const e="editor"===this.props.selectedAccessLevel?k.ShareTabName.EditTab:k.ShareTabName.ViewTab;this.context.logEvent(k.TiburonEventName.ViewShareScreen,void 0,{share_tab:e}),this.context.logEvent(k.TiburonEventName.ViewShareTab,void 0,{share_tab:e})}render(){const{actionHandler:e,contentMetadata:t,selectedAccessLevel:s,selectedLinkAccessLevel:n,selectedEmailAccessLevel:i,sharingInfo:a}=this.props,l=this.getLinkAccessLevelOptions(),c=this.props.sharingInfo.isCurrentAccountLoaded(),h=this.props.sharingInfo.sharingPrefsFetchComplete();if(!this.hasCheckedForLastSeenUpdate&&c&&h){const e=this.getTeamPolicyAudience();if(e){e!==this.props.sharingInfo.getLastSeenTeamPolicyAudience()&&this.props.actionHandler.setLastSeenTeamPolicyAudience({".tag":e})}this.hasCheckedForLastSeenUpdate=!0}if(0===l.length)return r.React$1.createElement(d.InfoBox,{imgPath:r.static_url("/static/metaserver/static/images/sharing/share_modal/no_access-vflRKAkm7.png"),imgAlt:o.intl.formatMessage({id:"jLOGFI",defaultMessage:"No permissions to share"}),title:o.intl.formatMessage({id:"XGWBlY",defaultMessage:"You can view, but not share"}),message:this.getNoPermissionsMessage()});if(a.isDTLSM1Enabled()){const e=this.getEmailAccessLevelOptions().length>0;return r.React$1.createElement(r.React$1.Fragment,null,r.React$1.createElement(d.ActionContainer,{header:this.getHeaderDescription(),style:{marginTop:"24px",marginBottom:"24px"}},r.React$1.createElement(Pa,{actionHandler:this.props.actionHandler,selectedAudience:ia(this.canCreateLink(n),a.getSelectedAudienceByAccessLevel(n),this.getSharedLinkByAccessLevel(n),a.teamPolicy(),t.policy,this.props.sharingInfo.getDefaultSharingLinkAudience(),a.isUlssClientOn(),this.logDefaultAudienceConflict()),linkAccessLevel:n,linkMetadata:this.getSharedLinkByAccessLevel(n),shouldDisplayAudienceConflictBanner:this.shouldRenderAudienceConflictBanner(s)})),r.React$1.createElement(pa,{variant:"standard",expandedPanels:this.props.expandedAccordionPanels},r.React$1.createElement(pa.Item,{itemId:"email",isDisabled:!e},r.React$1.createElement(pa.Header,{onClick:()=>this.handleAccordionClick("email"),style:{paddingLeft:"32px",paddingRight:"32px",paddingTop:"10px",paddingBottom:"2px"}},r.React$1.createElement(pa.HeaderContent,{withTitle:this.getAccordionTitle(e)})),r.React$1.createElement(pa.Panel,{style:{paddingLeft:"32px",paddingRight:"32px",paddingBottom:"0px"}},this.showEmailSection(i)))))}return r.React$1.createElement(d.ActionContainer,{header:this.getHeaderDescription()},this.shouldRenderAudienceConflictBanner(s)&&this.renderAudienceConflictBanner(),r.React$1.createElement(d.FormValidationMessage,{message:this.props.contactsError.message,variant:this.getMessageType()}),r.React$1.createElement(oa,{selectedAccessLevel:s,canCreateLink:this.canCreateLink(s),contentMetadata:t,linkAccessLevelOptions:this.getLinkAccessLevelOptions(),selectedAudience:a.getSelectedAudienceByAccessLevel(s),sharedLink:this.getSharedLinkByAccessLevel(s),teamPolicy:a.teamPolicy(),onSelectedAccessLevelChange:this.onTabSelected,openSharingSettingsModal:e.openSharingSettingsModal,defaultSharingLinkAudience:this.props.sharingInfo.getDefaultSharingLinkAudience(),isUlssEnabled:a.isUlssClientOn(),onLogDefaultAudienceConflict:this.logDefaultAudienceConflict()}),"editor"===this.props.selectedAccessLevel?this.renderLinkSection("editor"):this.renderLinkSection("viewer"))}getAccordionTitle(e){return o.intl.formatMessage({id:"jYiBTC",defaultMessage:"<t>or</t> <u>Share via email</u>"},{t:e=>r.React$1.createElement("span",{style:{fontWeight:"normal"}},e),u:t=>e?r.React$1.createElement("u",{className:"share-via-email",style:{textUnderlineOffset:"6px"}},r.React$1.createElement("b",null,t)):r.React$1.createElement(i.Tooltip,{title:o.intl.formatMessage({id:"0S6iYY",defaultMessage:"This can only be shared with the link"})},r.React$1.createElement("u",{className:"share-via-email-disabled",style:{textUnderlineOffset:"6px"}},r.React$1.createElement("b",null,t)))})}getMessageType(){const e=this.props.contactsError.level||"defaultLevel";return Fa[e]}getSharedLinkByAccessLevel(e){let t;return"editor"===e?t=this.props.sharingInfo.editRighteousLink():"viewer"===e&&(t=this.props.sharingInfo.viewRighteousLink()||this.props.sharingInfo.shmodelLink()),t}canInvite(e){const t=this.props.sharingInfo.permissionsObj();switch(e){case"editor":return t.canInviteEditor();case"viewer":return t.canInviteViewer();default:return!1}}canCreateLink(e){const{sharingInfo:t,isTeamSharedFolder:s,contentMetadata:n}=this.props,i=this.props.sharingInfo.permissionsObj();return p.canCreateLink(e,t.isCloudDoc(),t.isFolder(),s,t.isConfidentialFolder(),i.canInviteEditor(),t.canShareLink(),i.canCreateViewLink(),i.canCreateEditLink(),n.access_type,!!n.path_lower,t.sharingPrefs().confidential_folder_links_enabled)}validateAccessLevel(e){return this.canInvite(e)||this.canCreateLink(e)||void 0!==this.getSharedLinkByAccessLevel(e)}validateEmailAccessLevel(e){return this.canInvite(e)}getTeamPolicyAudience(){const e=this.props.sharingInfo.isUlssClientOn(),t=this.props.sharingInfo.teamPolicy();if(e&&t){if("members"===t.shared_folder_link_restriction_policy)return"no_one";switch(t.shared_link_create_policy){case"default_no_one":return"no_one";case"default_team_only":case"team_only":return"team";default:return"public"}}}shouldRenderAudienceConflictBanner(e){const t=this.props.sharingInfo.isUlssClientOn(),s=this.props.sharingInfo.teamPolicy(),n=this.props.sharingInfo.getDefaultSharingLinkAudience(),i=this.getSharedLinkByAccessLevel(e),a=this.props.initialLastSeenTeamPolicyAudience,r=this.getTeamPolicyAudience(),o=this.props.sharingInfo.isCurrentAccountLoaded(),l=this.props.sharingInfo.sharingPrefsFetchComplete();return t&&o&&l&&!i&&a&&a!==r&&function(e,t){if(!e||!t)return!1;const s=e.shared_folder_link_restriction_policy,n=e.shared_link_create_policy;return!!n&&na(n,s,t)!==t}(s,n)}renderAudienceConflictBanner(){const e=this.props.contactsError.message?"share-modal-evolution__audience-conflict-banner-with-other-banner":"share-modal-evolution__audience-conflict-banner-with-no-banner";return r.React$1.createElement("div",{className:e},r.React$1.createElement(i.Banner,{withLeftIcon:r.React$1.createElement(i.UIIcon,{src:i.InfoLine})},r.React$1.createElement(i.Banner.Message,null,this.getAudienceConflictBannerText())))}showEmailSection(e){const{actionHandler:t,sharingInfo:s}=this.props;return r.React$1.createElement(ji,{actionHandler:t,contactsError:this.props.contactsError,isEmailSending:this.props.isEmailSending,disabledContactsInput:!this.canInvite(e),handleMessageChanged:this.props.handleMessageChanged,modalClose:this.props.closeModalHandler,recipientMessage:this.props.recipientMessage,sharedLink:this.getSharedLinkByAccessLevel(e),showPostNoteAsComment:s.permissionsObj().canShareMessageAsComment(),isFolder:s.isFolder(),isPostNoteAsCommentChecked:s.isShareMessageAsCommentChecked(),isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,initialTypeaheadTokens:this.props.initialTypeaheadTokens,user:this.props.user,accessLevel:e,selectedEmailAccessLevel:e,onSelectedEmailAccessLevelChange:this.onEmailTabSelected,emailAccessLevelOptions:this.getEmailAccessLevelOptions(),canCreateLink:this.canCreateLink(e),contentMetadata:this.props.contentMetadata,canCreateViewLinkForFolder:this.canCreateLink("viewer"),viewLinkForFolder:s.shmodelLink(),showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest,teamPolicy:s.teamPolicy(),emailCountChangeCallback:this.updateEmailTokenCount.bind(this),getEmailTokenCountFn:this.getEmailTokenCount.bind(this)})}updateEmailTokenCount(e){}getEmailTokenCount(){}renderLinkSection(e){const{actionHandler:t,sharingInfo:s}=this.props;return this.validateAccessLevel(e)?r.React$1.createElement(Zi,{accessLevel:e,actionHandler:t,canCreateLink:this.canCreateLink(e),canInviteByEmail:this.canInvite(e),contactsError:this.props.contactsError,contentMetadata:this.props.contentMetadata,isEmailSending:this.props.isEmailSending,handleMessageChanged:this.props.handleMessageChanged,initialTypeaheadTokens:this.props.initialTypeaheadTokens,isPostNoteAsCommentChecked:s.isShareMessageAsCommentChecked(),isTokenizerEmpty:this.props.isTokenizerEmpty,isTeamSharedFolder:this.props.isTeamSharedFolder,onManageAccessClick:this.props.onManageAccessClick,recipientMessage:this.props.recipientMessage,user:this.props.user,sharedLink:this.getSharedLinkByAccessLevel(e),modalClose:this.props.closeModalHandler,isFolder:s.isFolder(),teamPolicy:s.teamPolicy(),showPostNoteAsComment:s.permissionsObj().canShareMessageAsComment(),canCreateViewLinkForFolder:this.canCreateLink("viewer"),viewLinkForFolder:s.shmodelLink(),showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest}):r.React$1.createElement(Qi,{accessLevel:e,isFolder:s.isFolder()})}getHeaderDescription(){return this.props.sharingInfo.isFolder()?o.intl.formatMessage({id:"hMjxKh",defaultMessage:"Share this folder"}):o.intl.formatMessage({id:"8fJdJ4",defaultMessage:"Share this file"})}getLinkAccessLevelOptions(){const e=[];return e.push({link_access_level:"viewer",allowed:this.validateAccessLevel("viewer"),label:"can view"}),e.push({link_access_level:"editor",allowed:this.validateAccessLevel("editor"),label:"can edit"}),e.filter((e=>e.allowed))}getEmailAccessLevelOptions(){const e=[];return e.push({link_access_level:"viewer",allowed:this.validateEmailAccessLevel("viewer"),label:"can view"}),e.push({link_access_level:"editor",allowed:this.validateEmailAccessLevel("editor"),label:"can edit"}),e.filter((e=>e.allowed))}getNoPermissionsMessage(){return this.props.sharingInfo.isFolder()?o.intl.formatMessage({id:"fpgILd",defaultMessage:"To share this folder, ask someone else for access to edit."}):o.intl.formatMessage({id:"m4b4bb",defaultMessage:"To share this file, ask someone else for access to edit."})}getAudienceConflictBannerText(){return o.intl.formatMessage({id:"suIfYq",defaultMessage:"Your admin has changed the <b>Who has access</b> default link sharing settings, but you can still adjust settings for certain items."},{b:e=>r.React$1.createElement("b",null,e)})}logDefaultAudienceConflict(){return e=>{const t={user_default_link_audience:e.userDefaultLinkAudience,team_default_link_audience:e.teamDefaultLinkAudience,final_audience:e.finalAudience,is_team_user:e.isTeamUser};this.hasLoggedDefaultAudienceConflict||(this.context.logEvent(k.TiburonEventName.AttemptSolveDefaultAudienceConflict,void 0,t),this.context.logEvent(k.TiburonEventName.SucceedSolveDefaultAudienceConflict,void 0,t),this.hasLoggedDefaultAudienceConflict=!0)}}}Oa.displayName="MainSection",Oa.contextType=os,i.requireCssWithComponent(Oa,["/static/metaserver/static/css/sharing/share_modal_evolution-vfl8CQtFl.css"]);class Da extends r.React$1.Component{constructor(){super(...arguments),this.getDocsendAnalyticsAddOnEntryPointMetadata=()=>{var e;const{contentMetadata:t,sharingInfo:s,user:n,docsendAnalyticsAddOnMetadata:a}=this.props,r=W.getDocsendAnalyticsAddOnConfig(n,a.variant),o=r.coreSharingModal.showFooterWhenViewAccess&&"writer"!==s.recipientAccess()||r.coreSharingModal.showFooterWhenEditAccess,l=r.isSupportedFile((null===(e=s.sharingInfoState().linkMetadata)||void 0===e?void 0:e.file_size)||0,i.file_extension(t.name));return o&&l&&t.path_lower&&t.isFile()?{showEntryPoint:!0,entryPointProps:{fileName:t.name,user:n,fileId:t.id,path:t.path_lower,variant:r.variantForLogging,linkMetadata:a,waitForLinkMetadata:r.coreSharingModal.fetchAnalyticsLink}}:{showEntryPoint:!1}}}render(){const{actionHandler:e,contactsError:t,contentMetadata:s,isEmailSending:n,handleManageAccessClick:i,handleMessageChanged:a,initialTypeaheadTokens:o,isTeamSharedFolder:l,isTokenizerEmpty:c,sharingInfo:d,showPassFileSettings:h,onCloseButtonClick:p,onSettingsButtonClick:u,recipientMessage:m,user:g,guestMembers:f,linkMembers:_,showApproval:E,sendApproval:S,needsAllApprovers:M,creatingApprovalRequest:v,expandedMainSectionAccordionPanels:k,initialLastSeenTeamPolicyAudience:b}=this.props;return r.React$1.createElement("div",{className:"share-modal-evolution-share-screen"},r.React$1.createElement(Ti,{canEdit:d.permissionsObj().canEdit(),isConfidentialFolder:d.isConfidentialFolder(),isTeamSharedFolder:d.isTeamSharedFolder(),isFolderInsideTeamFolderTree:d.isFolderInsideTeamFolderTree(),showPassFileSettings:h,contentInfo:d.contentInfo(),guestMembers:f,linkMembers:_,membership:d.members(),onCloseButtonClick:p,onManageAccessClick:i,onSettingsButtonClick:u,sharingInfo:d}),r.React$1.createElement(Oa,{actionHandler:e,closeModalHandler:p,contactsError:t,contentMetadata:s,isEmailSending:n,handleMessageChanged:a,initialTypeaheadTokens:o,isTeamSharedFolder:l,isTokenizerEmpty:c,onManageAccessClick:i,recipientMessage:m,sharingInfo:d,user:g,selectedAccessLevel:"writer"===this.props.sharingInfo.recipientAccess()?"editor":"viewer",selectedLinkAccessLevel:"writer"===this.props.sharingInfo.linkRecipientAccess(s)?"editor":"viewer",selectedEmailAccessLevel:"writer"===this.props.sharingInfo.emailRecipientAccess()?"editor":"viewer",showApproval:E,sendApproval:S,needsAllApprovers:M,creatingApprovalRequest:v,expandedAccordionPanels:k,initialLastSeenTeamPolicyAudience:b}))}}Da.displayName="ShareScreen";const $a=i.requireCssWithComponent(Da,["/static/metaserver/static/css/sharing/share_modal_evolution-vfl8CQtFl.css"]);class Ba extends r.React$1.Component{constructor(){super(...arguments),this.hasInitiatedLastSeenTeamPolicyAudience=!1,this.handleManageAccessClick=()=>{this.handleLogEvent(k.TiburonEventName.ClickWhoCanAccess),this.props.showScreen(i.MANAGE_SCREEN)},this.handleBackButtonClick=()=>{this.props.showScreen(i.SHARE_SCREEN)},this.handleLogEvent=(e,t,s)=>{const{contentMetadata:n,user:i}=this.props;this.props.logTiburonEvent(e,i.id,Object.assign(Object.assign({},L.buildExtraFromMetadata(n,t)),s))}}render(){return!this.hasInitiatedLastSeenTeamPolicyAudience&&this.props.sharingInfo.sharingPrefsFetchComplete()&&(this.initialLastSeenTeamPolicyAudience=this.props.sharingInfo.getLastSeenTeamPolicyAudience(),this.hasInitiatedLastSeenTeamPolicyAudience=!0),r.React$1.createElement(i.LayerContext.Provider,{value:{zIndex:1e4}},r.React$1.createElement(ls,{logEvent:this.handleLogEvent,experiments:this.props.actionHandler.getSharingInfo().getExperiments()},r.React$1.createElement("div",{className:"share-modal-evolution"},this.renderActiveScreen())))}renderActiveScreen(){return this.props.currentScreen===i.MANAGE_SCREEN?r.React$1.createElement(Ai,Object.assign({},this.manageAccessPageProps())):r.React$1.createElement($a,Object.assign({},this.getShareScreenProps()))}manageAccessPageProps(){const{isFolder:e,isTeamSharedFolder:t,onSettingsButtonClick:s,onLinkSettingsTextClick:n,sharingInfo:i,onCloseButtonClick:a,actionHandler:r,user:o,currentTab:l}=this.props;return{canInviteMembers:i.permissionsObj().canInvite(),fileName:i.name(),isFolder:e,isTeamSharedFolder:t,memberListProps:this.props.memberListProps,membership:i.members(),onBackButtonClick:this.handleBackButtonClick,onCloseButtonClick:a,onSettingsButtonClick:s,onLinkSettingsTextClick:n,ownerTeamName:this.props.ownerTeam?this.props.ownerTeam.name:void 0,actionHandler:r,editLinkExists:!!i.editRighteousLink(),user:o,lmlSprigSurveyOrigin:i.contentInfo().extras.origin,lmlExperimentVariant:i.sharingPrefs().exp_links_in_member_list,currentTab:this.getManageAccessPageTab(l)}}getManageAccessPageTab(e){if(e==k.ManageAccessTabName.ManagePeopleTab||e==k.ManageAccessTabName.ManageLinksTab)return e}getShareScreenProps(){return{actionHandler:this.props.actionHandler,contactsError:this.props.contactsError,contentMetadata:this.props.contentMetadata,isEmailSending:this.props.isEmailSending,handleManageAccessClick:this.handleManageAccessClick,handleMessageChanged:this.props.handleMessageChanged,initialTypeaheadTokens:this.props.initialTypeaheadTokens,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,onCloseButtonClick:this.props.onCloseButtonClick,onSettingsButtonClick:this.props.onSettingsButtonClick,recipientMessage:this.props.recipientMessage,sharingInfo:this.props.sharingInfo,user:this.props.user,guestMembers:this.props.guestMembers,linkMembers:this.props.linkMembers,showPassFileSettings:this.props.showPassFileSettings,showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest,docsendAnalyticsAddOnMetadata:this.props.docsendAnalyticsAddOnMetadata,expandedMainSectionAccordionPanels:this.props.expandedMainSectionAccordionPanels,initialLastSeenTeamPolicyAudience:this.initialLastSeenTeamPolicyAudience}}}Ba.displayName="ShareModalEvolution";const Ua=i.requireCssWithComponent(Ba,["/static/metaserver/static/css/sharing/share_modal_evolution-vfl8CQtFl.css","/static/metaserver/static/css/dig-components/index.web-vflGcQt8W.css"]);function Ha(e){return a.__awaiter(this,void 0,void 0,(function*(){const t=new i.UserApiV2Client,s=i.mustGetActiveUserId(),n={user_id:s,task:e};t.ns("custom_onboarding").rpc("update_task",n,{subjectUserId:s}).catch((t=>{var s;A.reportException({err:t,tags:["onboarding_checklist","updated_task"],severity:T.SEVERITY.NONCRITICAL,exc_extra:{task_type:null===(s=e.type)||void 0===s?void 0:s[".tag"]}})}))}))}class Va extends r.reactExports.PureComponent{render(){const{className:e,children:t,textButtonShare:s,isButtonShareDisabled:n,onClickButtonShare:a}=this.props,o=i.cx("scl-sharing-modal-footer-inband",e,"scl-sharing-modal-footer");return r.reactExports.createElement("div",{className:o},t,r.reactExports.createElement("div",{className:"scl-sharing-modal-footer-inband__spacer"}),r.reactExports.createElement(i.Button,{variant:"primary",className:"scl-sharing-modal-footer-inband__button","aria-label":s,onClick:a,disabled:n},s))}}Va.defaultProps={isButtonShareDisabled:!1},Va.displayName="SharingModalFooterInband";class Ga extends r.React$1.PureComponent{isInbandFooterDisabled(){return this.props.isTokenizerEmpty||this.props.contactsError&&this.props.contactsError.level===b.ContactsErrorLevel.Error||!!this.props.contentNameMessage}render(){const{mode:e,children:t,shareButtonLabelOverride:s}=this.props;switch(e){case l.MODES.SHARE:return r.React$1.createElement(Va,{isButtonShareDisabled:this.isInbandFooterDisabled(),textButtonShare:s||(this.props.isTeamSharedFolder?o.intl.formatMessage({id:"YcxVqg",defaultMessage:"Add"}):o.intl.formatMessage({id:"CcpVyl",defaultMessage:"Share"})),onClickButtonShare:this.props.onShareButtonClick},t);case l.MODES.SHARE_SENDING:return r.React$1.createElement(Va,{isButtonShareDisabled:!0,textButtonShare:s||(this.props.isTeamSharedFolder?o.intl.formatMessage({id:"JowGoo",defaultMessage:"Adding..."}):o.intl.formatMessage({id:"WyW2Um",defaultMessage:"Sharing..."})),onClickButtonShare:c.noop},t);case l.MODES.MEMBERSHIP:return this.props.isInContentManager&&!this.props.contentInfo.pathExists()?r.React$1.createElement(Va,{isButtonShareDisabled:!1,textButtonShare:s||(this.props.isTeamSharedFolder?o.intl.formatMessage({id:"YcxVqg",defaultMessage:"Add"}):o.intl.formatMessage({id:"CcpVyl",defaultMessage:"Share"})),onClickButtonShare:this.props.onShareButtonClick}):null;default:return null}}}Ga.displayName="ShareModalFooterSection";class Wa extends r.React$1.Component{constructor(){super(...arguments),this.afterLoad=()=>{this.hasPerformedAfterLoad=!0,this.props.user.is_team&&Ha({type:{".tag":"share_file"},is_completed:!0})},this.isGoldenGateTeamOverLimit=()=>b.shouldEnforceMemberLimits(this.props.user,this.props.isTeamSharedFolder,this.props.isFolderInsideTeamFolderTree)&&(null!=this.props.memberCounts?this.props.memberCounts.total_unique_users:0)>=v.GoldenGate.SHARING_TOTAL_LIMIT,this.handleLogTiburonEvent=(e,t,s)=>{const{modalSessionId:n,origin:a}=this.props.contentInfo.extras;i.ShareTibEventLogger.log(t,e,a,Object.assign(Object.assign({},s),{modal_session_id:n}))},this.handleMessageChanged=e=>{this.props.actionHandler.changeRecipientMessage(e.target.value)},this.linkSectionProps=()=>({actionHandler:this.props.actionHandler,contentInfo:this.props.contentInfo,mode:this.props.mode,user:this.props.user,onLinkSettingsClick:this.props.onLinkSettingsClick,closeModalHandler:this.props.onModalCloseClick,isLinkMetadataLoaded:this.props.isLinkMetadataLoaded,isTeamSharedFolder:this.props.isTeamSharedFolder,canShareLink:this.props.canShareLink,permissions:this.props.sharingPermissions}),this._addEveryoneGroup=()=>this.contactsSection.addExternalContacts([Ms.teamGroupInfoToContact(this.props.teamGroupInfo)]),this.headerSectionProps=()=>({ref:this.setHeaderSectionRef,actionHandler:this.props.actionHandler,contentInfo:this.props.contentInfo,contentNameMessage:this.props.contentNameMessage,contentNameMessageLevel:this.props.contentNameMessageLevel,canEdit:this.props.canEdit,isTeamSharedFolder:this.props.isTeamSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isConfidentialFolder:this.props.isConfidentialFolder,isContentNameFocused:this.props.isContentNameFocused,isCreatingNewFolder:this.props.isCreatingNewFolder,isMetadataLoaded:this.props.isMetadataLoaded,initialContentName:this.props.initialContentName,onModalCloseClick:this.props.onModalCloseClick,onSettingsButtonClick:this.props.onSettingsClick,onContentNameInputChange:this.handleContentNameInputChange,onContentNameInputKeyUp:this.handleContentNameInputKeyUp,ownerTeam:this.props.ownerTeam,sharingInfo:this.props.actionHandler.getSharingInfo(),showPassFileSettings:this.props.showPassFileSettings,user:this.props.user}),this.contactsSectionProps=()=>({ref:this.setContactsSectionRef,actionHandler:this.props.actionHandler,contentInfo:this.props.contentInfo,canInviteEditor:this.props.sharingPermissions.canInviteEditor(),canInviteViewer:this.props.sharingPermissions.canInviteViewer(),context:"spectrum",focusOnMount:this.props.focusOnMount&&this.props.contentInfo.pathExists(),initialTypeaheadTokens:this.getInitialTypeaheadTokens(),isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isTeamSharedFolder:this.props.isTeamSharedFolder,memberCountWithRecipients:this.props.memberCountWithRecipients,ownerTeam:this.props.ownerTeam,shouldLogContactSearch:!0,typeaheadPlaceholder:this.getTypeaheadPlaceholder(),user:this.props.user,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.isTeamSharedFolder?this.props.teamGroupInfo:void 0}),this.handleContentNameInputChange=e=>{this.props.actionHandler.handleContentNameChange(e.currentTarget.value)},this.handleContentNameInputKeyUp=e=>{e.key===i.Key_enum.Key.Enter&&this.contactsSection&&this.contactsSection.focusTypeaheadInput()},this.handleShareButtonClick=()=>a.__awaiter(this,void 0,void 0,(function*(){const{actionHandler:e}=this.props;if(this.props.isCreatingNewFolder)try{return yield e.setContentNameAndSendShare(this.contactsSection)}catch(e){this.headerSection.selectContentNameInput(),this.props.onSetContentNameAndSendShareFail&&this.props.onSetContentNameAndSendShareFail(e)}else yield e.sendShare(this.contactsSection)})),this.setContactsSectionRef=e=>{this.contactsSection=e},this.setHeaderSectionRef=e=>{this.headerSection=e}}componentDidMount(){this.hasPerformedAfterLoad=!1,this.logTTI()}componentDidUpdate(e,t){return this.logTTI()}logTTI(){if(this.props.contentInfo.extras.origin===i.SHARE_ACTION_ORIGIN_TYPE.GRANT_ACCESS&&this.props.mode!==l.MODES.LOADING&&i.mark_time_to_interactive(),this.props.mode===l.MODES.LINK_ONLY&&this.props.isLinkMetadataLoaded?this.props.actionHandler.logIfHaventBefore(k.TiburonEventName.ViewLinkOnlyModal,{link_only_reason:this.props.linkOnlyReason||"undefined"}):this.props.mode!==l.MODES.LOADING&&this.props.actionHandler.logIfHaventBefore(k.TiburonEventName.ViewShareModal),this.props.mode===l.MODES.LOADING||this.hasPerformedAfterLoad||this.afterLoad(),this.props.mode===l.MODES.MEMBERSHIP)return this.props.actionHandler.logIfHaventBefore(k.TiburonEventName.MemberListLoaded,{member_count:this.props.actionHandler.getSharingInfo().memberNum()})}render(){let e=`${this.props.mode}`;this.props.mode===l.MODES.MEMBERSHIP&&(this._shouldRenderMainMembershipMode()||(e="no-main-membership"));const t=i.cx("unified-share-modal",`unified-share-modal--${e}`,"unified-share-modal--two-link",{"unified-share-modal--loading":e===l.MODES.LOADING,"unified-share-modal--auto-folder":this.shouldRenderAutoFolderCheckbox()});switch(this.props.mode){case l.MODES.LINK_ONLY:return r.React$1.createElement("div",{className:t},r.React$1.createElement(Cs,Object.assign({},this.headerSectionProps())),this.props.linkOnlyReason!==l.LINK_ONLY_REASON.LINKS_PAGE&&this.renderLinkOnlyNoPermissionSection(),this.renderLinkOnlyFooter());case l.MODES.POINTER:return r.React$1.createElement(Cn,{className:t,sharingInfo:this.props.sharingInfo,onClickCloseButton:this.props.onModalCloseClick});case l.MODES.LOADING:return r.React$1.createElement("div",{className:t},r.React$1.createElement(Cs,Object.assign({},this.headerSectionProps(),{isLoading:!0})),this._renderMainLoading());case l.MODES.EVOLUTION:return r.React$1.createElement("div",{className:t},r.React$1.createElement(Ua,Object.assign({},this.shareModalEvolutionProps())));default:return r.React$1.createElement("div",{className:t},r.React$1.createElement(Cs,Object.assign({},this.headerSectionProps())),this._renderToSection(),r.React$1.createElement(yn,Object.assign({},this.props.contactsError)),this.shouldRenderConfidentialFolderSection()&&r.React$1.createElement(In,Object.assign({},this.confidentialFolderSectionProps())),this.shouldRenderInformOwnerUpdateSection()&&r.React$1.createElement($e,null),this._renderMainSection(),this.shouldRenderAutoFolderCheckbox()&&r.React$1.createElement(q.AutoFolderSetupCheckbox,{automateOptionChecked:!!this.props.automationOptionChecked,onAutomationOptionToggle:this.props.actionHandler.toggleAutomationOption,intl:o.intl,inShareModal:!0}),this.shouldRenderFooterSection()&&this.renderFooterSection())}}_renderToSection(){return this.props.showContentManagerBridge?this._renderContentManagerBridge():this.props.sharingPermissions.canInvite()?this.isGoldenGateTeamOverLimit()?this._renderOverLimitSection():r.React$1.createElement(Mn,Object.assign({},this.contactsSectionProps())):r.React$1.createElement(wn,Object.assign({},this.noPermissionsSectionProps()))}noPermissionsSectionProps(){return{isFolder:this.props.contentInfo.isFolder(),isTeamSharedFolder:this.props.isTeamSharedFolder,members:this.props.members,teamName:this.props.ownerTeam&&this.props.ownerTeam.name}}shouldRenderAutoFolderCheckbox(){const e=i.getStoreForBrowse(),{expFlowsCoreFolderSetupFlow:t}=i.browsePostTTIExperiments(e.getState()),s=this.props.sharingInfo.fqPath(),n=s?fe.getUserAutomation(s)(_e.getStoreForAutomations().getState()):void 0;return"INCLUDE_SHARING"===t&&!n}shouldRenderContentSettingsShareButton(){return this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings||this.inShareMode()||this.props.isInContentManager}inShareMode(){return[l.MODES.SHARE,l.MODES.SHARE_SENDING].includes(this.props.mode)}shouldRenderFooterSection(){return!!this.props.isMetadataLoaded&&(this.shouldRenderLinkRowInFooter()||this.shouldRenderContentSettingsShareButton())}renderFooterSection(){const e=i.cx(["unified-share-modal__section","unified-share-modal__section--footer"]);return r.React$1.createElement("div",{className:e},this.shouldRenderLinkRowInFooter()?this.renderLinkRowContent():r.React$1.createElement(Ga,Object.assign({},this.shareButtonProps())))}shareButtonProps(){return{mode:this.props.mode,contentInfo:this.props.contentInfo,contactsError:this.props.contactsError,contentNameMessage:this.props.contentNameMessage,isInContentManager:this.props.isInContentManager,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,onShareButtonClick:this.handleShareButtonClick,shareButtonLabelOverride:this.props.shareButtonLabelOverride}}_shouldRenderMainMembershipMode(){return this.props.sharingPermissions.canInvite()||this._showSharingMemberList()}_renderMainSection(){switch(this.props.mode){case l.MODES.MEMBERSHIP:return this._shouldRenderMainMembershipMode()?this._renderMainMembership():null;case l.MODES.SHARE:case l.MODES.SHARE_SENDING:return this._renderMainShare();default:return null}}confidentialFolderSectionProps(){const{ownerTeam:e,contentInfo:t,actionHandler:s}=this.props;return{intl:o.intl,teamName:e?e.name:"",parentFolderName:s.getSharingInfo().parentFolderName(),isRestoreAccessEnabled:t.pathExists(),onRestoreAccessClick:s.handleSetConfidentialClick}}shouldRenderConfidentialFolderSection(){return this.props.isConfidentialFolder&&this.props.canUpdateConfidentiality}hasOwnersThatAreNotCurrentUser(){const e=this.props.members;if(null==e)return!1;return e.users.filter((e=>e.access_type===i.ACCESS_LEVEL.OWNER&&e.team_member_id!==this.props.user.team_member_id)).size>0}shouldRenderInformOwnerUpdateSection(){return!!this.props.sharingInfo.metadata()&&(this.props.isInContentManager&&this.props.contentInfo.isFolder()&&!this.props.isTeamSharedFolder&&!this.props.isFolderInsideTeamFolderTree&&this.hasOwnersThatAreNotCurrentUser())}_renderContentManagerBridge(){const e=this.props.actionHandler.getSharingInfo(),t=i.parent_dir(e.displayPath()),s=e.name(),n=S.genContentManagerBridgeUri({containingFolder:t,filenameToSelect:s}),a=r.React$1.createElement("span",null,o.intl.formatMessage({id:"EpLafK",defaultMessage:"You can manage access in the <link>admin console</link>."},{link:e=>r.React$1.createElement("a",{href:n.toString(),target:"_blank",rel:"noreferrer"},e)}));return r.React$1.createElement(E.SharingModalBanner,{message:a})}_renderOverLimitSection(){const e=o.intl.formatMessage({id:"JSd+J1",defaultMessage:"This folder is over its {member_limit}-member limit."},{member_limit:v.GoldenGate.SHARING_TOTAL_LIMIT}),t=r.React$1.createElement("div",null,r.React$1.createElement("div",null,e),r.React$1.createElement("div",null,o.intl.formatMessage({id:"wFsjaI",defaultMessage:"Please remove some members."})," ",r.React$1.createElement("a",{href:"/help/9292",target:"_blank",rel:"noopener"},o.intl.formatMessage({id:"epmnB3",defaultMessage:"Learn more."}))));return r.React$1.createElement(E.SharingModalBanner,{message:t})}_renderMainLoading(){return r.React$1.createElement("div",{className:i.cx(["unified-share-modal__main","unified-share-modal__section","unified-share-modal__section--no-border",this.shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer-spectrum"])},r.React$1.createElement("div",{className:"unified-share-modal__loader-wrapper"},r.React$1.createElement("div",{className:"c-loader"},o.intl.formatMessage({id:"/DGYJM",defaultMessage:"Loading..."}))))}renderLinkOnlyFooter(){return r.React$1.createElement("div",{className:i.cx(["unified-share-modal__section","unified-share-modal__section--footer"])},this.props.isLinkMetadataLoaded?this.renderLinkRowContent():this.renderLinkOnlyLoading())}renderLinkRowContent(){if(!this.props.isInContentManager)return r.React$1.createElement(bn,Object.assign({},this.linkSectionProps()))}getLinkOnlyReasonMessage(){const e=this.props.sharingInfo.countsExceedNsLimit();switch(this.props.linkOnlyReason){case l.LINK_ONLY_REASON.INSIDE_SHARED_FOLDER:return r.React$1.createElement("span",null,o.intl.formatMessage({id:"vApw15",defaultMessage:"This folder can only be shared as a link because it’s in a shared folder."})," ",r.React$1.createElement("a",{href:"/help/1931",target:"_blank",rel:"noopener noreferrer"},o.intl.formatMessage({id:"bjsWDZ",defaultMessage:"Learn more"})));case l.LINK_ONLY_REASON.CONTAINS_SHARED_FOLDER:return r.React$1.createElement("span",null,o.intl.formatMessage({id:"0er2Ve",defaultMessage:"This folder can only be shared as a link because it contains a shared folder."})," ",r.React$1.createElement("a",{href:"/help/1931",target:"_blank",rel:"noopener noreferrer"},o.intl.formatMessage({id:"bjsWDZ",defaultMessage:"Learn more"})));case l.LINK_ONLY_REASON.TOTAL_MOUNTS_EXCEEDED:return r.React$1.createElement("div",{className:"scl-sharing-modal-banner--left"},r.React$1.createElement("b",null,b.getLinkOnlyTitle()),r.React$1.createElement("br",null),e?b.getTotalMountsExceededLinkOnlyMsg(e):b.getTotalMountsExceededMsg()," ",r.React$1.createElement("a",{href:"https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate",target:"_blank",rel:"noopener noreferrer"},o.intl.formatMessage({id:"bjsWDZ",defaultMessage:"Learn more"})));case l.LINK_ONLY_REASON.HOME_MOUNTS_EXCEEDED:return r.React$1.createElement("div",{className:"scl-sharing-modal-banner--left"},r.React$1.createElement("b",null,b.getLinkOnlyTitle()),r.React$1.createElement("br",null),e?b.getHomeMountsExceededLinkOnlyMsg(e):b.getHomeMountsExceededMsg()," ",r.React$1.createElement("a",{href:"https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate",target:"_blank",rel:"noopener noreferrer"},o.intl.formatMessage({id:"bjsWDZ",defaultMessage:"Learn more"})));case l.LINK_ONLY_REASON.TREE_SIZE_EXCEEDED:return r.React$1.createElement("div",{className:"scl-sharing-modal-banner--left"},r.React$1.createElement("b",null,b.getLinkOnlyTitle()),r.React$1.createElement("br",null),e?b.getTreeSizeExceededLinkOnlyMsg(e):b.getTreeSizeExceededMsg()," ",r.React$1.createElement("a",{href:"https://help.dropbox.com/files-folders/share/shared-folder-faq#cantcreate",target:"_blank",rel:"noopener noreferrer"},o.intl.formatMessage({id:"bjsWDZ",defaultMessage:"Learn more"})));default:return o.intl.formatMessage({id:"RSBaM6",defaultMessage:"This folder can only be shared as a link."})}}renderLinkOnlyNoPermissionSection(){let e;return e=this.props.actionHandler.getSharingInfo().isOSXPackage()?o.intl.formatMessage({id:"vJ3Igb",defaultMessage:"This package file can only be shared as a link."}):this.getLinkOnlyReasonMessage(),r.React$1.createElement(E.SharingModalBanner,{message:e})}renderLinkOnlyLoading(){return r.React$1.createElement("div",{className:"unified-share-modal__link-info--loading"},r.React$1.createElement(d.ScooterLoader,{"aria-label":o.intl.formatMessage({id:"qxfDnR",defaultMessage:"Loading..."})}))}_showSharingMemberList(){return!!this.props.sharingInfo.hasNonSelfMembers()||(this.props.isFolderInsideTeamFolderTree?1===this.props.members.users.size||!this.props.isConfidentialFolder:this.props.guestMembers.length>0||this.props.linkMembers.length>0)}_renderMemberList(){return r.React$1.createElement("div",{className:i.cx(["unified-share-modal__section","unified-share-modal__section--no-padding","unified-share-modal__section--no-border"])},r.React$1.createElement(qs,Object.assign({},this.memberListProps())))}shareModalEvolutionProps(){return{actionHandler:this.props.actionHandler,contactsError:this.props.contactsError,contentMetadata:this.props.metadata,currentScreen:this.props.currentScreen,currentTab:this.props.currentTab,isEmailSending:this.props.sharingInfo.uiMode()===l.MODES.SHARE_SENDING,handleMessageChanged:this.handleMessageChanged,initialTypeaheadTokens:this.getInitialTypeaheadTokens(),isFolder:this.props.contentInfo.isFolder(),isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isTeamSharedFolder:this.props.isTeamSharedFolder,isTokenizerEmpty:this.props.isTokenizerEmpty,logTiburonEvent:this.handleLogTiburonEvent,memberListProps:this.memberListProps(),onCloseButtonClick:this.props.onModalCloseClick,onSettingsButtonClick:this.props.onSettingsClick,onLinkSettingsTextClick:this.props.onLinkSettingsTextClick,ownerTeam:this.props.ownerTeam,recipientMessage:this.props.recipientMessage,sharingInfo:this.props.sharingInfo,showScreen:this.props.actionHandler.showScreen,user:this.props.user,guestMembers:this.props.guestMembers,linkMembers:this.getFilteredLinkMembers(),showPassFileSettings:this.props.showPassFileSettings,showApproval:this.props.showApproval,sendApproval:this.props.sendApproval,needsAllApprovers:this.props.needsAllApprovers,creatingApprovalRequest:this.props.creatingApprovalRequest,docsendAnalyticsAddOnMetadata:this.props.docsendAnalyticsAddOnMetadata,expandedMainSectionAccordionPanels:this.props.expandedMainSectionAccordionPanels}}memberListProps(){return{actionHandler:this.props.actionHandler,areMembersFullyLoaded:this.props.areMembersFullyLoaded,canInviteMembers:this.props.sharingPermissions.canInvite(),hasLinkMetadata:this.props.isLinkMetadataLoaded,canRelinquishMembership:this.props.canRelinquishMembership,canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,disabled:this.props.showContentManagerBridge,groupSeenStateInfo:this.props.groupSeenStateInfo,guestMembers:this.props.guestMembers,isConfidentialFolder:this.props.isConfidentialFolder,linkMembers:this.getFilteredLinkMembers(),memberCounts:this.props.memberCounts,membership:this.props.members,ownerTeamName:this.props.ownerTeam?this.props.ownerTeam.name:void 0,pendingMemberAction:this.props.pendingMemberAction,presentAccountIds:this.props.presentAccountIds,shouldShowPassUI:this.props.isPassEnabled&&i.fetchingStatusIsSuccessful(this.props.passFetchingStatus),user:this.props.user}}_renderTeamSharedFolderBanner(){let e;return e=null!=this.props.teamGroupInfo?[r.React$1.createElement("p",{className:"u-mar-top-xxl"},r.React$1.createElement("a",{onClick:this._addEveryoneGroup},o.intl.formatMessage({id:"DnaiNC",defaultMessage:"Add everyone at {team_name}"},{team_name:this.props.ownerTeam.name}))),r.React$1.createElement("p",null,o.intl.formatMessage({id:"ix7pHj",defaultMessage:"Or, add groups to this team folder."})+" ",r.React$1.createElement("a",{onClick:this.props.onCreateGroupCallback},o.intl.formatMessage({id:"tthwuJ",defaultMessage:"Create a group"})))]:r.React$1.createElement("p",{className:"u-mar-top-xxl"},o.intl.formatMessage({id:"IjevGW",defaultMessage:"Add groups to this team folder."})+" ",r.React$1.createElement("a",{onClick:this.props.onCreateGroupCallback},o.intl.formatMessage({id:"tthwuJ",defaultMessage:"Create a group"}))),r.React$1.createElement("div",{className:i.cx(["unified-share-modal__section","unified-share-modal__section--no-border"])},r.React$1.createElement("div",{className:i.cx(["unified-share-modal__no-members-banner","u-font-center","u-font-meta","u-font-center","u-font-meta"])},e))}_renderMainMembership(){const e=i.cx(["unified-share-modal__main",this._isPassInfoLoaded()?"unified-share-modal__main--pass-loaded":void 0]);return this._showSharingMemberList()?r.React$1.createElement("div",{className:e},this._renderMemberList()):this.props.isTeamSharedFolder?r.React$1.createElement("div",{className:e},this._renderTeamSharedFolderBanner()):r.React$1.createElement("div",{className:e},r.React$1.createElement(An,Object.assign({},this.messageFieldProps())))}messageFieldProps(){return{placeholder:o.intl.formatMessage({id:"LQgYei",defaultMessage:"Add a message (optional)"}),onChange:this.handleMessageChanged,value:this.props.recipientMessage}}_renderMainShare(){return r.React$1.createElement("div",{className:"unified-share-modal__main"},!this.props.isTeamSharedFolder&&r.React$1.createElement(An,Object.assign({},this.messageFieldProps())))}_isPassInfoLoaded(){return i.fetchingStatusIsComplete(this.props.passFetchingStatus)}shouldRenderLinkRowInFooter(){return this.props.mode!==l.MODES.SHARE&&this.props.mode!==l.MODES.SHARE_SENDING&&!this.props.isInContentManager}getInitialTypeaheadTokens(){const{recipientTokens:e,initialRecipientTokens:t}=this.props;return e?t.concat(e):t}hasEditLink(){return this.props.sharingInfo.editRighteousLink()}hasViewLink(){return this.props.sharingInfo.viewRighteousLink()||this.props.sharingInfo.shmodelLink()}getTypeaheadPlaceholder(){return this.props.isTeamSharedFolder?o.intl.formatMessage({id:"GLQxt4",defaultMessage:"Group names"}):this.props.user.is_team?o.intl.formatMessage({id:"BoLL3S",defaultMessage:"Email, name, or group"}):o.intl.formatMessage({id:"EUp7Eo",defaultMessage:"Email or name"})}getFilteredLinkMembers(){var e;const t=this.hasEditLink(),s=this.hasViewLink(),n=[];for(const a of this.props.linkMembers){const r=a&&a.access_type;if(r)switch(r){case i.ACCESS_LEVEL.OWNER:n.push(a);break;case i.ACCESS_LEVEL.WRITER:t&&n.push(a);break;case i.ACCESS_LEVEL.READER:case i.ACCESS_LEVEL.READER_NO_COMMENT:(s||(null===(e=this.props.presentAccountIds)||void 0===e?void 0:e.has(a.account_id)))&&n.push(a)}}return n}}Wa.displayName="ShareModalContentSpectrum",Wa.defaultProps={headerId:"unified-share-modal-title",initialRecipientTokens:[],isTeamSharedFolder:!1,mode:l.MODES.MEMBERSHIP,onFolderSettingsClick:null,guestMembers:[],linkMembers:[],onCreateGroupCallback:()=>{i.redirect("/team#groups/newgroup")}};const Ka=i.requireCssWithComponent(Wa,["/static/metaserver/static/css/spectrum/index.web-vflJy4G-t.css","/static/typescript/component_libraries/spectrum-sharing/src/index.web-vflUPprqa.css","/static/metaserver/static/css/react/contacts_tokenizer-vflR-o-P-.css","/static/metaserver/static/css/scooter/scooter-scoped-vfl0EaHDR.css","/static/metaserver/static/css/sharing/share_modal-vflClWHjs.css","/static/metaserver/static/css/modal-vflf1hwfZ.css"],[z.BubbleDropdown]);class za extends r.React$1.Component{constructor(e){super(e),this.spectrumModalClassName="scl-share-modal",this.handleKeyDown=e=>{e.key===i.Key_enum.Key.Escape&&this.onModalCloseClick()},this.preventEventBubbling=e=>e.stopPropagation(),this.onModalCloseClick=()=>a.__awaiter(this,void 0,void 0,(function*(){var e;const{onCancel:t,contentInfo:s}=this.props;t&&t();const n=this.getTokenizer();n&&n.finishLogging(!1),this.setState({open:!1}),i.dispatchModalClosed(),b.trackUserLeapEvent(b.SharingUserLeapEvent.SHARE_MODAL_CLOSE,s.extras.origin),b.logTiburonEvent(s,this.props.user.id,k.TiburonEventName.CloseShareModal),b.publishShopModalEvent(i.CampaignEvents.SHARE_MODAL_CLOSED,s,this.props.sharingInfo.getReferrer(),!0),"V1"===this.props.sharingPrefs.core_act_docsend_advanced_sharing&&(yield P.canBeShownDocsendModal(this.props.user.id))&&Tt({experimentVariant:"V1"}),this.props.sharingInfo.contentInfo().pathExists()&&this.props.sharingInfo.automationOptionChecked()&&H.asyncLaunchAddOrEditAutoFolderModal({fqPath:this.props.sharingInfo.fqPath(),nsId:null===(e=this.props.sharingInfo.metadata())||void 0===e?void 0:e.nsId(),user:this.props.user,entryPoint:"share_modal",source:"add_from_folder_creation"})})),this.getSpectrumModalElement=()=>document.getElementsByClassName(this.spectrumModalClassName)[0],this.onModalReady=()=>{i.dispatchModalOpened();const e=this.getSpectrumModalElement();e&&e.addEventListener("keypress",this.preventEventBubbling,!1)},this.handleDismiss=e=>{this.showPreviousScreen(e),this.props.openSettingsFromTheExternalSharePageQuickActions&&this.onModalCloseClick()},this.showPreviousScreen=e=>{let t;e!=d.EDIT_LINK_SETTINGS&&e!=d.VIEW_LINK_SETTINGS||(t=this.state.previousTab),this.setState({currentScreen:this.state.previousScreen,currentTab:t,previousTab:void 0})},this.onSettingsClick=()=>{b.logTiburonEvent(this.props.contentInfo,this.props.user.id,this.props.sharingInfo.isFolder()?k.TiburonEventName.OpenFolderSettingsModal:k.TiburonEventName.OpenFileSettingsModal),this.setState({currentTab:this.props.sharingInfo.isFolder()?d.FOLDER_SETTINGS:d.FILE_SETTINGS,previousScreen:this.state.currentScreen,currentScreen:i.SETTINGS_SCREEN})},this.onLinkSettingsClick=()=>{let e=d.VIEW_LINK_SETTINGS;this.props.sharingInfo.permissionsObj().canCreateEditLink()&&(e=d.EDIT_LINK_SETTINGS),b.logTiburonEvent(this.props.contentInfo,this.props.user.id,k.TiburonEventName.OpenLinkSettingsModal,{settings_tab:e}),this.setState({currentTab:e,previousScreen:this.state.currentScreen,currentScreen:i.SETTINGS_SCREEN})},this.onLinkSettingsTextClick=e=>{this.setState({previousTab:k.ManageAccessTabName.ManageLinksTab,currentTab:e,previousScreen:this.state.currentScreen,currentScreen:i.SETTINGS_SCREEN})},this.state={open:!0,currentScreen:e.initialScreen?e.initialScreen:i.SHARE_SCREEN,currentTab:e.initialCurrentTab,previousScreen:i.SHARE_SCREEN,previousTab:void 0}}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown,!1)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown,!1);const e=this.getTokenizer();this.props.actionHandler.onShareModalUnmount(e);const t=this.getSpectrumModalElement();t&&t.removeEventListener("keypress",this.preventEventBubbling,!1)}getTokenizer(){return this.refs.content&&this.refs.content.getWrappedComponent()&&this.refs.content.getWrappedComponent().refs.tokenizer}getClient(){return this.props.sharingInfo.isFolder()?new i.FolderShareApiClient({userId:this.props.user.id,isNonUserRelativeContext:this.props.isInContentManager}):new i.FileShareApiClient({userId:this.props.user.id})}getIsPassEnabled(){const e=l.passStore.getPassPermissions(this.props.contentInfo.extras.fileId);return!!e&&e.canReadPresence}isPassInfoLoaded(){return i.fetchingStatusIsComplete(this.props.passFetchingStatus)}shouldRenderMainLoading(){if(this.props.sharingInfo.fetchMetadataStatus()===l.FETCH_METADATA_STATUS.FAIL)return!1;const e=this.props.isLinkMetadataLoaded||!this.props.sharingInfo.shouldFetchLinkMetadata(),t=this.props.sharingInfo.isMetadataLoaded()&&this.props.sharingInfo.areSharingPrefsLoaded(),s=this.props.sharingInfo.hasNonSelfMembers()||this.props.areMembersFullyLoaded,n=!this.getIsPassEnabled()||this.isPassInfoLoaded(),i=this.props.shouldBlockMemberListOnPassLoad&&!n;return!t||!s||i||!e}getFinalUIMode(){return this.props.uiMode===l.MODES.POINTER?l.MODES.POINTER:this.shouldRenderMainLoading()?l.MODES.LOADING:this.shouldRenderShareME()?l.MODES.EVOLUTION:this.props.uiMode}render(){let e;if(e=this.props.sharingInfo.isFolder()?this.props.sharingInfo.folderPolicy():this.props.sharingInfo.filePolicy(),this.state.currentScreen===i.SETTINGS_SCREEN&&e){const t=this.props.actionHandler.getCachedLinkSeenStateInfo();return r.React$1.createElement(Ft,{className:this.spectrumModalClassName,actionHandler:this.props.actionHandler,sharingInfo:this.props.sharingInfo,sharingPrefs:this.props.sharingPrefs,client:this.getClient(),currentTab:this.state.currentTab,currentPolicy:e,folderName:this.props.sharingInfo.name(),isFolder:this.props.sharingInfo.isFolder(),isSharedFolder:this.props.contentInfo.isSharedFolder(),isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isTeamSharedFolder:this.props.isTeamSharedFolder,isUserOnOwnerTeam:this.props.isUserOnOwnerTeam,linkMetadata:this.props.linkMetadata,ownerTeam:this.props.ownerTeam,permissions:this.props.permissions,user:this.props.user,onDismiss:this.handleDismiss,onSuccessSharing:this.props.onSuccessSharing,isLinkVisitor:Re(this.props.user.account_id,t)})}{const e=i.cx(this.spectrumModalClassName,{"scl-share-modal--overflow-visible":this.getFinalUIMode()===l.MODES.EVOLUTION});return r.React$1.createElement(o.Provider,{value:o.intl},r.React$1.createElement(i.Modal$1,{"app-element":document.getElementById("embedded-app")||document.body,"aria-label":o.intl.formatMessage({id:"XTD4g+",defaultMessage:"Sharing Modal"}),className:e,"body-class-name":"scl-share-modal-content uxa-modal","body-id":"unified-share-modal",open:this.state.open,width:540,onLoad:this.onModalReady,onRequestClose:this.onModalCloseClick,shouldCloseOnOverlayClick:!0},this.renderModalContent()))}}renderModalContent(){const e=!!(this.props.contentInfo.isFile()?this.props.filePolicy&&this.props.filePolicy.viewer_info_policy:this.props.folderPolicy&&this.props.folderPolicy.viewer_info_policy),t={currentScreen:this.state.currentScreen,headerId:"unified-share-modal-title",isCreatingNewFolder:this.isCreatingNewFolder(),isLimitedTeam:this.props.viewer.team_is_limited,isPassEnabled:this.getIsPassEnabled(),mode:this.getFinalUIMode(),showContentManagerBridge:this.shouldRenderContentManagerBridge(),showPassFileSettings:e,onLinkSettingsClick:this.onLinkSettingsClick,onModalCloseClick:this.onModalCloseClick,onLinkSettingsTextClick:this.onLinkSettingsTextClick,onSettingsClick:this.onSettingsClick,currentTab:this.state.currentTab},s=Object.assign(Object.assign({},this.props),t);return r.React$1.createElement(Ka,Object.assign({},s))}shouldRenderContentManagerBridge(e=!1){return!this.props.isInContentManager&&(!!v.GoldenGate.hasContentManagerAndSuperAdmin(this.props.user.id)&&(!!this.props.isTeamSharedFolder||!(!this.props.isFolderInsideTeamFolderTree||!this.props.isUserOnOwnerTeam)&&(e||!this.props.sharingPermissions.canInviteEditor())))}isCreatingNewFolder(){const e=this.props.contentInfo;return e.isFolder()&&!e.extras.exists}shouldRenderShareME(){return this.props.sharingInfo.fetchMetadataStatus()!==l.FETCH_METADATA_STATUS.FAIL&&this.props.sharingInfo.shouldFetchLinkMetadata()}}za.displayName="ShareModal";const qa=K.listenToStores(za,{sharingInfoStore:l.sharingInfoStore,passStore:l.passStore},(e=>{const t=e.actionHandler.getSharingInfo(),s=t.getInitialProps(),{groupSeenStateInfo:n,linkSeenStateInfo:a,presentAccountIds:r,passFetchingStatus:o}=e.actionHandler.getPassInfo();return{sharingInfo:t,actionHandler:e.actionHandler,areMembersFullyLoaded:t.areMembersFullyLoaded(),areSharingPrefsLoaded:t.areSharingPrefsLoaded(),canChangeOptions:t.permissionsObj().canChangeOptions(),canEdit:t.permissionsObj().canEdit(),canRelinquishMembership:t.permissionsObj().canRelinquishMembership(),canShareLink:t.canShareLink(),canUnshareFile:t.permissionsObj().canUnshare(),canUnshareFolder:t.permissionsObj().canUnshare(),canUpdateConfidentiality:t.permissionsObj().canUpdateConfidentiality(),contactsError:t.contactsError(),contentInfo:t.contentInfo(),contentNameMessage:t.contentNameMessage(),contentNameMessageLevel:t.contentNameMessageLevel(),filePolicy:t.filePolicy(),folderPolicy:t.folderPolicy(),guestMembers:Ss(r),groupSeenStateInfo:n,hasDisplayableMembers:t.hasDisplayableMembers(),hasParentSharedFolder:t.hasParentSharedFolder(),initialContentName:s.initialContentName,initialRecipientTokens:t.initialRecipientTokens(),sharingPrefs:t.sharingPrefs(),isConfidentialFolder:t.isConfidentialFolder(),isContentNameFocused:t.isContentNameFocused(),isFolderInsideTeamFolderTree:t.isFolderInsideTeamFolderTree(),isInContentManager:s.isInContentManager,isLinkMetadataLoaded:t.isLinkMetadataLoaded(),isMetadataLoaded:t.isMetadataLoaded(),isOwner:t.isOwner(),isCurrentAccountLoaded:t.isCurrentAccountLoaded(),isTeamSharedFolder:t.isTeamSharedFolder(),isTokenizerEmpty:t.isTokenizerEmpty(),isUserOnOwnerTeam:t.isUserOnOwnerTeam(),linkMembers:(l=a,l?l.map((e=>{const{seen_state_user:{user_id:t,display_name:s,email:n,photo_circle_url:a,sharing_access_type:r},when_last_seen:o}=e;let l=i.ACCESS_LEVEL.READER;return r&&"edit_link_access"===r.type&&(l=i.ACCESS_LEVEL.WRITER),new i.UserMembershipInfo({access_type:l,account:new i.BasicAccount({account_id:t,display_name:s,email:n,email_verified:!0,familiar_name:"",given_name:"",profile_photo_url:a,surname:""}),account_id:t,initials:i.getInitials(s),is_inherited:!1,permissions:Es(),same_team:!0,time_last_seen:o?new Date(1e3*o):null})})):[]),linkMetadata:t.linkMetadata(),linkOnlyReason:t.linkOnlyReason(),memberCounts:t.memberCounts(),memberCountWithRecipients:t.memberCountWithRecipients(),members:t.members(),metadata:t.metadata(),ownerTeam:t.ownerTeam(),passFetchingStatus:o,pendingMemberAction:t.pendingMemberAction(),permissions:t.permissions(),sharingPermissions:t.permissionsObj(),presentAccountIds:i.immutableExports.Set(r),recipientMessage:t.recipientMessage(),recipientTokens:t.recipientTokens(),shareButtonLabelOverride:s.shareButtonLabelOverride,shareFolderPromise:t.shareFolderPromise(),shouldBlockMemberListOnPassLoad:t.shouldBlockMemberListOnPassLoad(),initialScreen:e.initialScreen,initialCurrentTab:e.initialCurrentTab,teamPolicy:t.teamPolicy(),uiMode:t.uiMode(),user:t.user(),onCancel:s.onCancel,onCreateGroupCallback:t.onCreateGroupCallback(),onDeleteLink:s.onDeleteLink,onSetContentNameAndSendShareFail:s.onSetContentNameAndSendShareFail,onShareClick:s.onShareClick,onSuccessSharing:s.onSuccessSharing,teamGroupInfo:s.teamGroupInfo,viewer:i.Viewer.get_viewer(),focusOnMount:s.focusOnMount,openSettingsFromTheExternalSharePageQuickActions:e.actionHandler.getOpenSettingsFromTheExternalSharePageQuickActions(),creatingApprovalRequest:t.creatingApprovalRequest(),showApproval:s.showApproval,sendApproval:t.sendApproval(),needsAllApprovers:t.needsAllApprovers(),automationOptionChecked:t.automationOptionChecked(),docsendAnalyticsAddOnMetadata:Object.assign({variant:s.docsendAnalyticsAddOn},t.modalInfoState().docsendAnalyticsLink),expandedMainSectionAccordionPanels:t.getExpandedMainSectionAccordionPanels()};var l})),ja=()=>(new Date).getTime().toString(),Ya=function(e,t,s){let n=null;"number"==typeof e&&(e=i.Viewer.get_viewer().get_user_by_id(e)),null==s.userHomeNs&&(s.userHomeNs=e.home_ns_id);let a=Qa(t),r=null;if(null!=a){if(a=Object.assign(Object.assign({},a),s),a.modalSessionId||(a.modalSessionId=ja()),void 0===s.logShareModalView||s.logShareModalView){const{nsId:t,sjid:s,fileId:n,filename:r,fqPath:o}=a;i.logViewShareModal({uid:e.id,modal_session_id:a.modalSessionId||"",file_nsid:t,file_sjid:s,file_id:n,file_name:r,file_path:o})}try{n=l.ContentInfo.createFromParams(a)}catch(e){n=null}r=t instanceof i.BrowseContext?t:a.browseContext}return{browseContext:r,contentInfo:n,shareModalInfo:a,user:e}},Za=function(e,t,a,r,o,l=!0){let c,d,h;if(({browseContext:c,contentInfo:d,shareModalInfo:h,user:e}=Ya(e,t,a)),null==d||null==h)return!1;b.logTiburonEvent(d,e.id,k.TiburonEventName.BeginShareFlow);const p=(null!=c?c.isNonUserRelativeContext:void 0)||h.isNonUserRelativeContext;let u=n.EmailVerificationReasons.SHMODAL;if(h.origin===i.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE&&(u=n.EmailVerificationReasons.SHARE_FILEVIEWER),p||s.EmailVerification.get_for_user(e).verified_or_show(u,h.onCancel)){const s=new(d.isFolder()?i.FolderShareApiClient:i.FileShareApiClient)({userId:e.id,isNonUserRelativeContext:p}),n=Ee.approvalIOClient(e.id),c=new _s(s,e,qa,r,o,a.openSettingsFromTheExternalSharePageQuickActions,n),{inLinksPage:u}=h,m=h.prefillContacts,g=c.initializeShareModal({contentInfo:d,initialRecipientTokens:m,inLinksPage:u},{client:s,content:t,user:e,onDeleteLink:h.onDeleteLink,teamGroupInfo:d.teamGroupInfo(),isInContentManager:!!p,onSuccessSharing:h.onSuccessSharing,shareAsConfidential:!!h.shareAsConfidential,initialContentName:h.initialContentName,shouldSyncThisFolder:h.shouldSyncThisFolder,recipientMessage:h.recipientMessage,onCreateGroupCallback:h.onCreateGroupCallback,onShareClick:h.onShareClick,shouldSuppressRedirectToBrowse:h.shouldSuppressRedirectToBrowse,shouldCloseImmediately:h.shouldCloseImmediately,onCancel:h.onCancel,onClose:h.onClose,onSetContentNameAndSendShareFail:h.onSetContentNameAndSendShareFail,shareButtonLabelOverride:h.shareButtonLabelOverride,focusOnMount:l,referrer:h.referrer,experiments:h.experiments,showApproval:h.showApproval,approvalClient:n,onCreateApprovalSuccess:h.onCreateApprovalSuccess,automationOptionChecked:a.automationOptionChecked,docsendAnalyticsAddOn:h.docsendAnalyticsAddOn,defaultRecipientAccessLevel:a.defaultRecipientAccessLevel});a.defaultRecipientAccessLevel&&c.changeRecipientAccess(a.defaultRecipientAccessLevel),a.openLinkSettings?g.then((()=>c.handleLinkSettingsClick())):a.initialScreen&&a.initialScreen===i.MANAGE_SCREEN?c.showScreen(i.MANAGE_SCREEN):c.openShareModal()}else b.logTiburonEvent(d,e.id,k.TiburonEventName.ShareModalEmailUnverified);return!0},Qa=function(e){if(e instanceof i.File){const t=[i.FileTypes.FILE,i.FileTypes.PACKAGE].indexOf(e.type)>-1;return{exists:!e.isDeleted,fileId:e.file_id,fqPath:e.fq_path,isFolder:!t,isTeamSharedFolder:e.type===i.FileTypes.TEAM_SHARED_FOLDER,isFolderInsideTeamFolderTree:e.is_in_team_folder_tree,sjid:e.sjid,nsId:e.ns_id,nsPath:e.ns_path,targetNsId:e.target_ns}}return e instanceof i.BrowseContext?Ja(e):e},Ja=function(e){return e.isInFolderMode?e.isInsideSharedFolder?e.currentNSPath?{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentMountPoint,isFolder:!0,nsId:null,nsPath:e.currentMountPoint,targetNsId:e.currentNSID}:{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentFQPath,isFolder:!1,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}};var Xa=Object.freeze({__proto__:null,generateModalSessionId:ja,getShareModalInfo:Qa,getSharingInfo:Ya,showNewFolderShareModal:function(e,t=null,s=null,n=null,a=!1,r=!1,o=null,l,c,d,h,p=null,u=null,m,g,f,_,E=!0,S,M,v){t||(t=ja());const k={fqPath:function(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=1;s<=100;s++)e+=t.charAt(Math.floor(62*Math.random()));return b.getNewFolderPathFromContentName(e,s||"")}(),isFolder:!0,exists:!1,origin:i.SHARE_ACTION_ORIGIN_TYPE.WIZARD,modalSessionId:t,isNonUserRelativeContext:r,isTeamSharedFolder:!1,initialContentName:n,shareAsConfidential:a,shouldSyncThisFolder:o,shouldSuppressRedirectToBrowse:p,shouldCloseImmediately:u,onCancel:m,onClose:g,onSetContentNameAndSendShareFail:f,shareButtonLabelOverride:_,logShareModalView:E,experiments:S,defaultRecipientAccessLevel:v},C={origin:i.SHARE_ACTION_ORIGIN_TYPE.WIZARD};return d&&(C.onSuccessSharing=d),h&&(C.onShareClick=h),C.automationOptionChecked=M,C.defaultRecipientAccessLevel=v,Za(e,k,C,l,c)},showPrefilledShareModal:function({user:e,sharePrefillEmails:t,content:s,setUrl:n,contentManagerValidateFolderPath:a,extras:r}){let o,l;return t&&t.length>0?(o=i.SHARE_ACTION_ORIGIN_TYPE.GRANT_ACCESS,l=t.map((e=>new i.Contact({type:i.ContactTypes.EMAIL,email:e,name:"",query:e,pending:!0})))):(o=i.SHARE_ACTION_ORIGIN_TYPE.DESKTOP_CLIENT,l=[]),Za(e,s,Object.assign({origin:o,prefillContacts:l},r),n,a)},showShareModal:Za});t.Accordion=pa,t.DropdownMenu=Ps,t.DropdownMenuButton=xs,t.IntegrationPopoverGroup=ke,t.KeyCodes={TAB:9,ENTER:13,SPACE:32},t.MemberRow=Hs,t.Menu=Fs,t.MenuItem=Os,t.Token=dn,t.TokenizedInput=pn,t.Typeahead=mn,t.actions_adapter_esnext=Pe,t.fetchTeamGuestPassDetails=function(){return a.__awaiter(this,void 0,void 0,(function*(){const e=ms();let t;try{t=yield e.ns("guest_pass").rpc("get_team_details",{},{})}catch(e){throw new Error(e.error[".tag"])}if(void 0===t.remaining_guest_passes||void 0===t.used_guest_passes||void 0===t.guest_pass_duration_days||void 0===t.is_team_eligible_for_guest_pass)throw new Error("Missing data in response");return{remainingGuestPasses:t.remaining_guest_passes,usedGuestPasses:t.used_guest_passes,guestPassDurationDays:t.guest_pass_duration_days,isTeamEligibleForGuestPass:t.is_team_eligible_for_guest_pass}}))},t.generateModalSessionId=ja,t.getTasks=function(){return a.__awaiter(this,void 0,void 0,(function*(){const e=new i.UserApiV2Client,t=i.mustGetActiveUserId(),s=yield e.ns("custom_onboarding").rpc("get_tasks",{user_id:t},{subjectUserId:t}).catch((e=>{A.reportException({err:e,tags:["onboarding_checklist"],severity:T.SEVERITY.NONCRITICAL})}));return null==s?void 0:s.tasks}))},t.getText=Oe,t.share_modal_util_esnext=Xa,t.showShareModal=Za,t.updateTask=Ha}));
//# sourceMappingURL=c_sharing_share_modal_util.js-vflezWQOZ.map
