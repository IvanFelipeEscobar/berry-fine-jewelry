define(["exports","./c_tslib","./e_ui_page_files_router","./c_contacts_bloodhound","metaserver/static/js/modules/constants/contacts","./c_react_query_api_helpers_queries_search_experiments"],(function(e,t,o,r,s,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(o){if("default"!==o){var r=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,r.get?r:{enumerable:!0,get:function(){return e[o]}})}})),t.default=e,Object.freeze(t)}var i=n(s);const u=o.createCustomRequestQuery({requestMethod:"contacts:get",queryFn:({apiArg:e})=>({signal:s})=>a.reportExceptionIfRequestFails((()=>t.__awaiter(void 0,void 0,void 0,(function*(){const t=yield(new o.UserApiV2Client).ns("contacts").rpc("get",e,{subjectUserId:o.mustGetActiveUserId(),signal:s}),n=((null==t?void 0:t.uncompressed_server_contacts)||[]).filter((e=>!e.group_id&&!!e.account_id)).map(a.convertBasicContactResultToContact),i=new r.Bloodhound({datumTokenizer:o.ContactCommon.get_index_tokens,queryTokenizer:r.Bloodhound.tokenizers.whitespace,identify:o.ContactCommon.get_key,sorter:o.ContactCommon.sorter,local:[]});return i.add(n),{apiData:i,pkgData:null}}))),["search_bar","search_bar_people_suggestions","search_react_query"])}),c=o.createCustomRequestQuery({requestMethod:"team:search_contacts",queryFn:({apiArg:e})=>()=>a.reportExceptionIfRequestFails((()=>t.__awaiter(void 0,void 0,void 0,(function*(){return e.query?o.WebRequest$2({url:"/team/search_contacts",data:{query:JSON.stringify(e.query)},subject_user:o.mustGetActiveUserId()}).then((e=>({apiData:JSON.parse(e).map((e=>new o.Contact(e))),pkgData:null}))):{apiData:[],pkgData:null}}))),["search_bar","search_bar_people_suggestions","search_react_query"])}),l={start_merge:!1,uncompressed:!0,use_bolt:!1,version:11},g=()=>!!i.MERGE_SEARCH_ALLOWED[o.mustGetActiveUserId()],d="search_suggestion:get_people_suggestion",_=o.createDefaultApiv2QueryFn(d),p=o.createApiv2Query({requestMethod:d,queryFn:(...e)=>(...r)=>a.reportExceptionIfRequestFails((()=>t.__awaiter(void 0,void 0,void 0,(function*(){var t;const s=yield _(...e)(...r);return o.logPeopleSuggestionFetched(null===(t=s.apiData.people_suggestions)||void 0===t?void 0:t.length),s}))),["search_view","search_view_people_suggestion","search_react_query"],o.logPeopleSuggestionFailed)}),v=e=>{var t;const o={num_items:5,return_team_members_if_empty:!0},r=p.useQuery({apiArg:o},{enabled:e});if(!e)return[r,[]];return[r,(null===(t=r.data)||void 0===t?void 0:t.apiData.people_suggestions)||[]]};e.PEOPLE_SUGGESTIONS_DROPDOWN_LIMIT=3,e.formatPeopleSuggestionsForSuggestionsDropdown=(e,t)=>e.slice(0,2).map((e=>a.convertContactToPeopleSuggestion(e,t))),e.formatPeopleSuggestionsForZeroState=e=>{var t;return null!==(t=null==e?void 0:e.slice(0,o.SEARCH_MAX_NUM_PEOPLE_SUGGESTIONS_FOR_EMPTY_STATE))&&void 0!==t?t:[]},e.formatPeopleSuggestionsLoadingState=({isError:e,isLoading:t,isSuccess:r})=>e?o.PeopleSuggestionsLoadingState.FAILED:t?o.PeopleSuggestionsLoadingState.LOADING:r?o.PeopleSuggestionsLoadingState.LOADED:void 0,e.formatSuggestedPeopleForQuery=e=>e.slice(0,o.PEOPLE_FILTER_SEARCH_CAPACITY).map((e=>o.convertFilteredContactToSuggestedUser(e))),e.formatSuggestedUser=e=>e?o.convertFilteredContactToSuggestedUser(e):void 0,e.formatZeroPeopleSuggestionsLoadingState=({isError:e,isLoading:t,isSuccess:r})=>e?o.PeopleSuggestionsLoadingState.FAILED:t?o.PeopleSuggestionsLoadingState.LOADING:r?o.PeopleSuggestionsLoadingState.LOADED:void 0,e.useContactsQueryBy=(e,t)=>{var o,r;const s=g(),a=c.useQuery({apiArg:{query:e}},{enabled:s}),n=u.useQuery({apiArg:l},{enabled:!s});let i=[];if(s){const e=null===(o=a.data)||void 0===o?void 0:o.apiData;(null==e?void 0:e.length)&&(i=[...e]);return[a,i.slice(0,null!=t?t:2)]}{const o=null===(r=n.data)||void 0===r?void 0:r.apiData;e&&o&&o.search(e,(e=>{i=[...e]}));return[n,i.slice(0,null!=t?t:2)]}},e.useFilteredContactQuery=e=>{var t;const o=g(),r=u.useQuery({apiArg:l},{enabled:!o});if(!e||o)return[r,void 0];let s;const a=null===(t=r.data)||void 0===t?void 0:t.apiData;if(a){s=a.all().find((t=>t.dbx_account_id===e))}return[r,s]},e.usePeopleSuggestionQuery=v,e.useZeroStatePeopleSuggestionQuery=(e,t)=>{const[r,s]=v(e);return[r,s.slice(0,null!=t?t:5).map(o.convertSuggestedUserToContact)]}}));
//# sourceMappingURL=c_react_query_api_helpers_queries_people_suggestion.js-vflqwJfuX.map
