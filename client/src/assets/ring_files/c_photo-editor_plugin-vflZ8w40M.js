define(["require","exports","./c_tslib","./c_photo-editor_logging_photo_editor_events_logger","./e_edison","./c_core_i18n","./e_ui_page_files_router","./c_photo-editor_logging_logging_utils","./c_src_data_actions","./c_core_logging_constants","./c_src_preview-photo-editor_types","./c_src_sink_index","./c_apex-metrics_src_types","./c_lodash-es_lodash","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_core_xhr","./c_csrf","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings"],(function(t,e,s,i,o,r,a,n,c,d,l,g,h,m,_,u,E,v,p,A,f,I,x,D,T,y,O,j,P,L,w,R,S,C,b,M,N,k,F){"use strict";const U=r.defineMessage({id:"fCv2+s",defaultMessage:"Edit"});var B;!function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(B||(B={}));const V=o.reactExports.lazy((()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{RootComponent:e}=yield new Promise((function(e,s){t(["./c_photo-editor_layout_root"],e,s)}));return{default:e}}))));class ${constructor(t,e,s,r,l){this.context=t,this.getActiveFile=e,this.user=s,this.onImageChanged=r,this.loadStatus=B.NOT_LOADED,this.integratedEditor=!1,this.onEditorReady=()=>{this.timerTTI&&(i.stopTimer(this.timerTTI),this.timerTTI=void 0)},this.lifecycle={pluginDidActivate:()=>{if(this.loadStatus===B.NOT_LOADED){const{file:t}=this.getActiveFile();this.timerTTI=i.startAndRetrieveTimer({metricName:i.AmpMetrics.TTI_EDITOR,metricTags:{size_bucket:n.getSizeBucket(n.convertByteToMegabyte(t.bytes)),entry_point:i.EntryPoint.PREVIEWS}},this.integratedEditor),i.logAmpMetric({metricName:i.AmpMetrics.OPEN_EDITOR,metricTags:{entry_point:i.EntryPoint.PREVIEWS}},this.integratedEditor),this.loadStatus=B.LOADED,i.logImageEditorEvent(i.ImageEditorEvent.selectEdit,this.integratedEditor,{entryPoint:i.EntryPoint.PREVIEWS})}},pluginDidDeactivate:()=>{this.store.dispatch(c.actions.reset())}},this.getComponent=({file:t,titleBarActionSetters:e,activationParams:s})=>{if(!e)return null;const{file:r}=this.getActiveFile(),{navigation:c,sharedLinkInfo:l}=this.context.getPluginData(),g=(t,e,s)=>{this.context.logUserAction(t,e,Object.assign({actionSurface:"image_edit"},s))},h=o.reactExports.useCallback((t=>{i.logImageEditorErrorEvent(t,this.integratedEditor),g(d.UserAction.EditError),c.exitEditMode(),this.loadStatus=B.NOT_LOADED}),[i.logImageEditorEvent]),m=o.reactExports.useMemo((()=>({exit:()=>{c.exitEditMode(),this.loadStatus=B.NOT_LOADED},onImageChanged:this.onImageChanged,updatePreviewMetadata:c.updatePreviewMetadata,logUserAction:g,redirectToFile:t=>{a.redirect(a.preview_uri_for_fq_path(this.user,t))},closeViewer:()=>c.closeViewer(d.UserActionContext.Editor)})),[c,this.onImageChanged,this.context]);return o.React$1.createElement(a.ErrorBoundary,{onCatch:h},o.React$1.createElement(o.reactExports.Suspense,{fallback:o.React$1.createElement(n.Loading,{integratedEditor:this.integratedEditor})},o.React$1.createElement(V,{user:this.user,file:r,imageFile:t,store:this.store,pluginApi:m,sharedLinkInfo:l,onImageEditorReady:this.onEditorReady,integratedEditor:this.integratedEditor,titleBarActionSetters:e,activationParams:s,logUserAction:g})))},this.onActivate=()=>l(this.context),this.getActiveFile=e,this.store=n.createStore()}}e.PhotoEditorPluginFullScreen=class extends ${constructor(t,e,s,i,o,r){super(e,s,i,o,r),this.adapter=t,this.context=e,this.getActiveFile=s,this.user=i,this.onImageChanged=o,this.buttonIcon=a.EditLine,this.fullscreenLayer=this.getComponent,this.buttonText=this.adapter.intl.formatMessage(U)}},e.PhotoEditorPluginIntegrated=class extends ${constructor(t,e,s,i,o){super(t,e,s,i,o),this.context=t,this.getActiveFile=e,this.user=s,this.onImageChanged=i,this.layerUI={Layer:this.getComponent},this.editUI={},this.shouldReplacePreview=!0,this.allowTitleBar=!0,this.integratedEditor=!0}}}));
//# sourceMappingURL=c_photo-editor_plugin.js-vfla37hNq.map
