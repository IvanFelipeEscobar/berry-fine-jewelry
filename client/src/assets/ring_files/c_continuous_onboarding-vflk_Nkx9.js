define(["require","exports","./e_edison","./e_ui_page_files_router","./e_core_exception","./c_core_browser_detection","./c_core_i18n","./c_tslib","./c_file_uploader_types","./c_lodash-es_lodash","./c_growth_ui_send_app_link_form","./c_src_sink_index","./c_apex-metrics_src_types","./c_core_custom_protocol","./c_ui_trials_types","./c_core_exception_info","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","metaserver/static/js/modules/constants/request","./c_core_xhr","./c_csrf","./c_browser_cookies","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/core/langpack","./c_form_row_index"],(function(e,t,o,a,s,i,n,l,r,c,d,m,u,p,_,g,b,y,S,E,C,h,R,k,M,f,A,O,I,N,$,T,v,B,x,w,L,D,j){"use strict";var U;!function(e){e.DISMISS_BTN="dismiss_btn",e.FIRST_TIME_REONBOARDING="first_time_reonboarding"}(U||(U={}));class P extends a.GrowthUserActionTracker{constructor(){super(...arguments),this.project="continuous_onboarding"}}const F=(e,t)=>{const o=Object.keys(e.module_map).reduce(((t,o)=>{const a=e.module_map[o];return!a.is_seen&&a.should_show&&t.push(a.seen_string),t}),[]);o.length&&a.markModulesAsCompleted(t,o)},H=e=>{for(let t=0;t<e.module_ids.length;t++){const o=e.module_map[e.module_ids[t]];if(o.should_show)return o.module_id}return null};var V;!function(e){e.OPEN_SIDEBAR="open-sidebar",e.CLOSE_SIDEBAR="close-sidebar",e.HIDE_SIDEBAR="hide-sidebar",e.SET_ACTIVE_MODULE="set-active-module",e.FORCE_CLOSE="force-close",e.REOPEN_IF_CLOSED_BY_ACTIVE_BACKGROUND="reopen-if-closed-by-active-background",e.SET_SIDEBAR="set-sidebar",e.BOLT_SIDEBAR_UPDATE="bolt-sidebar-update",e.NEW_MODULE_UPDATE="new-module-update",e.HIDE_MODULE="hide-module",e.SET_MILESTONE_COMPLETE="set-milestone-complete"}(V||(V={}));const G={isOpen:!1,isClosedDueToActiveBackground:!1,activeModuleId:null,showOpenButtonWhenCollapsed:!0,showCompletedState:!1},W=(e,t)=>{switch(t.type){case V.OPEN_SIDEBAR:return Object.assign(Object.assign({},e),{isOpen:!0,isClosedDueToActiveBackground:!1,showOpenButtonWhenCollapsed:!0});case V.CLOSE_SIDEBAR:return Object.assign(Object.assign({},e),{isOpen:!1,isClosedDueToActiveBackground:!1,showOpenButtonWhenCollapsed:!0});case V.HIDE_SIDEBAR:return Object.assign(Object.assign({},e),{isOpen:!1,showOpenButtonWhenCollapsed:!1});case V.SET_ACTIVE_MODULE:return Object.assign(Object.assign({},e),{activeModuleId:t.activeModuleId});case V.FORCE_CLOSE:return Object.assign(Object.assign({},e),{isOpen:!1,isClosedDueToActiveBackground:e.isOpen,showOpenButtonWhenCollapsed:!0});case V.REOPEN_IF_CLOSED_BY_ACTIVE_BACKGROUND:return Object.assign(Object.assign({},e),{isOpen:e.isClosedDueToActiveBackground||e.isOpen,isClosedDueToActiveBackground:!1});case V.SET_SIDEBAR:{const{progression:o,display_surface_props:a,bolt_channel_states:s}=t,i=H(o);return null===i?Object.assign({},e):Object.assign(Object.assign({},e),{progression:o,display_surface_props:a,bolt_channel_states:s,showOpenButtonWhenCollapsed:!a.open_on_load,activeModuleId:i})}case V.BOLT_SIDEBAR_UPDATE:{const{progression:o,bolt_channel_states:a,display_surface_props:s}=t;if(e.progression){const t=e.progression.progression_id!==o.progression_id?o:Object.assign(Object.assign({},e.progression),{milestone_map:Object.assign(Object.assign({},e.progression.milestone_map),o.milestone_map),implementation_data:Object.assign(Object.assign({},e.progression.implementation_data),o.implementation_data)}),i=e.activeModuleId&&t.module_map[e.activeModuleId]&&t.module_map[e.activeModuleId].should_show?e.activeModuleId:H(t);return Object.assign(Object.assign({},e),{progression:t,activeModuleId:i,display_surface_props:s,bolt_channel_states:a,showCompletedState:!o.module_ids.length})}return Object.assign({},e)}case V.NEW_MODULE_UPDATE:{const{progression:o}=t;if(e.progression){const t=[],a={};o.module_ids.forEach((s=>{-1===e.progression.module_ids.indexOf(s)&&(t.push(s),a[s]=o.module_map[s])}));const s=Object.assign(Object.assign({},e.progression),{module_ids:[...e.progression.module_ids,...t],module_map:Object.assign(Object.assign({},e.progression.module_map),a)}),i=e.activeModuleId&&s.module_map[e.activeModuleId].should_show?e.activeModuleId:H(s);return Object.assign(Object.assign({},e),{progression:s,activeModuleId:i})}return Object.assign({},e)}case V.HIDE_MODULE:if(e.progression){const o=Object.assign({},e.progression);return o.module_map[t.module_id]=Object.assign(Object.assign({},o.module_map[t.module_id]),{should_show:!1}),Object.assign(Object.assign({},e),{progression:o,activeModuleId:H(o)})}return Object.assign({},e);case V.SET_MILESTONE_COMPLETE:if(e.progression){const o=Object.assign({},e.progression);return o.milestone_map[t.milestoneKey]=Object.assign(Object.assign({},o.milestone_map[t.milestoneKey]),{is_completed:!0}),Object.assign(Object.assign({},e),{progression:o})}return Object.assign({},e);default:throw new Error("No such action")}},q={surface:{".tag":"web_sidebar"}},K=(e,t)=>{let o=0;const s=()=>(q.surface_path=a.get_pathname(),(new a.UserApiV2Client).ns("growth").rpc("get_continuous_onboarding",q,{subjectUserId:e}).then(t).catch((()=>{o<2&&(o++,setTimeout(s,3e3))})));s()},z=(e,t,o,s)=>{let i;const n=Object.keys(s).map((e=>{const{unique_id:t,revision:o,token:i}=s[e];return new a.SignedChannelState(e,t,o,i)}));if(n.length){const s=a=>{const s=a[0].app_id;e.logBoltNotification(s),K(o,(({progression:e,bolt_channel_states:a,display_surface_props:s})=>{if(e){const i=s;F(e,o),t({type:V.BOLT_SIDEBAR_UPDATE,progression:e,bolt_channel_states:a,display_surface_props:i}),setTimeout((()=>{t({type:V.NEW_MODULE_UPDATE,progression:e})}),600)}}))},l=()=>{i.unsubscribe(),K(o,(({bolt_channel_states:a})=>{z(e,t,o,a)}))};return i=new a.BoltClient(n,s,l),i.start(),i}},Y=(e,t,a)=>{const[s,i]=o.React$1.useState(!1);o.React$1.useEffect((()=>{a&&!s&&(e[t](),i(!0))}),[a,e,t,s])};const Z=({handleHideSidebar:e,emptyStateProps:t,isSidebarComplete:s,logger:i})=>{Y(i,"logSidebarEmptyStateViewed",s);const{dismiss_button_text:n,description:l,image_url:r,image_url_hi_res:c,image_alt:d}=t,m=a.cx({"continuous-onboarding__complete-view":!0,"continuous-onboarding__complete-view--isVisible":s});return o.React$1.createElement("div",{className:m,"aria-hidden":!s},o.React$1.createElement("div",{className:"continuous-onboarding__complete-view__content"},r&&o.React$1.createElement(a.Image$1,{className:"continuous-onboarding__complete-view__image",alt:d,src:r,srcHiRes:c}),o.React$1.createElement(a.Text,{className:"continuous-onboarding__complete-view__text",isBold:!0},l)),o.React$1.createElement("div",null,o.React$1.createElement(a.Button$1,{className:"continuous-onboarding__complete-view__dismiss-btn",variant:"primary",onClick:()=>{i.logSidebarEmptyStateDismissed(),e()}},n)))};Z.displayName="CompletedView",Z.displayName="CompletedView";const Q=({children:e,className:t,cardBodyAccessibilityProps:s})=>{const i=a.cx({"module-card__body":!0,[t||""]:!!t});return o.React$1.createElement("div",Object.assign({className:i},s),e)};Q.displayName="ModuleCardBodyContainer",Q.displayName="ModuleCardBodyContainer";const X=({src:e,srcHiRes:t,alt:s})=>o.React$1.createElement(a.Image$1,{className:"module-card__image",alt:s,src:e,srcHiRes:t});X.displayName="ModuleCardImage",X.displayName="ModuleCardImage";const J=({description:e})=>o.React$1.createElement(a.Text,{className:"module-card__description",tagName:"p",color:"faint"},e);J.displayName="ModuleCardDescription",J.displayName="ModuleCardDescription";const ee={primary:"primary",secondary:"opacity",outline:"outline",other:"primary"},te=({primaryCtaStyle:e,onCtaClick:t,ctaText:s,onSkipClick:i,primaryButton:l,disabled:r})=>{const c=e?ee[e[".tag"]]:"primary",d=o.React$1.createElement(a.Button$1,{variant:c,onClick:t,disabled:r,className:"module-card__button-group__primary-cta"},s);return o.React$1.createElement("div",{className:"module-card__button-group"},l||d,i&&o.React$1.createElement(a.Button$1,{variant:"transparent",onClick:i,disabled:r,className:"module-card__button-group__skip-cta"},n.intl.formatMessage({id:"2iucH+",defaultMessage:"Skip"})))};te.displayName="ModuleCardButtonGroup",te.displayName="ModuleCardButtonGroup";const oe=e=>{const{description:t,imageUrl:a,imageUrlHiRes:s,imageAlt:i,onCtaClick:n,onSkipClick:l,ctaText:r,primaryCtaStyle:c,cardBodyAccessibilityProps:d,className:m,buttonsDisabled:u}=e;return o.React$1.createElement(Q,{cardBodyAccessibilityProps:d,className:m},a&&o.React$1.createElement(X,{alt:i,src:a,srcHiRes:s}),t&&o.React$1.createElement(J,{description:t}),n&&o.React$1.createElement(te,{primaryCtaStyle:c,onCtaClick:n,ctaText:r,onSkipClick:l,disabled:u}))};oe.displayName="ModuleCardBody",oe.displayName="ModuleCardBody";const ae=e=>{const{module:t,logger:a,isOpen:s}=e,{module_id:i,success_description:n,success_image_url:l,success_image_url_hi_res:r,success_image_alt:c}=t;return o.React$1.useEffect((()=>{s&&a.logModuleCompletedView(i)}),[a,i,s]),o.React$1.createElement(oe,{className:"module-card__completed-card-body",description:n,imageUrl:l,imageUrlHiRes:r,imageAlt:c,cardBodyAccessibilityProps:{"aria-hidden":!1,id:`content-${i}-complete`}})};ae.displayName="CompletedCardBody",ae.displayName="CompletedCardBody";const se=e=>{const{module:{module_id:t,module_index:s},milestone:{milestone_id:i,milestone_type_props:n},logger:l,markAsComplete:r,onSkipClick:c,cardBodyAccessibilityProps:d}=e,{does_cta_complete_milestone:m,description:u,image_url:p,image_url_hi_res:_,image_alt:g,cta_text:b,cta_href:y,button_style:S,open_in_new_tab:E}=n;return o.React$1.createElement(oe,{description:u,imageUrl:p,imageUrlHiRes:_,imageAlt:g,onCtaClick:()=>{l.logMilestoneCtaClick(t,i,{module_index:s}),m&&r({shouldOptimisticallyUpdate:!1}),E?a.open_tab(y):a.redirect(y)},onSkipClick:c,ctaText:b,primaryCtaStyle:S,cardBodyAccessibilityProps:d})};var ie;se.displayName="LinkTypeCardBody",se.displayName="LinkTypeCardBody",function(e){e.TEST_ACTION="other",e.SHARE_FOLDER="launch_file_share",e.UPLOAD_FILE="launch_file_uploader"}(ie||(ie={}));const ne={[ie.TEST_ACTION]:()=>l.__awaiter(void 0,void 0,void 0,(function*(){})),[ie.SHARE_FOLDER]:({userId:t})=>l.__awaiter(void 0,void 0,void 0,(function*(){const{asyncShowShareAFolderWizardModal:o}=yield new Promise((function(t,o){e(["./c_sharing_wizard_async_wizard_modals"],t,o)}));o(a.Viewer.get_viewer().get_user_by_id(t))})),[ie.UPLOAD_FILE]:({markAsComplete:t})=>l.__awaiter(void 0,void 0,void 0,(function*(){const{FileUploaderController:o}=yield new Promise((function(t,o){e(["./c_file_uploader_types"],t,o)})).then((function(e){return e.file_uploader_esnext}));o.handleUploadButtonClick({folderUpload:!1,onNextFileUploadComplete:()=>t(),actionElement:r.UploadElement.ACTION_BAR,actionScreen:"continuous_onboarding"})}))},le=e=>{const{module:{module_id:t,module_index:a},milestone:{milestone_id:s,milestone_type_props:i},logger:n,markAsComplete:l,onSkipClick:r,cardBodyAccessibilityProps:c,userId:d}=e,{does_cta_complete_milestone:m,description:u,image_url:p,image_url_hi_res:_,image_alt:g,cta_text:b,button_style:y,action:S}=i;return o.React$1.createElement(oe,{description:u,imageUrl:p,imageUrlHiRes:_,imageAlt:g,onCtaClick:()=>{n.logMilestoneCtaClick(t,s,{module_index:a}),m&&l();const e=ne[S[".tag"]];e&&e({userId:d,markAsComplete:l})},onSkipClick:r,ctaText:b,primaryCtaStyle:y,cardBodyAccessibilityProps:c})};var re,ce;le.displayName="ActionTypeCardBody",le.displayName="ActionTypeCardBody",function(e){e.SMS="sms",e.EMAIL="email"}(re||(re={})),function(e){e.SUCCESS="success",e.INVALID="invalid",e.FAIL="fail"}(ce||(ce={}));class de{constructor(){}log(e,t={}){const o=this.project;o&&a.ProEventsLogger.log(`growth_continuous_onboarding_${e}`,Object.assign(Object.assign({},t),{project:o}),void 0,!1,o)}setProject(e){this.project=e}logSidebarViewed(){this.log("viewed")}logSidebarManuallyExpanded(){this.log("sidebar_manually_expanded")}logSidebarManuallyCollapsed(){this.log("sidebar_manually_collapsed")}logSidebarAutoExpanded(){this.log("sidebar_auto_expanded")}logSidebarAutoCollapsed(){this.log("sidebar_auto_collapsed")}logSidebarEmptyStateViewed(){this.log("completed_viewed")}logSidebarEmptyStateDismissed(){this.log("completed_dismissed")}logSidebarNonEmptyStateDismissed(){this.log("uncompleted_dismissed")}logMilestoneViewed(e,t,o){this.log("milestone_viewed",{module:e,milestone:t,module_index:o})}logModuleSkipped(e,t,o){this.log("module_skip_clicked",{module:e,milestone:t,module_index:o})}logMilestoneCtaClick(e,t,o={}){this.log("milestone_cta_clicked",Object.assign(Object.assign({},o),{module:e,milestone:t}))}logMobileLinkSubmitStatus(e,t,o,a){this.log(`mobile_link_send_${a}`,{module:e,milestone:t,message_type:o})}logMobileLinkSwitchForm(e,t,o){this.log("mobile_link_switch_form",{module:e,milestone:t,new_message_type:o})}logModuleCompletedView(e){this.log("module_complete_viewed",{module:e})}logModuleCompletedDismissed(e){this.log("module_complete_dismissed",{module:e})}logBoltNotification(e){this.log("bolt_notification_received",{channel_name:e})}logDeepLinkFailureNoApp(e,t){this.log("deep_link_failure_no_app",{module:e,milestone:t})}logDeepLinkFailureOther(e,t){this.log("deep_link_failure_other",{module:e,milestone:t})}logDeepLinkFailureCtaClick(e,t){this.log("deep_link_failure_cta_click",{module:e,milestone:t})}logModalView(e,t){this.log("modal_view",{module:e,milestone:t})}logModalCtaClick(e,t){this.log("modal_cta_click",{module:e,milestone:t})}logModalCancelClick(e,t){this.log("modal_cancel_click",{module:e,milestone:t})}logTrialStartSuccess(e,t){this.log("trial_start_success",{module:e,milestone:t})}logTrialStartError(e,t,o){this.log("trial_start_error",{module:e,milestone:t,reason:o})}logTimeToApiResponse(){const e=a.time_since_start();if(!e)return;const t=a.get_pathname();let o="other";0===t.indexOf("/home")||0===t.indexOf("/personal")?o="browse":"/h"===t&&(o="home");m.getMetricsReporter().createStats({ns:"continuous_onboarding",name:"time_to_api_response"},{progression:this.project||"",route:o}).recordDuration(e,u.TimeUnit.MILLISECONDS)}}const me=e=>{const{module:{module_id:t,module_index:a},milestone:{milestone_id:s,milestone_type_props:i},implementationData:l,onSkipClick:r,cardBodyAccessibilityProps:c,logger:m}=e,{description:u,email_success_description:p,sms_success_description:_,email_success_text:g,sms_success_text:b,email_input_field_placeholder:y,sms_input_field_placeholder:S,email_input_invalid_error_text:E,sms_input_invalid_error_text:C,send_email_cta_text:h,send_sms_cta_text:R,resend_email_cta_text:k,resend_sms_cta_text:M,send_button_style:f,resend_button_style:A,default_delivery_method:O}=i,I="sms"===O[".tag"],[N,$]=o.React$1.useState(!1),[T,v]=o.React$1.useState(I?d.SendAppLinkFormType.SMS:d.SendAppLinkFormType.EMAIL),[B,x]=o.React$1.useState(""),[w,L]=o.React$1.useState(""),D={onSkipClick:r,hasPrimaryCtaStyle:N?"primary"===A[".tag"]:"primary"===f[".tag"],send_email_cta_text:N?k:h,send_sms_cta_text:N?M:R},j=B||u;return o.React$1.createElement(Q,{className:"module-card__mobile-link",cardBodyAccessibilityProps:c},j&&o.React$1.createElement(J,{description:j}),o.React$1.createElement(d.SendAppLinkForm,{formTypes:I?[d.SendAppLinkFormType.SMS,d.SendAppLinkFormType.EMAIL]:[d.SendAppLinkFormType.EMAIL,d.SendAppLinkFormType.SMS],buttonPosition:d.SendAppLinkButtonPosition.BOTTOM,phoneInputData:l.phone_input_data,SubmitButton:ue(D),onStatusChange:({sendStatus:e,currentFormType:o})=>{switch(e){case d.SendStatus.SUCCESS:$(!0),L(o===d.SendAppLinkFormType.SMS?b:g),x(o===d.SendAppLinkFormType.SMS?_:p),m.logMobileLinkSubmitStatus(t,s,o===d.SendAppLinkFormType.SMS?re.SMS:re.EMAIL,ce.SUCCESS);break;case d.SendStatus.INVALID:L(o===d.SendAppLinkFormType.SMS?C:E),m.logMobileLinkSubmitStatus(t,s,o===d.SendAppLinkFormType.SMS?re.SMS:re.EMAIL,ce.INVALID);break;case d.SendStatus.FAILURE:L(n.intl.formatMessage({id:"8NCBLs",defaultMessage:"There was an error sending your link"})),m.logMobileLinkSubmitStatus(t,s,o===d.SendAppLinkFormType.SMS?re.SMS:re.EMAIL,ce.FAIL);break;default:L("")}},onSwitchFormType:e=>{v(e),m.logMobileLinkSwitchForm(t,s,e===d.SendAppLinkFormType.SMS?re.SMS:re.EMAIL)},onSubmit:()=>{m.logMilestoneCtaClick(t,s,{message_type:T===d.SendAppLinkFormType.SMS?re.SMS:re.EMAIL,module_index:a})},inputHelperText:w,isFullWidth:!0,showDisclaimer:!0,formLayout:d.SendAppLinkFormLayout.SUBMIT_ON_BOTTOM,smsInputPlaceholder:S,emailInputPlaceholder:y}))};me.displayName="MobileLinkTypeCardBody",me.displayName="MobileLinkTypeCardBody";const ue=c.memoize((({onSkipClick:e,hasPrimaryCtaStyle:t,send_sms_cta_text:s,send_email_cta_text:i})=>({sendStatus:l,currentFormType:r})=>{const c={default:s,[d.SendStatus.SENDING]:n.intl.formatMessage({id:"nCZAww",defaultMessage:"Sending..."}),[d.SendStatus.SUCCESS]:s,[d.SendStatus.INVALID]:s,[d.SendStatus.FAILURE]:s},m={default:i,[d.SendStatus.SENDING]:n.intl.formatMessage({id:"nCZAww",defaultMessage:"Sending..."}),[d.SendStatus.SUCCESS]:i,[d.SendStatus.INVALID]:i,[d.SendStatus.FAILURE]:i},u=r===d.SendAppLinkFormType.SMS?c:m,p=l?u[l]:u.default,_=l===d.SendStatus.SENDING,g=o.React$1.createElement(a.Button$1,{className:"module-card__button-group__primary-cta",variant:t?"primary":"opacity",disabled:_,type:"submit"},p);return o.React$1.createElement(te,{onSkipClick:e,primaryButton:g,disabled:_})})),pe=e=>{const{module:{module_id:t,module_index:s},milestone:{milestone_id:i,milestone_type_props:n},onSkipClick:l,markAsComplete:c,cardBodyAccessibilityProps:d,logger:m}=e,{image_url:u,image_url_hi_res:p,image_alt:_,description:g,cta_text:b,upload_files_button_copy:y,upload_folder_button_copy:S}=n,E=o.React$1.createElement(a.Menu.Wrapper,{onSelection:e=>{var o;o="folder"===e,r.FileUploaderController.handleUploadButtonClick({folderUpload:o,onNextFileUploadComplete:()=>c(),actionElement:r.UploadElement.ACTION_BAR,actionScreen:"continuous_onboarding"}),m.logMilestoneCtaClick(t,i,{upload_type:e,module_index:s})}},(({getTriggerProps:e,getContentProps:t})=>o.React$1.createElement(o.React$1.Fragment,null,o.React$1.createElement(a.Button$1,Object.assign({variant:"primary",className:"module-card__button-group__primary-cta",withDropdownIcon:!0},e()),b),o.React$1.createElement(a.Menu.Content,Object.assign({},t()),o.React$1.createElement(a.Menu.Segment,null,o.React$1.createElement(a.Menu.ActionItem,{value:"file"},y),o.React$1.createElement(a.Menu.ActionItem,{value:"folder"},S))))));return o.React$1.createElement(Q,{className:"module-card__upload-files",cardBodyAccessibilityProps:d},u&&o.React$1.createElement(X,{alt:_,src:u,srcHiRes:p}),g&&o.React$1.createElement(J,{description:g}),o.React$1.createElement(te,{primaryButton:E,onSkipClick:l}))};pe.displayName="UploadContentTypeCardBody",pe.displayName="UploadContentTypeCardBody";const _e=e=>{if("dropbox_client"===e[".tag"])return"dropbox-client";throw new Error(`Unknown deep link scheme: ${e[".tag"]}`)},ge=e=>{const{module:{module_id:t,module_index:s},milestone:{milestone_id:i,milestone_type_props:n},logger:l,markAsComplete:r,onSkipClick:c,cardBodyAccessibilityProps:d}=e,[m,u]=o.React$1.useState(!1),[_,g]=function(e=1e3){const[t,a]=o.React$1.useState(!1),[s,i]=o.React$1.useState();return o.React$1.useEffect((()=>()=>{s&&clearTimeout(s)}),[]),[t,()=>{a(!0),i(setTimeout((()=>a(!1)),e))}]}(1e3),[b,y]=o.React$1.useState(0),{scheme:S,path:E,does_cta_complete_milestone:C,description:h,image_url:R,image_url_hi_res:k,image_alt:M,cta_text:f,button_style:A,deep_link_failure_cta_href:O,deep_link_failure_cta_text:I,deep_link_failure_description:N,deep_link_failure_image_url:$,deep_link_failure_image_url_hi_res:T,deep_link_failure_image_alt:v,deep_link_failure_button_style:B}=n,x=m?{description:N,imageUrl:$,imageUrlHiRes:T,imageAlt:v,ctaText:I,primaryCtaStyle:B}:{description:h,imageUrl:R,imageUrlHiRes:k,imageAlt:M,ctaText:f,primaryCtaStyle:A};return o.React$1.createElement(oe,Object.assign({},x,{onCtaClick:()=>{if(g(),m)l.logDeepLinkFailureCtaClick(t,i),a.redirect(O);else{l.logMilestoneCtaClick(t,i,{module_index:s}),p.launchUri(((e,t)=>new o.URI({scheme:_e(e),path:`//${t}`}).toString())(S,E)).then((()=>{C&&r()})).catch((()=>{l.logDeepLinkFailureNoApp(t,i),u(!0)}));const e=b+1;e>=2&&(l.logDeepLinkFailureOther(t,i),u(!0)),y(e)}},onSkipClick:c,buttonsDisabled:_,cardBodyAccessibilityProps:d}))};ge.displayName="ClientDeepLinkTypeCardBody",ge.displayName="ClientDeepLinkTypeCardBody";const be=({children:e,open:t,onRequestClose:s,imageProps:{imageSrc:i,imageSrcHiRes:n,imageAlt:l}})=>o.React$1.createElement(a.Modal$1,{className:"continuous-onboarding-modal",open:t,width:"large",isCentered:!0,onRequestClose:s},o.React$1.createElement("div",{className:"continuous-onboarding-modal__container"},o.React$1.createElement("div",{className:"continuous-onboarding-modal__content-pane"},e),o.React$1.createElement("div",{className:"continuous-onboarding-modal__image-pane"},o.React$1.createElement(a.Image$1,{className:"continuous-onboarding-modal__image-pane__image",alt:l,src:i,srcHiRes:n}))));be.displayName="SplitPaneModal",be.displayName="SplitPaneModal";const ye=({preButtonText:e,isLoading:t,isError:s,onSubmit:i,onCancelClick:l,primaryCtaText:r})=>{const c=a.cx({"continuous-onboarding-modal__footer__error-text":s});return o.React$1.createElement(a.Modal$1.Footer,{className:"continuous-onboarding-modal__footer"},e&&o.React$1.createElement(a.Text,{size:"small",isBold:!0,className:c},e),o.React$1.createElement("div",{className:"continuous-onboarding-modal__footer__button-group"},o.React$1.createElement(a.Button$1,{className:"continuous-onboarding-modal__cancel",variant:"opacity",onClick:l,disabled:t},n.intl.formatMessage({id:"YALbcv",defaultMessage:"Cancel"})),o.React$1.createElement(a.Button$1,{className:"continuous-onboarding-modal__submit",variant:"primary",onClick:i,isLoading:t,disabled:s},r)))};ye.displayName="SplitPaneModalFooter",ye.displayName="SplitPaneModalFooter";const Se=({children:e})=>o.React$1.createElement("ul",{className:"continuous-onboarding-modal__feature-list"},e);Se.displayName="IconBulletList",Se.displayName="IconBulletList";const Ee=({text:e,iconSrc:t})=>o.React$1.createElement("li",{className:"continuous-onboarding-modal__icon-bullet"},o.React$1.createElement(a.UIIcon,{className:"continuous-onboarding-modal__icon-bullet__icon",src:t}),o.React$1.createElement(a.Text,{className:"continuous-onboarding-modal__icon-bullet__text"},e));Ee.displayName="IconBulletListItem",Ee.displayName="IconBulletListItem";const Ce=e=>o.React$1.createElement("b",{key:0},e),he=({userId:e,modalOpen:t,closeModal:s,markAsComplete:i,logger:l,moduleId:r,milestoneId:c})=>{o.React$1.useEffect((()=>{a.Modal$1.setAppElement(document.getElementById("embedded-app")||document.body)}),[]),((e,t,a,s)=>{o.React$1.useEffect((()=>{e&&t.logModalView(a,s)}),[e,t,a,s])})(t,l,r,c);const[d,m]=o.React$1.useState(!1),[u,p]=o.React$1.useState(!1),g=()=>{d||(l.logModalCancelClick(r,c),s())},{title:b,bulletOne:y,bulletTwo:S,bulletThree:E,splitPaneImageAlt:C,preButtonText:h,primaryCtaText:R,errorText:k}={title:n.intl.formatMessage({id:"9XdwOI",defaultMessage:"Try Dropbox Plus for passwords and more"}),bulletOne:n.intl.formatMessage({id:"rcbdKo",defaultMessage:"<bold>Sync your passwords</bold> and access them across devices"},{bold:Ce}),bulletTwo:n.intl.formatMessage({id:"b3FNKE",defaultMessage:"<bold>Sign into websites instantly</bold> with the browser extension"},{bold:Ce}),bulletThree:n.intl.formatMessage({id:"96hRce",defaultMessage:"<bold>Keep passwords encrypted</bold> to protect against hacks"},{bold:Ce}),primaryCtaText:n.intl.formatMessage({id:"qMMLEM",defaultMessage:"Get the app"}),preButtonText:n.intl.formatMessage({id:"I6hPTR",defaultMessage:"Get the Passwords app and start your 14-day trial"}),splitPaneImageAlt:n.intl.formatMessage({id:"sLvLeQ",defaultMessage:"Someone saves and syncs their Facebook account credentials across devices using Dropbox Passwords."}),errorText:n.intl.formatMessage({id:"Qry3+4",defaultMessage:"Unable to start your free trial"})},M={imageSrc:o.static_url("/static/metaserver/static/images/continuous_onboarding/passwords_sync_across_devices_desktop_1x-vflNY03Lm.gif"),imageSrcHiRes:o.static_url("/static/metaserver/static/images/continuous_onboarding/passwords_sync_across_devices_desktop_2x-vflxgvTNT.gif"),imageAlt:C};return o.React$1.createElement(be,{open:t,onRequestClose:g,imageProps:M},o.React$1.createElement(a.Modal$1.Header,{hasBottomSpacing:"title-standard"},o.React$1.createElement(a.Title,null,b)),o.React$1.createElement(a.Modal$1.Body,null,o.React$1.createElement(Se,null,o.React$1.createElement(Ee,{iconSrc:a.LockLine,text:y}),o.React$1.createElement(Ee,{iconSrc:a.PasswordsLine,text:S}),o.React$1.createElement(Ee,{iconSrc:a.ShieldLine,text:E}))),o.React$1.createElement(ye,{preButtonText:u?k:h,primaryCtaText:R,onCancelClick:g,onSubmit:()=>{m(!0),l.logModalCtaClick(r,c);(new a.UserApiV2Client).ns("growth").rpc("plus_npt_start",{trial_project_type:_.ProjectType.NCCT_PLUS_TRIALS},{subjectUserId:e}).then((()=>{l.logTrialStartSuccess(r,c),a.redirect("/getpasswords"),i({shouldOptimisticallyUpdate:!1}),setTimeout((()=>{a.reload()}),500)})).catch((e=>{l.logTrialStartError(r,c,e.summary),m(!1),p(!0)}))},isLoading:d,isError:u}))};he.displayName="PasswordsNptModal",he.displayName="PasswordsNptModal";const Re=e=>{const{module:{module_id:t,module_index:a},milestone:{milestone_id:s,milestone_type_props:i},logger:n,markAsComplete:l,onSkipClick:r,cardBodyAccessibilityProps:c,userId:d}=e,{does_cta_complete_milestone:m,description:u,image_url:p,image_url_hi_res:_,image_alt:g,cta_text:b,button_style:y,modal:S}=i,[E,C]=o.React$1.useState(!1),h=(e=>{if("passwords_npt"===e[".tag"])return he;throw new Error("Unknown modal type")})(S);return o.React$1.createElement(o.React$1.Fragment,null,o.React$1.createElement(oe,{description:u,imageUrl:p,imageUrlHiRes:_,imageAlt:g,onCtaClick:()=>{n.logMilestoneCtaClick(t,s,{module_index:a}),m&&l(),C(!0)},onSkipClick:r,ctaText:b,primaryCtaStyle:y,cardBodyAccessibilityProps:c}),o.React$1.createElement(h,{userId:d,modalOpen:E,closeModal:()=>C(!1),markAsComplete:l,logger:n,moduleId:t,milestoneId:s}))};Re.displayName="ModalTypeCardBodyComponent",Re.displayName="ModalTypeCardBody";const ke=a.requireCssWithComponent(Re,["/static/metaserver/static/css/growth/continuous_onboarding/continuous_onboarding_modal-vfl0BtDE9.css"]),Me=e=>{const{milestone:t,module:a,implementationData:s,isActive:i,markMilestoneAsComplete:n,skipModule:l,userId:r,cardBodyAccessibilityProps:c,logger:d,isOpen:m}=e,{module_id:u,module_index:p,milestone_keys_allowing_module_skipping:_}=a,{milestone_id:g,milestone_key:b,milestone_type_props:y}=t;o.React$1.useEffect((()=>{i&&g&&m&&d.logMilestoneViewed(u,g,p)}),[i,g,d,u,p,m]);const S=_.includes(b)?()=>{d.logModuleSkipped(u,g,p),l()}:void 0,E=({shouldOptimisticallyUpdate:e=!0}={})=>{n(g,b,e)};if((e=>"link"===e[".tag"])(y))return o.React$1.createElement(se,{milestone:t,module:a,cardBodyAccessibilityProps:c,markAsComplete:E,onSkipClick:S,logger:d});if((e=>"action"===e[".tag"])(y))return o.React$1.createElement(le,{milestone:t,module:a,cardBodyAccessibilityProps:c,markAsComplete:E,onSkipClick:S,logger:d,userId:r});if((e=>"mobile_link"===e[".tag"])(y))return o.React$1.createElement(me,{milestone:t,module:a,implementationData:s,cardBodyAccessibilityProps:c,onSkipClick:S,logger:d});if((e=>"upload_content"===e[".tag"])(y))return o.React$1.createElement(pe,{milestone:t,module:a,cardBodyAccessibilityProps:c,markAsComplete:E,onSkipClick:S,logger:d});if((e=>"client_deep_link"===e[".tag"])(y))return o.React$1.createElement(ge,{milestone:t,module:a,cardBodyAccessibilityProps:c,markAsComplete:E,onSkipClick:S,logger:d});if((e=>"modal"===e[".tag"])(y))return o.React$1.createElement(ke,{milestone:t,module:a,cardBodyAccessibilityProps:c,markAsComplete:E,onSkipClick:S,logger:d,userId:r});throw new Error(`Unknown milestone type: ${y[".tag"]}`)};Me.displayName="MilestoneCardBody",Me.displayName="MilestoneCardBody";const fe=e=>{const{module:t,implementationData:s,isActive:i,shouldImmediatelyExpandModule:l,setActive:r,markMilestoneAsComplete:c,skipModule:d,dismissCompletedModule:m,userId:u,logger:p,isOpen:_}=e,{module_id:g,next_incomplete_milestone:b,title:y,should_show:S}=t,E=!b;let C,h;if(void 0===b)C=o.React$1.createElement(ae,{module:t,dismissCompletedModule:m,logger:p,isOpen:_}),h=o.React$1.createElement(a.IconButton,{variant:"transparent",className:"module-card__heading__dismiss-btn",onClick:()=>{m(),p.logModuleCompletedDismissed(g)}},o.React$1.createElement(a.UIIcon,{src:a.CloseLine,"aria-label":n.intl.formatMessage({id:"ZXDoHc",defaultMessage:"Dismiss completed module"})}));else{const e={"aria-hidden":!i,id:`content-${b.milestone_id}`};C=o.React$1.createElement(Me,{milestone:b,module:t,implementationData:s,isActive:i,markMilestoneAsComplete:c,skipModule:d,userId:u,cardBodyAccessibilityProps:e,logger:p,isOpen:_}),h=o.React$1.createElement(a.IconButton,{id:`module-card-accordion-btn-${g}`,variant:"transparent",className:"module-card__heading__accordion-btn",onClick:()=>r(!i),"aria-controls":e.id,"aria-expanded":i,"aria-labelledby":`module-card-heading-${g}`},o.React$1.createElement(a.UIIcon,{src:i?a.ChevronUpLine:a.ChevronDownLine,"aria-label":i?n.intl.formatMessage({id:"DAPFIt",defaultMessage:"Collapse module"}):n.intl.formatMessage({id:"nOS+/t",defaultMessage:"Expand module"})}))}const R=a.cx({"module-card":!0,[`module-card__${g}`]:!0,"module-card--isActive":E||i,"module-card--isActive--immediatelyExpand":l,"module-card--isHidden":!S});return o.React$1.createElement("li",{className:R,"aria-hidden":!S},o.React$1.createElement("div",{className:"module-card__heading"},o.React$1.createElement("div",{className:"module-card__heading__title-container"},o.React$1.createElement(a.Text,{id:`module-card-heading-${g}`,className:"module-card__heading__title-text",tagName:"h3",isBold:!0},y)),h),C)};fe.displayName="ModuleCardNoCss",fe.displayName="ModuleCard";const Ae=a.requireCssWithComponent(fe,["/static/metaserver/static/css/growth/continuous_onboarding/module_card-vflhO8I1R.css"]),Oe=({userId:e,dispatch:t,modules:s,implementationData:i,activeModuleId:n,logger:l,isOpen:r})=>{const c=function(e){const t=o.React$1.useRef();return o.React$1.useEffect((()=>{t.current=e})),t.current}(n),{isScrolled:d,handleScroll:m}=(()=>{const[e,t]=o.React$1.useState(!1);return{isScrolled:e,handleScroll:e=>{t(e.currentTarget.scrollTop>0)}}})(),u=a.cx({"continuous-onboarding__card-container":!0,"continuous-onboarding__card-container--is-scrolled":d});return o.React$1.createElement("ul",{className:u,onScroll:m},s.map((s=>{const d=s.module_id===n;return o.React$1.createElement(Ae,{key:s.module_id,userId:e,module:s,implementationData:i,isActive:d,shouldImmediatelyExpandModule:d&&null===c,setActive:e=>t({type:V.SET_ACTIVE_MODULE,activeModuleId:e?s.module_id:null}),markMilestoneAsComplete:(o,s,i=!0)=>{a.markModuleAsCompleted(e,o),i&&t({type:V.SET_MILESTONE_COMPLETE,milestoneKey:s})},skipModule:()=>{a.markModuleAsCompleted(e,s.skip_string),t({type:V.HIDE_MODULE,module_id:s.module_id})},dismissCompletedModule:()=>{a.markModuleAsCompleted(e,s.dismiss_string),t({type:V.HIDE_MODULE,module_id:s.module_id})},logger:l,isOpen:r})})))};Oe.displayName="ModuleCardList",Oe.displayName="ModuleCardList";const Ie=o.React$1.forwardRef((({isOpen:e,title:t,handleOpen:s},i)=>{const l=n.intl.formatMessage({id:"xIG5bM",defaultMessage:"Open sidebar ({title})"},{title:t});return o.React$1.createElement("button",{className:"continuous-onboarding__open-btn","aria-label":l,"aria-hidden":e,id:"continuous-onboarding-expand-btn",onClick:s,"aria-expanded":!1,"aria-controls":"continuous-onboarding-container",ref:i},o.React$1.createElement("div",{className:"continuous-onboarding__open-btn__container"},o.React$1.createElement(a.Title,{className:"continuous-onboarding__open-btn__text",size:"small",isBold:!0},t),o.React$1.createElement(a.UIIcon,{className:"continuous-onboarding__open-btn__icon",src:a.ExpandLeftLine,"aria-hidden":!0})))}));Ie.displayName="SidebarExpandBar",Ie.displayName="SidebarExpandBar";const Ne=o.React$1.forwardRef((({title:e,handleCollapse:t},s)=>o.React$1.createElement("div",{className:"continuous-onboarding__heading"},o.React$1.createElement(a.Title,{className:"continuous-onboarding__heading__text",size:"small",isBold:!0},e),t&&o.React$1.createElement(a.IconButton,{id:"continuous-onboarding-collapse-btn",variant:"transparent",className:"continuous-onboarding__heading__collapse-btn",onClick:t,"aria-expanded":!0,"aria-controls":"continuous-onboarding-container",ref:s},o.React$1.createElement(a.UIIcon,{src:a.CloseLine,"aria-label":n.intl.formatMessage({id:"HI573A",defaultMessage:"Collapse sidebar"})})))));Ne.displayName="SidebarHeader",Ne.displayName="SidebarHeader";class $e extends o.React$1.PureComponent{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){this.props.onExpandChange&&this.props.onExpandChange(!1),s.reportException({err:e,severity:g.SEVERITY.CRITICAL,tags:["continuous_onboarding_web"],exc_extra:{component_stacktrace:t&&t.componentStack}})}render(){return this.state.hasError?null:o.React$1.createElement(ve,Object.assign({},this.props))}}$e.displayName="ContinuousOnboardingErrorBoundary";const Te="basic_plan_reonboarding_user_progression",ve=o.React$1.memo((({userId:e,isBackgroundActive:t,onExpandChange:s})=>{const n=o.React$1.useRef(new de).current,l=o.reactExports.useRef(null),r=o.reactExports.useRef(null),c=o.reactExports.useRef(!1),d=o.reactExports.useRef(!1),[m,u]=o.React$1.useReducer(W,G),{isOpen:p,activeModuleId:_,showOpenButtonWhenCollapsed:g,progression:b,display_surface_props:y,showCompletedState:S}=m;if(((e,t,a,s)=>{const[n,l]=o.React$1.useState(null);o.React$1.useEffect((()=>{i.is_supported_mobile_browser()||K(a,(({progression:o,display_surface_props:s,bolt_channel_states:i})=>{if("basic_welcome_user_progression"===(null==o?void 0:o.progression_id))return;if(!o||!o.module_ids.length)return;const n=s;F(o,a);const r=z(e,t,a,i);if(t({type:V.SET_SIDEBAR,progression:o,display_surface_props:n,bolt_channel_states:i}),e.setProject(o.progression_id),e.logTimeToApiResponse(),n.open_on_load&&o.module_ids.length){const e=setTimeout((()=>{t({type:V.OPEN_SIDEBAR}),l(null)}),500);l(e)}return()=>{r&&r.unsubscribe()}}))}),[]),o.React$1.useEffect((()=>{n&&s&&(t({type:V.FORCE_CLOSE}),clearTimeout(n),l(null))}),[s,n])})(n,u,e,t),((e,t,a)=>{o.React$1.useEffect((()=>{if(void 0!==a){let o;a?(o=V.FORCE_CLOSE,e.logSidebarAutoCollapsed()):(o=V.REOPEN_IF_CLOSED_BY_ACTIVE_BACKGROUND,e.logSidebarAutoExpanded()),t({type:o})}}),[a])})(n,u,t),((e,t,a)=>{Y(e,"logSidebarViewed",t),o.React$1.useEffect((()=>{a&&a(t)}),[t,a])})(n,p,s),!y||!b)return null;const E=(e=>{const{module_ids:t,module_map:o,milestone_map:a}=e,s=t.map(((e,t)=>Object.assign(Object.assign({},o[e]),{milestones:[],module_index:t})));return s.forEach((e=>{e.milestones=e.milestone_keys.map((e=>a[e])),e.next_incomplete_milestone=(e=>{for(let t=e.length-1;t>=0;t--)if(e[t].is_completed)return e[t+1];return e[0]})(e.milestones)})),s})(b),C=!p&&!g,h=(null==b?void 0:b.progression_id)===Te;return o.React$1.createElement("aside",{className:a.cx({"continuous-onboarding":!0,"continuous-onboarding--open":p}),"aria-hidden":C,onTransitionEnd:()=>{if(d.current||c.current)return d.current?(d.current=!1,void(l.current&&l.current.focus())):void(c.current&&(c.current=!1,r.current&&r.current.focus()))}},g&&o.React$1.createElement(Ie,{isOpen:p,title:y.collapsed_title,handleOpen:()=>{n.logSidebarManuallyExpanded(),a.setUserMetadata({CONTINUOUS_ONBOARDING_IS_COLLAPSED:!1},e),u({type:V.OPEN_SIDEBAR}),d.current=!0},ref:r}),o.React$1.createElement("div",{id:"continuous-onboarding-container",className:"continuous-onboarding__container","aria-hidden":!p},o.React$1.createElement(Ne,{title:y.expanded_title,handleCollapse:S?void 0:()=>{n.logSidebarManuallyCollapsed(),a.setUserMetadata({CONTINUOUS_ONBOARDING_IS_COLLAPSED:!0},e),u({type:V.CLOSE_SIDEBAR}),c.current=!0},ref:l}),o.React$1.createElement(Oe,{userId:e,modules:E,implementationData:b.implementation_data,dispatch:u,activeModuleId:_,logger:n,isOpen:p}),!S&&h&&o.React$1.createElement("div",{className:"continuous-onboarding__dismiss-button"},o.React$1.createElement(a.Button$1,{variant:"transparent",onClick:()=>{n.logSidebarNonEmptyStateDismissed(),function(e){const t=U.DISMISS_BTN;new P(e).track(t)}(e),u({type:V.HIDE_SIDEBAR})}},y.empty_state_props.dismiss_button_text)),o.React$1.createElement(Z,{isSidebarComplete:S,handleHideSidebar:()=>u({type:V.HIDE_SIDEBAR}),emptyStateProps:y.empty_state_props,logger:n})))}));ve.displayName="ContinuousOnboardingNoCss",ve.displayName="ContinuousOnboarding";const Be=a.requireCssWithComponent($e,["/static/metaserver/static/css/growth/continuous_onboarding/continuous_onboarding-vfld6LLGP.css"]);t.ContinuousOnboarding=Be,t.ContinuousOnboardingErrorBoundary=$e,t.ContinuousOnboardingNoCss=ve,t.REONBARDING_PROGRESSION_ID=Te}));
//# sourceMappingURL=c_continuous_onboarding.js-vfl7GPIRr.map
