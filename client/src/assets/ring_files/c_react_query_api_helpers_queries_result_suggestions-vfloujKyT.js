define(["exports","./e_ui_page_files_router","./c_react_query_api_helpers_queries_search_experiments","./e_core_exception","./c_core_exception_info","./c_tslib","./e_edison"],(function(e,t,s,i,a,r,n){"use strict";const o=t.createApiv2Query({requestMethod:"assistant:get_assistance"}),u="files:get_query_suggestions",g=t.createDefaultApiv2QueryFn(u),c=t.createApiv2Query({requestMethod:u,getQueryKey:t.getApiv2QueryKey(u,(e=>{e.search_session_id="MASKED",e.typeahead_session_id="MASKED"})),queryFn:(...e)=>(...i)=>{var a;const[{apiArg:n},{reqCtx:o}]=e,u=null!==(a=n.query)&&void 0!==a?a:"";return s.reportExceptionIfRequestFails((()=>r.__awaiter(void 0,void 0,void 0,(function*(){var s,a,r;const n=performance.now(),c=yield g(...e)(...i),d=performance.now()-n,l=null!==(a=null===(s=c.apiData.query_suggestions)||void 0===s?void 0:s.length)&&void 0!==a?a:0,_=null!==(r=o.responseHeaders)&&void 0!==r?r:{},S=parseInt(_["x-server-response-time"],10),p=isNaN(S)?void 0:S;t.logQuerySuggestionsFetched(u,l,d);const v=p?d-p:void 0;return t.logQuerySuggestionsLatencyToAmp(d,p,v),c}))),["search_bar","search_bar_query_suggestions","search_react_query"],(()=>t.logQuerySuggestionsFailed(u)))}}),d="manual_tagging:tags/get_viewable_tags",l=t.createDefaultApiv2QueryFn(d),_=t.createApiv2Query({requestMethod:d,queryFn:(...e)=>(...t)=>s.reportExceptionIfRequestFails((()=>r.__awaiter(void 0,void 0,void 0,(function*(){return yield l(...e)(...t)}))),["search_bar","search_bar_tags_suggestions","search_react_query"])}),S="files:search_v2",p=t.createDefaultApiv2QueryFn(S),v=t.createApiv2Query({requestMethod:S,getQueryKey:t.getApiv2QueryKey(S,(e=>{e.session_id="MASKED",e.typeahead_session_id="MASKED",e.options&&(e.options.last_modified_date_range=void 0,e.options.media_filters&&(e.options.media_filters.date_taken=void 0),e.options.flexible_query=void 0)})),queryFn:(...e)=>(...i)=>{const[a,{reqCtx:n}]=e;return s.reportExceptionIfRequestFails((()=>r.__awaiter(void 0,void 0,void 0,(function*(){var s;const a=performance.now(),r=yield p(...e)(...i),o=performance.now()-a,u=r.apiData.matches.length,g=null!==(s=n.responseHeaders)&&void 0!==s?s:{},c=parseInt(g["x-server-response-time"],10),d=r.apiData.request_id?t.getRequestId(r.apiData.request_id):void 0,l=isNaN(c)?void 0:c,_=l?o-l:void 0;return t.logResultSuggestionsFetched(o,l,_,u,d),t.logResultSuggestionsLatencyToAmp(o,l,_),t.recordResultSuggestionLoadTime(o,"search_v2"),r}))),["search_bar","search_bar_result_suggestions","search_react_query"],(()=>t.logResultSuggestionsFailed()))}});e.formatQuerySuggestions=e=>e.map(s.convertQuerySuggestionResultToQuerySuggestion),e.formatQuerySuggestionsLoadingState=({isError:e,isLoading:s,isSuccess:i})=>e?t.QuerySuggestionsLoadingState.FAILED:s?t.QuerySuggestionsLoadingState.LOADING:i?t.QuerySuggestionsLoadingState.LOADED:void 0,e.formatRecentItemSuggestions=e=>e.slice(0,5).map(s.convertRecentItemToRecentItemSuggestion),e.formatRecentItemSuggestionsLoadingState=({isError:e,isLoading:s,isSuccess:i})=>e?t.RecentItemSuggestionsLoadingState.FAILED:s?t.RecentItemSuggestionsLoadingState.LOADING:i?t.RecentItemSuggestionsLoadingState.LOADED:void 0,e.formatResultSuggestion=(e,i)=>s.convertSearchResultToResultSuggestion(e,t.mustGetActiveUser(),i),e.formatResultSuggestionsLoadingState=({isError:e,isLoading:s,isSuccess:i})=>e?t.ResultSuggestionsLoadingState.FAILED:s?t.ResultSuggestionsLoadingState.LOADING:i?t.ResultSuggestionsLoadingState.LOADED:void 0,e.formatTagsSuggestions=e=>e.slice(0,3).map(s.convertTagToTagSuggestion),e.formatTagsSuggestionsLoadingState=({isError:e,isLoading:s,isSuccess:i})=>e?t.TagsSuggestionsLoadingState.FAILED:s?t.TagsSuggestionsLoadingState.LOADING:i?t.TagsSuggestionsLoadingState.LOADED:void 0,e.useQuerySuggestionsQueryBy=(e,s,i)=>{var a;const r={query:e,max_results:t.SEARCH_POSTERIOR_QUERY_SUGGESTIONS_CAPACITY,search_session_id:s,typeahead_session_id:i},[o,u]=n.reactExports.useState(r);n.reactExports.useEffect((()=>{if(JSON.stringify(r)!==JSON.stringify(o)){const e=setTimeout((()=>u(r)),t.SEARCH_QUERY_SUGGESTIONS_DEBOUNCE);return()=>clearTimeout(e)}}),[r]);const g=c.useQuery({apiArg:o},{enabled:!!o.query}),d=((null===(a=g.data)||void 0===a?void 0:a.apiData.query_suggestions)||[]).filter((t=>{var s;return(null===(s=t.text)||void 0===s?void 0:s.toLowerCase())!==e.toLowerCase()}));return[g,d]},e.useRecentItemsQuery=e=>{var r,n;const u=o.useQuery({apiArg:{request_params:{features:[{".tag":"recent"}],num_items:5,metadata_configs:{include_file_metadata:!0,include_paper_metadata:!0,include_user_info:!0,file_metadata_options:[{".tag":"with_url"},{".tag":"with_icon"},{".tag":"with_breadcrumb"}]}}}},{enabled:e});if(!e)return[u,[]];const g=null!==(n=null===(r=u.data)||void 0===r?void 0:r.apiData.results)&&void 0!==n?n:[];let c=[];const d=t.getActiveUser();return d?(c=g.map((e=>s.convertAssistantResultToRecentItem(e,d))).filter((e=>null!==e)),[u,c]):(i.reportException({err:new Error("User is undefined in useRecentItemsQuery"),severity:a.SEVERITY.NONCRITICAL,tags:["js:search"]}),[u,c])},e.useResultSuggestionsQueryBy=e=>{const i=t.searchSessionManager.getSearchSessionId({searchSessionExtensionType:"PASSIVE"}),a=Object.assign(Object.assign({},e),{searchSessionId:i,maxResults:t.MAX_SEARCH_RESULT_SUGGESTIONS_TO_FETCH,start:0,isDropdown:!0,isForResultSuggestions:!0,filenameOnly:!0,includeHighlights:!1,includeSnippets:!1,skipLogging:!0}),r=s.useSearchInputExperiments(),o={expSearchEnableMSOfficeThumbnails:r.expSearchEnableMSOfficeThumbnails,manualTaggingVariant:r.manualTaggingVariant,searchDocClassification:r.searchDocClassification},u=t.prepareSearchExperimentsData(a,o),g=t.prepareSearchApiRequestData(u),[c,d]=n.reactExports.useState(g);n.reactExports.useEffect((()=>{if(JSON.stringify(g)!==JSON.stringify(c)){const e=setTimeout((()=>d(g)),t.SEARCH_RESULT_SUGGESTIONS_DEBOUNCE);return()=>clearTimeout(e)}}),[g]);const l=v.useQuery({apiArg:c},{enabled:!!c.query}),_=l.data;if(!(null==_?void 0:_.apiData.request_id))return[l,[],void 0];const S=t.getRequestId(_.apiData.request_id);return[l,t.extractSearchV2ResultsList(_.apiData.matches,a.start,S),S]},e.useTagsSuggestionsQueryBy=(e,s)=>{var i,a,r;const n=_.useQuery({apiArg:void 0},{enabled:s});if(!s)return[n,[]];const o=null!==(r=null===(a=null===(i=n.data)||void 0===i?void 0:i.apiData.tag_and_counts)||void 0===a?void 0:a.map((e=>e.typed_tag)).filter(t.isUserGeneratedTag))&&void 0!==r?r:[];return[n,t.getTagsSuggestions(e,o).slice(0,3)]},e.useZeroStateTagsSuggestions=e=>{var s,i,a;const r=_.useQuery({apiArg:void 0},{enabled:e});if(!e)return[r,[]];return[r,(null!==(a=null===(i=null===(s=r.data)||void 0===s?void 0:s.apiData.tag_and_counts)||void 0===i?void 0:i.map((e=>e.typed_tag)).filter(t.isUserGeneratedTag))&&void 0!==a?a:[]).slice(0,5)]}}));
//# sourceMappingURL=c_react_query_api_helpers_queries_result_suggestions.js-vflfN_PMq.map
