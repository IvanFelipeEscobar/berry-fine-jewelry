define(["exports","./e_ui_page_files_router","./c_keymaster","./e_edison","./c_lodash-es_lodash","./c_core_browser_detection","metaserver/static/js/modules/constants/web_experience_constants"],(function(e,t,s,i,n,c,o){"use strict";const l="SelectableList",r="SelectableTileGrid";let a="";var h,d,S;function u(t,s,i,c,o,l){switch(t){case e.SelectDirection.PREV:return Math.max(0,s-1);case e.SelectDirection.NEXT:return Math.min(i-1,s+1);case e.SelectDirection.PREV_ROW:case e.SelectDirection.NEXT_ROW:return function(t,s,i,c,o,l=!1){if(s<0||s>=i)return 0;o&&0!==o.length||(o=[0]);const r=n.sortedIndex(o,s),a=o[r]===s?r:r-1,h=o[a],d=(s-h)%c;switch(t){case e.SelectDirection.NEXT_ROW:{const e=o.length;if(a===e-1&&s+c>=i){const e=(i-h)%c;if((s-h)%c<e||0===e)return l?i-1:s}const t=a+1,n=t<o.length?o[t]:i;if(s+c-(c-((n-h)%c||c))<n){const e=n-1;return Math.min(s+c,e)}const r=t+1<e?o[t+1]-1:i-1;return Math.min(n+d,r)}case e.SelectDirection.PREV_ROW:{if(0===a&&s-c<0)return l?0:s;if(s-c>=h)return s-c;const e=o[a-1],t=h-1,i=h-e,n=e+i-(i%c||c);return Math.min(n+d,t)}}}(t,s,i,c,o,l)}}e.SelectableListActionSource=void 0,(h=e.SelectableListActionSource||(e.SelectableListActionSource={})).KEYBOARD="keyboard",h.DRAG_TO_SELECT="drag_to_select",e.SelectDirection=void 0,(d=e.SelectDirection||(e.SelectDirection={}))[d.PREV=0]="PREV",d[d.NEXT=1]="NEXT",d[d.PREV_ROW=2]="PREV_ROW",d[d.NEXT_ROW=3]="NEXT_ROW",e.SelectOptions=void 0,(S=e.SelectOptions||(e.SelectOptions={})).DEFAULT="DEFAULT",S.EXTEND="EXTEND",S.ONLY="ONLY";class p extends i.React$1.PureComponent{constructor(s){super(s),this.isFocused=!1,this.updateSelection=(e,s,i=!1)=>{const{selection:n}=this.props,c=i?e.length?e[0]:this.props.itemIds[0]:n.anchor,o=n.merge({selected:t.immutableExports.OrderedSet(e),anchor:c});this.props.onSelectionChange(o,s)},this.handleSelectPrevious=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.selectNeighboringItem(e.SelectDirection.PREV,e.SelectableListActionSource.KEYBOARD))},this.handleSelectPreviousRow=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.selectNeighboringItem(e.SelectDirection.PREV_ROW,e.SelectableListActionSource.KEYBOARD))},this.handleExtendSelectionToPrevious=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.extendSelectionRange(e.SelectDirection.PREV,e.SelectableListActionSource.KEYBOARD))},this.handleExtendSelectionToPreviousRow=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.extendSelectionRange(e.SelectDirection.PREV_ROW,e.SelectableListActionSource.KEYBOARD))},this.handleSelectNext=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.selectNeighboringItem(e.SelectDirection.NEXT,e.SelectableListActionSource.KEYBOARD))},this.handleSelectNextRow=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.selectNeighboringItem(e.SelectDirection.NEXT_ROW,e.SelectableListActionSource.KEYBOARD))},this.handleExtendSelectionToNext=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.extendSelectionRange(e.SelectDirection.NEXT,e.SelectableListActionSource.KEYBOARD))},this.handleExtendSelectionToNextRow=t=>{this.isGlobalEvent(t)&&(t.preventDefault(),this.extendSelectionRange(e.SelectDirection.NEXT_ROW,e.SelectableListActionSource.KEYBOARD))},this.handleKeyboardDeselectAll=t=>{const{selection:s}=this.props;t&&!this.isGlobalEvent(t)||!s.selected.size||this.handleDeselectAll(e.SelectableListActionSource.KEYBOARD)},this.handleDeselectAll=e=>{if(this.updateSelection([],e,!0),i.reactDomExports.findDOMNode(this).contains(document.activeElement)){const e=document.activeElement;e.blur&&e.blur()}this.props.onDeselectAll&&this.props.onDeselectAll()},this.handleKeyboardSelectAll=t=>{const{itemIds:s,selection:i}=this.props;t&&!this.isGlobalEvent(t)||i.selected.size===s.length||this.handleSelectAll(e.SelectableListActionSource.KEYBOARD)},this.handleSelectAll=e=>{this.updateSelection(this.props.itemIds,e,!0)},this.handleDeselect=(e,t,s)=>{if(t)return this.extendOrShrinkSelectionByFile(e,s);this.updateSelectionById(e,"delete",s)},this.handleSelect=(t,s=e.SelectOptions.DEFAULT,i)=>{if(s===e.SelectOptions.EXTEND)return this.extendOrShrinkSelectionByFile(t);s===e.SelectOptions.ONLY?this.updateSelection([t],i,!0):this.updateSelectionById(t,"add",i)},this.handleFocusFile=e=>{this.setState({focusedFileId:e})},this.isSelectableListEvent=()=>this.isFocused,this.handleFocus=()=>{this.isFocused=!0},this.handleBlur=()=>{this.isFocused=!1},this.state={selection:s.selection,keyScope:s.keyScope}}UNSAFE_componentWillReceiveProps(e){this.props.keyScope!==e.keyScope&&(this.setState({keyScope:e.keyScope}),this.isFocused=!1)}componentDidMount(){this.setupKeyboardShortcuts(),this.setFocusedIdFromSelection(this.props.selection)}componentDidUpdate(e,t){e.selection&&this.props.selection&&e.selection.anchor!==this.props.selection.anchor&&this.setFocusedIdFromSelection(this.props.selection),this.state.keyScope!==t.keyScope&&this.setupKeyboardShortcuts(),e.isActive!==this.props.isActive&&(this.props.isActive?this.setupKeyboardShortcuts():this.cleanupKeyboardShortcuts())}componentWillUnmount(){this.cleanupKeyboardShortcuts()}setupKeyboardShortcuts(){const{keyScope:e}=this.state;a=s.key.getScope(),a!==e&&s.key.setScope(e);const t=s.key.filter||(e=>{const t=e.target||e.srcElement;if(!(t instanceof Element))return!0;const s=t.tagName;return!("INPUT"===s||"SELECT"===s||"TEXTAREA"===s)});s.key.filter=s=>{const i=s.target||s.srcElement,n=i.tagName;if(this.isSelectableListEvent()&&"BUTTON"===n){const t=["content-tile-container","star__toggle","more-options-button"];return!("ON"!==o.CONTENT_TILES||this.props.isSearchMode&&"ON"!==o.CONTENT_TILES_SEARCH||e!==r||!s.target||"object"!=typeof s.target||!(s.target instanceof Element)||"function"!=typeof s.target.getAttribute||!t.includes(s.target.getAttribute("data-testid")))}return i instanceof HTMLInputElement&&"checkbox"===i.type||t.call(this,s)},e===l?(s.key("up",e,this.handleSelectPrevious),s.key("shift+up",e,this.handleExtendSelectionToPrevious),s.key("down",e,this.handleSelectNext),s.key("shift+down",e,this.handleExtendSelectionToNext)):e===r&&(s.key("left",e,this.handleSelectPrevious),s.key("shift+left",e,this.handleExtendSelectionToPrevious),s.key("right",e,this.handleSelectNext),s.key("shift+right",e,this.handleExtendSelectionToNext),s.key("up",e,this.handleSelectPreviousRow),s.key("shift+up",e,this.handleExtendSelectionToPreviousRow),s.key("down",e,this.handleSelectNextRow),s.key("shift+down",e,this.handleExtendSelectionToNextRow)),s.key("escape",e,this.handleKeyboardDeselectAll),c.mac?s.key("command+a",e,this.handleKeyboardSelectAll):s.key("ctrl+a",e,this.handleKeyboardSelectAll)}cleanupKeyboardShortcuts(){s.key.clearScope(this.state.keyScope),a&&s.key.setScope(a),s.key.resetFilter()}setFocusedIdFromSelection(e){e.anchor&&0!==e.selected.size&&this.setState({focusedFileId:e.anchor})}selectNeighboringItem(e,t){const{itemIds:s,selection:i,tilesPerRow:n,sectionStartIndices:c}=this.props,o=s.indexOf(i.selected.last()),l=s[u(e,o,s.length,n,c)];this.setState({focusedFileId:l}),this.updateSelection([l],t,!0)}extendSelectionRange(t,s){const{itemIds:i,selection:n,tilesPerRow:c,sectionStartIndices:o}=this.props,l=n.anchor||i[0];if(!l)return;const r=i.indexOf(n.selected.last());let a=n.selected.toArray();const h=i.indexOf(l),{startIndex:d,endIndex:S}=this.getRangeOfSelectedBlock(l);a=function(t,s,i,n,c,o,l,r,a){switch(t){case e.SelectDirection.PREV:case e.SelectDirection.PREV_ROW:{if(0===s)return l;const e=u(t,s,r.length,i,a,!0),h=Math.min(s,n)-e,d=s-Math.max(e,n);for(let e=o;e>o-d;e--){const t=l.indexOf(r[e]);l.splice(t,1)}for(let e=c-1;e>=c-h;e--)l.push(r[e]);break}case e.SelectDirection.NEXT:case e.SelectDirection.NEXT_ROW:{if(s===r.length)return l;const e=u(t,s,r.length,i,a,!0),h=Math.min(e,n)-c,d=e-Math.max(s,n);for(let e=c;e<c+h;e++){const t=l.indexOf(r[e]);l.splice(t,1)}for(let e=o+1;e<=o+d;e++)l.push(r[e]);break}}return l}(t,r,c,h,d,S,a,i,o),this.setState({focusedFileId:a[a.length-1]}),this.updateSelection(a,s)}getRangeOfSelectedBlock(e){const{itemIds:t,selection:s}=this.props;let i=t.indexOf(e),n=0,c=0;for(;n=i,i--,!(i<0)&&s.selected.has(t[i]););for(i=n;;){const e=t[i];if(!e||!s.selected.has(e))break;c=i,i++}return{startIndex:n,endIndex:c}}extendOrShrinkSelectionByFile(e,t){const{itemIds:s,selection:i}=this.props,n=i.anchor||s[0];if(!n)return;const c=s.indexOf(n),o=s.indexOf(e),{startIndex:l,endIndex:r}=this.getRangeOfSelectedBlock(n),a=[],h=[];s.forEach(((e,t)=>{l<=t&&t<=r&&a.push(e),(o<=t&&t<=c||c<=t&&t<=o)&&h.push(e)})),o<c&&h.reverse();const d=i.update("selected",(e=>e.subtract(a).union(h)));this.setState({focusedFileId:e}),this.props.onSelectionChange(d,t)}updateSelectionById(e,t,s){const{selection:i}=this.props,n="add"===t?e:i.anchor,c=i.selected[t](e),o=i.merge({selected:c,anchor:n||null});this.props.onSelectionChange(o,s)}isGlobalEvent(e){const t=e.target instanceof HTMLInputElement,s=e.target instanceof HTMLElement,n=t&&"checkbox"===e.target.type,c=s&&(e.target.classList.contains("mc-popover-selectable-item")||e.target.classList.contains("mc-popover-content-item")||e.target.classList.contains("mc-popover-trigger"));return!document.activeElement||document.activeElement===document.body||e.target instanceof Element&&(i.reactDomExports.findDOMNode(this).contains(e.target)&&(!t||n)&&!c)}render(){const{children:e}=this.props,{focusedFileId:t}=this.state;if(!e)return null;let s=e;return"function"==typeof e&&(s=e({focusedFileId:t,updateSelection:this.updateSelection,handleDeselect:this.handleDeselect,handleDeselectAll:this.handleDeselectAll,handleFocusFile:this.handleFocusFile,handleSelect:this.handleSelect,handleSelectAll:this.handleSelectAll,isSelectableListEvent:this.isSelectableListEvent})),i.React$1.createElement("div",{className:"selectable-list",onBlur:this.handleBlur,onFocus:this.handleFocus},s)}}p.defaultProps={isActive:!0},p.displayName="SelectableList",e.SELECTABLE_LIST_KEY_SCOPE=l,e.SELECTABLE_TILE_GRID_KEY_SCOPE=r,e.SelectableList=p}));
//# sourceMappingURL=c_ui_selectable_list.js-vfl7uo-B6.map
