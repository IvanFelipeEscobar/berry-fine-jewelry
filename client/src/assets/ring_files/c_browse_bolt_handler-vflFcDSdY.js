define(["exports","./e_edison","./e_ui_page_files_router","./c_lodash-es_lodash","./e_core_exception","./c_browse","./c_data_action_creators_index","./c_tslib","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","./c_core_i18n","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/core/langpack","./c_core_exception_info","metaserver/static/js/modules/constants/request","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_core_xhr","./c_csrf","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","./c_bug_reporting_routing","./c_history","./c_ux_analytics_dispatch_custom_event","./c_pagelet_logger","./c_pagination_manager","./c_browse_actions","./c_files_view_file_actions_file_from_metadata","./c_file_actions_strings","./c_action_bar_file_actions_logging","./c_files_view_file_actions_snackbars","./c_sync_everything_hive_logger","./c_pap-events_previews_rename_file","./c_sharing_async_share_modal_util","./c_flows_utils_async_modal_launchers","metaserver/static/js/modules/constants/global_file_upload","./c_browse_file_actions_action_handlers","./c_views_copy_link_mini_modal","./c_share_modal_evolution_utils_logging","./c_src_utils_logging","./c_components_sharing_spinner","./c_truncate_index","./c_clipboard_v3","./c_sharing_ui_util","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","./c_sharing_settings_utils_sharing_settings_util","./c_udcl_index","./c_downloads","./c_extensions_cloud_docs_compat","./c_integrations_data_selectors","./c_share_download_ui_api","./c_browse_interface","./c_ui_async_overquota_modal_controller","./c_file_viewer_async_controller","./c_file_viewer_logging_performance","./c_cloud_docs_gdd_migration_gdd_ui_blocking","./c_plusplus_file_actions","./c_vault_constants","./c_file_viewer_file_extension_extension_constants","./c_gdd_migration_ui_utils","./c_profile_services_profile_services_link","./c_profile_services_profile_services_constants","metaserver/static/js/modules/constants/login_and_register","./c_file_imports_gdrive_file_picker","./c_components_modals_show_modal","./c_spectrum_modal_utility_modal","./c_spectrum_tertiary_link_tertiary_list","./c_icon_templates_actionable_index","./c_spectrum_svg_icon_bundle","./c_spectrum_icon_form_index","./c_icon_templates_stateless_index","./c_exenv_index","./c_ux_analytics_modal_tracking","./c_file_transfers_async_browse_entry_point_onboarding_modal_async","./c_starred_actions","./c_starred_constants","./c_starred_star","./c_common_uuid","./c_files_view_files_view_logging","./c_sharing_browse_exports","./c_unity_features","metaserver/static/js/modules/constants/unity","./c_file_store_utils","./c_file_transfers_lib_urls","./c_src_common_constants2","./c_browse_tts","./c_pap-events_navigation_navigate_to_edit","./c_file_uploader_upload_kit_provider","./c_browse_crypto_subtle_digest","./c_file_uploader_utils","./c_pap-events_enums_file_type-utils","./c_base64","./c_upload_kit_lib_types","./c_file_uploader_result_type","./c_file_uploader_actions_adapter","./c_data_store","./c_data_slice","./c_upload_kit_scheduler_types","./c_upload_kit_uploader_context","./c_upload_kit_utils_path","./c_upload_kit_uploader_upload_abort_controller","./c_resize-observer-polyfill_dist_ResizeObserver","./c_src_simple-action-bar_inline_action_bar","./c_src_simple-action-bar_action_bar_types","./c_src_highlighted-truncated-string_em-string","./c_action_bar_file_actions","./c_unity_check_file_cache","./c_action_bar_action_bar_strings","./c_flows_redux_store","./c_flows_redux_reducer","./c_flows_lib_api","./c_flows_logging_flows_loggers","./c_src_common_constants","./c_flows_constants","./c_flows_redux_selectors","./c_action_bar_action_bar_constants","./c_file_actions_portable_copy","./c_ui_fileops_actions","./c_file_actions_portable_select_destination","./c_hive_schemas_web-modal-activity","./c_flows_conversions_conversion_actions","./c_flows_conversions_convert","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments","./c_flows_utils_browse_logger","./c_flows_redux_actions","./c_workflow_builder_workflow_actions_action_ui_config","./c_form_row_index","./c_ui_tree_view","./c_icon_folder_icon","./c_components_spacer_index","./c_naming_conventions_utils","./c_tagging_components_tags_container","./c_components_item_truncation_container","./c_hooks_resize_observer","./c_tagging_components_tags_search","./c_typeahead_index","./c_modal_filters_view_tidy_filters","./c_folder_dialog_folder_picker_dig","./c_table_columns_file_name_column","./c_src_table","./c_react-table_index","./c_src_icons_file_icon","./c_src_icons_file_icon_extensions","./c_combinations_index","./c_spectrum_icon_arrow_index","./c_keymaster","./c_breadcrumb_index","./c_ui_hoc","./c_plugin_utils_tilingFunc","./c_plugin_utils_getImageDefaultSizes","./c_flows_flows_client","./c_spectrum_icon_partners_index","./c_icon_shortcuts_icon","./c_icon_file_icon","./c_ui_title_bubble","./c_ui_overlay","./c_raf_throttle","./c_growth_ui_teams_web_actions_logger_events","./c_sharing_wizard_async_wizard_modals","./c_file_actions_portable_move","./c_extensions_extensions_menu_component_v2","./c_spectrum_tooltip","./c_spectrum_positioned_portal","./c_extensions_extensions_utils","metaserver/static/js/modules/constants/payments","./c_account_email","./c_account_email_verify_reasons","./c_ui_modal_dig","./c_ui_input_dig","metaserver/static/js/modules/constants/reel","./c_components_approval-forms_url_utils","./c_components_approval-forms_gating_utils","./c_flows_approval_approval_io_client","./c_contacts_data_v2","./c_contacts_bloodhound","metaserver/static/js/modules/constants/contacts","./c_components_approval-forms_approval_checkbox_in_share","./c_pap-events_previews_select_share_menu","./c_extensions_split_share_button","./c_shallow_equal","./c_flows_approval_approval_request_modal","./c_components_saver_modal_index","./c_collections_utils_file_identifier","./c_collections_utils_thumbnails","./c_collections_lib_survey","./c_sync_everything_strings","./c_conversions_actions_unzip","./c_utils_contacts_tokenizer_contacts_tokenizer_util","./c_components_add-content-menu_index","./c_cloud_docs_create_api","./c_folder_dialog_async","./c_pap-events_navigation_select_create_menu","./c_capture_sdk_helpers","./c_capture_redux_selectors","./c_capture_async_recorder","./c_file_uploader_types","./c_flows_utils_exposure_logger","./c_components_loading_indicator","./c_sharing_share_modal_util","./c_pass_store","./c_core_types_preview_type","./c_file_viewer_utils","./c_core_logging_constants","./c_sharing_share_page_action_types","metaserver/static/js/modules/constants/python","./c_flux_base_store","./c_src_utils_clipboard","./c_hooks_lib_index","./c_components_icons_icon_dropdown_selected","./c_components_sharing_modal_banner","./c_es_src_dropbox","./c_sharing_ui_notifications_util","./c_deprecated_ajax_ajax_form_extract_errors","./c_sharing_confirmation_modals_reset_access_modal","./c_tabs_index","./c_sharing_content_manager","./c_spectrum_colorized_icon","./c_sharing_upsells_util","./c_ui_flag","./c_integrations_hellosign_deep_integration_constants","./c_docsend_analytics_add_on_data_apiUtils","./c_docsend_src_utils","./c_flux_store_listener","./c_ui_bubble_dropdown_v2","./c_components_auto-folder-setup-checkbox_index","./c_avatar_initials_avatar","./c_avatar_size","./c_spectrum_avatar_avatar_initials","./c_prop-types_index","./c_spectrum_dropdown_button","./c_integrations_profile_card_popover","./c_integrations_profile_card_tooltip","./c_src_text","./c_src_instrumentation_common_context","./c_src_instrumentation_constants","./c_src_instrumentation_function_wrapper","./c_spectrum_culled_list","./c_spectrum_util_raf_throttle","./c_sharing_member_avatars","./c_ui_tooltip","./c_collections_utils_file","./c_onboarding_checklist_async_share_button_tooltip","./c_jquery","./c_Key","./c_growth_ui_send_app_link_form","./c_auth_authenticator","./c_security_crypto","./c_experiments_provider","./c_file_info_utils","./c_browse_selection_indicator","./c_capture_api","./c_browse_element_width","./c_spectrum_media_table_skeleton","./c_spectrum_media_table_media_cell","./c_spectrum_overflow_button","./c_spectrum_dimensions","./c_spectrum_vertically_fixed","./c_campaigns_campaigns_element_id_enum","./c_files_view_keyboard_shortcuts","./c_ui_selectable_list","./c_filename_highlights","./c_src_highlighted-truncated-string_index","./c_files_view_file_thumbnail","./c_icon_file_folder_icon","./c_sync_everything_utils_deep_link_utils","./c_core_custom_protocol","./c_web_util_errors","./c_react_query_api_helpers_queries_search_experiments","./c_aspect_ratio_index","./c_src_common_file","./c_pap-events_filesystem_item_actions_unstar_file","./c_content_suggestions_suggest_nonempty","./c_ui_section_section_empty_text","./c_content_suggestions_suggested_file_card","./c_ui_section_header_tooltip","./c_ui_section_section_header","./c_api_v2_team_client","./c_error_boundary","./c_react-error-boundary","./c_file_uploader_add_more_files_menu","./c_file_uploader_action_logger","./c_api_v2_redux_files","./c_right_rail_file_activity_file_activity_blade","./c_info_blade_content_metadata_image_metadata","./c_components_approval-forms_approval_metadata","./c_comments_component_pane","./c_comments_data_store","./c_src_right-rail_hooks","./c_components_utils_throttle-debounce","./c_spectrum_popover_popover_content","./c_components_section_tags_section_preview","./c_components_flows-icon-button_index","./c_flows_version_change_log_section","./c_file_activity_component_file_activity_blade","./c_list_index","./c_file_activity_data_store","./c_trash_constants","./c_proto_edison_redirect_messages_pb","./c_hooks_use_stabilized_callback","./c_maestro_layout_search","./c_edison_ui_spa_chrome","./c_onboarding_checklist_constants","./c_security_csrf_hmac"],(function(e,t,_,s,c,i,o,n,a,r,l,d,u,p,m,h,g,f,v,b,w,y,x,k,B,j,C,R,D,S,I,N,U,F,L,q,z,E,O,M,$,T,H,Q,A,J,K,V,G,P,W,X,Y,Z,ee,te,_e,se,ce,ie,oe,ne,ae,re,le,de,ue,pe,me,he,ge,fe,ve,be,we,ye,xe,ke,Be,je,Ce,Re,De,Se,Ie,Ne,Ue,Fe,Le,qe,ze,Ee,Oe,Me,$e,Te,He,Qe,Ae,Je,Ke,Ve,Ge,Pe,We,Xe,Ye,Ze,et,tt,_t,st,ct,it,ot,nt,at,rt,lt,dt,ut,pt,mt,ht,gt,ft,vt,bt,wt,yt,xt,kt,Bt,jt,Ct,Rt,Dt,St,It,Nt,Ut,Ft,Lt,qt,zt,Et,Ot,Mt,$t,Tt,Ht,Qt,At,Jt,Kt,Vt,Gt,Pt,Wt,Xt,Yt,Zt,e_,t_,__,s_,c_,i_,o_,n_,a_,r_,l_,d_,u_,p_,m_,h_,g_,f_,v_,b_,w_,y_,x_,k_,B_,j_,C_,R_,D_,S_,I_,N_,U_,F_,L_,q_,z_,E_,O_,M_,$_,T_,H_,Q_,A_,J_,K_,V_,G_,P_,W_,X_,Y_,Z_,es,ts,_s,ss,cs,is,os,ns,as,rs,ls,ds,us,ps,ms,hs,gs,fs,vs,bs,ws,ys,xs,ks,Bs,js,Cs,Rs,Ds,Ss,Is,Ns,Us,Fs,Ls,qs,zs,Es,Os,Ms,$s,Ts,Hs,Qs,As,Js,Ks,Vs,Gs,Ps,Ws,Xs,Ys,Zs,ec,tc,_c,sc,cc,ic,oc,nc,ac,rc,lc,dc,uc,pc,mc,hc,gc,fc,vc,bc,wc,yc,xc,kc,Bc,jc,Cc,Rc,Dc,Sc,Ic,Nc,Uc,Fc,Lc,qc,zc,Ec,Oc,Mc,$c,Tc,Hc,Qc,Ac,Jc,Kc,Vc,Gc,Pc,Wc,Xc){"use strict";class Yc{constructor(e,t=null){this.onBoltRefresh=()=>{this.logRefresh(),this.isDisconnected=!0,this.handleBoltRefresh()},this.logRefresh=()=>{this.isDisconnected||i.browseClientMetrics.newRefreshTriggered()},this.onBoltUpdate=()=>{this.isDisconnected&&(this.isDisconnected=!1,i.browseClientMetrics.newRefreshCompleted()),this.handleUpdate&&this.handleUpdate()},this.updateBoltClient=(e=!1)=>{const t=this.boltData.map((e=>new _.SignedChannelState("sfj",e.bolt_unique_id,e.latest_sjid.toString(),e.bolt_token)));t.length>0&&(!this.boltClient||e?(this.boltClient=new _.BoltClient(t,this.onBoltUpdate,this.onBoltRefresh),this.boltClient.start(),this.boltClient.setSuccessMinimumDelay(5)):this.boltClient.clearAndUpdateStates(t))},this.userId=e,this.status=_.BrowseBoltClientStatus.NotReady,this.boltData=[],this.rootNamespaceIdentifier=t}isReady(){return this.status!==_.BrowseBoltClientStatus.NotReady}setInitialBoltData(e){this.boltData=e,this.status=_.BrowseBoltClientStatus.NotLive,i.browseClientMetrics.namespaceCount(e.length)}fetchInitialBoltData(){const e=new _.UserApiV2Client,t=null!==this.rootNamespaceIdentifier?{current_ns_id:this.rootNamespaceIdentifier}:{};return e.ns("files").rpc("get_browse_bolt_data",t,{subjectUserId:this.userId}).then((e=>{void 0===e.bolt_token_response&&c.reportException({err:new Error("Receive empty bolt token response from /get_browse_bolt_data"),severity:"non-critical",tags:["js:browse"]});const t=e.bolt_token_response||[],_=[];t.forEach((e=>{_.push({bolt_token:e.bolt_token||"",bolt_unique_id:e.bolt_unique_id||"",latest_sjid:(e.latest_sjid||0).toString()})})),this.setInitialBoltData(_)}),(e=>{var t;let s=(null===(t=e.raw)||void 0===t?void 0:t.status)||0;s>=400&&s<500&&this.setInitialBoltData([]),this.status=_.BrowseBoltClientStatus.NotReady,c.reportException({err:new Error("Error getting bolt data from /get_browse_bolt_data"),severity:"non-critical",tags:["js:browse"]})}))}handleUpdateBoltClient(e){const t=this.boltData.length-e.length;i.browseClientMetrics.namespaceCountChange(t),this.boltData=e,this.updateBoltClient()}getNsMap(){const e={};return this.boltData.forEach((t=>{e[t.bolt_unique_id]=parseInt(t.latest_sjid,10)})),e}startLiveUpdate(e=null){this.isReady()&&(e&&(this.handleUpdate=e),this.updateBoltClient(),this.status=_.BrowseBoltClientStatus.Live)}stopLiveUpdate(){this.status=_.BrowseBoltClientStatus.NotLive,this.boltClient&&this.boltClient.unsubscribe()}handleBoltRefresh(){this.boltClient&&this.boltClient.unsubscribe(),this.fetchInitialBoltData().then((()=>{this.updateBoltClient(!0),this.status=_.BrowseBoltClientStatus.Live}))}}var Zc;!function(e){e.ON="ON",e.CONTROL="CONTROL",e.OFF="OFF"}(Zc||(Zc={}));const ei=({user:e,path:c,shouldShowDeletedFiles:o,rootNamespaceIdentifier:n,browseLimitBoltScope:a,applyBoltUpdates:r,applyBoltUpdatesForFileExplorer:l})=>{const d=t.React$1.useRef(c),u=t.React$1.useRef(o),p=t.React$1.useRef();return t.React$1.useEffect((()=>{d.current=c,u.current=o})),t.React$1.useEffect((()=>{const t=new Yc(e.id,n);let c,o=0,m=0,h=!1,g=new i.NonQueuedUpdateSimulator;function f(){if(g.notificationOccurred(),c||h)return h=!0,void m++;o=Date.now(),m=0,h=!1,g.initializeIfNeeded(o),c=_.getChangesForDirectory({path:d.current,userId:e.id,namespaceToJournalIdMap:t.getNsMap(),rootNamespaceIdentifier:null!=n?n:void 0,includeDeletedFiles:u.current,limitScope:a===Zc.ON,onSuccess:e=>{c=void 0,i.browseHandlerMetrics.recordQueuedLatency(o),i.browseHandlerMetrics.recordNumberRequestsQueued(m),g.queuedUpdateComplete(o),r({path:d.current,updates:e}),l({path:d.current,updates:e}),t.handleUpdateBoltClient(e.bolt_data)},onComplete:()=>{c=void 0,h&&s.defer((()=>{h=!1,f()}))}})}return p.current=_.makeCancelable(_.waitForTTI().then((()=>t.fetchInitialBoltData()))),p.current.then((()=>{t.startLiveUpdate(f)})),()=>{var e;null===(e=p.current)||void 0===e||e.cancel(),g.reset(),t.stopLiveUpdate(),c&&c.abort()}}),[r,l,e]),t.React$1.createElement(t.React$1.Fragment,null)};ei.displayName="BoltHandler";const ti={applyBoltUpdates:o.applyBoltUpdates,applyBoltUpdatesForFileExplorer:_.applyBoltUpdates},_i=_.connect((function(e){return{user:_.user$1(e),path:_.path$1(e),shouldShowDeletedFiles:_.shouldShowDeletedFiles(e),rootNamespaceIdentifier:_.isInsideBackupFolder(e)?_.context(e).rootNSID:null,browseLimitBoltScope:_.experiments(e).browseLimitBoltScope}}),ti)(ei);e.BoltHandler=ei,e.ConnectedBoltHandler=_i}));
//# sourceMappingURL=c_browse_bolt_handler.js-vflolHSZ4.map
