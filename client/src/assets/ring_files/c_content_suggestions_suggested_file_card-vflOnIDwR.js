define(["require","exports","./e_ui_page_files_router","./e_edison","./c_ui_section_header_tooltip","./c_ui_section_section_header","./c_core_i18n","./c_hooks_resize_observer","./c_tslib","./c_lodash-es_lodash","./c_files_view_file_thumbnail","./c_icon_folder_icon","./c_src_simple-action-bar_action_bar_types","./c_action_bar_action_bar_strings"],(function(e,t,i,s,n,a,o,r,l,c,d,m,u,g){"use strict";const h=e=>{const{minTileWidth:t,maxColWidth:s,tilePadding:n}={minTileWidth:i.SUGGEST_GRID_V2_MIN_TILE_WIDTH,maxColWidth:i.SUGGEST_GRID_V2_MAX_TILE_WIDTH,tilePadding:i.SUGGEST_GRID_V2_TILE_PADDING},a=e-2*n-2;if(a<2*i.SUGGEST_GRID_MAX_TILE_WIDTH)return{itemsToShow:2,tileWidth:(a-n)/2};let o=Math.max(1,Math.floor(a/s)),r=i.SUGGEST_GRID_MAX_TILE_WIDTH;if(a%s>1){const e=a/(o+1)-n;e>=t&&(o++,r=e)}return{itemsToShow:o,tileWidth:r}},_=({isHiddenByUser:e,buttonAction:t})=>s.React$1.createElement(a.SectionHeader,{title:o.intl.formatMessage({id:"47aM5Y",defaultMessage:"Suggested from your activity"}),ueName:"suggest",isHidden:e,onToggleHidden:t,infoIcon:s.React$1.createElement(n.HeaderTooltip,{title:o.intl.formatMessage({id:"Sx3SWG",defaultMessage:"Quick access to files youâ€™ve been working on."}),size:"standard",label:o.intl.formatMessage({id:"WYQtmB",defaultMessage:"More info"})})}),f=({isHiddenByUser:e,children:t,onHeightChanged:n})=>{const a=p(n);return s.React$1.createElement("section",{ref:a,className:i.cx({"home-access-section":!0,"home-access-section-suggest-nonempty":!e})},t)},p=e=>{const[t,i]=r.useResizeObserver(),n=null==i?void 0:i.contentRect,a=t.current;return s.React$1.useEffect((()=>{if(!e)return;let t=0;if(n&&(t+=n.height),a){const{marginTop:e,marginBottom:i}=window.getComputedStyle(a);t+=Math.ceil(parseFloat(e)+parseFloat(i))}e(t)}),[n,a,e]),t};class T extends s.React$1.PureComponent{render(){const{isHiddenByUser:e,containerWidth:t}=this.props,{itemsToShow:i,tileWidth:n}=h(t);return s.React$1.createElement(f,{isHiddenByUser:e},s.React$1.createElement(_,{isHiddenByUser:e}),s.React$1.createElement(E,{isHiddenByUser:e,itemsToShow:i,tileWidth:n}))}}T.displayName="SuggestLoading";class E extends s.React$1.PureComponent{renderLoadingTile(e,t,n){return this.props.suggestLoadingTile?this.props.suggestLoadingTile({tileWidth:e,tileMarginRight:n}):s.React$1.createElement("div",{key:t,className:i.cx(["tile","home-suggest-preview-tile"])},s.React$1.createElement("div",{className:"tile__loading-container",style:{width:e+"px"}},s.React$1.createElement("div",{className:"tile__loading-thumbnail",style:{width:e+"px"}})),s.React$1.createElement("div",{className:"loading-tile-label"},s.React$1.createElement("div",{className:"loading-tile-label__detail-text"}),s.React$1.createElement("div",{className:"loading-tile-label__detail-subheader"})))}render(){const{itemsToShow:e,tileWidth:t,tileMarginRight:n,isHiddenByUser:a}=this.props,o=[];for(let i=0;i<e;i++)o.push(this.renderLoadingTile(t,i,n));return a?null:s.React$1.createElement("div",{className:i.cx({"home-access-section__content":!0,"home__suggest-items":!0})},s.React$1.createElement("div",{className:"home-tile__container"},o))}}E.displayName="SuggestLoadingInner";const y={type:i.FileTypes.FOLDER,icon:"folder"},b=e=>{const t={bytes:10,direct_blockserver_link:"",event_type:0,ext:e.type,file_id:e.resourceId,has_automated_rule:!1,fq_path:e.fqPath||"",href:e.url,icon:"",is_cloud_doc:!1,is_versionable:!1,is_dir:e.isDir||!1,is_in_team_folder_tree:!1,is_in_vault_folder:!1,is_locked:!1,is_symlink:!1,is_unmounted:!1,ns_id:0,ns_path:e.fqPath||"",revision_id:"",sjid:0,sort_key:"ReadonlyArray<string> | string",target_ns:null,type:e.isDir?i.FileTypes.FOLDER:i.FileTypes.FILE,isDeleted:!1,read_only:!1};return new i.File(t)};class R extends s.React$1.PureComponent{constructor(e){super(e),this.cardRef=s.React$1.createRef(),this.onDismissItemClick=()=>{const{position:e,suggested:t,user:s,dismissSuggestedItem:n,logger:a,source:r}=this.props;a.logClickDismissSuggestedItem(t,"dismiss-suggested-item",e,r),n(s,t).then((()=>{a.logDismissSuggestedItem(t,"dismiss-suggested-item",e,"no_feedback_modal",this.props.source)})).catch((()=>{const e=t.filename;let s;s=e?o.intl.formatMessage({id:"YmEqih",defaultMessage:"There was a problem dismissing {item_name}"},{item_name:e}):o.intl.formatMessage({id:"rBSlLP",defaultMessage:"There was a problem dismissing your selection"}),i.Snackbar.fail(s,"content-suggestions")}))},this.onDismissItemClickEvent=e=>{e.stopPropagation(),e.preventDefault(),this.onDismissItemClick()},this.onParentFolderClick=e=>{e.stopPropagation(),e.preventDefault();const{suggested:t,position:s,logger:n,openSuggestedParent:a,source:o}=this.props;a(t,(()=>n.logOpenParentFolder(t,"parent-folder",s,o)),i.isMetaKeyPressed(e))},this.onFilenameClick=e=>{e.preventDefault(),e.stopPropagation(),this.handleNavigation(e,"title")},this.onMouseEnter=()=>{this.props.shouldTruncateFilenameOnTileHover&&this.setState({shouldTruncateFilename:!0})},this.onMouseLeave=()=>{this.setState({shouldTruncateFilename:!1})},this.onFileThumbnailClick=e=>{e.preventDefault(),e.stopPropagation(),this.handleNavigation(e,"icon")},this.onFileThumbnailKeyPress=e=>{e.target===this.cardRef.current&&e.key===i.Key_enum.Key.Enter&&(e.preventDefault(),e.stopPropagation(),this.handleNavigation(e,"icon"))},this.handleNavigation=(e,t)=>{const{suggested:s,position:n,logger:a,openSuggestedItem:o}=this.props;o(s,(()=>a.logOpenSuggestedItem(s,t,n,this.props.source)),i.isMetaKeyPressed(e))},this.state={shouldTruncateFilename:!1}}render(){const{suggested:e,tileWidth:t,tileMarginRight:n,useTileWidthForCard:a,user:o,filenameMaxChars:r,filenameWidthAfterTruncation:l,subheaderLabelMaxChars:u,showIconsInsteadOfThumbnails:g,fileIconSize:h,isExtensionThumbnailableFnOverride:_,showOverflowMenu:f}=this.props,p=i.suggestedItemToFileIconFields(e,g),T=e.breadcrumb.length?e.breadcrumb[0]:null,E=T?T.name:i.Viewer.get_root_name(o),R=T?T.url:i.browse_uri_for_fq_path(o,"").toString(),v=e.fqPath.split("/"),S=c.uniqueId("home__suggest_filename-");return v.pop(),s.React$1.createElement("div",{className:"home__suggest_card",onClick:this.onFileThumbnailClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onKeyPress:this.onFileThumbnailKeyPress,ref:this.cardRef,style:a?{width:t,marginRight:n}:void 0},s.React$1.createElement("a",{className:"home__suggest_image",href:e.url,tabIndex:-1,onClick:this.onFileThumbnailClick,"aria-hidden":"true",style:a?void 0:{width:t}},s.React$1.createElement(d.FileThumbnail,{file:p,thumbnailSize:256,iconSize:h||72,key:e.key,"aria-hidden":"true",isExtensionThumbnailableFnOverride:_})),f?s.React$1.createElement($,{file:b(e),dismissAction:this.onDismissItemClick}):s.React$1.createElement(N,{onClick:this.onDismissItemClickEvent,folderId:S}),s.React$1.createElement("div",{className:"home__suggest_details",style:a?void 0:{width:t}},s.React$1.createElement(I,{filename:e.filename,url:e.url,onClick:this.onFilenameClick,maxChars:r,shouldTruncate:this.state.shouldTruncateFilename,widthAfterTruncation:l}),s.React$1.createElement("div",{className:"home__suggest_subheader"},s.React$1.createElement(m.FolderIcon,{file:y,className:"home__suggest_subheader-icon","aria-hidden":"true"}),s.React$1.createElement(C,{folderName:E,folderPathArray:v,folderUrl:R,folderId:S,onClick:this.onParentFolderClick,maxChars:u}))))}}R.displayName="SuggestedFileCard";const v=i.requireCssWithComponent(R,["/static/metaserver/static/css/dig-components/index.web-vflGcQt8W.css"]),I=e=>{const{filename:t,onClick:n,url:a,maxChars:o,shouldTruncate:r,widthAfterTruncation:l}=e,c="home__suggest_filename";let d=i.Emstring.em_snippet(t,o||14,.5);if(r&&l){const e=document.getElementsByClassName(c)[0];if(e){const t=function(e){const t=window.getComputedStyle(e,null),i=t.getPropertyValue("font-weight")||"normal",s=t.getPropertyValue("font-size"),n=t.getPropertyValue("font-family");return`${i} ${s} ${n}`}(e);d=d.substring(0,function(e,t,i){let s=e.length;for(;S(e.substring(0,s),t)>i;)s--;return s}(d,t,l))}}const m=s.React$1.createElement("a",{className:c,href:a,onClick:n},d);return t!==d?s.React$1.createElement(i.Tooltip,{className:"home__suggest-v2_tooltip",id:"suggested-file-card-filename-tooltip",title:t,placement:"top"},m):m};function S(e,t){const i=document.createElement("canvas"),s=i&&i.getContext("2d")||null;if(!s)return-1;s.font=t;return s.measureText(e).width}const C=e=>{const{folderName:t,folderPathArray:n,folderUrl:a,folderId:o,onClick:r,maxChars:l}=e,c=i.Emstring.em_snippet(t,l||10,.5),d=s.React$1.createElement("a",{id:o,className:"home__suggest_subheader-label",href:a,onClick:r,"aria-label":t},c);return n.length>2?s.React$1.createElement(i.Tooltip,{className:"home__suggest-v2_tooltip",id:"suggested-file-card-v2-foldername-tooltip",title:n.join("/"),placement:"bottom"},d):t!==c?s.React$1.createElement(i.Tooltip,{className:"home__suggest-v2_tooltip",id:"suggested-file-card-v2-foldername-tooltip",title:t,placement:"bottom"},d):d},$=s.React$1.lazy((()=>l.__awaiter(void 0,void 0,void 0,(function*(){const{BrowseInlineActionBar:t}=yield new Promise((function(t,i){e(["./c_browse_browse_inline_action_bar"],t,i)}));return{default:e=>{const n={actionType:u.ActionBarActionTypes.CUSTOM_ACTION,isEnabled:!0,icon:i.HideLine,text:g.HIDE_SUGGESTED_ITEM_STRING,id:"dismiss-action-id",handler:e.dismissAction},a=[u.ActionBarActionTypes.MOVE,u.ActionBarActionTypes.RENAME,u.ActionBarActionTypes.DELETE];return s.React$1.createElement(t,{className:"filecard-menu",isContentSuggestion:!0,additionalActions:[n],excludedActions:a,file:e.file,actionSurface:i.ActionSurfaceLogValue.CONTENT_SUGGESTIONS})}}})))),N=e=>{const t=i.useUniqueId({prefix:"home__suggest_dismiss-"});return s.React$1.createElement(i.IconButton,{id:t,variant:"transparent",className:"home__suggest_dismiss",onClick:e.onClick,"aria-label":o.intl.formatMessage({id:"KaeLBh",defaultMessage:"Dismiss suggestion"}),"aria-labelledby":i.cx(t,e.folderId)},s.React$1.createElement(i.UIIcon,{src:i.CloseLine,"aria-hidden":"true"}))};t.SuggestFrame=f,t.SuggestHeader=_,t.SuggestLoadingInner=E,t.SuggestedFileCard=v,t.getLayout=h}));
//# sourceMappingURL=c_content_suggestions_suggested_file_card.js-vflJrpJyk.map
