define(["require","exports","./c_tslib","./e_edison","./e_ui_page_files_router","./c_file_uploader_clean_actions","./c_file_uploader_types","./c_file_uploader_utils","./c_data_store","./c_data_slice","./c_lodash-es_lodash","./c_core_browser_detection","./c_core_i18n","./c_cloud_docs_create_api","./c_ui_fileops_actions","./e_core_exception","./c_core_notify","./c_file_uploader_action_logger","./c_file_actions_portable_copy","./c_core_exception_info","./c_clipboard_v3","./c_browse_actions","./c_file_actions_actions_share_copy_link","./c_sharing_async_share_modal_util","./c_sharing_ui_notifications_util","./c_views_copy_link_mini_modal","./c_share_modal_evolution_utils_logging","./c_src_utils_logging","./c_campaigns_campaign_events_api","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/payments","./c_dig-illustrations_spot_files-old-2","./c_pap-events_enums_file_type-utils","./c_spectrum_icon_inline_index","./c_icon_templates_status_index","./c_spectrum_icon_chooser_index","./c_browse_interface","./c_ux_analytics_modal_tracking","./c_src_truncated-string_index","./c_file_uploader_clean_dropzone_outline","./c_file_uploader_actions_adapter","./c_hooks_use_stabilized_callback","./c_upload_kit_lib_selectors","metaserver/static/js/modules/constants/global_file_upload","./c_combinations_index","./c_src_icons_file_icon","./c_truncate_index","./c_resize-observer-polyfill_dist_ResizeObserver","./c_campaigns_campaigns_element_id_enum","./c_file_uploader_add_more_files_menu","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","metaserver/static/js/modules/constants/request","./c_core_xhr","./c_csrf","./c_browser_cookies","metaserver/static/js/modules/constants/page_load","./c_src_sink_index","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","./c_pap-events_manual_upload_select_upload_folder","./c_hive_schemas_web-modal-activity","./c_folder_dialog_async","./c_growth_ui_teams_web_actions_logger_events","./c_sharing_actions_cdm_new_folder_modal_actions","./c_sharing_ui_util","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","./c_sharing_settings_utils_sharing_settings_util","./c_deprecated_ajax_ajax_form_extract_errors","./c_sharing_browse_exports","./c_sharing_default_permissions_web_uploads_exports","./c_sharing_default_permissions_web_uploads_utils","./c_data_action_creators_index","./c_files_view_file_actions_file_from_metadata","./c_file_actions_strings","./c_history","./c_ux_analytics_dispatch_custom_event","./c_browse_crypto_subtle_digest","./c_base64","./c_upload_kit_lib_types","./c_file_viewer_file_extension_extension_constants","metaserver/static/js/modules/core/langpack","./c_gdd_migration_ui_utils","./c_profile_services_profile_services_link","./c_profile_services_profile_services_constants","metaserver/static/js/modules/constants/login_and_register","./c_file_imports_gdrive_file_picker","./c_action_bar_file_actions_logging","./c_file_uploader_result_type","./c_udcl_index","./c_files_view_file_actions_snackbars","./c_sync_everything_hive_logger","./c_pap-events_previews_rename_file","./c_flows_utils_async_modal_launchers","./c_utils_contacts_tokenizer_contacts_tokenizer_util","./c_components_sharing_spinner","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_spectrum_tooltip","./c_spectrum_positioned_portal","./c_spectrum_dimensions","./c_upload_kit_utils_path","./c_src_icons_file_icon_extensions"],(function(e,t,a,s,o,r,n,l,i,c,d,u,p,m,_,g,E,f,h,R,S,T,M,y,C,O,b,v,L,A,I,U,D,F,x,N,k,P,w,$,B,G,z,q,V,Q,j,H,W,Y,K,J,Z,X,ee,te,ae,se,oe,re,ne,le,ie,ce,de,ue,pe,me,_e,ge,Ee,fe,he,Re,Se,Te,Me,ye,Ce,Oe,be,ve,Le,Ae,Ie,Ue,De,Fe,xe,Ne,ke,Pe,we,$e,Be,Ge,ze,qe,Ve,Qe,je,He,We,Ye,Ke,Je,Ze,Xe,et,tt,at,st,ot,rt,nt,lt){"use strict";function it(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var s=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,s.get?s:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var ct=it(I);const dt=()=>{const e=s.reactExports.useRef(null),t=s.reactExports.useRef(0),a=s.reactExports.useRef(0),n=o.useSelector(c.getIsDraggingFiles),l=o.useDispatch(),i=s.reactExports.useCallback((()=>{t.current=0,e.current=null,a.current=0}),[t,e,a]);return s.reactExports.useEffect((()=>{n&&(l(c.uploadActionCreators.clearDraggedPersistentDropzone()),l(c.uploadActionCreators.clearDraggedOuterDropzone()))}),[n]),s.reactExports.useEffect((()=>{const s=[];return s.push([document,"dragover",e=>{e.preventDefault(),e.stopPropagation()}]),s.push([document,"dragenter",s=>{if(s.preventDefault(),s.stopPropagation(),s.target===e.current)return;e.current=s.target,t.current++;const o=s.dataTransfer,n=o.mozItemCount;let l=0;o.items&&(l=Object.keys(o.items).length);let i=1;n?i=n:l&&(i=l);const{types:c}=o,p=["Files","application/x-moz-file",u.INTERNAL_FILE_DATA_TRANSFER_TYPE,"text/x-moz-url","text/uri-list","Url"];if(c&&d.intersection(c,p).length||c instanceof DOMStringList&&(c.contains("Files")||c.contains("text/x-moz-url")||c.contains(u.INTERNAL_FILE_DATA_TRANSFER_TYPE)||u.msie&&(c.contains("Text")||c.contains("text/plain")))){if(i===a.current)return;a.current=i;const e=(e=>{let t;return t=e instanceof DOMStringList?e.contains("Text")||e.contains("text/plain"):e.includes(u.INTERNAL_FILE_DATA_TRANSFER_TYPE)||e.includes("text/plain"),t})(c);r.UploaderActions.setNumDraggingFiles({numDraggingFiles:i,isInternalTransfer:e})}}]),s.push([document,"dragleave",s=>{s.preventDefault(),s.stopPropagation(),e.current=null,t.current--,t.current<1&&(t.current=0,a.current=0,r.UploaderActions.setNumDraggingFiles({numDraggingFiles:0}))}]),s.forEach((([e,t,a])=>{e.addEventListener(t,a)})),()=>s.forEach((([e,t,a])=>{e.removeEventListener(t,a)}))}),[t,e]),i};const ut=({uploadConsumerInterface:t,uploaderPostTTIExperiments:i,isContentManager:p,resetDragRefs:S,createShortcutForGdssFile:T})=>{const M=o.useDispatch(),y=o.useSelector(c.getTargetSurface),C=o.useSelector(c.getPath),O=o.useSelector(c.getUser),b=o.useSelector(c.isMovingIntoVault),v=o.useSelector(c.hasPermissionToUploadToFolder),L=o.useSelector(c.getOverQuotaStatus),A=o.useSelector(o.path$1),I=o.useSelector(c.getCurrentlyActiveOuterDropzone),U=o.useSelector(c.getCurrentlyActivePersistentDropzone);s.reactExports.useEffect((()=>{const i=mt(),D=e=>{if(e.defaultPrevented)return;const{dataTransfer:t}=e;e.preventDefault(),e.stopPropagation(),S(),r.UploaderActions.setNumDraggingFiles({numDraggingFiles:0});const a=t&&t.getData(u.INTERNAL_FILE_DATA_TRANSFER_TYPE);let s;if(a&&(s=F(e,a),!s))return;if(M(c.uploadActionCreators.setLastFileUploadMethod("dnd")),o.Viewer.get_viewer().team_is_locked)return void M(c.uploadActionCreators.setUploadModalType({type:"OVER_QUOTA_MODAL",forceLocked:!0,context:r.UploaderOverQuotaModalContexts.LOCKED_TEAM_DRAG_AND_DROP}));if(!v&&!b)return;if(o.isBackupBrowse())return;if(L===l.OverQuotaStatusType.BASIC_OVER_QUOTA)return void M(c.uploadActionCreators.setUploadModalType({type:"OVER_QUOTA_MODAL",context:r.UploaderOverQuotaModalContexts.ALREADY_OQ_DRAG_AND_DROP}));const n=function(e){if(!e||!e.types)return null;if(((e,t)=>{for(const a of e)if(t===a)return!0;return!1})(e.types,"Files"))return null;let t,a=null;try{t=e.getData("text/x-moz-url")}catch(e){}if(null!=t){const e=t.split("\n");e.length>=1&&(a=e[0])}if(!a)try{a=e.getData("text/uri-list")}catch(e){}if(!a)try{a=e.getData("Url")}catch(e){}return a||(a=null),a}(t);n?m.createNewFile({user:O,path:C,documentType:o.PointerFileTypes.SIMPLE_POINTER,selection_mode:"unselected",empty_folder:!1,defaultUrl:n,source:o.NewFileMenuFromType.DRAG_DROP,createShortcutForGdssFile:T}):(pt(e,s),x(t))},F=(t,o)=>{s.assert(null!=O,"user is null");try{const{userId:s,fromPath:r,fileInfos:n}=JSON.parse(o);if(n.length&&r&&s){if(p)return;if(!v&&b)return void E.Notify.error(i.lockedVault);if(!v)return void E.Notify.error(i.notThisFolderError);if(s!==(null==O?void 0:O.id))return void E.Notify.error(i.notFromOtherDbxError);if(t.ctrlKey||t.altKey)h.portableCopy({user:O,filesPath:n,newPath:"/"===C?"":C,source:"drag_and_drop"});else if(r!==C){if(1===n.length&&n[0].is_dir&&n[0].fq_path===C)return void E.Notify.error(i.cantMoveFolderToItself);const t=(t,s)=>a.__awaiter(void 0,void 0,void 0,(function*(){const{handleMovedFolder:a}=yield new Promise((function(t,a){e(["./e_ui_page_files_router"],t,a)})).then((function(e){return e.action_creators_esnext}));a({fromPath:t,newPath:s})}));_.moveFiles({user:O,path:r,files:n,newPath:C,checkFSWs:!0,extra:{targetSurface:y},onSuccess:()=>a.__awaiter(void 0,void 0,void 0,(function*(){n.some((e=>e.is_dir))&&t(r,C)})),onUndo:()=>a.__awaiter(void 0,void 0,void 0,(function*(){n.some((e=>e.is_dir))&&t(C,r)}))})}return}}catch(e){return g.reportException({err:e,severity:R.SEVERITY.NONCRITICAL,tags:["web_uploader","drag_and_drop"]}),e}},x=e=>a.__awaiter(void 0,void 0,void 0,(function*(){const{items:a,errors:s}=yield t.handleDrop(e,C),i=l.generateTaskTrackingId();if(!a.length)return void l.showCannotUploadEmptyFolderSnackbar();const[c,u]=d.partition(a,(e=>e.isDir));u.forEach((e=>f.setMethodForFileUpload(e.id,n.UploadMethod.DRAG)));const p=c.length?u.length?l.ChooserType.FILE_FOLDER:l.ChooserType.FOLDER:l.ChooserType.FILE,m="folder_explorer"===I?"folder_explorer":"dedicated_dropzone"===U?"dedicated_dropzone":"browse_suggestions"===U?"browse_suggestions":A!==C?"browse_folder":"outer_dropzone"===I?"outer_dropzone":"catch_all";f.logUploadAction({user:O,action:o.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,chooser_type:p,upload_method:n.UploadMethod.DRAG,dropzoneArea:m}),o.TeamsWebActionsLogger.log("drag_and_drop_files",Object.assign({file_type:p},l.getUploadLocationMetadataToLog(O,C))),t.startUploading(),r.UploaderActions.logUploadAttempts({chooserType:p,items:u,upload_method:n.UploadMethod.DRAG,uploadPath:C,errors:s,actionElement:n.UploadElement.DRAG_AND_DROP,taskTrackingId:i})}));return document.addEventListener("drop",D),()=>document.removeEventListener("drop",D)}),[v,b,M,p,L,C,y,S,i,O,t,U,I])},pt=({dataTransfer:e},t)=>{const{items:a=null}=e||{};if(a&&a.length>0&&!a[0]){const{name:e,message:s}=t||{};g.reportException({err:new Error("Drag and drop DateTransfer item unexpectedly undefined"),severity:R.SEVERITY.NONCRITICAL,tags:["web_uploader","drag_and_drop"],exc_extra:{item_index:0,items_length:a.length,had_internal_transfer_error:!!t,internal_transfer_error_name:e,internal_transfer_error_message:s}})}},mt=()=>({notThisFolderError:p.intl.formatMessage({id:"sVwi15",defaultMessage:"You don’t have permission to add to this folder."}),notFromOtherDbxError:p.intl.formatMessage({id:"gsjvql",defaultMessage:"You can’t move or copy files here from another Dropbox."}),lockedVault:p.intl.formatMessage({id:"6ASmGo",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}),cantMoveFolderToItself:p.intl.formatMessage({id:"ZGOZr9",defaultMessage:"You can’t move a folder into itself"})}),_t=(e,t,a=R.SEVERITY.NONCRITICAL)=>{g.reportException({err:new Error(e),severity:a,exc_extra:{err:t},tags:["rich_snackbar","product-growth"]})},gt="sharing-notification";const Et=()=>{o.Snackbar.close("inline-upload-snackbar")},ft=(e,t)=>{o.Snackbar.close(gt),S.copyToClipboard(t.url,(()=>ht(t)),(()=>Rt(t.url,e)))},ht=e=>{const t=e?e.link_permissions.link_access_level:void 0;let a="viewer";t&&(a=t.hasOwnProperty(".tag")?t[".tag"]:t),C.showCopyLinkSuccessSnackbar(e.url,a)},Rt=(e,t)=>{const{userId:a,ns_id:s,filePath:r}=t;_t("Failed to copy link to clipboard"),C.showCopyLinkErrorSnackbar(e),o.ShareTibEventLogger.log(a,v.TiburonEventName.CopySharedLinkFailure,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{is_folder:!1,ns_id:s,fq_path:r,error:"failed_copy_to_clipboard"})};var St;!function(e){e.from_upload_snackbar="from_upload_snackbar",e.from_rename_snackbar="from_rename_snackbar"}(St||(St={}));const Tt=new Set(["3gp","3gpp","3gpp2","asf","avi","dv","flv","m2t","m2ts","m4v","mkv","mov","mp4","mpeg","mpg","mts","mxf","oggtheora","ogv","rm","ts","vob","webm","wmv"]),Mt={COPY_LINK:{name:"copy_link",icon:o.LinkLine,onClick:function(e){return a.__awaiter(this,void 0,void 0,(function*(){const t="copy_link";o.ProEventsLogger.log("rich_snackbar_click",{action:t});const{filePath:s,ns_id:r,userId:n,campaignImpressionContext:l}=e;l&&L.logCampaignClick(l,t),Et(),C.showCopyLinkProgressSupportedBrowserSnackbar();try{const t=yield((e,t="max")=>a.__awaiter(void 0,void 0,void 0,(function*(){const{userId:a,filePath:s,ns_id:r}=e,n=new o.FileShareApiClient({userId:a});try{const e=yield n.sharedLinkInfo({fileIdOrPath:s});if(e.length)return e[0];o.ShareTibEventLogger.log(a,v.TiburonEventName.AttemptCreateSharedLinkWithSettings,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{access:t,is_folder:!1,ns_id:r,fq_path:s});try{const e=yield n.createSharedLink({fileIdOrPath:s,settings:{access:t}});return o.ShareTibEventLogger.log(a,v.TiburonEventName.SucceedCreateSharedLinkWithSettings,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,Object.assign({is_folder:!1,ns_id:r,fq_path:s,access:t,http_status_code:200,response_status:"success"},b.buildExtraFromLinkMetadata(e))),e}catch(e){return o.ShareTibEventLogger.log(a,v.TiburonEventName.FailCreateSharedLinkWithSettings,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{is_folder:!1,ns_id:r,fq_path:s,access:t,http_status_code:e.raw&&e.raw.status,error_tag:e.error&&e.error[".tag"]||"undefined_error",error_summary:e&&e.summary}),_t("Failed to create link",e),Promise.reject(e)}}catch(e){return _t("Failed to get shared link info",e),Promise.reject(e)}})))(e),l=t.url;o.ShareTibEventLogger.log(n,v.TiburonEventName.CopySharedLink,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,Object.assign(Object.assign({},b.buildExtraFromLinkMetadata(t)),{is_folder:!1,ns_id:r,fq_path:s})),M.isBrowserCopyEnabled()?S.copyToClipboard(l,(()=>ht(t)),(()=>Rt(l,e))):C.showCopyLinkCTASnackbar(l,(()=>ft(e,t)),gt)}catch(e){e.error[".tag"]===O.CopyLinkException.ACCESS_DENIED||e.error[".tag"]===O.CopyLinkException.SETTINGS_ERROR&&e.error.settings_error[".tag"]===O.CopyLinkException.NOT_AUTHORIZED?C.showCopyLinkNoPermissionSnackbar():e.error[".tag"]===O.CopyLinkException.PATH&&e.error.path[".tag"]===O.CopyLinkException.NOT_FOUND?C.showCopyLinkNotFoundSnackbar():e.error[".tag"]===O.CopyLinkException.EMAIL_NOT_VERIFIED?C.showCopyLinkEmailNotVerifiedSnackbar():C.showCopyLinkCatchallSnackbar(),o.ShareTibEventLogger.log(n,v.TiburonEventName.CopySharedLinkFailure,o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD,{is_folder:!1,ns_id:r,fq_path:s,error_message:e.error[".tag"]}),_t("Failed to copy link",e)}}))},text:p.intl.formatMessage({id:"CgXNiX",defaultMessage:"Copy link"})},SHARE:{name:"share",icon:o.ShareArrowLine,onClick:function(e){const t="share";o.ProEventsLogger.log("rich_snackbar_click",{action:t});const{userId:a,filePath:s,campaignImpressionContext:r}=e;return r&&L.logCampaignClick(r,t),Et(),y.asyncShowShareModal(a,{fqPath:s,isFolder:!1},{origin:o.SHARE_ACTION_ORIGIN_TYPE.SHARE_TO_UPLOAD})},text:p.intl.formatMessage({id:"8r1z6a",defaultMessage:"Share"})},OPEN_IN_REPLAY_WITH_UPLOAD:{name:"open_in_replay",icon:o.VideoLine,text:p.intl.formatMessage({id:"iI2jlD",defaultMessage:"Use Dropbox Replay"}),onClick:e=>a.__awaiter(void 0,void 0,void 0,(function*(){try{const t=yield(e=>a.__awaiter(void 0,void 0,void 0,(function*(){const{userId:t,filePath:a}=e,s=new o.UserApiV2Client;try{return(yield s.ns("files").rpc("get_metadata",{path:a},{subjectUserId:t})).id}catch(e){return _t("Failed to get file id",e,R.SEVERITY.CRITICAL),Promise.reject(e)}})))(e);o.redirect(`https://replay.dropbox.com/project/creating/${t}?creationSource=dropbox_web_snackbar`)}catch(e){g.reportException({err:e,severity:R.SEVERITY.CRITICAL}),o.redirect("https://replay.dropbox.com/?login=true")}}))}};function yt(e,t,a,s,r){const{campaignId:n,campaignImpressionId:i,campaignVariantId:c}=(null==s?void 0:s["PG Share On Upload"])||{};let d;const u=e.filter((e=>e.status!==l.FileStatusType.CANCELLED)).last();if(!u)return;const p=u.userId,m=i?L.createMegaphoneCampaignImpressionContext(i,n,c):void 0,_=(e,t)=>({filePath:o.joinPathWithFileName({fqPath:e.dest,fileName:e.name}),userId:p,ns_id:e.ns_id,snackbar_origin:t||St.from_upload_snackbar,campaignImpressionContext:m}),g=_(u);i&&(null==s?void 0:s["PG Share On Upload"])&&"complete"===t&&1===e.count((e=>e.status!==l.FileStatusType.CANCELLED))&&(d={actions:[Mt.SHARE,Mt.COPY_LINK],clickHandlerArgs:g});const E=e.find((e=>e.status!==l.FileStatusType.CANCELLED&&Tt.has(o.file_extension(e.name))));if("complete"===t&&E&&(null==a?void 0:a.snackbarOpenWithReplay)&&(d=Ct(Object.assign({},_(E)))),d){const{logView:e,logDismiss:t,logCloseClick:a,actionNames:s}=Ot(d,m);d.onShown=()=>{e(s)},d.onDismissed=()=>{t(s)},d.onCloseClick=()=>{a(s)}}return d}const Ct=e=>({actions:[Mt.OPEN_IN_REPLAY_WITH_UPLOAD],helperText:p.intl.formatMessage({id:"EKLtAC",defaultMessage:"Share and request feedback on your video files."}),clickHandlerArgs:e}),Ot=(e,t)=>({logView:e=>{o.ProEventsLogger.log("rich_snackbar_view",{actions:e}),t&&L.logCampaignImpression(t)},logDismiss:e=>{o.ProEventsLogger.log("rich_snackbar_dismiss",{actions:e}),t&&L.logCampaignDismissed(t)},logCloseClick:e=>o.ProEventsLogger.log("rich_snackbar_close_click",{actions:e}),actionNames:e.actions.map((e=>e.name))}),bt=20;var vt;function Lt(e){return e.some((e=>e.status===l.FileStatusType.SET_PERMISSIONS||e.status===l.FileStatusType.PENDING||e.status===l.FileStatusType.UPLOADING))?vt.UPLOADING:e.some((e=>e.status===l.FileStatusType.FAILED))?vt.ERROR:vt.COMPLETE}function At(e,t){return e.count((e=>e.status===t))}function It(e){return e.count((e=>e.status!==l.FileStatusType.CANCELLED))}function Ut(e){return l.isUploadTypeError(e)?function(e){switch(e){case l.UploadErrorType.OVER_QUOTA_ERROR:return p.intl.formatMessage({id:"uVZpJw",defaultMessage:"out of space"});case l.UploadErrorType.FILE_SIZE_ERROR:return p.intl.formatMessage({id:"tsdRAZ",defaultMessage:"file too large"});case l.UploadErrorType.CONNECTION_ERROR:return p.intl.formatMessage({id:"vfWhT4",defaultMessage:"lost connection"});case l.UploadErrorType.HTTP_ERROR:return p.intl.formatMessage({id:"b/nZwr",defaultMessage:"server error"});case l.UploadErrorType.EMPTY_OR_FOLDER:return p.intl.formatMessage({id:"Gi+irE",defaultMessage:"can’t upload folders or empty files"});case l.UploadErrorType.FOLDER_SAFARI:return p.intl.formatMessage({id:"Y5AhQP",defaultMessage:"try uploading files separately"});case l.UploadErrorType.PACKAGE_FILE:return p.intl.formatMessage({id:"HjCRjv",defaultMessage:"OSX package file"});case l.UploadErrorType.UPLOAD_PRECHECK_INVALID_CHAR_ERROR:case l.UploadErrorType.INVALID_FILE_NAME:return p.intl.formatMessage({id:"f98azI",defaultMessage:"filename contains invalid character"});case l.UploadErrorType.PERMISSIONS_AT_UPLOAD_ERROR:case l.UploadErrorType.COMMIT_PERMISSIONS_ERROR:return p.intl.formatMessage({id:"K+VjRY",defaultMessage:"could not apply permissions"});case l.UploadErrorType.INVALID_EXTENSION:return p.intl.formatMessage({id:"1OLuBC",defaultMessage:"file extension is invalid"});case l.UploadErrorType.BLOCKS_MISSING_ERROR:case l.UploadErrorType.COMMIT_HTTP_ERROR:case l.UploadErrorType.UPLOAD_BLOCK_ERROR:case l.UploadErrorType.SERVER_RESPONSE_ERROR:case l.UploadErrorType.SERVER_TOKEN_EMPTY_ERROR:case l.UploadErrorType.SERVER_TOKENS_MISSING_ERROR:case l.UploadErrorType.SERVER_HASH_RESPONSE_ERROR:case l.UploadErrorType.SERVER_HASH_EMPTY_ERROR:case l.UploadErrorType.HASHES_NOT_EQUAL_ERROR:case l.UploadErrorType.UPLOAD_PRECHECK_ERROR:case l.UploadErrorType.START_UPLOAD_SESSION_ERROR:case l.UploadErrorType.GENERIC:case l.UploadErrorType.LOCKED_TEAM_ERROR:case l.UploadErrorType.COMMIT_TOO_MANY_WRITES_ERROR:case l.UploadErrorType.COMMIT_UPLOAD_SESSION_GENERIC_ERROR:case l.UploadErrorType.COMMIT_UPLOAD_SESSION_NOT_FOUND:return p.intl.formatMessage({id:"b/nZwr",defaultMessage:"server error"});case l.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR:case l.UploadErrorType.CLIENT_HASH_EMPTY_ERROR:case l.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR:case l.UploadErrorType.BLOCK_INDEX_ERROR:case l.UploadErrorType.BLOCK_EMPTY_ERROR:case l.UploadErrorType.BLOB_EMPTY_ERROR:case l.UploadErrorType.BLOB_MISSING_ERROR:case l.UploadErrorType.CLIENT_HASH_DIGEST_ERROR:case l.UploadErrorType.FILE_READER_NULL_RESULT_ERROR:case l.UploadErrorType.APPEND_BLOCK_MISSING_PARAMS:case l.UploadErrorType.APPEND_INCORRECT_OFFSET:case l.UploadErrorType.APPEND_INVALID_DATA_SIZE:case l.UploadErrorType.APPEND_INVALID_OFFSET:case l.UploadErrorType.COMMIT_CONCURRENT_SESSION_DATA_NOT_ALLOWED:case l.UploadErrorType.COMMIT_CONFLICT_ERROR:case l.UploadErrorType.COMMIT_DISALLOWED_NAME:case l.UploadErrorType.COMMIT_DOES_NOT_FIT_TEMPLATE:case l.UploadErrorType.COMMIT_DUPLICATE_PROPERTY_GROUPS:case l.UploadErrorType.COMMIT_INVALID_ARGS:case l.UploadErrorType.COMMIT_MALFORMED_PATH:case l.UploadErrorType.COMMIT_PROPERTY_FIELD_TOO_LARGE:case l.UploadErrorType.COMMIT_READINESS_ERROR:case l.UploadErrorType.COMMIT_TEMPLATE_NOT_FOUND:case l.UploadErrorType.COMMIT_UNSUPPORTED_FOLDER:case l.UploadErrorType.PAYLOAD_TOO_LARGE:case l.UploadErrorType.IGNORED:return p.intl.formatMessage({id:"NpsjeY",defaultMessage:"upload processing error"})}}(e):p.intl.formatMessage({id:"m/cR6w",defaultMessage:"an unknown error occurred"})}function Dt(e,t){if(t)return;const a=At(e,l.FileStatusType.PENDING),s=p.intl.formatMessage({id:"MZCMJM",defaultMessage:"{count, plural, one{{count} file left} other{{count} files left}}"},{count:a});return a>0?s:p.intl.formatMessage({id:"ut04US",defaultMessage:"View details"})}function Ft(e,t){const a=Lt(e),s=It(e);if(t)return p.intl.formatMessage({id:"UhMk+M",defaultMessage:"Uploading {filename}"},{filename:o.Emstring.em_snippet(t.name,bt)});if(a===vt.UPLOADING)return p.intl.formatMessage({id:"sHyWgn",defaultMessage:"Starting upload..."});if(a===vt.COMPLETE){if(s>1)return p.intl.formatMessage({id:"1I2L6w",defaultMessage:"Uploaded {num_files} files"},{num_files:s});if(1===s){const t=function(e){return e.filter((e=>e.status!==l.FileStatusType.CANCELLED)).last()}(e);return p.intl.formatMessage({id:"JS4aqp",defaultMessage:"Uploaded {filename}"},{filename:o.Emstring.em_snippet(t.name,bt)})}return p.intl.formatMessage({id:"5B2AGb",defaultMessage:"Upload canceled"})}return""}function xt(e,t){const a=Lt(e);return t||a!==vt.ERROR?Ft(e,t):function(e){const t=It(e),a=At(e,l.FileStatusType.FAILED);if(t>1){const s=At(e,l.FileStatusType.COMPLETE);return p.intl.formatMessage({id:"bfG+or",defaultMessage:"{count, plural, one{Uploaded {count} of {num_files} files} other{Uploaded {count} of {num_files} files}}"},{count:s,num_files:t})+" - "+p.intl.formatMessage({id:"lTOxVL",defaultMessage:"{count, plural, one{{count} error} other{{count} errors}}"},{count:a})}{const{errorType:t}=e.last();return t===l.UploadErrorType.GENERIC?p.intl.formatMessage({id:"KbJSNk",defaultMessage:"Unable to upload {filename}"},{filename:o.Emstring.em_snippet(e.last().name,bt)}):t===l.UploadErrorType.LOCKED_TEAM_ERROR?p.intl.formatMessage({id:"tQ1bJN",defaultMessage:"Can’t upload. Your team no longer has full use of {trademark_business} features."},{trademark_business:A.TRADEMARK_BUSINESS}):p.intl.formatMessage({id:"XwpHsG",defaultMessage:"Unable to upload {filename}: {reason}"},{filename:o.Emstring.em_snippet(e.last().name,bt),reason:Ut(t)})}}(e)}function Nt({fileList:e,currentUpload:t,numSecondsLeft:a,onViewDetails:r,onShown:n,onClosed:i,allowParallelUpload:c,campaigns:d,snackbarOpenWithReplay:u}){const m=Lt(e);let _;_=m===vt.UPLOADING?"sync":m===vt.ERROR?"fail":"complete";let g="";m===vt.UPLOADING&&a&&(g=" - "+o.format_time_remaining(a));let f=p.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"});m===vt.UPLOADING&&(f="");const h=c?e.find((e=>e.status===l.FileStatusType.UPLOADING)):t,R=xt(e,h);let S;It(e),"complete"===_&&e.filter((e=>e.status!==l.FileStatusType.CANCELLED)).count()>0&&(S=yt(e,_,{snackbarOpenWithReplay:u},d)),o.Snackbar.manager||"complete"!==_&&"fail"!==_||E.AccessibleAnnounce.polite(R);const T=function(e,t){const a=Lt(e);return a===vt.UPLOADING&&t?t.percentUploaded:a===vt.COMPLETE||a===vt.ERROR?100:0}(e,h),M={closeButtonText:f,onCloseClick:()=>{},onTimeout:()=>{},actionButtonText:Dt(e,Boolean(S)),onActionClick:r,title:R+g,variant:_,timeoutDelayMsForCompleteVariant:15e3,externalProgress:T,onClosed:i,onShown:n,id:"inline-upload-snackbar",isLowPriority:!0,accessibleAnnouncement:R,richSnackbarProps:S};o.Snackbar.manager&&(M.timeoutDelayMsForCompleteVariant=void 0),o.Snackbar.update(s.React$1.createElement(o.Snackbar,Object.assign({},M)))}!function(e){e.UPLOADING="uploading",e.ERROR="error",e.COMPLETE="complete"}(vt||(vt={}));function kt(e){var{user:t,overQuotaDetails:r,fileUploadMethod:n}=e,i=a.__rest(e,["user","overQuotaDetails","fileUploadMethod"]);const c=i.isTeamUser&&!i.isContentManager,[d,u]=s.React$1.useState(!0),m=()=>{var e;g(),u(!1),null===(e=i.onModalDismissed)||void 0===e||e.call(i)},_=`wb_oq_${n}`,g=()=>{o.NQOQLogger.logCloseModal(_,{modal_type:"billboard"});const{locationCode:e}=f();E(e,"close")};s.React$1.useEffect((()=>{(()=>{const e=l.getOQmodalOQALocationCode(i.pathname);E(e,"view")})(),o.NQOQLogger.logViewModal(_,{modal_type:"billboard"})}),[]);const E=(e,t)=>{if(["ho","fb"].includes(e)){let a;switch(i.overQuotaStatus){case l.OverQuotaStatusType.BASIC_NEAR_QUOTA:a="near";break;case l.OverQuotaStatusType.BASIC_OVER_QUOTA:a="over";break;case l.OverQuotaStatusType.NONE:a="under";break;default:a=void 0}const{trackingButtonLabel:s,buttonUrl:r}=f();o.GrowthEventsLogger.log(`${_}_${e}`,{action:t,button_text:s,destination_url:r.split("?")[0],location:"overlay",quota_status:"over",upsell_type:"modal",initial_quota_status:a})}},f=()=>{const e=l.getOQmodalOQALocationCode(i.pathname);let a=ct.OUT_OF_SPACE_URL+`?oqa=${_}_${e}`,o=Pt.getMoreSpaceButton,n="get more space";return[l.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,l.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(i.overQuotaStatus)?(a=(()=>{let e;return t.is_cdm_member&&!t.is_team_admin&&r&&r.numTeamAdmins>0?r.promptAdminToUpgradeEmailTemplateUrl:(e=r&&1===r.numTeamAdmins?"/plans":"/team/upgrade",new s.URI({path:e,query:{_tk:"over_quota",_camp:"upload_modal",oqa:"upl_b"}}).toString())})(),t.is_cdm_member&&(!t.is_team_admin||r&&r.numTeamAdmins>0)&&(o=Pt.askMoreSpaceButton,n="ask for more space")):i.isLockedTeam?(a="/team/decide",o=Pt.seeNextStepsButton,n="see next steps"):c&&(a="/help/business/space-limit-full",o=Pt.learnMoreButton,n="learn more about dropbox space"),{buttonUrl:a,buttonLabel:o,locationCode:e,trackingButtonLabel:n}},{buttonUrl:h,buttonLabel:R}=f();return s.React$1.createElement(o.Modal$1,{open:d,onRequestClose:m},s.React$1.createElement(o.Modal$1.Body,null,s.React$1.createElement("div",null,s.React$1.createElement("div",{style:{width:"60%",margin:"0 auto"}},s.React$1.createElement(U.FilesOld2Spot,null)),s.React$1.createElement(o.Title,null,(()=>{let e=Pt.dbxFull;return i.isLockedTeam?e=Pt.cantUpload:c&&(e=Pt.cantUploadFile),e})()),s.React$1.createElement(o.Text,null,(()=>{let e=Pt.dbxOutOfSpace;if(t.is_cdm_member&&[l.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,l.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(i.overQuotaStatus)&&r){let a;if(i.overQuotaStatus===l.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA)a=p.intl.formatMessage({id:"eVpI8G",defaultMessage:"Your member folder is full, so no new files can be added"});else{const{team_name:e}=o.Viewer.get_viewer();a=p.intl.formatMessage({id:"p8/jOi",defaultMessage:"The {team_name} shared workspace is full, so no new files can be added"},{team_name:e})}e=t.is_team_admin||!r.numTeamAdmins?p.intl.formatMessage({id:"GolcMz",defaultMessage:"{count, plural, one{{dropbox_full_message}. To get more space, upgrade your account.} other{{dropbox_full_message}. To get more space, upgrade to {trademark_business}.}}"},{count:r.numTeamMembers,dropbox_full_message:a,trademark_business:A.TRADEMARK_BUSINESS}):p.intl.formatMessage({id:"yLQ0gT",defaultMessage:"{count, plural, one{{dropbox_full_message}. To get more space, ask your Dropbox admin ({admin_email}).} other{{dropbox_full_message}. To get more space, ask your Dropbox admins ({admin_email} and {num_other_admins} others).}}"},{count:r.numTeamAdmins,dropbox_full_message:a,admin_email:r.teamAdminEmail,num_other_admins:r.numTeamAdmins-1})}if(i.oqFilename&&(e=p.intl.formatMessage({id:"tZnEbs",defaultMessage:"In order to finish uploading {filename}, you need to add more storage to your Dropbox."},{filename:i.oqFilename})),i.isLockedTeam){const t=o.Viewer.get_viewer().work_user;e=t&&t.is_team_admin?Pt.teamAdminOutofSpace:Pt.teamOutOfSpace}else c&&(e=p.intl.formatMessage({id:"HuFRIc",defaultMessage:"Your Dropbox account is full. To add this file, remove files or ask your admin for more space."}));return e})()))),s.React$1.createElement(o.Modal$1.Footer,null,s.React$1.createElement(o.Button$1,{variant:"opacity",onClick:m,"data-testid":"oq-upsell-close-button"},p.intl.formatMessage({id:"1Pqc4z",defaultMessage:"Close"})),s.React$1.createElement(o.Button$1,{href:h,variant:"primary",onClick:()=>{const{locationCode:e,trackingButtonLabel:t}=f();o.NQOQLogger.logAcceptModal(_,{modal_type:"billboard",cta_text:t}),E(e,"click")},"data-testid":"oq-upsell-confirm-button"},R)))}const Pt={dbxOutOfSpace:p.intl.formatMessage({id:"Pw8npz",defaultMessage:"You can’t upload files because you’re out of storage space. Before you can upload to Dropbox, you need to get more space."}),dbxFull:p.intl.formatMessage({id:"8R3KaE",defaultMessage:"Your Dropbox is full"}),cantUpload:p.intl.formatMessage({id:"SeVOq4",defaultMessage:"Can’t upload to Dropbox"}),cantUploadFile:p.intl.formatMessage({id:"uFwg1z",defaultMessage:"Can’t upload file"}),teamAdminOutofSpace:p.intl.formatMessage({id:"lyIL9W",defaultMessage:"Your team no longer has full use of {trademark_business} features. Add your billing info now and you can pick up right where you left off."},{trademark_business:A.TRADEMARK_BUSINESS}),teamOutOfSpace:p.intl.formatMessage({id:"0Z3ZFO",defaultMessage:"Your team no longer has full use of {trademark_business} features. To keep using {trademark_business}, contact your admin."},{trademark_business:A.TRADEMARK_BUSINESS}),getMoreSpaceButton:p.intl.formatMessage({id:"eE3bQq",defaultMessage:"Get more space"}),askMoreSpaceButton:p.intl.formatMessage({id:"J1cfo9",defaultMessage:"Ask for more space"}),seeNextStepsButton:p.intl.formatMessage({id:"4LQCKL",defaultMessage:"See next steps"}),learnMoreButton:p.intl.formatMessage({id:"NWOHm8",defaultMessage:"Learn more about Dropbox space"})},wt=(e,t)=>e&&t?`wb_nq_${e}_${"/h"===t?"ho":"fb"}`:"upl_nq",$t=e=>{const t=e.oqa?`?oqa=${e.oqa}`:"";return s.React$1.createElement("div",{className:"nearquota-alt-action"},s.React$1.createElement(o.Banner,{type:"warning"},s.React$1.createElement(o.Banner.Message,null,p.intl.formatMessage({id:"6DbW2J",defaultMessage:"You’re almost out of storage space."})),s.React$1.createElement(o.Banner.Actions,null,s.React$1.createElement(o.Button$1,{variant:"transparent",key:"nq-link",href:`/low-space${t}`},p.intl.formatMessage({id:"aIkHtJ",defaultMessage:"Add storage"})))))};$t.displayName="NearquotaUploadAltActionComponent";const Bt=o.requireCssWithComponent($t,["/static/metaserver/static/css/nearquota_upload_alt_action-vflOyxyD8.css"]);class Gt extends s.React$1.Component{render(){return s.React$1.createElement("div",{onKeyDown:e=>{27===e.keyCode&&e.isDefaultPrevented()&&e.stopPropagation()},style:{display:"inline-block"}},this.props.children)}}Gt.Capture=e=>s.React$1.createElement("div",{onKeyDown:e=>{27===e.keyCode&&e.preventDefault()}},e.children),Gt.displayName="EscapeKeyGuard";const zt=e=>{const t=s.React$1.useRef(null),a=s.React$1.useRef(null),i=s.React$1.useRef(null),d=o.useSelector(c.getUser),m=o.useSelector(c.getPath),_=o.useSelector(c.getFileList),g=o.useSelector(c.getNumDraggingFiles),E=o.useSelector(c.getOverQuotaStatus),[h,R]=s.React$1.useState(!0),S=o.usePrevious(_);s.React$1.useEffect((()=>{if(S&&_.count()>S.count()){T();const e=a.current;let t;null!=e&&(e.querySelectorAll(".upload-file")&&(t=e.querySelectorAll(".upload-file")[S.count()]),t&&t.scrollIntoView({behavior:"smooth"}))}}),[_]);const T=()=>{var e;null===(e=i.current)||void 0===e||e.focus()},M=s.React$1.useMemo((()=>_.some((e=>e.status===l.FileStatusType.PENDING||e.status===l.FileStatusType.UPLOADING))),[_]),y=t=>{e.handleAddMoreFilesOrFolder(t),t?f.logUploadAction({user:d,action:o.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK,chooser_type:l.ChooserType.FOLDER,upload_method:n.UploadMethod.CHOOSER}):f.logUploadAction({user:d,action:o.WebUserActionLogEvent.UPLOAD_FILES_CLICK,chooser_type:l.ChooserType.FILE,upload_method:n.UploadMethod.CHOOSER})},C=s.React$1.useCallback((t=>{B.ActionsAdapter.emit("fileCanceled",{uploadFiles:[t]});o.logEvent(r.PAP_Upload_File({eventState:"canceled",fileSize:t.fileSize,fileType:(e=>D.getFileTypeFromString(o.file_extension(e.name)))(t),batchIdString:t.batchId,uploadId:t.uploadId})),e.handleCancelUpload(t)}),[e.handleCancelUpload]),O=()=>{R(!1),e.onModalDismissed&&e.onModalDismissed()},b=M?p.intl.formatMessage({id:"5fnw5C",defaultMessage:"Hide"}):p.intl.formatMessage({id:"VHlGpS",defaultMessage:"Done"}),v=Jt(d,e.isTeamOnboarding,E),L=u.is_input_webkitdirectory_supported()?s.React$1.createElement(Ht,{user:d,handleFileChoose:y}):s.React$1.createElement(o.Button$1,{ref:i,variant:"opacity",onClick:()=>{y(!1),f.logUploadAction({user:d,action:o.WebUserActionLogEvent.ADD_MORE_FILES_CLICK})}},p.intl.formatMessage({id:"9LGAlt",defaultMessage:"Add more files"}));return s.React$1.createElement("div",{ref:t},s.React$1.createElement(P.UXAnalyticsModalTracking,{id:"uploader-modal"}),s.React$1.createElement(o.Modal$1,{className:"uploader-modal-root","aria-label":v,title:v,open:h,width:660,withCloseButton:"Close",shouldCloseOnOverlayClick:!0,onRequestClose:O,shouldFocusAfterRender:!0,onLoad:T},s.React$1.createElement("div",{"data-testid":"uploader-modal-root"}),s.React$1.createElement(Kt,{user:d,path:m,numDraggingFiles:g}),s.React$1.createElement(o.Modal$1.Header,{hasBottomSpacing:"title-standard"},s.React$1.createElement(o.Modal$1.Title,null,v)),s.React$1.createElement(o.Text,{variant:"paragraph",size:"standard",tagName:"h3",className:l.modalSubtitle},p.intl.formatMessage({id:"MlWtl7",defaultMessage:"Drag and drop here to add more"})),s.React$1.createElement(o.Modal$1.Body,{className:"uploader-modal-body",tabIndex:0,hasVerticalSpacing:!1},s.React$1.createElement("ol",{ref:a,id:"upload-files-list",className:"upload-files-list"},_.toArray().map((t=>s.React$1.createElement(qt,{key:t.uploadId,file:t,getCMUriForFqPath:e.getCMUriForFqPath,handleFileCancel:C,isContentManager:e.isContentManager,isSomethingUploading:M,shouldShowDestinationLink:e.shouldShowDestinationLink,user:d,expUserLevelSharingSettings:e.expUserLevelSharingSettings})))),(()=>{if(_.some((e=>e.status===l.FileStatusType.COMPLETE))&&E===l.OverQuotaStatusType.BASIC_NEAR_QUOTA){const t=wt(e.lastFileUploadMethod,o.get_uri().path);return s.React$1.createElement(Bt,{oqa:t})}return null})()),s.React$1.createElement(o.Modal$1.Footer,{className:"uploader-modal-footer"},s.React$1.createElement(Yt,null),L,s.React$1.createElement(o.Button$1,{"data-testid":"uploader-modal-primary-action",variant:"primary",onClick:()=>{f.logUploadAction({user:d,action:o.WebUserActionLogEvent.CLOSE_MODAL_CLICK}),O()}},b))))};zt.displayName="UploadStatusModal";const qt=({file:e,getCMUriForFqPath:t,handleFileCancel:a,isContentManager:r,isSomethingUploading:n,shouldShowDestinationLink:i,user:c,expUserLevelSharingSettings:d})=>{let u;u=e.status===l.FileStatusType.UPLOADING?e.percentUploaded:e.status===l.FileStatusType.PENDING?0:100;const m={"upload-file":!0,complete:e.status===l.FileStatusType.COMPLETE,cancelled:e.status===l.FileStatusType.CANCELLED,error:e.status===l.FileStatusType.FAILED},_=o.cx(m),g=o.Emstring.em_snippet(e.name,13),E=e.fileSize?o.format_bytes(e.fileSize):"",f=s.React$1.createRef(),h=null==e?void 0:e.numSecondsLeft,R=n&&h?o.format_time_remaining(h):"",S=p.intl.formatMessage({id:"n0GA/S",defaultMessage:"In queue"});return s.React$1.createElement("li",{className:_,key:e.uploadId,style:{backgroundSize:u+"% 4px"}},s.React$1.createElement("div",{className:"upload-file-info",style:{overflow:"hidden"}},s.React$1.createElement(Vt,{file:e,handleFileCancel:a}),s.React$1.createElement("div",{className:"filename-col"},s.React$1.createElement(o.FileIcon,{className:"brws-file-name-cell-icon",path:e.name,role:"presentation"}),s.React$1.createElement("span",{className:"filename"}," ",g," "),e.status===l.FileStatusType.COMPLETE&&s.React$1.createElement("span",{className:"size"}," ",E," ")),e.status===l.FileStatusType.COMPLETE&&i&&s.React$1.createElement(Qt,{file:e,isContentManager:r,getCMUriForFqPath:t}),e.status===l.FileStatusType.FAILED&&s.React$1.createElement(jt,{file:e,isContentManager:r,user:c}),e.status===l.FileStatusType.PENDING&&s.React$1.createElement("div",{className:"time-left"},S),e.status===l.FileStatusType.UPLOADING&&s.React$1.createElement("div",{className:"time-left"},R),e.status===l.FileStatusType.COMPLETE&&s.React$1.createElement(Wt,{user:c,modalRef:f,file:e,expUserLevelSharingSettings:d}),s.React$1.createElement("div",{ref:f})))};qt.displayName="UploadModalFileListRow";const Vt=({file:e,handleFileCancel:t})=>{const a=a=>{a.preventDefault(),t(e)};if(e.status===l.FileStatusType.UPLOADING&&100===e.percentUploaded)return s.React$1.createElement("div",{className:"status-col"},s.React$1.createElement(x.IconStatus,{height:"16px",width:"16px","aria-label":p.intl.formatMessage({id:"dyc22F",defaultMessage:"Finishing upload"}),name:"sync"}));if(e.status===l.FileStatusType.PENDING||e.status===l.FileStatusType.UPLOADING)return s.React$1.createElement("div",{className:"status-col"},s.React$1.createElement(o.Button$1,{variant:"transparent",className:"upload-cancel-button","data-testid":"upload-cancel-button",onClick:a},s.React$1.createElement(N.IconChooser,{name:"search-cancel","aria-label":p.intl.formatMessage({id:"1B7zHK",defaultMessage:"Cancel"})})));let r,n="complete";switch(e.status){case l.FileStatusType.COMPLETE:n="complete",r=p.intl.formatMessage({id:"Pr70Iu",defaultMessage:"Completed"});break;case l.FileStatusType.CANCELLED:n="warn",r=p.intl.formatMessage({id:"4OM0H+",defaultMessage:"Upload canceled"});break;case l.FileStatusType.FAILED:n="fail",r=p.intl.formatMessage({id:"QFMGYv",defaultMessage:"Error"});break;default:return s.React$1.createElement("div",{className:"status-col"})}return s.React$1.createElement("div",{className:"status-col"},s.React$1.createElement(x.IconStatus,{height:"16px",width:"16px","aria-label":r,name:n}))};Vt.displayName="FileListRowStatus";const Qt=({file:e,isContentManager:t,getCMUriForFqPath:a})=>{if(e.status===l.FileStatusType.CANCELLED)return s.React$1.createElement("div",{className:"dest-col"},p.intl.formatMessage({id:"E9pip7",defaultMessage:"Canceled"}));let r,n;const i=o.Viewer.get_viewer().get_user_by_id(e.userId);return t?(r="",n=a(e.dest)):(r=k.get_browse_root_name(i),n=o.browse_uri_for_fq_path(i,e.dest).toString()),s.React$1.createElement("div",{className:"dest-col"},s.React$1.createElement("a",{href:n},s.React$1.createElement(w.TruncatedString,{text:`${r}${e.dest}`,variant:w.TruncatedStringVariant.TRUNCATED_STRING_START})))};Qt.displayName="FileListRowDest";const jt=({file:e,isContentManager:t,user:a})=>{let r,n;return r=e.errorMessage&&e.errorMessage.length>0?e.errorMessage:p.intl.formatMessage({id:"o6vFum",defaultMessage:"Something went wrong while uploading this file."}),n=e.errorType===l.UploadErrorType.FILE_SIZE_ERROR?p.intl.formatMessage({id:"TbtJyb",defaultMessage:"File too large"}):p.intl.formatMessage({id:"BG2rbV",defaultMessage:"Upload Error"}),s.assert(null!=a,"user is null"),a.is_team&&e.errorType===l.UploadErrorType.OVER_QUOTA_ERROR&&!t&&(r=p.intl.formatMessage({id:"1/Swud",defaultMessage:"Your Dropbox account is full. To add this file, remove files or ask your admin for more space."}),n=p.intl.formatMessage({id:"jmkpma",defaultMessage:"Can’t upload file"})),s.React$1.createElement("div",{className:"error-col"},s.React$1.createElement("span",{className:"error-msg"},n),s.React$1.createElement("span",{className:"error-details"},s.React$1.createElement(o.Tooltip,{placement:"right",title:r},s.React$1.createElement("div",{className:"error-details-tooltip-target",tabIndex:0},s.React$1.createElement(F.IconInline,{name:"info","aria-label":p.intl.formatMessage({id:"0JARub",defaultMessage:"More information"})})))))};jt.displayName="FileListRowError";const Ht=({user:e,handleFileChoose:t})=>s.React$1.createElement(Gt,null,s.React$1.createElement(o.Menu.Wrapper,{onSelection:t,onToggle:({isOpen:t})=>{t&&f.logUploadAction({user:e,action:o.WebUserActionLogEvent.ADD_MORE_FILES_CLICK})}},(({getContentProps:e,getTriggerProps:t})=>s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.Button$1,Object.assign({},t(),{variant:"opacity"}),p.intl.formatMessage({id:"mChtPJ",defaultMessage:"Add more files"})),s.React$1.createElement(o.Menu.Content,Object.assign({},e(),{placement:"top"}),s.React$1.createElement(o.Menu.Segment,null,s.React$1.createElement(Gt.Capture,null,s.React$1.createElement(o.Menu.ActionItem,{key:"Files",value:!1,className:"action-upload-files",disabled:!1},s.React$1.createElement(o.UIIcon,{src:o.UploadFileLine,className:"popover-item-icon"}),p.intl.formatMessage({id:"v/OFBA",defaultMessage:"Files"})),s.React$1.createElement(o.Menu.ActionItem,{key:"Folder",value:!0,className:"action-upload-folder",disabled:!1},s.React$1.createElement(o.UIIcon,{src:o.UploadFolderLine,className:"popover-item-icon"}),p.intl.formatMessage({id:"kEZNl7",defaultMessage:"Folder"})))))))));Ht.displayName="AddMoreFilesMenu";const Wt=({file:e,user:t,modalRef:a,expUserLevelSharingSettings:r})=>{const n=p.intl.formatMessage({id:"8QMEOE",defaultMessage:"Copy link"});return s.React$1.createElement(o.Button$1,{className:"copy-link-button",variant:"opacity",onClick:()=>((e,a)=>{if(t){const s=(e,t)=>{o.getStoreForBrowse().dispatch({type:o.ActionTypes$3.SET_IS_CREATING_SHARED_LINK,payload:{fileIdOrPath:t,isCreatingSharedLink:e}})};O.CopyLinkMiniModal.show({user:t,filePath:e.dest+"/"+e.name,setIsCreatingSharedLink:s,anchorRef:a,zIndexOverride:1e4,userActionSource:o.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL,yOffsetDistance:20,isInUserLevelSharingSettings:"ON"===r},"copy-link-modal")}})(e,a)},n)};Wt.displayName="CopyLinkButton";const Yt=()=>s.React$1.createElement("div",{className:"upload-modal-link"},p.intl.formatMessage({id:"V4uuab",defaultMessage:"Having problems? Please try again or see our Help center <a>here</a>."},{a:e=>s.React$1.createElement("a",{key:"modal-link",href:"/help/space/upload-limitations",rel:"noopener noreferrer",target:"_blank"},e)}));Yt.displayName="HelpLink";const Kt=({numDraggingFiles:e,path:t,user:a})=>{const r=p.intl.formatMessage({id:"KMQkGZ",defaultMessage:"{count, plural, one{Drop your file to {upload_action}} other{Drop your files to {upload_action}}}"},{count:e,upload_action:l.makeUploadSnippet(20,a,t)}),n={[l.modalDropzone]:!0,[l.dropzoneVisible]:e>0,[l.dropzoneContainer]:!0};return s.React$1.createElement($.DropzoneOutline,{location:"upload_status_modal"},s.React$1.createElement("div",{className:o.cx(n)},r))};Kt.displayName="Dropzone";const Jt=(e,t,a)=>{let o;return s.assert(null!=e,"user is null"),o=t?p.intl.formatMessage({id:"90d3KF",defaultMessage:"Which files would you like to add?"}):e.is_cdm_member&&a in[l.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,l.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA]?p.intl.formatMessage({id:"Px//ha",defaultMessage:"More space needed"}):p.intl.formatMessage({id:"v0yMM4",defaultMessage:"Upload Details"}),o},Zt=e=>!!e.is_team&&o.Viewer.get_viewer().team_is_limited,Xt="d&d-upload-snackbar",ea={notThisFolderError:p.intl.formatMessage({id:"sVwi15",defaultMessage:"You don’t have permission to add to this folder."}),teamNotLongerTrademark:p.intl.formatMessage({id:"aJ2o2T",defaultMessage:"Can’t upload. Your team no longer has full use of {trademark_business} features."},{trademark_business:A.TRADEMARK_BUSINESS}),lockedVault:p.intl.formatMessage({id:"6ASmGo",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}),noDragOnBackups:{defaultMessage:"Files can’t be moved into backups.",description:"Error snackbar when trying to drag a file in backups"}};o.injectInternalStyle("typescript/component_libraries/files_components/src/bottom-drawer/index.module.out.css",(e=>"._bottom-drawer-header_q16fd_1{align-items:center;background-color:var(--color__opacity--1);border:1px solid var(--color__standard__border);box-sizing:content-box;cursor:pointer;display:flex;flex-direction:row;height:40px;justify-content:space-between;margin:0 -1px;padding:0 var(--spacing__unit--2)}._bottom-drawer-inner_q16fd_17{display:flex;flex-direction:column}._bottom-drawer-resize-handle_q16fd_22{background:transparent;cursor:row-resize;height:5px;position:absolute;top:0;width:100%}._bottom-drawer-container_q16fd_31{background-color:var(--color__elevated__background);bottom:0;box-shadow:var(--boxshadow__elevation1);position:fixed;width:440px}._bottom-drawer-body_q16fd_39{flex-grow:1;overflow-y:scroll}._bottom-drawer-footer_q16fd_44{align-items:center;border-top:1px solid var(--color__standard__border);display:flex;flex-direction:row;flex-shrink:0;height:60px;justify-content:right;padding:0 var(--spacing__unit--2)}"));const ta="_bottom-drawer-header_q16fd_1",aa="_bottom-drawer-inner_q16fd_17",sa="_bottom-drawer-resize-handle_q16fd_22",oa="_bottom-drawer-container_q16fd_31",ra="_bottom-drawer-body_q16fd_39",na="_bottom-drawer-footer_q16fd_44",la=({children:e,title:t,initialExpandedHeight:a,maxHeight:r,minHeight:n,progressValue:l,headerRightElement:i,isExpanded:c,toggle:d,footer:u,distanceFromRight:p=8,onResize:m,scrollContainerRef:_,className:g,headerDataCampaignsElementId:E,minDistanceFromTop:f})=>{const[h,R]=s.reactExports.useState(!1),[S,T]=s.reactExports.useState(a),M=s.React$1.useRef(null),y=s.reactExports.useCallback((e=>{var t;null===(t=M.current)||void 0===t||t.releasePointerCapture(e.pointerId),R(!1)}),[]),C=s.reactExports.useCallback((e=>{var t;e.preventDefault(),e.stopPropagation(),R(!0),null===(t=M.current)||void 0===t||t.setPointerCapture(e.pointerId),window.addEventListener("pointerup",y,{once:!0})}),[y]);s.reactExports.useEffect((()=>{const e=e=>{h&&T((t=>{const a=t-e.movementY,s=Math.max(Math.min(a,r),n);return m&&m(s),s}))};return window.addEventListener("pointermove",e),()=>{window.removeEventListener("pointermove",e)}}),[h,r,n,S,m]);const O=`calc(100vh - ${f+40}px)`;return s.React$1.createElement(o.Layer,null,s.React$1.createElement("div",{className:o.cx(oa,g),role:"alert",style:{right:p},"data-testid":"bottom-drawer_container"},c&&s.React$1.createElement("div",{className:sa,onPointerDown:C,ref:M}),s.React$1.createElement("div",{onClick:d,className:ta,"data-campaigns-element-id":E},s.React$1.createElement(o.Text,{"data-test-id":"bottom-drawer-title"},t),i),s.React$1.createElement("div",{style:c?{height:S,maxHeight:O,minHeight:"158px"}:{height:0},className:aa},s.React$1.createElement("div",{"data-testid":"bottom-drawer_body",ref:_,className:ra},e),u&&s.React$1.createElement("div",{className:na},u)),!c&&void 0!==l&&s.React$1.createElement(o.ProgressBar,{in:!0,value:l})))};la.displayName="BottomDrawer";o.injectInternalStyle("typescript/component_libraries/files_components/src/persistent-upload/index.module.out.css",(e=>"._upload-file-row-container_1p35g_1{border-bottom:1px solid var(--color__faint__border);height:58px}._upload-file-row_1p35g_1{align-items:center;display:flex;height:54px;justify-content:flex-start;padding:0 var(--spacing__unit--2)}._upload-file-icon--xsmall_1p35g_17{flex-shrink:0;height:24px;width:24px}._upload-status-icon_1p35g_23{flex-shrink:0}._upload-file-row-file-name_1p35g_27{flex-grow:2;padding:0 var(--spacing__unit--1)}"));const ia="_upload-file-row-container_1p35g_1",ca="_upload-file-row_1p35g_1",da="_upload-status-icon_1p35g_23",ua="_upload-file-row-file-name_1p35g_27";var pa;!function(e){e.COMPLETE="COMPLETE",e.PENDING="PENDING",e.ERROR="ERROR",e.UPLOADING="UPLOADING"}(pa||(pa={}));const ma=({file:e,status:t,button:a,statusDescription:r,percentUploaded:n,onActive:l,onBlur:i,intl:c})=>s.reactExports.createElement("div",{"data-testid":"persistent-upload-file-row",className:ia,onFocus:l,onMouseOver:l,onMouseLeave:i,onBlur:i},s.reactExports.createElement("div",{className:ca},s.reactExports.createElement(_a,{status:t,intl:c}),s.reactExports.createElement("div",{className:ua},s.reactExports.createElement(V.LabelGroup,{withText:s.reactExports.createElement(o.Text,{size:"small"},s.reactExports.createElement(j.Truncate,{location:.5,maxWidth:240,"data-testid":"fileRow-fileName"},e.title)),withSubtext:r,withLeftAccessory:s.reactExports.createElement(Q.FileIcon,{file:e,size:"xsmall"})})),a),t===pa.UPLOADING&&s.reactExports.createElement(o.ProgressBar,{isStatic:!0,value:n}));ma.displayName="UploadFileRow";const _a=({status:e,intl:t})=>{let a,r,n;switch(e){case pa.UPLOADING:a=o.SyncingLine,r=t.formatMessage({id:"/irRX1",defaultMessage:"Uploading file"});break;case pa.PENDING:a=o.ClockLine,r=t.formatMessage({id:"wm1jIe",defaultMessage:"Pending"});break;case pa.ERROR:a=o.WarningLine,r=t.formatMessage({id:"OHDEc4",defaultMessage:"Warning icon"}),n="#9B0032";break;case pa.COMPLETE:a=o.CheckmarkCircleLine,r=t.formatMessage({id:"r1iZmO",defaultMessage:"Upload Complete"}),n="#2D7A02"}return s.reactExports.createElement(o.UIIcon,{className:da,src:a,"aria-label":r,role:"status",color:n})};_a.displayName="UploadStatusIcon";const ga=e=>{var{type:t,closeButtonLabel:r,message:n,buttonHref:l,buttonText:i,onRequestClose:c,buttonOnClick:d}=e,u=a.__rest(e,["type","closeButtonLabel","message","buttonHref","buttonText","onRequestClose","buttonOnClick"]);return s.React$1.createElement(o.Banner,Object.assign({type:t,withCloseButton:r,onRequestClose:c},u),s.React$1.createElement(o.Banner.Message,null,n),s.React$1.createElement(o.Banner.Actions,null,i&&s.React$1.createElement(o.Button$1,{variant:"transparent",key:"nq-link",href:l,onClick:d},i)))};ga.displayName="DrawerBanner";const Ea=({scrollToErrorFiles:e,shouldShowScrollButton:t})=>{const r=o.useSelector(c.getFileList),n=o.useSelector(c.getOverQuotaStatus),i=o.useSelector(c.getLastFileUploadMethod),d=r.some((e=>e.status===l.FileStatusType.COMPLETE)),u=r.find((e=>e.status===l.FileStatusType.FAILED)),[p,m]=s.reactExports.useState(!1),[_,g]=s.reactExports.useState(!1);if((n===l.OverQuotaStatusType.BASIC_NEAR_QUOTA||n===l.OverQuotaStatusType.BASIC_OVER_QUOTA)&&d&&!p){const e=wt(i,o.get_uri().path),t=e?`?oqa=${e}`:"";return s.React$1.createElement(ga,Object.assign({type:"warning",buttonHref:`/low-space${t}`,onRequestClose:()=>m(!0)},fa.nearQuota))}if(void 0!==u&&!_){const r=fa.error,{buttonText:n}=r,l=a.__rest(r,["buttonText"]);return s.React$1.createElement(ga,Object.assign({type:"alert",onRequestClose:()=>g(!0),buttonOnClick:e,buttonText:t?n:"",withLeftIcon:s.React$1.createElement(o.UIIcon,{src:o.WarningLine,role:"presentation"})},l))}return null};Ea.displayName="DrawerBannerWrapper";const fa={nearQuota:{closeButtonLabel:p.intl.formatMessage({id:"5VPgNB",defaultMessage:"Dismiss warning"}),message:p.intl.formatMessage({id:"6DbW2J",defaultMessage:"You’re almost out of storage space."}),buttonText:p.intl.formatMessage({id:"aIkHtJ",defaultMessage:"Add storage"})},error:{closeButtonLabel:p.intl.formatMessage({id:"Fv/Ats",defaultMessage:"Dismiss error"}),message:p.intl.formatMessage({id:"KR7ECY",defaultMessage:"There was an error uploading a file."}),buttonText:p.intl.formatMessage({id:"k8tYQo",defaultMessage:"Show errors"})}};function ha(e,t,a){let s,o=[];return()=>{let r;a.key&&null!=a.debug&&a.debug()&&(r=Date.now());const n=e();if(!(n.length!==o.length||n.some(((e,t)=>o[t]!==e))))return s;let l;if(o=n,a.key&&null!=a.debug&&a.debug()&&(l=Date.now()),s=t(...n),null==a||null==a.onChange||a.onChange(s),a.key&&null!=a.debug&&a.debug()){const e=Math.round(100*(Date.now()-r))/100,t=Math.round(100*(Date.now()-l))/100,s=t/16,o=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c⏱ ${o(t,5)} /${o(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*s,120))}deg 100% 31%);`,null==a?void 0:a.key)}return s}}const Ra=e=>e,Sa=e=>{const t=Math.max(e.startIndex-e.overscan,0),a=Math.min(e.endIndex+e.overscan,e.count-1),s=[];for(let e=t;e<=a;e++)s.push(e);return s},Ta=(e,t)=>{const a=new ResizeObserver((e=>{var a,s;t({width:null==(a=e[0])?void 0:a.contentRect.width,height:null==(s=e[0])?void 0:s.contentRect.height})}));if(e.scrollElement)return t(e.scrollElement.getBoundingClientRect()),a.observe(e.scrollElement),()=>{a.unobserve(e.scrollElement)}},Ma={element:["scrollLeft","scrollTop"],window:["scrollX","scrollY"]},ya=(Ca="element",(e,t)=>{if(!e.scrollElement)return;const a=Ma[Ca][0],s=Ma[Ca][1];let o=e.scrollElement[a],r=e.scrollElement[s];const n=()=>{const o=e.scrollElement[e.options.horizontal?a:s];t(Math.max(0,o-e.options.scrollMargin))};n();const l=t=>{const l=t.currentTarget,i=l[a],c=l[s];(e.options.horizontal?o-i:r-c)&&n(),o=i,r=c};return e.scrollElement.addEventListener("scroll",l,{capture:!1,passive:!0}),()=>{e.scrollElement.removeEventListener("scroll",l)}});var Ca;const Oa=(e,t)=>Math.round(e.getBoundingClientRect()[t.options.horizontal?"width":"height"]),ba=(e,t,a)=>{var s;let{adjustments:o,behavior:r,sync:n}=t;const l=(n?e:e+a.options.scrollMargin)+(o??0);null==(s=a.scrollElement)||null==s.scrollTo||s.scrollTo({[a.options.horizontal?"left":"top"]:l,behavior:r})};class va{constructor(e){var t=this;this.unsubs=[],this.scrollElement=null,this.isScrolling=!1,this.isScrollingTimeoutId=null,this.measurementsCache=[],this.itemMeasurementsCache={},this.pendingMeasuredCacheIndexes=[],this.scrollAdjustments=0,this.measureElementCache={},this.pendingScrollToIndexCallback=null,this.getResizeObserver=(()=>{let e=null;return()=>e||("undefined"!=typeof ResizeObserver?e=new ResizeObserver((e=>{e.forEach((e=>{this._measureElement(e.target,!1)}))})):null)})(),this.range={startIndex:0,endIndex:0},this.setOptions=e=>{Object.entries(e).forEach((t=>{let[a,s]=t;void 0===s&&delete e[a]})),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Ra,rangeExtractor:Sa,onChange:()=>{},measureElement:Oa,initialRect:{width:0,height:0},scrollMargin:0,scrollingDelay:150,indexAttribute:"data-index",...e}},this.notify=()=>{var e,t;null==(e=(t=this.options).onChange)||e.call(t,this)},this.cleanup=()=>{this.unsubs.filter(Boolean).forEach((e=>e())),this.unsubs=[],this.scrollElement=null},this._didMount=()=>{const e=this.getResizeObserver();return Object.values(this.measureElementCache).forEach((t=>null==e?void 0:e.observe(t))),()=>{null==e||e.disconnect(),this.cleanup()}},this._willUpdate=()=>{var e;null==(e=this.pendingScrollToIndexCallback)||e.call(this);const t=this.options.getScrollElement();this.scrollElement!==t?(this.cleanup(),this.scrollElement=t,this._scrollToOffset(this.scrollOffset,{adjustments:void 0,behavior:void 0,sync:!0}),this.unsubs.push(this.options.observeElementRect(this,(e=>{this.scrollRect=e,this.calculateRange()}))),this.unsubs.push(this.options.observeElementOffset(this,(e=>{null!==this.isScrollingTimeoutId&&(clearTimeout(this.isScrollingTimeoutId),this.isScrollingTimeoutId=null);const t=e=>{this.isScrolling!==e&&(this.isScrolling=e,this.notify())};this.scrollAdjustments=0,this.scrollOffset!==e&&(this.scrollOffset=e,t(!0)),this.calculateRange(),this.isScrollingTimeoutId=setTimeout((()=>{this.isScrollingTimeoutId=null,t(!1)}),this.options.scrollingDelay)})))):this.isScrolling||this.calculateRange()},this.getSize=()=>this.scrollRect[this.options.horizontal?"width":"height"],this.getMeasurements=ha((()=>[this.options.count,this.options.paddingStart,this.options.getItemKey,this.itemMeasurementsCache]),((e,t,a,s)=>{const o=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const r=this.measurementsCache.slice(0,o);for(let n=o;n<e;n++){const e=a(n),o=s[e],l=r[n-1]?r[n-1].end:t,i="number"==typeof o?o:this.options.estimateSize(n),c=l+i;r[n]={index:n,start:l,size:i,end:c,key:e}}return this.measurementsCache=r,r}),{key:!1,debug:()=>this.options.debug}),this.calculateRange=ha((()=>[this.getMeasurements(),this.getSize(),this.scrollOffset]),((e,t,a)=>{const s=function(e){let{measurements:t,outerSize:a,scrollOffset:s}=e;const o=t.length-1,r=e=>t[e].start,n=La(0,o,r,s);let l=n;for(;l<o&&t[l].end<s+a;)l++;return{startIndex:n,endIndex:l}}({measurements:e,outerSize:t,scrollOffset:a});return s.startIndex===this.range.startIndex&&s.endIndex===this.range.endIndex||(this.range=s,this.notify()),this.range}),{key:!1,debug:()=>this.options.debug}),this.getIndexes=ha((()=>[this.options.rangeExtractor,this.range,this.options.overscan,this.options.count]),((e,t,a,s)=>e({...t,overscan:a,count:s})),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const t=this.options.indexAttribute,a=e.getAttribute(t);return a?parseInt(a,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{const a=this.indexFromElement(e),s=this.measurementsCache[a];if(!s)return;const o=this.measureElementCache[s.key],r=this.getResizeObserver();if(!e.isConnected)return void(o&&(null==r||r.unobserve(o),delete this.measureElementCache[s.key]));o&&o===e||(o&&(null==r||r.unobserve(o)),this.measureElementCache[s.key]=e,null==r||r.observe(e));const n=this.options.measureElement(e,this),l=n-(this.itemMeasurementsCache[s.key]??s.size);0!==l&&(s.start<this.scrollOffset&&this.isScrolling&&this._scrollToOffset(this.scrollOffset,{adjustments:this.scrollAdjustments+=l,behavior:void 0,sync:!1}),this.pendingMeasuredCacheIndexes.push(a),this.itemMeasurementsCache={...this.itemMeasurementsCache,[s.key]:n},this.notify())},this.measureElement=e=>{e&&this._measureElement(e,!0)},this.getVirtualItems=ha((()=>[this.getIndexes(),this.getMeasurements()]),((e,t)=>{const a=[];for(let s=0,o=e.length;s<o;s++){const o=t[e[s]];a.push(o)}return a}),{key:!1,debug:()=>this.options.debug}),this.scrollToOffset=function(e,a){let{align:s="start",behavior:o}=void 0===a?{}:a;const r=t.scrollOffset,n=t.getSize();"auto"===s&&(s=e<=r?"start":e>=r+n?"end":"start");const l={adjustments:void 0,behavior:o,sync:!1};"start"===s?t._scrollToOffset(e,l):"end"===s?t._scrollToOffset(e-n,l):"center"===s&&t._scrollToOffset(e-n/2,l)},this.scrollToIndex=function(e,a){let{align:s="auto",...o}=void 0===a?{}:a;t.pendingScrollToIndexCallback=null;const r=t.getMeasurements(),n=t.scrollOffset,l=t.getSize(),{count:i}=t.options,c=r[Math.max(0,Math.min(e,i-1))];if(!c)return;if("auto"===s)if(c.end>=n+l-t.options.scrollPaddingEnd)s="end";else{if(!(c.start<=n+t.options.scrollPaddingStart))return;s="start"}const d="end"===s?c.end+t.options.scrollPaddingEnd:c.start-t.options.scrollPaddingStart;t.scrollToOffset(d,{align:s,...o});if(Object.keys(t.measureElementCache).length>0){const a=()=>"number"==typeof t.itemMeasurementsCache[t.options.getItemKey(e)];a()||(t.pendingScrollToIndexCallback=()=>{a()&&(t.pendingScrollToIndexCallback=null,t.scrollToIndex(e,{align:s,...o}))})}},this.getTotalSize=()=>{var e;return((null==(e=this.getMeasurements()[this.options.count-1])?void 0:e.end)||this.options.paddingStart)+this.options.paddingEnd},this._scrollToOffset=(e,t)=>{let{adjustments:a,behavior:s,sync:o}=t;this.options.scrollToFn(e,{behavior:s,sync:o,adjustments:a},this)},this.measure=()=>{this.itemMeasurementsCache={},this.notify()},this.setOptions(e),this.scrollRect=this.options.initialRect,this.scrollOffset=this.options.initialOffset,this.calculateRange()}}const La=(e,t,a,s)=>{for(;e<=t;){const o=(e+t)/2|0,r=a(o);if(r<s)e=o+1;else{if(!(r>s))return o;t=o-1}}return e>0?e-1:0};const Aa="undefined"!=typeof window?s.reactExports.useLayoutEffect:s.reactExports.useEffect;function Ia(e){return function(e){const t=s.reactExports.useReducer((()=>({})),{})[1],a={...e,onChange:a=>{t(),null==e.onChange||e.onChange(a)}},[o]=s.reactExports.useState((()=>new va(a)));return o.setOptions(a),s.reactExports.useEffect((()=>o._didMount()),[]),Aa((()=>o._willUpdate())),o}({observeElementRect:Ta,observeElementOffset:ya,scrollToFn:ba,...e})}const Ua="DBX_UPLOAD_DETAILS_DRAWER_OPEN_PREFERENCE";const Da="DBX_UPLOAD_DETAILS_DRAWER_HEIGHT",Fa=({cancelUploads:e,retryUploads:t,handleAddMoreFilesOrFolder:a,isContentManager:r,getCMUriForFqPath:n,expUserLevelSharingSettings:i})=>{const u=o.useDispatch(),m=o.useSelector(c.getUiDismissed),_=o.useSelector(c.getUiExpanded),E=o.useSelector(c.isUploadInProgress),h=o.useSelector(c.getUser),R=o.useSelector(c.getFileList),S=o.useSelector(c.getPendingUploads),T=s.reactExports.useRef(null),M=R.find((e=>e.status===l.FileStatusType.UPLOADING)),y=s.reactExports.useCallback((()=>{f.logUploadAction({user:h,action:_?o.WebUserActionLogEvent.UPLOAD_DRAWER_COLLAPSE:o.WebUserActionLogEvent.UPLOAD_DRAWER_EXPAND,num_files_pending:S.size}),u(c.uploadActionCreators.setUiExpanded(!_)),function(e,t){try{o.UserLocalStorage.set(e,Ua,t)}catch(e){g.reportException({err:e,severity:"non-critical",tags:["web_upload"]})}}(h.id,!_)}),[_,h,u,S.size]),C=s.reactExports.useCallback((e=>{e.stopPropagation(),u(c.uploadActionCreators.setUiDismissed(!0)),f.logUploadAction({user:h,action:o.WebUserActionLogEvent.UPLOAD_DRAWER_CLOSE})}),[h,u]);s.reactExports.useEffect((()=>{const e=function(e){try{return o.UserLocalStorage.get(e,Ua)}catch(e){return g.reportException({err:e,severity:"non-critical",tags:["web_upload"]}),!0}}(h.id);u(c.uploadActionCreators.setUiExpanded(null==e||e))}),[]),s.reactExports.useEffect((()=>{E&&u(c.uploadActionCreators.setUiDismissed(!1))}),[E]);const O=(()=>{const e=o.useSelector(c.getFileList),t=s.reactExports.useMemo((()=>e.count((({status:e})=>e===l.FileStatusType.COMPLETE))),[e]),a=s.reactExports.useMemo((()=>e.count((({status:e})=>e===l.FileStatusType.FAILED))),[e]),r=s.reactExports.useMemo((()=>e.count((({status:e})=>e===l.FileStatusType.CANCELLED))),[e]),n=e.count()-r,i=t+a,d=o.useSelector(c.getNumSecondsLeft);if(i!==n){const e=p.intl.formatMessage({id:"wp7Ipt",defaultMessage:"Uploading {uploadingFiles, number}{totalFiles, plural, one{ item} other{ of {totalFiles, number} items}}"},{uploadingFiles:t+1,totalFiles:n}),a=d?o.format_time_remaining(d):"",r=p.intl.formatMessage({id:"Boa4tb",defaultMessage:", "});return s.React$1.createElement(s.React$1.Fragment,null,e,a&&`${r}${a}`)}const u=p.intl.formatMessage({id:"sTSEFF",defaultMessage:", {failedFiles, plural, one{{failedFiles, number} upload} other{{failedFiles, number} uploads}} failed"},{failedFiles:a}),m=p.intl.formatMessage({id:"+ejiKL",defaultMessage:"{completeFiles, number} {completeOrFailed, plural, one{upload} other{ of {completeOrFailed, number} uploads}} complete"},{completeFiles:t,completeOrFailed:i});return s.React$1.createElement(s.React$1.Fragment,null,m,a>0&&u)})(),b=s.reactExports.useMemo(xa,[E]),v=s.reactExports.useRef(b),L=(()=>{var e;const t=s.reactExports.useMemo((()=>document.getElementById("sidebar-portal")),[]),[a,o]=s.reactExports.useState(null!==(e=null==t?void 0:t.getBoundingClientRect().width)&&void 0!==e?e:0),r=s.reactExports.useRef();return s.reactExports.useEffect((()=>{var e;return r.current=new H.index((e=>{const t=e[0];o(t.contentRect.width)})),t&&(null===(e=r.current)||void 0===e||e.observe(t)),()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.disconnect()}}),[]),null===t?0:a})(),A=(()=>{var e;const t=s.reactExports.useMemo((()=>document.getElementById("global-header-portal")),[]),[a,o]=s.reactExports.useState(null!==(e=null==t?void 0:t.getBoundingClientRect().bottom)&&void 0!==e?e:0);return s.reactExports.useEffect((()=>{const e=d.debounce((()=>{t&&o(t.getBoundingClientRect().bottom)}),32,{trailing:!0});return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),a})(),I=Ia({count:R.count(),getScrollElement:()=>T.current,estimateSize:()=>59,overscan:6}),U=s.reactExports.useCallback((e=>{localStorage.setItem(Da,`${e}`),v.current=e}),[]),D=s.reactExports.useMemo((()=>R.reduce(((e,t)=>t.status===l.FileStatusType.FAILED||t.status===l.FileStatusType.CANCELLED?e:e+1),0)),[R]),F=59*D,x=(e=>{const[t,a]=s.reactExports.useState(0);return s.reactExports.useEffect((()=>{const t=d.debounce((()=>{var t;a(null!==(t=null==e?void 0:e.scrollTop)&&void 0!==t?t:0)}),50,{trailing:!0});return null==e||e.addEventListener("scroll",t),()=>null==e?void 0:e.removeEventListener("scroll",t)}),[e]),t})(T.current),N=x<=F-(v.current-118)||x>F,k=s.reactExports.useCallback((()=>{f.logUploadAction({user:h,action:o.WebUserActionLogEvent.UPLOAD_SCROLL_TO_ERRORS}),I.scrollToIndex(D,{align:"start"})}),[R]),P=o.useSelector(c.getUiCanShow)&&!m,w=!m&&!E;return P?s.React$1.createElement(o.LayerContext.Provider,{value:{zIndex:10}},s.React$1.createElement(la,{className:l.drawer,headerDataCampaignsElementId:W.CampaignsElementIdEnum.UPLOAD_DETAILS_DRAWER_HEADER,isExpanded:_,toggle:y,initialExpandedHeight:b,maxHeight:640,minHeight:380,title:O,progressValue:null==M?void 0:M.percentUploaded,distanceFromRight:L+9,onResize:U,scrollContainerRef:T,minDistanceFromTop:A+8,headerRightElement:s.React$1.createElement("div",null,s.React$1.createElement(o.IconButton,{variant:"transparent",onClick:y,"aria-label":_?qa.collapsedLabel:qa.expandedLabel,className:l.drawerCloseButton,"data-testid":"persistent-upload-toggle-button"},s.React$1.createElement(o.UIIcon,{src:_?o.ChevronDownLine:o.ChevronUpLine})),w&&s.React$1.createElement(o.IconButton,{variant:"transparent",onClick:C,"aria-label":qa.dismissLabel,className:l.drawerCloseButton,"data-testid":"persistent-upload-dismiss-button"},s.React$1.createElement(o.UIIcon,{src:o.CloseLine}))),footer:s.React$1.createElement(wa,{cancelUploads:e,retryUploads:t,handleAddMoreFilesOrFolder:a,uploadInProgress:E})},s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.Layer,{isPortaled:!1,className:l.drawerBannerContainer,"data-testid":"drawer-banner-container"},s.React$1.createElement(Ea,{shouldShowScrollButton:N,scrollToErrorFiles:k})),s.React$1.createElement(Na,{cancelUploads:e,retryUploads:t,isContentManager:r,getCMUriForFqPath:n,rowVirtualizer:I,expUserLevelSharingSettings:i})))):null},xa=()=>{const e=localStorage.getItem(Da);if(e){const t=parseInt(e,10);return isNaN(t)?380:t}return 380},Na=({cancelUploads:e,retryUploads:t,isContentManager:a=!1,getCMUriForFqPath:r,rowVirtualizer:n,expUserLevelSharingSettings:l})=>{const i=o.useSelector(c.getSortedUploads),d=o.useSelector(c.getUser);return s.React$1.createElement("div",{style:{height:`${n.getTotalSize()}px`,width:"100%",position:"relative"}},n.getVirtualItems().map((o=>{const n=i[o.index];return s.React$1.createElement("div",{key:n.uploadId,"data-index":o.index,style:{width:"100%",position:"absolute",top:0,left:0,transform:`translateY(${o.start}px)`}},s.React$1.createElement(ka,{file:n,cancelUploads:e,retryUploads:t,isContentManager:a,getCMUriForFqPath:r,user:d,expUserLevelSharingSettings:l}))})))};Na.displayName="DetailsDrawerItems";const ka=({cancelUploads:e,file:t,isContentManager:a,getCMUriForFqPath:n,user:i,expUserLevelSharingSettings:c,retryUploads:d})=>{const u={uniqueKey:t.uploadId,title:t.name,isFolder:!1},m=a?n(t.dest):o.browse_uri_for_fq_path(i,t.dest).toString(),_=za(t.status,t.percentUploaded,t.numSecondsLeft,t.fileSize);return s.React$1.createElement(ma,{intl:p.intl,key:t.uploadId,file:u,status:Ba(t.status),statusDescription:t.status!==pa.COMPLETE?_:s.React$1.createElement(Pa,{destination:(g=t.dest,g||a?g||p.intl.formatMessage({id:"tWz/Xr",defaultMessage:"Files"}):k.get_browse_root_name(i)),url:m}),percentUploaded:q.SMOOTH_UPLOAD_PROGRESS_BAR?t.progressBarPercent:t.percentUploaded,button:(t=>{if(t.status===l.FileStatusType.SET_PERMISSIONS||t.status===l.FileStatusType.PENDING||t.status===l.FileStatusType.UPLOADING){const a=t.status===l.FileStatusType.UPLOADING&&100===t.percentUploaded;return s.React$1.createElement(o.Button$1,{variant:"opacity",disabled:a,onClick:()=>{B.ActionsAdapter.emit("fileCanceled",{uploadFiles:[t]}),o.logEvent(r.PAP_Upload_File({eventState:"canceled",fileSize:t.fileSize,fileType:l.getFileType(t),batchIdString:t.batchId,uploadId:t.uploadId})),e([t])}},s.React$1.createElement(o.Text,{isBold:!0,size:"small",color:a?"disabled":"standard"},qa.cancelButton))}if(t.status===l.FileStatusType.FAILED||t.status===l.FileStatusType.CANCELLED||t.status===l.FileStatusType.CANCELLING){const e=t.status===l.FileStatusType.CANCELLING;return s.React$1.createElement(o.Button$1,{variant:"opacity",disabled:e,onClick:()=>{f.logUploadAction({user:i,action:o.WebUserActionLogEvent.RETRY_UPLOAD_CLICK,upload:t}),d([t])}},s.React$1.createElement(o.Text,{isBold:!0,size:"small",color:e?"disabled":"standard"},qa.retryButton))}if(t.status===l.FileStatusType.COMPLETE)return s.React$1.createElement($a,{user:i,file:t,expUserLevelSharingSettings:c})})(t)});var g},Pa=({destination:e,url:t})=>{let a=e;return e.includes("/")&&(a=e.split("/").slice(-1)[0]),s.React$1.createElement(o.Text,{size:"small",color:"faint",className:l.drawerDestinationLinkWrapper},s.React$1.createElement("span",{className:l.drawerDestinationPrefix},qa.uploadedTo," "),s.React$1.createElement(o.LinkWrapper,{"data-testid":"persistent-upload-drawer-destination-link",href:t,className:l.drawerDestinationLink},s.React$1.createElement(j.Truncate,{maxWidth:150,location:.5},a)))};Pa.displayName="UploadCompleteSubText";const wa=({cancelUploads:e,retryUploads:t,handleAddMoreFilesOrFolder:a,uploadInProgress:r})=>{const i=o.useSelector(c.getUser),d=o.useSelector(c.getFailedOrCanceledUploads),p=o.useSelector(c.getCancellingUploads),m=s.reactExports.useMemo((()=>d.size>0||p.size>0),[p.size,d.size]),_=s.reactExports.useMemo((()=>0===d.size&&p.size>0),[p.size,d.size]),g=e=>{a(e),e?f.logUploadAction({user:i,action:o.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK,chooser_type:l.ChooserType.FOLDER,upload_method:n.UploadMethod.CHOOSER}):f.logUploadAction({user:i,action:o.WebUserActionLogEvent.UPLOAD_FILES_CLICK,chooser_type:l.ChooserType.FILE,upload_method:n.UploadMethod.CHOOSER})};return s.React$1.createElement(s.React$1.Fragment,null,m&&s.React$1.createElement(o.Button$1,{variant:"opacity",className:l.drawerFooterButton,disabled:_,onClick:()=>t(d.toArray())},s.React$1.createElement(o.Text,{size:"small",isBold:!0,color:_?"disabled":"standard"},qa.retryAllButton)),u.is_input_webkitdirectory_supported()?s.React$1.createElement(Y.AddMoreFilesMenu,{user:i,handleFileChoose:g},qa.addMore):s.React$1.createElement(o.Button$1,{variant:"primary",onClick:()=>{g(!1),f.logUploadAction({user:i,action:o.WebUserActionLogEvent.ADD_MORE_FILES_CLICK})}},qa.addMore))};wa.displayName="DetailsDrawerFooter";const $a=({file:e,user:t,expUserLevelSharingSettings:a})=>{const r=s.reactExports.useRef(null),n=p.intl.formatMessage({id:"8QMEOE",defaultMessage:"Copy link"});return s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.Button$1,{ref:r,className:o.cx("copy-link-button",l.drawerRowButton),variant:"opacity",onClick:()=>((e,s)=>{if(t){const r=(e,t)=>{o.getStoreForBrowse().dispatch({type:o.ActionTypes$3.SET_IS_CREATING_SHARED_LINK,payload:{fileIdOrPath:t,isCreatingSharedLink:e}})};O.CopyLinkMiniModal.show({user:t,filePath:e.dest+"/"+e.name,setIsCreatingSharedLink:r,anchorRef:s,zIndexOverride:1e4,userActionSource:o.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL,yOffsetDistance:20,placement:"bottom-start",isInUserLevelSharingSettings:"ON"===a},"copy-link-modal")}})(e,r)},s.React$1.createElement(o.Text,{isBold:!0,size:"small"},n)))};$a.displayName="CopyLinkButton",Fa.displayName="UploadDetailsDrawer";const Ba=e=>{let t=pa.PENDING;switch(e){case l.FileStatusType.SET_PERMISSIONS:case l.FileStatusType.PENDING:t=pa.PENDING;break;case l.FileStatusType.UPLOADING:t=pa.UPLOADING;break;case l.FileStatusType.CANCELLING:case l.FileStatusType.CANCELLED:case l.FileStatusType.FAILED:t=pa.ERROR;break;case l.FileStatusType.COMPLETE:t=pa.COMPLETE}return t},Ga=(e,t)=>{const a=Math.pow(10,t||0);return Math.round(e*a)/a},za=(e,t,a,r)=>{const n=1e6;let i=qa.inQueue;const c=t/100*r/n,d=r/n,u=d<10?Ga(d,1):Ga(d),p=` ${d<10?Ga(c,1):Ga(c)}mb / ${u}mb`;switch(e){case l.FileStatusType.SET_PERMISSIONS:case l.FileStatusType.PENDING:i=qa.inQueue;break;case l.FileStatusType.UPLOADING:i=100===t?qa.finalizing:`${qa.uploading}${q.DISPLAY_UPLOAD_BYTES_COMPLETED?p+""+(a?" -":""):""}${a?" "+o.format_time_remaining(a):""}${q.DISPLAY_UPLOAD_BYTES_COMPLETED&&!a?"":"..."}`;break;case l.FileStatusType.CANCELLING:case l.FileStatusType.CANCELLED:i=qa.canceled;break;case l.FileStatusType.FAILED:i=qa.uploadError;break;case l.FileStatusType.COMPLETE:i="Uploaded"}return s.React$1.createElement(o.Text,{size:q.DISPLAY_UPLOAD_BYTES_COMPLETED?"xsmall":"small"},i)},qa={expandedLabel:p.intl.formatMessage({id:"/CSzAZ",defaultMessage:"Expand upload details"}),collapsedLabel:p.intl.formatMessage({id:"B0aPu6",defaultMessage:"Collapse upload details"}),dismissLabel:p.intl.formatMessage({id:"LWeJac",defaultMessage:"Dismiss upload details"}),inQueue:p.intl.formatMessage({id:"FKZydJ",defaultMessage:"In queue..."}),finalizing:p.intl.formatMessage({id:"070Gwl",defaultMessage:"Finalizing..."}),canceled:p.intl.formatMessage({id:"sFCVfQ",defaultMessage:"Canceled"}),uploadError:p.intl.formatMessage({id:"4h/qiz",defaultMessage:"Upload Failed. Please Try Again"}),uploading:p.intl.formatMessage({id:"mQEN7c",defaultMessage:"Uploading"}),cancelButton:p.intl.formatMessage({id:"WrCo9+",defaultMessage:"Cancel"}),retryButton:p.intl.formatMessage({id:"mrNhj0",defaultMessage:"Retry"}),retryAllButton:p.intl.formatMessage({id:"D66NAx",defaultMessage:"Retry all"}),addMore:p.intl.formatMessage({id:"Cor7eb",defaultMessage:"Add more"}),stopUploads:p.intl.formatMessage({id:"+tXJyP",defaultMessage:"Stop uploads"}),uploadedTo:p.intl.formatMessage({id:"J7hC6w",defaultMessage:"Uploaded to"})},Va=({ajaxInterceptor:e,autoTeamGroupId:t,chooseDestination:c,dragAndDropEnabled:p=!0,isContentManager:m=!1,getBrowseContext:_,rootNSIDForCM:g,handleClickNewFolder:E,uploadConsumerInterface:f,uploaderPostTTIExperiments:h,createShortcutForGdssFile:R,hideInlineSnackbar:S,getCMUriForFqPath:T})=>{const M=s.React$1.useMemo((()=>i.getStoreForUpload()),[]);s.React$1.useEffect((()=>{r.UploaderActions.hasInit||r.UploaderActions.init({chooseDestination:c,isContentManager:m,rootNSIDForCM:g,autoTeamGroupId:t,getBrowseContext:_,handleClickNewFolder:E,uploadConsumerInterface:f}),r.UploaderActions.setAjaxInterceptor(e),r.UploaderActions.setIsContentManager(m),r.UploaderActions.setUser({user:o.getActiveUser()})}),[]);const y=s.React$1.useCallback((e=>a.__awaiter(void 0,void 0,void 0,(function*(){yield r.UploaderActions.cancelUploads({files:e},f),d.uniqBy(e,(({batchId:e})=>e)).forEach((({batchId:e})=>r.reportBatchEndStateIfDone(e,M.getState)))}))),[f]),C=s.React$1.useCallback((e=>{r.UploaderActions.retryUploads({files:e},f)}),[f]),O=s.React$1.useCallback((e=>{const t=l.generateTaskTrackingId();e?r.UploaderActions.chooseFolder(f,n.UploadElement.UPLOAD_MODAL,t):r.UploaderActions.chooseFiles(f,n.UploadElement.UPLOAD_MODAL,t)}),[f]),b=!u.is_mobile_or_tablet(),v=s.React$1.useMemo((()=>"wakeLock"in navigator?navigator.wakeLock:void 0),[]);return s.React$1.createElement(o.Provider,{store:M},s.React$1.createElement(Wa,{isContentManager:m,uploadConsumerInterface:f,getCMUriForFqPath:T,uploaderPostTTIExperiments:h}),p&&s.React$1.createElement(Qa,{uploadConsumerInterface:f,isContentManager:m,uploaderPostTTIExperiments:h,createShortcutForGdssFile:R}),!S&&!b&&s.React$1.createElement(ja,{uploaderPostTTIExperiments:h,uploadConsumerInterface:f}),b&&s.React$1.createElement(Ya,{uploaderPostTTIExperiments:h,cancelUploads:y,retryUploads:C,handleAddMoreFilesOrFolder:O,getCMUriForFqPath:T,isContentManager:m}),void 0!==v&&s.React$1.createElement(Ha,{wakeLock:v}))};Va.displayName="FileUploaderFC";const Qa=({uploadConsumerInterface:e,uploaderPostTTIExperiments:t,isContentManager:a=!1,createShortcutForGdssFile:r})=>{const n=dt();return ut({uploadConsumerInterface:e,uploaderPostTTIExperiments:t,isContentManager:a,resetDragRefs:n,createShortcutForGdssFile:r}),(()=>{const e=o.useSelector(c.isInternalTransfer),t=o.useSelector(c.getNumDraggingFiles),a=o.useSelector(c.hasPermissionToUploadToFolder),r=o.useSelector(c.isMovingIntoVault),n=o.useSelector(c.getUser),i=o.useSelector(c.getPath),d=o.useSelector(c.getUploadModalType),u=o.usePrevious(t);s.reactExports.useEffect((()=>{if(t>0&&!e){if(null===d)if(!a&&r)o.Snackbar.failSticky(ea.lockedVault,Xt);else if(c.hasPermissionToUploadToFolder)if(o.Viewer.get_viewer().team_is_locked)o.Snackbar.failSticky(ea.teamNotLongerTrademark,Xt);else if(o.isBackupBrowse())o.Snackbar.failSticky(ea.noDragOnBackups,Xt);else{const e=p.intl.formatMessage({id:"WVIgaJ",defaultMessage:"Drop your files to "}),t=l.makeUploadSnippet(1e3,n,i),a=s.React$1.createElement(s.React$1.Fragment,null,s.React$1.createElement(o.Text,{color:"inherit"},e),s.React$1.createElement(o.Text,{color:"inherit",isBold:!0},t)," ");o.Snackbar.show(s.React$1.createElement(o.Snackbar,{title:a,customIcon:o.UploadLine,id:Xt}))}else o.Snackbar.failSticky(ea.notThisFolderError,Xt)}else u&&u>0&&0===t&&o.Snackbar.close(Xt)}),[a,e,r,d,t,u,i,n])})(),null};Qa.displayName="UploadDragAndDrop";const ja=({uploaderPostTTIExperiments:e,uploadConsumerInterface:t})=>((({uploaderPostTTIExperiments:e})=>{const t=o.useDispatch(),a=o.useSelector(c.getUser),r=o.useSelector(c.isUploadInProgress),n=o.useSelector(c.isPermissionsAtUploadModalOpen),i=o.useSelector(c.getNumSecondsLeft),d=o.useSelector(c.getFileList),u=o.useSelector(c.getUploadModalType),p=s.reactExports.useRef(!0);s.reactExports.useEffect((()=>{if(null!==u||n)o.Snackbar.close("inline-upload-snackbar");else{if(!r&&(0===d.toArray().filter((e=>e.status!==l.FileStatusType.CANCELLED)).length||p.current))return o.Snackbar.close("inline-upload-snackbar"),void(p.current=!1);Nt({fileList:d,onViewDetails:()=>{t(c.uploadActionCreators.setUploadModalType({type:"UPLOAD_MODAL"})),f.logUploadAction({user:a,action:o.WebUserActionLogEvent.VIEW_DETAILS_CLICK})},numSecondsLeft:i,onShown:()=>{},onClosed:()=>{},allowParallelUpload:!0,campaigns:null==e?void 0:e.campaigns,snackbarOpenWithReplay:null==e?void 0:e.snackbarOpenWithReplay}),p.current=!1}}),[t,d,i,n,r,u,a,e])})({uploaderPostTTIExperiments:e}),(({uploadConsumerInterface:e})=>{const t=o.useDispatch(),a=s.reactExports.useRef(z.anyFileUploading(e.uploadItems)),r=s.reactExports.useRef(!1);s.reactExports.useEffect((()=>{const s=()=>{z.numUploadingFiles(e.uploadItems)>1&&(t(c.uploadActionCreators.setUploadModalType({type:"UPLOAD_MODAL"})),r.current=!0)},o=z.anyFileUploading(e.uploadItems);(o&&!a.current||o&&!r.current)&&s(),o!==a.current&&(o||(r.current=!1),a.current=o)}),[t,e.uploadItems])})({uploadConsumerInterface:t}),null);ja.displayName="UploadProgressSnackBar";const Ha=({wakeLock:e})=>((e=>{const t=s.reactExports.useRef(null),r=o.useSelector(c.isUploadInProgress),n=s.reactExports.useCallback((()=>a.__awaiter(void 0,void 0,void 0,(function*(){if(!t.current||t.current.released){try{t.current=yield e.request("screen")}catch(e){return!1}document.addEventListener("visibilitychange",l)}return!0}))),[]),l=s.reactExports.useCallback((()=>{null!==t.current&&"visible"===document.visibilityState&&n()}),[]),i=s.reactExports.useCallback((()=>{var e;null===(e=null==t?void 0:t.current)||void 0===e||e.release(),t.current=null,document.removeEventListener("visibilitychange",l)}),[]);s.reactExports.useEffect((()=>(r?n():i(),i)),[n,l,r,i])})(e),null);Ha.displayName="UploadPreventSleep";const Wa=({isContentManager:e=!1,uploadConsumerInterface:t,onAllFileUploadsComplete:a,getCMUriForFqPath:d,uploaderPostTTIExperiments:u})=>{(()=>{const e=o.useSelector(c.isUploadInProgress),t=o.useSelector(c.getPendingUploads),a=o.useSelector(c.getUser),n=i.getStoreForUpload();s.reactExports.useEffect((()=>{const s=s=>{if(!e)return;const o={};t.forEach((({batchId:e})=>{o[e]?o[e]++:o[e]=1})),Object.entries(o).forEach((([e,t])=>{r.reportBatchEndStateIfDone(e,n.getState,!0,o[e]),f.logUploadAction({action:f.WebUploadActionEvent.UPLOAD_ABANDONED,batchId:e,num_files_abandoned:t,user:a})}));const l=p.intl.formatMessage({id:"vrk/tc",defaultMessage:"Leaving this page will cancel your uploads."});return s.returnValue=l,l};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)}),[t,e,a])})(),(({isContentManager:e})=>{const t=o.useSelector(c.getUser),a=o.useSelector(c.getFileList),n=o.useSelector(c.getUploadModalType),i=o.useSelector(c.getOverQuotaStatus),d=o.useSelector(c.getOverQuotaDetails),u=o.useSelector(c.getLastFileUploadMethod),p=o.useDispatch(),m=s.reactExports.useCallback((({forceLocked:n=!1,context:m})=>{const _=a.toArray().filter((e=>e.status!==l.FileStatusType.COMPLETE&&(e.errorType===l.UploadErrorType.OVER_QUOTA_ERROR||e.errorType===l.UploadErrorType.GENERIC||e.errorType===l.UploadErrorType.LOCKED_TEAM_ERROR))),g=_&&_[_.length-1]?_[_.length-1].name:void 0,E=n||a.toArray().filter((e=>e.errorType===l.UploadErrorType.LOCKED_TEAM_ERROR)).length>0;g&&l.uploadFailureEmitEventIsOn()||o.mountModal(s.React$1.createElement(kt,{oqFilename:g,isLockedTeam:E,isContentManager:e,isTeamUser:!!t.is_team,context:m||r.UploaderOverQuotaModalContexts.UNKNOWN,overQuotaStatus:i,onModalDismissed:()=>{p(c.uploadActionCreators.setUploadModalType(null)),o.unmountModal()},user:t,overQuotaDetails:d,fileUploadMethod:u}))}),[p,a,e,u,d,i,t]);s.reactExports.useEffect((()=>{if("OVER_QUOTA_MODAL"===(null==n?void 0:n.type)){const{forceLocked:e,context:t}=n;m({forceLocked:e,context:t})}}),[n,m])})({isContentManager:e}),(({isContentManager:e,uploadConsumerInterface:t,getCMUriForFqPath:a,uploaderPostTTIExperiments:d})=>{const u=o.useDispatch(),p=o.useSelector(c.getUploadModalType),m=G.useStabilizedCallback((()=>{o.mountModal(s.React$1.createElement(o.Provider,{store:i.getStoreForUpload()},s.React$1.createElement(zt,{dragAndDropEnabled:!0,isContentManager:e,isTeamOnboarding:!1,shouldShowDestinationLink:!0,onModalDismissed:()=>{u(c.uploadActionCreators.setUploadModalType(null)),o.unmountModal()},handleCancelUpload:e=>r.UploaderActions.cancelUploads({files:[e]},t),handleAddMoreFilesOrFolder:e=>{const a=l.generateTaskTrackingId();e?r.UploaderActions.chooseFolder(t,n.UploadElement.UPLOAD_MODAL,a):r.UploaderActions.chooseFiles(t,n.UploadElement.UPLOAD_MODAL,a)},getCMUriForFqPath:a,expUserLevelSharingSettings:null==d?void 0:d.expUserLevelSharingSettings})))}));s.React$1.useEffect((()=>{o.Modal$1.setAppElement(document.getElementById("embedded-app")||document.body)}),[]),s.reactExports.useEffect((()=>{"UPLOAD_MODAL"===(null==p?void 0:p.type)&&m()}),[p,m])})({isContentManager:e,uploadConsumerInterface:t,getCMUriForFqPath:d,uploaderPostTTIExperiments:u}),(({uploadConsumerInterface:e,onAllFileUploadsComplete:t})=>{const a=o.useDispatch(),r=o.useSelector(c.getFileList),n=o.useSelector(c.getUser),i=o.useSelector(c.isUploadInProgress),d=s.reactExports.useRef(!1),u=G.useStabilizedCallback((()=>{const e=r.valueSeq().filter((e=>e.status===l.FileStatusType.COMPLETE)).map((e=>({name:e.name,path:e.dest}))).toArray();B.ActionsAdapter.emit("uploadComplete",{filesAdded:e})})),p=G.useStabilizedCallback((()=>{r.find((e=>e.errorType===l.UploadErrorType.OVER_QUOTA_ERROR))&&!Zt(n)&&a(c.uploadActionCreators.setUploadModalType({type:"OVER_QUOTA_MODAL"})),null==t||t(r)}));s.reactExports.useEffect((()=>{i!==d.current&&(!i&&d.current&&(u(),p(),a(c.fetchQuotaUpsell())),d.current=i)}),[a,u,p,i,e.uploadItems])})({uploadConsumerInterface:t,onAllFileUploadsComplete:a});const m=o.useDispatch(),_=o.useSelector(c.getOverQuotaDetails);return s.React$1.useEffect((()=>{void 0===_&&m(c.fetchQuotaUpsell())}),[]),null};Wa.displayName="AlwaysPresentHooks";const Ya=({uploaderPostTTIExperiments:e,cancelUploads:t,retryUploads:a,getCMUriForFqPath:r,isContentManager:n,handleAddMoreFilesOrFolder:i})=>((({uploaderPostTTIExperiments:e})=>{const t=o.useSelector(c.isUploadInProgress),a=o.useSelector(c.getFileList),r=s.reactExports.useRef(t);s.reactExports.useEffect((()=>{if(r.current!==t){if(!t&&r.current){a.count((e=>e.status!==l.FileStatusType.CANCELLED));const t=null==e?void 0:e.campaigns,r=null==e?void 0:e.snackbarOpenWithReplay,n=Object.assign({},t);delete n["PG Share On Upload"];const i=yt(a,"complete",{snackbarOpenWithReplay:r},n);i&&o.Snackbar.update(s.React$1.createElement(o.Snackbar,{id:"inline-upload-snackbar",title:"",richSnackbarProps:i}))}r.current=t}}),[a,t,e])})({uploaderPostTTIExperiments:e}),s.React$1.createElement(Fa,{cancelUploads:t,retryUploads:a,handleAddMoreFilesOrFolder:i,getCMUriForFqPath:r,isContentManager:n,expUserLevelSharingSettings:null==e?void 0:e.expUserLevelSharingSettings}));t.FileUploaderFC=Va}));
//# sourceMappingURL=c_file_uploader_clean_uploader_main.js-vflKsLrVy.map
