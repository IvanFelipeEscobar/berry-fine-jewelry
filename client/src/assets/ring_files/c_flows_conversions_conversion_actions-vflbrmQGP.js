define(["require","exports","./c_tslib","./c_flows_conversions_convert","./c_core_i18n","./c_flows_utils_browse_logger","./c_flows_lib_api","./c_flows_logging_flows_loggers","./c_flows_redux_store","./c_flows_redux_actions","./e_ui_page_files_router","./c_flows_constants","./e_edison","./c_spectrum_icon_partners_index","./c_gdd_migration_ui_utils","./c_icon_shortcuts_icon"],(function(e,t,o,i,s,n,a,r,l,c,u,d,_,g,f,m){"use strict";const p="browse_save_as";function S({files:e,template:t,conversionType:u,source:d}){return o.__awaiter(this,void 0,void 0,(function*(){const{initLabel:o,failLabel:_}={initLabel:e=>s.intl.formatMessage({id:"YdruIN",defaultMessage:"Your {numFiles, plural, one {file} other {files}} will be saved shortly..."},{numFiles:e}),failLabel:e=>s.intl.formatMessage({id:"j4UjMR",defaultMessage:"There was a problem saving your {numFiles, plural, one {file} other {files}}"},{numFiles:e})};n.updateSnackbar({variant:"sync",title:o(e.length)});const g=i.getConversionLoggingFunctions(u);l.getStoreForAutomations().dispatch(c.setShouldSubscribeToBolt(!0));try{yield a.submitFileWorkflow(t,e.map((e=>e.file_id))),r.PapLogger.logSucceedSubmitManualWorkflow(p,t,e.length),g.logConvert(d,e.length)}catch(o){n.updateSnackbar({variant:"fail",title:_(e.length)}),r.PapLogger.logFailSubmitManualWorkflow(p,t,e.length,o)}}))}const E="pdf",v={actionText:"PDF",actionIcon:u.FileLine,selector:i.singleFileWithExtensionSelector(d.SUPPORTED_PDF_EXTENSIONS),convert:(e,t,s)=>{const{source:n}=s;return i.convertFileAndShowSnackbar(Object.assign(Object.assign({},s),{file:e[0],user:t,conversionType:E,folderRuleAction:"pdf_conversion",loggingFunctions:i.getConversionLoggingFunctions(E),getStrings:(e,o)=>i.getDefaultConversionStrings("PDF",e,t,o),conversionFn:(e,t,s)=>o.__awaiter(void 0,void 0,void 0,(function*(){return(yield i.convertToPdf(t.id,i.getFileIdentifier(e,s))).path})),getAdoptionSnackbarProps:o=>i.getAdoptionSnackbarProps({user:t,conversionType:E,folderRuleAction:"pdf_conversion",fileType:"PDF",resultPath:o,source:n,nsId:e[0].ns_id}),template:{sequence:[{workflow_action:{".tag":"pdf_conversion"}}]},outputExt:"PDF"}))}},F={actionText:"PDF",actionIcon:u.FileLine,selector:i.strictMultiFileWithExtensionSelector(d.SUPPORTED_PDF_EXTENSIONS),convert:(e,t,{source:o})=>S({files:e,template:{sequence:[{workflow_action:{".tag":"pdf_conversion"}}]},conversionType:E,source:o})},h={jpg:d.SUPPORTED_IMAGE_INPUT_EXTENSIONS.filter((e=>"jpg"!==e&&"jpeg"!==e)),png:d.SUPPORTED_IMAGE_INPUT_EXTENSIONS.filter((e=>"png"!==e))},O="image-format",M=Object.entries(h).map((([e,t])=>({actionText:e.toUpperCase(),actionIcon:u.ImageLine,selector:i.singleFileWithExtensionSelector(t),convert:(t,s,n)=>{const{source:a}=n;return i.convertFileAndShowSnackbar(Object.assign(Object.assign({},n),{file:t[0],user:s,conversionType:O,folderRuleAction:"image_conversion",loggingFunctions:i.getConversionLoggingFunctions(O),getStrings:(t,o)=>i.getDefaultConversionStrings(e.toUpperCase(),t,s,o),conversionFn:(t,s,n)=>o.__awaiter(void 0,void 0,void 0,(function*(){return(yield i.convertImageFormat(s.id,i.getFileIdentifier(t,n),e)).path})),getAdoptionSnackbarProps:o=>i.getAdoptionSnackbarProps({user:s,conversionType:O,folderRuleAction:"image_conversion",fileType:e,resultPath:o,source:a,nsId:t[0].ns_id}),outputExt:e}))}}))),T="doc-to-image",I=d.SUPPORTED_IMAGE_OUTPUT_EXTENSIONS.map((e=>({actionText:e.toUpperCase(),actionIcon:u.ImageLine,selector:i.singleFileWithExtensionSelector(d.SUPPORTED_DOC_INPUT_EXTENSIONS),convert:(t,s,n)=>{const{source:a}=n;return i.convertFileAndShowSnackbar(Object.assign(Object.assign({},n),{file:t[0],user:s,conversionType:T,folderRuleAction:"image_conversion",loggingFunctions:i.getConversionLoggingFunctions(T),getStrings:(t,o)=>i.getDefaultConversionStrings(e.toUpperCase(),t,s,o),conversionFn:(t,s,n)=>o.__awaiter(void 0,void 0,void 0,(function*(){return(yield i.convertDocToImage(s.id,i.getFileIdentifier(t,n),e)).path})),getAdoptionSnackbarProps:o=>i.getAdoptionSnackbarProps({user:s,conversionType:T,folderRuleAction:"image_conversion",fileType:e,resultPath:o,source:a,nsId:t[0].ns_id}),outputExt:e}))}}))),C="media-remux",L=(e,t,n)=>(a,r,l)=>{const{source:c}=l;return i.convertFileAndShowSnackbar(Object.assign(Object.assign({},l),{file:a[0],user:r,conversionType:C,folderRuleAction:t,loggingFunctions:i.getConversionLoggingFunctions(C),getStrings:(t,o)=>function(e,t,o,n){const a=i.getDefaultConversionStrings(e,t,o,n);return Object.assign(Object.assign({},a),{failTooLarge:s.intl.formatMessage({id:"D67i/e",defaultMessage:"Couldn't save as {fileType} because the file is too large. The maximum file size is {maxSize} MB."},{fileType:e,maxSize:d.MEDIA_REMUX_FILE_SIZE_LIMIT})})}(e.toUpperCase(),t,r,o),conversionFn:(t,s,n)=>o.__awaiter(void 0,void 0,void 0,(function*(){return(yield i.mediaRemux(s.id,i.getFileIdentifier(t,n),e)).path})),getAdoptionSnackbarProps:t?o=>i.getAdoptionSnackbarProps({user:r,conversionType:C,folderRuleAction:t,fileType:e,resultPath:o,source:c,nsId:a[0].ns_id}):void 0,template:n,outputExt:e}))},D=[...d.SUPPORTED_VIDEO_OUTPUT_CONTAINERS.map((e=>({actionText:e.toUpperCase(),actionIcon:u.VideoLine,selector:i.singleFileWithExtensionSelector(d.SUPPORTED_VIDEO_INPUT_EXTENSIONS.filter((t=>t!==e))),convert:L(e,"video_conversion",{sequence:[{workflow_action:{".tag":"video_conversion",format:e}}]})}))),...d.SUPPORTED_AUDIO_OUTPUT_CONTAINERS.map((e=>({actionText:e.toUpperCase(),actionIcon:u.AudioLine,selector:i.singleFileWithExtensionSelector([...d.SUPPORTED_AUDIO_INPUT_EXTENSIONS,...d.SUPPORTED_VIDEO_INPUT_EXTENSIONS].filter((t=>t!==e))),convert:L(e,"audio_conversion",{sequence:[{workflow_action:{".tag":"audio_conversion",format:e}}]})})))],R=[...d.SUPPORTED_VIDEO_OUTPUT_CONTAINERS.map((e=>({actionText:e.toUpperCase(),actionIcon:u.VideoLine,selector:i.strictMultiFileWithExtensionSelector(d.SUPPORTED_VIDEO_INPUT_EXTENSIONS.filter((t=>t!==e))),convert:(t,o,{source:i})=>S({files:t,template:{sequence:[{workflow_action:{".tag":"video_conversion",format:e}}]},conversionType:C,source:i})}))),...d.SUPPORTED_AUDIO_OUTPUT_CONTAINERS.map((e=>({actionText:e.toUpperCase(),actionIcon:u.AudioLine,selector:i.strictMultiFileWithExtensionSelector([...d.SUPPORTED_AUDIO_INPUT_EXTENSIONS,...d.SUPPORTED_VIDEO_INPUT_EXTENSIONS].filter((t=>t!==e))),convert:(t,o,{source:i})=>S({files:t,template:{sequence:[{workflow_action:{".tag":"audio_conversion",format:e}}]},conversionType:C,source:i})})))];const b=["mov","mp4","avi","mkv","mpeg"],A={actionText:"GIF",actionIcon:u.VideoLine,selector:(e,t)=>{const o=i.singleFileWithExtensionSelector(b),s=!!t&&t.expFlowsManualVideoGifUi;return o(e)&&s},convert:function(t,o,{shareToken:i}){return function(t,o,i){new Promise((function(t,o){e(["./c_components_modals_video_to_gif_settings_modal"],t,o)})).then((({StatefulVideoToGifSettingsModal:e})=>{u.Modal.showInstance(_.React$1.createElement(u.Provider,{store:u.getStoreForBrowse()},_.React$1.createElement(s.Provider,{value:s.intl},_.React$1.createElement(e,{file:t,user:o,shareToken:i}))))}))}(t[0],o,i),Promise.resolve()}},y=d.SUPPORTED_DOC_INPUT_EXTENSIONS.concat(d.SUPPORTED_IMAGE_INPUT_EXTENSIONS),P={jpg:y.filter((e=>"jpg"!==e&&"jpeg"!==e)),png:y.filter((e=>"png"!==e))},k=Object.entries(P).map((([e,t])=>({actionText:e.toUpperCase(),actionIcon:u.ImageLine,selector:i.strictMultiFileWithExtensionSelector(t),convert:(t,o,{source:i})=>S({files:t,conversionType:"image-batch",template:{sequence:[{workflow_action:{".tag":"image_conversion",format:e}}]},source:i})})));var N,U;t.ConversionActionGroup=void 0,(N=t.ConversionActionGroup||(t.ConversionActionGroup={}))[N.DEFAULT=0]="DEFAULT",N[N.CLOUD_DOCS=1]="CLOUD_DOCS",function(e){e.GOOGLE_DRIVE="web_shortcut",e.MICROSOFT_FILE="ms_file"}(U||(U={}));const w=(e,t,o,i,s)=>{u.logEvent({class:"cloud_docs",action:"select",object:"cloud_docs_manual_conversion_modal",properties:{accountRole:e,numFiles:t,cloudDocsManualConversionType:o,cloudDocsManualConversionModalButton:i,dontAskAgainChecked:s}})},G=(e,t)=>{u.logEvent({class:"cloud_docs",action:"open",object:"cloud_docs_manual_conversion_folder_picker",properties:{accountRole:e,eventState:t}})},x=(e,t,o,i,s,n,a,r)=>{u.logEvent({class:"cloud_docs",action:"initiate",object:"cloud_docs_manual_conversion",properties:{accountRole:e,numFiles:t,cloudDocsManualConversionType:o,modalWasShown:i,copyFilePermissions:s,useDefaultFolder:n,cloudDocsManualConversionError:a,eventState:r}})},W=(e,t)=>{switch(t){case U.GOOGLE_DRIVE:return(e=>{const t=new Set;for(const o of e){const e=u.getGoogleFileTypeByPath(o);if(e){t.add(e);continue}const i=u.getMicrosoftFileTypeByPath(o);i&&t.add(u.MicrosoftToGoogleFileTypes[i])}if(1===t.size)for(const e of t)return u.GoogleFileLabels[e];return s.intl.formatMessage({id:"ZYjkCp",defaultMessage:"Google"})})(e);case U.MICROSOFT_FILE:return(e=>{const t=new Set;for(const o of e){const e=u.getMicrosoftFileTypeByPath(o);if(e){t.add(e);continue}const i=u.getGoogleFileTypeByPath(o);i&&t.add(u.GoogleToMicrosoftFileTypes[i])}if(1===t.size)for(const e of t)return u.MicrosoftFileLabels[e];return s.intl.formatMessage({id:"WbLFdE",defaultMessage:"Microsoft"})})(e)}},j=({srcFileNames:e,targetDest:t,folderName:o=f.Strings.MIGRATION_FOLDER,onChangeDriveFolder:i,onLearnMore:n})=>{const a=W(e,t);switch(t){case U.GOOGLE_DRIVE:return s.intl.formatMessage({id:"pU1fIE",defaultMessage:"{numFiles, plural, one{The new {fileTypeLabel} shortcut (to be saved in <folderPickerButton>{folderName}</folderPickerButton>) will inherit the same sharing permissions as the original file. Save as will replace the original file.} other{The new {fileTypeLabel} shortcuts (to be saved in <folderPickerButton>{folderName}</folderPickerButton>) will inherit the same sharing permissions as the original files. Save as will replace the original files.}} <button>Learn more</button>"},{fileTypeLabel:a,numFiles:e.length,folderName:o,bold:e=>_.React$1.createElement(u.Text,{isBold:!0},e),button:e=>_.React$1.createElement(u.Button$1,{variant:"transparent",onClick:n},e),folderPickerButton:e=>_.React$1.createElement(u.Button$1,{onClick:i,variant:"transparent",withIconLeft:_.React$1.createElement(u.UIIcon,{src:u.FolderLine,role:"presentation"})},e)});case U.MICROSOFT_FILE:return s.intl.formatMessage({id:"gctOhH",defaultMessage:"{numFiles, plural, one{The new {fileTypeLabel} file will inherit the same sharing permissions as the original file. Save as will replace the original file.} other{The new {fileTypeLabel} files will inherit the same sharing permissions as the original files. Save as will replace the original files.}} <button>Learn more</button>"},{fileTypeLabel:a,numFiles:e.length,bold:e=>_.React$1.createElement(u.Text,{isBold:!0},e),button:e=>_.React$1.createElement(u.Button$1,{variant:"transparent",onClick:()=>{}},e)})}};var $;!function(e){e.LINK_TO_INCOMPATIBLE_GOOGLE_ACCOUNT=s.intl.formatMessage({id:"u9TFTP",defaultMessage:"Please link to the Google account of the same email as your Dropbox account."}),e.FAIL_TO_LINK_GOOGLE_ACCOUNT=s.intl.formatMessage({id:"4L5zkJ",defaultMessage:"Failed to link Google account."}),e.pendingSaveShortcuts=function(e){return s.intl.formatMessage({id:"EXRMbA",defaultMessage:"Saving as {numFiles, plural, one{shortcut} other{shortcuts}} in Google Drive..."},{numFiles:e})},e.pendingSaveMsFiles=function(e){return s.intl.formatMessage({id:"xNu9kx",defaultMessage:"Saving as Microsoft {numFiles, plural, one{file} other{files}}..."},{numFiles:e})},e.successMessageMultipleShortcuts=function(e){return s.intl.formatMessage({id:"EcF4mj",defaultMessage:"{numFiles} files saved as Google file shortcuts."},{numFiles:e})},e.successMessageMultipleMsFiles=function(e){return s.intl.formatMessage({id:"ZXYeoK",defaultMessage:"{numFiles} files saved as Microsoft files."},{numFiles:e})},e.successMessageOneShortcut=function(e){return s.intl.formatMessage({id:"osYTsQ",defaultMessage:"{filename} saved to Google Drive."},{filename:e})},e.successMessageOneMsFile=function(e){return s.intl.formatMessage({id:"0kS6qL",defaultMessage:"{filename} saved."},{filename:e})},e.SERVER_ERROR=s.intl.formatMessage({id:"+rrsxb",defaultMessage:"Server error"}),e.srcFilesNotFound=function(e){return s.intl.formatMessage({id:"eRab3W",defaultMessage:"Source {numFiles, plural, one{file} other{files}} not found"},{numFiles:e})},e.srcFilesWrongType=function(e){return s.intl.formatMessage({id:"V0eQ4f",defaultMessage:"Source {numFiles, plural, one{file} other{files}} of the wrong type"},{numFiles:e})},e.GOOGLE_ACCOUNT_NOT_LINKED=s.intl.formatMessage({id:"Qs6YhO",defaultMessage:"Google account not linked"}),e.FOLDER_CREATION_FAILED=s.intl.formatMessage({id:"gBED0D",defaultMessage:"Folder creation failed"}),e.FIND_UNUSED_FILENAME_FAILED=s.intl.formatMessage({id:"UgrtDM",defaultMessage:"Find unused filename failed"}),e.UPLOAD_FAILED=s.intl.formatMessage({id:"MQocdR",defaultMessage:"Upload failed"}),e.GRANT_PERMISSIONS_FAILED=s.intl.formatMessage({id:"OltuRn",defaultMessage:"Grant permissions failed"}),e.CREATE_FILE_FAILED=s.intl.formatMessage({id:"8eZdXo",defaultMessage:"Create file failed"}),e.DELETE_FILE_FAILED=s.intl.formatMessage({id:"QoVCWl",defaultMessage:"Delete file failed"}),e.FIND_FOLDER_FAILED=s.intl.formatMessage({id:"6phdrE",defaultMessage:"Find folder failed"}),e.INVALID_DEST_FOLDER_MIME_TYPE=s.intl.formatMessage({id:"+DHCWS",defaultMessage:"Destination folder invalid"}),e.GOOGLE_SERVER_ERROR=s.intl.formatMessage({id:"gTHqcG",defaultMessage:"Google server error"}),e.NO_WRITE_PERMISSION=s.intl.formatMessage({id:"EYJIs6",defaultMessage:"User has no write access"}),e.singleFileFailSaveShortcut=function({filename:e,rootCause:t}){return e?s.intl.formatMessage({id:"LsI80W",defaultMessage:"{filename} couldn’t be saved to Google Drive ({rootCause})."},{filename:e,rootCause:t}):s.intl.formatMessage({id:"IYz0cM",defaultMessage:"File couldn’t be saved to Google Drive ({rootCause})."},{rootCause:t})},e.singleFileFailSaveMsFile=function({filename:e,rootCause:t}){return e?s.intl.formatMessage({id:"fvHSWo",defaultMessage:"{filename} couldn’t be saved ({rootCause})."},{filename:e,rootCause:t}):s.intl.formatMessage({id:"nARyLu",defaultMessage:"File couldn’t be saved ({rootCause})."},{rootCause:t})},e.multipleFilesPartialFailureShortcuts=function(e){return s.intl.formatMessage({id:"4UgBQ9",defaultMessage:"Some files couldn’t be saved as shortcuts ({rootCause})."},{rootCause:e})},e.multipleFilesFullFailureShortcuts=function(e){return s.intl.formatMessage({id:"Q9gfPh",defaultMessage:"Files couldn’t be saved as shortcuts ({rootCause})."},{rootCause:e})},e.multipleFilesFullFailureMsFile=function(e){return s.intl.formatMessage({id:"O1bxfj",defaultMessage:"Files couldn’t be saved as Microsoft files ({rootCause})."},{rootCause:e})},e.FAILED_TO_GET_GOOGLE_SHORTCUT_SETTINGS=s.intl.formatMessage({id:"AoDCl3",defaultMessage:"Failed to get Google shortcut settings. Please try again."})}($||($={}));const B=e=>"ns_path"in e?u.filename(e.ns_path):void 0,V=e=>o.__awaiter(void 0,void 0,void 0,(function*(){try{const t=new u.UserApiV2Client;return yield t.ns("cloud_docs").rpc("google_shortcut_settings/get",void 0,{subjectUserId:e.id})}catch(e){return u.Snackbar.failSticky($.FAILED_TO_GET_GOOGLE_SHORTCUT_SETTINGS),null}})),H=({user:e,dontAskMeAgain:t,copyFilePermissions:i})=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=(({dontAskMeAgain:e,copyFilePermissions:t})=>e?t?{".tag":"always"}:{".tag":"never"}:{".tag":"ask_each_time"})({dontAskMeAgain:t,copyFilePermissions:i}),s=new u.UserApiV2Client;try{yield s.ns("cloud_docs").rpc("google_shortcut_settings/set",{copy_permissions_to_google_shortcut:o},{subjectUserId:e.id})}catch(e){}})),X=({user:e,srcFileNames:t,targetDest:i,onUpdateCopyPermissionsSetting:n,onSubmit:a})=>{const[r,l]=_.reactExports.useState(!1),[{folderName:c,folderId:d},g]=_.reactExports.useState({folderName:f.Strings.MIGRATION_FOLDER});_.reactExports.useEffect((()=>{var o,s,n;o=e.role,s=t.length,n=i,u.logEvent({class:"cloud_docs",action:"shown",object:"cloud_docs_manual_conversion_modal",properties:{accountRole:o,numFiles:s,cloudDocsManualConversionType:n}})}),[e.role,t.length,i]);const m=()=>o.__awaiter(void 0,void 0,void 0,(function*(){G(e.role,"start");try{if((yield f.ensureUserHasGddMigrationCompatibleLink(e))!==f.GddMigrationCompatibleLinkStatus.HAS_COMPATIBLE_LINK)return void G(e.role,"canceled")}catch(e){const t=f.parseLinkAccountError(e);return void(t&&u.Snackbar.failSticky(t))}try{const t=yield f.chooseGdriveFolder(e.id);t?(G(e.role,"success"),g(t)):G(e.role,"canceled")}catch(t){G(e.role,"failed")}})),p=()=>{u.open_tab(f.HELP_CENTER_ARTICLE_URL)},S=_.reactExports.useMemo((()=>(({srcFileNames:e,targetDest:t,dontAskMeAgain:o,folderName:i,onChangeDriveFolder:n,onSetDontAskMeAgain:a,onConvertAndCopy:r,onConvertButDontCopy:l,onLearnMore:c})=>({title:s.intl.formatMessage({id:"taJUkh",defaultMessage:"Save with sharing permissions?"}),bodyText:_.React$1.createElement(_.React$1.Fragment,null,j({srcFileNames:e,targetDest:t,folderName:i,onChangeDriveFolder:n,onLearnMore:c})),actions:_.React$1.createElement(_.React$1.Fragment,null,_.React$1.createElement(u.Checkbox,{id:"toggleDontAskMeAgain",checked:o,onChange:e=>a(e.currentTarget.checked),"aria-label":s.intl.formatMessage({id:"PJIYJF",defaultMessage:"Toggle don’t ask me again"})}),_.React$1.createElement(u.Label,{htmlFor:"toggleDontAskMeAgain"},_.React$1.createElement(u.Text,null,s.intl.formatMessage({id:"rI2pNz",defaultMessage:"Don’t ask me again"})))),tertiaryActions:_.React$1.createElement(_.React$1.Fragment,null,_.React$1.createElement(u.Button$1,{variant:"opacity",onClick:l},s.intl.formatMessage({id:"QzQNL5",defaultMessage:"Save without permissions"})),_.React$1.createElement(u.Button$1,{variant:"primary",onClick:r},f.Strings.SAVE)),width:"standard",withCloseButton:f.Strings.CLOSE}))({srcFileNames:t,targetDest:i,dontAskMeAgain:r,folderName:c,onChangeDriveFolder:m,onSetDontAskMeAgain:e=>l(e),onConvertAndCopy:()=>{u.Modal.close(),n({dontAskMeAgain:r,copyFilePermissions:!0}),w(e.role,t.length,i,"save_with_permissions",r),a({modalWasShown:!0,copyFilePermissions:!0,folderId:d})},onConvertButDontCopy:()=>{u.Modal.close(),n({dontAskMeAgain:r,copyFilePermissions:!1}),w(e.role,t.length,i,"save_without_permissions",r),a({modalWasShown:!0,copyFilePermissions:!1,folderId:d})},onLearnMore:p})),[t,i,n,a,r,d,c,l]);return _.React$1.createElement(f.ModalTemplate,Object.assign({open:!0},S,{onRequestClose:()=>{var o,s,n;u.Modal.close(),o=e.role,s=t.length,n=i,u.logEvent({class:"cloud_docs",action:"dismiss",object:"cloud_docs_manual_conversion_modal",properties:{accountRole:o,numFiles:s,cloudDocsManualConversionType:n}})}}))};X.displayName="ManualConversionComponent";const K=({user:e,srcFileNames:t,targetDest:o,copyPermissionsSetting:i,onUpdateCopyPermissionsSetting:s,onSubmit:n})=>{switch(i[".tag"]){case"always":return void n({modalWasShown:!1,copyFilePermissions:!0});case"never":return void n({modalWasShown:!1,copyFilePermissions:!1});case"ask_each_time":case"other":break;default:u.enforceExhaustive(i)}u.Modal.showInstance(_.React$1.createElement(X,{user:e,srcFileNames:t,targetDest:o,onUpdateCopyPermissionsSetting:s,onSubmit:n}))},q=({files:e,user:t,modalWasShown:i,copyFilePermissions:s,folderId:n})=>o.__awaiter(void 0,void 0,void 0,(function*(){const o="web_shortcut",a=!n,r="none";x(t.role,e.length,o,i,s,a,r,"start");try{const e=yield f.ensureUserHasGddMigrationCompatibleLink(t);switch(e){case f.GddMigrationCompatibleLinkStatus.HAS_COMPATIBLE_LINK:break;case f.GddMigrationCompatibleLinkStatus.HAS_INCOMPATIBLE_LINK:return void u.Snackbar.failSticky($.LINK_TO_INCOMPATIBLE_GOOGLE_ACCOUNT);case f.GddMigrationCompatibleLinkStatus.NOT_LINKED:return void u.Snackbar.failSticky($.FAIL_TO_LINK_GOOGLE_ACCOUNT);default:u.Snackbar.failSticky($.FAIL_TO_LINK_GOOGLE_ACCOUNT),u.enforceExhaustive(e)}}catch(e){const t=f.parseLinkAccountError(e);return void(t&&u.Snackbar.failSticky(t))}u.Snackbar.sync($.pendingSaveShortcuts(e.length));const l=[];for(let t=0;t<e.length;t+=4){const o=e.slice(t,t+4);l.push({dest_service:{".tag":"gdrive"},src_files:o.map((e=>e.file_id)),keep_original_file:!1,preserve_existing_shortcut:!0,copy_permissions:s,dest_folder_id:n})}try{const n=new u.UserApiV2Client,c=yield Promise.all(l.map((e=>n.ns("cloud_docs").rpc("convert_to_web_shortcut",e,{subjectUserId:t.id}))));x(t.role,e.length,o,i,s,a,r,"success"),((e,t)=>{e.length>1?u.Snackbar.completeSticky($.successMessageMultipleShortcuts(e.length)):u.Snackbar.completeSticky($.successMessageOneShortcut(u.filename(t)))})(e,c[0].shortcuts[0].file_path)}catch(n){const r=((e,t)=>{let o=!1,i="server_error",s=$.SERVER_ERROR;if(t instanceof u.AppError){const n=t.error;switch(n[".tag"]){case"src_file_not_found":i="src_file_not_found",s=$.srcFilesNotFound(e.length);break;case"src_file_wrong_type":i="src_file_wrong_type",s=$.srcFilesWrongType(e.length);break;case"missing_linked_service":i="google_account_not_linked",s=$.GOOGLE_ACCOUNT_NOT_LINKED;break;case"no_write_permission":s=$.NO_WRITE_PERMISSION;break;case"external_api_error":switch(o=n.is_partial_failure,n.error_sub_type[".tag"]){case"create_folder":i="folder_creation_failed",s=$.FOLDER_CREATION_FAILED;break;case"find_unused_filename":i="find_unused_filename_failed",s=$.FIND_UNUSED_FILENAME_FAILED;break;case"upload":i="upload_failed",s=$.UPLOAD_FAILED;break;case"grant_role":i="grant_permissions_failed",s=$.GRANT_PERMISSIONS_FAILED;break;case"create_file":i="create_file_failed",s=$.CREATE_FILE_FAILED;break;case"delete_file":i="delete_file_failed",s=$.DELETE_FILE_FAILED;break;case"find_file_or_folder":i="find_folder_failed",s=$.FIND_FOLDER_FAILED;break;case"other":i="google_server_error",s=$.GOOGLE_SERVER_ERROR;break;default:u.enforceExhaustive(n.error_sub_type)}break;case"invalid_dest_folder_mime_type":i="invalid_dest_folder_mime_type",s=$.INVALID_DEST_FOLDER_MIME_TYPE;break;case"other":break;default:u.enforceExhaustive(n)}}if(1===e.length){const t=B(e[0]);u.Snackbar.failSticky($.singleFileFailSaveShortcut({filename:t,rootCause:s}))}else o?u.Snackbar.failSticky($.multipleFilesPartialFailureShortcuts(s)):u.Snackbar.failSticky($.multipleFilesFullFailureShortcuts(s));return i})(e,n);x(t.role,e.length,o,i,s,a,r,"success")}})),z=({files:e,user:t,modalWasShown:i,copyFilePermissions:s})=>o.__awaiter(void 0,void 0,void 0,(function*(){const o="ms_file",n=void 0,a="none";x(t.role,e.length,o,i,s,n,a,"start");const r=[];for(let t=0;t<e.length;t+=4){const o=e.slice(t,t+4);r.push({src_files:o.map((e=>e.file_id)),keep_original_file:!1,preserve_existing_ms_file:!0,copy_permissions:s})}u.Snackbar.sync($.pendingSaveMsFiles(e.length));const l=new u.UserApiV2Client;try{const c=yield Promise.all(r.map((e=>l.ns("cloud_docs").rpc("convert_gdd_to_ms_office_file",e,{subjectUserId:t.id}))));x(t.role,e.length,o,i,s,n,a,"success"),((e,t)=>{e.length>1?u.Snackbar.completeSticky($.successMessageMultipleMsFiles(e.length)):u.Snackbar.completeSticky($.successMessageOneMsFile(u.filename(t)))})(e,c[0].converted_files[0].dest_file_path)}catch(a){const r=((e,t)=>{let o="server_error",i=$.SERVER_ERROR;if(t instanceof u.AppError){const s=t.error;switch(s[".tag"]){case"src_file_not_found":o="src_file_not_found",i=$.srcFilesNotFound(e.length);break;case"src_file_wrong_type":o="src_file_wrong_type",i=$.srcFilesWrongType(e.length);break;case"no_write_permission":i=$.NO_WRITE_PERMISSION;break;case"other":o="server_error";break;default:u.enforceExhaustive(s)}}if(1===e.length){const t=B(e[0]);u.Snackbar.failSticky($.singleFileFailSaveMsFile({filename:t,rootCause:i}))}else u.Snackbar.failSticky($.multipleFilesFullFailureMsFile(i));return o})(e,a);x(t.role,e.length,o,i,s,n,r,"failed")}})),Y=["gdoc","gslides","gsheet"],Q=e=>(t,o)=>!!(null==o?void 0:o.expGddMigrationFrontendActions)&&e(t,o),J=(e,t)=>(o,i)=>!t.some((e=>e(o,i)))&&e(o,i),Z=Q(i.multiFileWithExtensionSelector(["gdoc"])),ee=Q(i.multiFileWithExtensionSelector(["gslides"])),te=Q(i.multiFileWithExtensionSelector(["gsheet"])),oe=J(Q(i.multiFileWithExtensionSelector(Y)),[Z,ee,te]),ie=Q(i.multiFileWithExtensionSelector(["gdoc","doc","docx"])),se=Q(i.multiFileWithExtensionSelector(["gslides","ppt","pptx"])),ne=Q(i.multiFileWithExtensionSelector(["gsheet","xls","xlsx"])),ae=J(Q(i.multiFileWithExtensionSelector(Y.concat(["doc","docx","ppt","pptx","xls","xlsx"]))),[ie,se,ne]);var re;!function(e){e.GOOGLE_DOC_SHORTCUT=s.intl.formatMessage({id:"CKb8d4",defaultMessage:"Google Doc shortcut"}),e.GOOGLE_SLIDES_SHORTCUT=s.intl.formatMessage({id:"f6BDMy",defaultMessage:"Google Slides shortcut"}),e.GOOGLE_SHEET_SHORTCUT=s.intl.formatMessage({id:"4dVxeR",defaultMessage:"Google Sheet shortcut"}),e.GOOGLE_FILE_SHORTCUT=s.intl.formatMessage({id:"c4laUx",defaultMessage:"Google file shortcut"}),e.MICROSOFT_DOC=s.intl.formatMessage({id:"yUBw4G",defaultMessage:"Microsoft Word"}),e.MICROSOFT_SLIDES=s.intl.formatMessage({id:"F/PKmQ",defaultMessage:"Microsoft Powerpoint"}),e.MICROSOFT_SHEET=s.intl.formatMessage({id:"wxiHoJ",defaultMessage:"Microsoft Excel"}),e.MICROSOFT_FILE=s.intl.formatMessage({id:"zNrz5l",defaultMessage:"Microsoft file"})}(re||(re={}));const le=(e,t)=>o.__awaiter(void 0,void 0,void 0,(function*(){yield((e,t)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=yield V(t);o&&K({user:t,srcFileNames:e.map((e=>{var t;return null!==(t=B(e))&&void 0!==t?t:""})),targetDest:U.GOOGLE_DRIVE,copyPermissionsSetting:o.copy_permissions_to_google_shortcut,onUpdateCopyPermissionsSetting:({dontAskMeAgain:e,copyFilePermissions:o})=>{H({user:t,dontAskMeAgain:e,copyFilePermissions:o})},onSubmit:({modalWasShown:o,copyFilePermissions:i,folderId:s})=>{q({files:e,user:t,modalWasShown:o,copyFilePermissions:i,folderId:s})}})})))(e,t)})),ce=(e,t)=>o.__awaiter(void 0,void 0,void 0,(function*(){yield((e,t)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=yield V(t);o&&K({user:t,srcFileNames:e.map((e=>{var t;return null!==(t=B(e))&&void 0!==t?t:""})),targetDest:U.MICROSOFT_FILE,copyPermissionsSetting:o.copy_permissions_to_google_shortcut,onUpdateCopyPermissionsSetting:({dontAskMeAgain:e,copyFilePermissions:o})=>{H({user:t,dontAskMeAgain:e,copyFilePermissions:o})},onSubmit:({modalWasShown:o,copyFilePermissions:i})=>{z({files:e,user:t,modalWasShown:o,copyFilePermissions:i})}})})))(e,t)})),ue=e=>{var{shortcutUrl:t}=e,i=o.__rest(e,["shortcutUrl"]);const s=m.urlToShortcutIconAsset(t,"small");return _.React$1.createElement("img",Object.assign({},i,{src:s,alt:""}))};ue.displayName="ShortcutsIcon";const de=[v,F,...M,...I,...k,...D,...R,A,...[...[{actionText:re.GOOGLE_DOC_SHORTCUT,actionIcon:e=>_.React$1.createElement(ue,Object.assign({},e,{shortcutUrl:"docs.google.com/document"})),selector:ie,convert:le,actionGroup:t.ConversionActionGroup.CLOUD_DOCS},{actionText:re.GOOGLE_SLIDES_SHORTCUT,actionIcon:e=>_.React$1.createElement(ue,Object.assign({},e,{shortcutUrl:"docs.google.com/presentation"})),selector:se,convert:le,actionGroup:t.ConversionActionGroup.CLOUD_DOCS},{actionText:re.GOOGLE_SHEET_SHORTCUT,actionIcon:e=>_.React$1.createElement(ue,Object.assign({},e,{shortcutUrl:"docs.google.com/spreadsheets"})),selector:ne,convert:le,actionGroup:t.ConversionActionGroup.CLOUD_DOCS},{actionText:re.GOOGLE_FILE_SHORTCUT,actionIcon:e=>_.React$1.createElement(ue,Object.assign({},e,{shortcutUrl:"www.google.com"})),selector:ae,convert:le,actionGroup:t.ConversionActionGroup.CLOUD_DOCS}],...[{actionText:re.MICROSOFT_DOC,actionIcon:e=>_.React$1.createElement(g.IconPartners,Object.assign({},e,{width:14,height:14,name:"microsoft_docx"})),selector:Z,convert:ce,actionGroup:t.ConversionActionGroup.CLOUD_DOCS},{actionText:re.MICROSOFT_SLIDES,actionIcon:e=>_.React$1.createElement(g.IconPartners,Object.assign({},e,{width:14,height:14,name:"microsoft_pptx"})),selector:ee,convert:ce,actionGroup:t.ConversionActionGroup.CLOUD_DOCS},{actionText:re.MICROSOFT_SHEET,actionIcon:e=>_.React$1.createElement(g.IconPartners,Object.assign({},e,{width:14,height:14,name:"microsoft_xlsx"})),selector:te,convert:ce,actionGroup:t.ConversionActionGroup.CLOUD_DOCS},{actionText:re.MICROSOFT_FILE,actionIcon:u.FileLine,selector:oe,convert:ce,actionGroup:t.ConversionActionGroup.CLOUD_DOCS}]]];t.getConversionActionsForFiles=(e,t)=>de.filter((o=>o.selector(e,t)))}));
//# sourceMappingURL=c_flows_conversions_conversion_actions.js-vflpkkCGB.map
