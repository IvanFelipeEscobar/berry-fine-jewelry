define(["exports","./e_edison","./c_tslib","./c_lodash-es_lodash","./c_core_i18n","./e_ui_page_files_router","./c_truncate_index","./c_resize-observer-polyfill_dist_ResizeObserver","./c_file_viewer_toolbar","./c_src_preview-photo-editor_utils","./c_src_preview-photo-editor_exif","./c_ui_preview_crop_and_rotate_crop_rotate_exports","./c_apex-metrics_src_types","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_core_xhr","./c_csrf","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","./c_folder_dialog_folder_picker","./c_keymaster","./c_spectrum_dimensions","./c_spectrum_icon_arrow_index","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_icon_templates_selectable_index","./c_spectrum_media_table_media_cell","./c_spectrum_overflow_button","./c_icon_templates_actionable_index","./c_spectrum_culled_list","./c_spectrum_util_raf_throttle","./c_spectrum_vertically_fixed","./c_exenv_index","./c_spectrum_tooltip","./c_spectrum_positioned_portal","./c_browse_interface","./c_icon_folder_icon","./c_icon_icon_helper","./c_ui_title_bubble","./c_ui_overlay","./c_raf_throttle","./c_ui_selectable_list","./c_core_logging_constants","./c_src_preview-photo-editor_types","./c_file_store_utils","./c_pap-events_previews_crop_rotate_select_rotate","./c_loggers_device_type"],(function(e,t,i,a,r,o,n,s,c,p,h,l,d,u,g,m,f,w,v,b,x,_,y,C,E,M,R,k,j,D,A,S,B,N,T,O,L,I,W,z,$,H,P,X,U,Y,F,q,Q,G,Z,K,V,J,ee,te,ie,ae,re,oe,ne,se,ce,pe,he,le,de){"use strict";o.injectInternalStyle("typescript/component_libraries/photos/src/preview-photo-editor/rotate-image-button/index.module.out.css",(e=>"._hidden-rotate-callout_1efo6_1{clip:rect(0,0,0,0);border:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px}"));const ue="_hidden-rotate-callout_1efo6_1",ge=({onRotate:e,disabled:i=!1,rotatedDegrees:a,isCalloutActive:n})=>{const{rotateImageLabel:s}=function(){const e=r.useIntl();return{rotateImageLabel:e.formatMessage({id:"GiGonM",defaultMessage:"Rotate"})}}(),c=r.useIntl();return t.React$1.createElement(t.React$1.Fragment,null,n&&t.React$1.createElement("span",{className:ue,"aria-live":"polite"},c.formatMessage({id:"BPCB+1",defaultMessage:"Rotated {degrees} degrees clockwise."},{degrees:a})),t.React$1.createElement(o.Tooltip,{placement:"top",title:s,inverse:!1},t.React$1.createElement(o.IconButton,{variant:"transparent","aria-label":s,disabled:i,onClick:e,inverse:!0},t.React$1.createElement(o.UIIcon,{src:o.RotateRightLine}))))};const me=({onCrop:e,disabled:i=!1})=>{const{cropImageLabel:a}={cropImageLabel:r.useIntl().formatMessage({id:"pQaAFe",defaultMessage:"Crop"})};return t.React$1.createElement(o.Tooltip,{placement:"top",title:a,inverse:!1},t.React$1.createElement(o.IconButton,{variant:"transparent","aria-label":a,disabled:i,onClick:e,inverse:!0},t.React$1.createElement(o.UIIcon,{src:o.CropLine})))};function fe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function we(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(i),!0).forEach((function(t){xe(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fe(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function ve(e){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function be(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function xe(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _e(e){return function(e){if(Array.isArray(e))return ye(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ye(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ye(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var Ce="undefined"!=typeof window&&void 0!==window.document,Ee=Ce?window:{},Me=!(!Ce||!Ee.document.documentElement)&&"ontouchstart"in Ee.document.documentElement,Re=!!Ce&&"PointerEvent"in Ee,ke="cropper",je="all",De="crop",Ae="move",Se="zoom",Be="e",Ne="w",Te="s",Oe="n",Le="ne",Ie="nw",We="se",ze="sw",$e="".concat(ke,"-crop"),He="".concat(ke,"-disabled"),Pe="".concat(ke,"-hidden"),Xe="".concat(ke,"-hide"),Ue="".concat(ke,"-invisible"),Ye="".concat(ke,"-modal"),Fe="".concat(ke,"-move"),qe="".concat(ke,"Action"),Qe="".concat(ke,"Preview"),Ge="crop",Ze="move",Ke="none",Ve="crop",Je="cropend",et="cropmove",tt="cropstart",it="dblclick",at=Re?"pointerdown":Me?"touchstart":"mousedown",rt=Re?"pointermove":Me?"touchmove":"mousemove",ot=Re?"pointerup pointercancel":Me?"touchend touchcancel":"mouseup",nt="ready",st="resize",ct="wheel",pt="zoom",ht="image/jpeg",lt=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,dt=/^data:/,ut=/^data:image\/jpeg;base64,/,gt=/^img|canvas$/i,mt={viewMode:0,dragMode:Ge,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},ft=Number.isNaN||Ee.isNaN;function wt(e){return"number"==typeof e&&!ft(e)}var vt=function(e){return e>0&&e<1/0};function bt(e){return void 0===e}function xt(e){return"object"===ve(e)&&null!==e}var _t=Object.prototype.hasOwnProperty;function yt(e){if(!xt(e))return!1;try{var t=e.constructor,i=t.prototype;return t&&i&&_t.call(i,"isPrototypeOf")}catch(e){return!1}}function Ct(e){return"function"==typeof e}var Et=Array.prototype.slice;function Mt(e){return Array.from?Array.from(e):Et.call(e)}function Rt(e,t){return e&&Ct(t)&&(Array.isArray(e)||wt(e.length)?Mt(e).forEach((function(i,a){t.call(e,i,a,e)})):xt(e)&&Object.keys(e).forEach((function(i){t.call(e,e[i],i,e)}))),e}var kt=Object.assign||function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return xt(e)&&i.length>0&&i.forEach((function(t){xt(t)&&Object.keys(t).forEach((function(i){e[i]=t[i]}))})),e},jt=/\.\d*(?:0|9){12}\d*$/;function Dt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return jt.test(e)?Math.round(e*t)/t:e}var At=/^width|height|left|top|marginLeft|marginTop$/;function St(e,t){var i=e.style;Rt(t,(function(e,t){At.test(t)&&wt(e)&&(e="".concat(e,"px")),i[t]=e}))}function Bt(e,t){if(t)if(wt(e.length))Rt(e,(function(e){Bt(e,t)}));else if(e.classList)e.classList.add(t);else{var i=e.className.trim();i?i.indexOf(t)<0&&(e.className="".concat(i," ").concat(t)):e.className=t}}function Nt(e,t){t&&(wt(e.length)?Rt(e,(function(e){Nt(e,t)})):e.classList?e.classList.remove(t):e.className.indexOf(t)>=0&&(e.className=e.className.replace(t,"")))}function Tt(e,t,i){t&&(wt(e.length)?Rt(e,(function(e){Tt(e,t,i)})):i?Bt(e,t):Nt(e,t))}var Ot=/([a-z\d])([A-Z])/g;function Lt(e){return e.replace(Ot,"$1-$2").toLowerCase()}function It(e,t){return xt(e[t])?e[t]:e.dataset?e.dataset[t]:e.getAttribute("data-".concat(Lt(t)))}function Wt(e,t,i){xt(i)?e[t]=i:e.dataset?e.dataset[t]=i:e.setAttribute("data-".concat(Lt(t)),i)}var zt=/\s\s*/,$t=function(){var e=!1;if(Ce){var t=!1,i=function(){},a=Object.defineProperty({},"once",{get:function(){return e=!0,t},set:function(e){t=e}});Ee.addEventListener("test",i,a),Ee.removeEventListener("test",i,a)}return e}();function Ht(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=i;t.trim().split(zt).forEach((function(t){if(!$t){var o=e.listeners;o&&o[t]&&o[t][i]&&(r=o[t][i],delete o[t][i],0===Object.keys(o[t]).length&&delete o[t],0===Object.keys(o).length&&delete e.listeners)}e.removeEventListener(t,r,a)}))}function Pt(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=i;t.trim().split(zt).forEach((function(t){if(a.once&&!$t){var o=e.listeners,n=void 0===o?{}:o;r=function(){delete n[t][i],e.removeEventListener(t,r,a);for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];i.apply(e,s)},n[t]||(n[t]={}),n[t][i]&&e.removeEventListener(t,n[t][i],a),n[t][i]=r,e.listeners=n}e.addEventListener(t,r,a)}))}function Xt(e,t,i){var a;return Ct(Event)&&Ct(CustomEvent)?a=new CustomEvent(t,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,i),e.dispatchEvent(a)}function Ut(e){var t=e.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var Yt=Ee.location,Ft=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function qt(e){var t=e.match(Ft);return null!==t&&(t[1]!==Yt.protocol||t[2]!==Yt.hostname||t[3]!==Yt.port)}function Qt(e){var t="timestamp=".concat((new Date).getTime());return e+(-1===e.indexOf("?")?"?":"&")+t}function Gt(e){var t=e.rotate,i=e.scaleX,a=e.scaleY,r=e.translateX,o=e.translateY,n=[];wt(r)&&0!==r&&n.push("translateX(".concat(r,"px)")),wt(o)&&0!==o&&n.push("translateY(".concat(o,"px)")),wt(t)&&0!==t&&n.push("rotate(".concat(t,"deg)")),wt(i)&&1!==i&&n.push("scaleX(".concat(i,")")),wt(a)&&1!==a&&n.push("scaleY(".concat(a,")"));var s=n.length?n.join(" "):"none";return{WebkitTransform:s,msTransform:s,transform:s}}function Zt(e,t){var i=e.pageX,a=e.pageY,r={endX:i,endY:a};return t?r:we({startX:i,startY:a},r)}function Kt(e){var t=e.aspectRatio,i=e.height,a=e.width,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",o=vt(a),n=vt(i);if(o&&n){var s=i*t;"contain"===r&&s>a||"cover"===r&&s<a?i=a/t:a=i*t}else o?i=a/t:n&&(a=i*t);return{width:a,height:i}}var Vt=String.fromCharCode;var Jt=/^data:.*,/;function ei(e){var t,i=new DataView(e);try{var a,r,o;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var n=i.byteLength,s=2;s+1<n;){if(255===i.getUint8(s)&&225===i.getUint8(s+1)){r=s;break}s+=1}if(r){var c=r+10;if("Exif"===function(e,t,i){var a="";i+=t;for(var r=t;r<i;r+=1)a+=Vt(e.getUint8(r));return a}(i,r+4,4)){var p=i.getUint16(c);if(((a=18761===p)||19789===p)&&42===i.getUint16(c+2,a)){var h=i.getUint32(c+4,a);h>=8&&(o=c+h)}}}if(o){var l,d,u=i.getUint16(o,a);for(d=0;d<u;d+=1)if(l=o+12*d+2,274===i.getUint16(l,a)){l+=8,t=i.getUint16(l,a),i.setUint16(l,1,a);break}}}catch(e){t=1}return t}var ti,ii,ai={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.element,t=this.options,i=this.container,a=this.cropper,r=Number(t.minContainerWidth),o=Number(t.minContainerHeight);Bt(a,Pe),Nt(e,Pe);var n={width:Math.max(i.offsetWidth,r>=0?r:200),height:Math.max(i.offsetHeight,o>=0?o:100)};this.containerData=n,St(a,{width:n.width,height:n.height}),Bt(e,Pe),Nt(a,Pe)},initCanvas:function(){var e=this.containerData,t=this.imageData,i=this.options.viewMode,a=Math.abs(t.rotate)%180==90,r=a?t.naturalHeight:t.naturalWidth,o=a?t.naturalWidth:t.naturalHeight,n=r/o,s=e.width,c=e.height;e.height*n>e.width?3===i?s=e.height*n:c=e.width/n:3===i?c=e.width/n:s=e.height*n;var p={aspectRatio:n,naturalWidth:r,naturalHeight:o,width:s,height:c};this.canvasData=p,this.limited=1===i||2===i,this.limitCanvas(!0,!0),p.width=Math.min(Math.max(p.width,p.minWidth),p.maxWidth),p.height=Math.min(Math.max(p.height,p.minHeight),p.maxHeight),p.left=(e.width-p.width)/2,p.top=(e.height-p.height)/2,p.oldLeft=p.left,p.oldTop=p.top,this.initialCanvasData=kt({},p)},limitCanvas:function(e,t){var i=this.options,a=this.containerData,r=this.canvasData,o=this.cropBoxData,n=i.viewMode,s=r.aspectRatio,c=this.cropped&&o;if(e){var p=Number(i.minCanvasWidth)||0,h=Number(i.minCanvasHeight)||0;n>1?(p=Math.max(p,a.width),h=Math.max(h,a.height),3===n&&(h*s>p?p=h*s:h=p/s)):n>0&&(p?p=Math.max(p,c?o.width:0):h?h=Math.max(h,c?o.height:0):c&&(p=o.width,(h=o.height)*s>p?p=h*s:h=p/s));var l=Kt({aspectRatio:s,width:p,height:h});p=l.width,h=l.height,r.minWidth=p,r.minHeight=h,r.maxWidth=1/0,r.maxHeight=1/0}if(t)if(n>(c?0:1)){var d=a.width-r.width,u=a.height-r.height;r.minLeft=Math.min(0,d),r.minTop=Math.min(0,u),r.maxLeft=Math.max(0,d),r.maxTop=Math.max(0,u),c&&this.limited&&(r.minLeft=Math.min(o.left,o.left+(o.width-r.width)),r.minTop=Math.min(o.top,o.top+(o.height-r.height)),r.maxLeft=o.left,r.maxTop=o.top,2===n&&(r.width>=a.width&&(r.minLeft=Math.min(0,d),r.maxLeft=Math.max(0,d)),r.height>=a.height&&(r.minTop=Math.min(0,u),r.maxTop=Math.max(0,u))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=a.width,r.maxTop=a.height},renderCanvas:function(e,t){var i=this.canvasData,a=this.imageData;if(t){var r=function(e){var t=e.width,i=e.height,a=e.degree;if(90==(a=Math.abs(a)%180))return{width:i,height:t};var r=a%90*Math.PI/180,o=Math.sin(r),n=Math.cos(r),s=t*n+i*o,c=t*o+i*n;return a>90?{width:c,height:s}:{width:s,height:c}}({width:a.naturalWidth*Math.abs(a.scaleX||1),height:a.naturalHeight*Math.abs(a.scaleY||1),degree:a.rotate||0}),o=r.width,n=r.height,s=i.width*(o/i.naturalWidth),c=i.height*(n/i.naturalHeight);i.left-=(s-i.width)/2,i.top-=(c-i.height)/2,i.width=s,i.height=c,i.aspectRatio=o/n,i.naturalWidth=o,i.naturalHeight=n,this.limitCanvas(!0,!1)}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCanvas(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,St(this.canvas,kt({width:i.width,height:i.height},Gt({translateX:i.left,translateY:i.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(e){var t=this.canvasData,i=this.imageData,a=i.naturalWidth*(t.width/t.naturalWidth),r=i.naturalHeight*(t.height/t.naturalHeight);kt(i,{width:a,height:r,left:(t.width-a)/2,top:(t.height-r)/2}),St(this.image,kt({width:i.width,height:i.height},Gt(kt({translateX:i.left,translateY:i.top},i)))),e&&this.output()},initCropBox:function(){var e=this.options,t=this.canvasData,i=e.aspectRatio||e.initialAspectRatio,a=Number(e.autoCropArea)||.8,r={width:t.width,height:t.height};i&&(t.height*i>t.width?r.height=r.width/i:r.width=r.height*i),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*a),r.height=Math.max(r.minHeight,r.height*a),r.left=t.left+(t.width-r.width)/2,r.top=t.top+(t.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=kt({},r)},limitCropBox:function(e,t){var i=this.options,a=this.containerData,r=this.canvasData,o=this.cropBoxData,n=this.limited,s=i.aspectRatio;if(e){var c=Number(i.minCropBoxWidth)||0,p=Number(i.minCropBoxHeight)||0,h=n?Math.min(a.width,r.width,r.width+r.left,a.width-r.left):a.width,l=n?Math.min(a.height,r.height,r.height+r.top,a.height-r.top):a.height;c=Math.min(c,a.width),p=Math.min(p,a.height),s&&(c&&p?p*s>c?p=c/s:c=p*s:c?p=c/s:p&&(c=p*s),l*s>h?l=h/s:h=l*s),o.minWidth=Math.min(c,h),o.minHeight=Math.min(p,l),o.maxWidth=h,o.maxHeight=l}t&&(n?(o.minLeft=Math.max(0,r.left),o.minTop=Math.max(0,r.top),o.maxLeft=Math.min(a.width,r.left+r.width)-o.width,o.maxTop=Math.min(a.height,r.top+r.height)-o.height):(o.minLeft=0,o.minTop=0,o.maxLeft=a.width-o.width,o.maxTop=a.height-o.height))},renderCropBox:function(){var e=this.options,t=this.containerData,i=this.cropBoxData;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,e.movable&&e.cropBoxMovable&&Wt(this.face,qe,i.width>=t.width&&i.height>=t.height?Ae:je),St(this.cropBox,kt({width:i.width,height:i.height},Gt({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),Xt(this.element,Ve,this.getData())}},ri={initPreview:function(){var e=this.element,t=this.crossOrigin,i=this.options.preview,a=t?this.crossOriginUrl:this.url,r=e.alt||"The image to preview",o=document.createElement("img");if(t&&(o.crossOrigin=t),o.src=a,o.alt=r,this.viewBox.appendChild(o),this.viewBoxImage=o,i){var n=i;"string"==typeof i?n=e.ownerDocument.querySelectorAll(i):i.querySelector&&(n=[i]),this.previews=n,Rt(n,(function(e){var i=document.createElement("img");Wt(e,Qe,{width:e.offsetWidth,height:e.offsetHeight,html:e.innerHTML}),t&&(i.crossOrigin=t),i.src=a,i.alt=r,i.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',e.innerHTML="",e.appendChild(i)}))}},resetPreview:function(){Rt(this.previews,(function(e){var t=It(e,Qe);St(e,{width:t.width,height:t.height}),e.innerHTML=t.html,function(e,t){if(xt(e[t]))try{delete e[t]}catch(i){e[t]=void 0}else if(e.dataset)try{delete e.dataset[t]}catch(i){e.dataset[t]=void 0}else e.removeAttribute("data-".concat(Lt(t)))}(e,Qe)}))},preview:function(){var e=this.imageData,t=this.canvasData,i=this.cropBoxData,a=i.width,r=i.height,o=e.width,n=e.height,s=i.left-t.left-e.left,c=i.top-t.top-e.top;this.cropped&&!this.disabled&&(St(this.viewBoxImage,kt({width:o,height:n},Gt(kt({translateX:-s,translateY:-c},e)))),Rt(this.previews,(function(t){var i=It(t,Qe),p=i.width,h=i.height,l=p,d=h,u=1;a&&(d=r*(u=p/a)),r&&d>h&&(l=a*(u=h/r),d=h),St(t,{width:l,height:d}),St(t.getElementsByTagName("img")[0],kt({width:o*u,height:n*u},Gt(kt({translateX:-s*u,translateY:-c*u},e))))})))}},oi={bind:function(){var e=this.element,t=this.options,i=this.cropper;Ct(t.cropstart)&&Pt(e,tt,t.cropstart),Ct(t.cropmove)&&Pt(e,et,t.cropmove),Ct(t.cropend)&&Pt(e,Je,t.cropend),Ct(t.crop)&&Pt(e,Ve,t.crop),Ct(t.zoom)&&Pt(e,pt,t.zoom),Pt(i,at,this.onCropStart=this.cropStart.bind(this)),t.zoomable&&t.zoomOnWheel&&Pt(i,ct,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&Pt(i,it,this.onDblclick=this.dblclick.bind(this)),Pt(e.ownerDocument,rt,this.onCropMove=this.cropMove.bind(this)),Pt(e.ownerDocument,ot,this.onCropEnd=this.cropEnd.bind(this)),t.responsive&&Pt(window,st,this.onResize=this.resize.bind(this))},unbind:function(){var e=this.element,t=this.options,i=this.cropper;Ct(t.cropstart)&&Ht(e,tt,t.cropstart),Ct(t.cropmove)&&Ht(e,et,t.cropmove),Ct(t.cropend)&&Ht(e,Je,t.cropend),Ct(t.crop)&&Ht(e,Ve,t.crop),Ct(t.zoom)&&Ht(e,pt,t.zoom),Ht(i,at,this.onCropStart),t.zoomable&&t.zoomOnWheel&&Ht(i,ct,this.onWheel,{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&Ht(i,it,this.onDblclick),Ht(e.ownerDocument,rt,this.onCropMove),Ht(e.ownerDocument,ot,this.onCropEnd),t.responsive&&Ht(window,st,this.onResize)}},ni={resize:function(){if(!this.disabled){var e,t,i=this.options,a=this.container,r=this.containerData,o=a.offsetWidth/r.width,n=a.offsetHeight/r.height,s=Math.abs(o-1)>Math.abs(n-1)?o:n;if(1!==s)i.restore&&(e=this.getCanvasData(),t=this.getCropBoxData()),this.render(),i.restore&&(this.setCanvasData(Rt(e,(function(t,i){e[i]=t*s}))),this.setCropBoxData(Rt(t,(function(e,i){t[i]=e*s}))))}},dblclick:function(){var e,t;this.disabled||this.options.dragMode===Ke||this.setDragMode((e=this.dragBox,t=$e,(e.classList?e.classList.contains(t):e.className.indexOf(t)>-1)?Ze:Ge))},wheel:function(e){var t=this,i=Number(this.options.wheelZoomRatio)||.1,a=1;this.disabled||(e.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout((function(){t.wheeling=!1}),50),e.deltaY?a=e.deltaY>0?1:-1:e.wheelDelta?a=-e.wheelDelta/120:e.detail&&(a=e.detail>0?1:-1),this.zoom(-a*i,e)))},cropStart:function(e){var t=e.buttons,i=e.button;if(!(this.disabled||("mousedown"===e.type||"pointerdown"===e.type&&"mouse"===e.pointerType)&&(wt(t)&&1!==t||wt(i)&&0!==i||e.ctrlKey))){var a,r=this.options,o=this.pointers;e.changedTouches?Rt(e.changedTouches,(function(e){o[e.identifier]=Zt(e)})):o[e.pointerId||0]=Zt(e),a=Object.keys(o).length>1&&r.zoomable&&r.zoomOnTouch?Se:It(e.target,qe),lt.test(a)&&!1!==Xt(this.element,tt,{originalEvent:e,action:a})&&(e.preventDefault(),this.action=a,this.cropping=!1,a===De&&(this.cropping=!0,Bt(this.dragBox,Ye)))}},cropMove:function(e){var t=this.action;if(!this.disabled&&t){var i=this.pointers;e.preventDefault(),!1!==Xt(this.element,et,{originalEvent:e,action:t})&&(e.changedTouches?Rt(e.changedTouches,(function(e){kt(i[e.identifier]||{},Zt(e,!0))})):kt(i[e.pointerId||0]||{},Zt(e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var t=this.action,i=this.pointers;e.changedTouches?Rt(e.changedTouches,(function(e){delete i[e.identifier]})):delete i[e.pointerId||0],t&&(e.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,Tt(this.dragBox,Ye,this.cropped&&this.options.modal)),Xt(this.element,Je,{originalEvent:e,action:t}))}}},si={change:function(e){var t,i=this.options,a=this.canvasData,r=this.containerData,o=this.cropBoxData,n=this.pointers,s=this.action,c=i.aspectRatio,p=o.left,h=o.top,l=o.width,d=o.height,u=p+l,g=h+d,m=0,f=0,w=r.width,v=r.height,b=!0;!c&&e.shiftKey&&(c=l&&d?l/d:1),this.limited&&(m=o.minLeft,f=o.minTop,w=m+Math.min(r.width,a.width,a.left+a.width),v=f+Math.min(r.height,a.height,a.top+a.height));var x=n[Object.keys(n)[0]],_={x:x.endX-x.startX,y:x.endY-x.startY},y=function(e){switch(e){case Be:u+_.x>w&&(_.x=w-u);break;case Ne:p+_.x<m&&(_.x=m-p);break;case Oe:h+_.y<f&&(_.y=f-h);break;case Te:g+_.y>v&&(_.y=v-g)}};switch(s){case je:p+=_.x,h+=_.y;break;case Be:if(_.x>=0&&(u>=w||c&&(h<=f||g>=v))){b=!1;break}y(Be),(l+=_.x)<0&&(s=Ne,p-=l=-l),c&&(d=l/c,h+=(o.height-d)/2);break;case Oe:if(_.y<=0&&(h<=f||c&&(p<=m||u>=w))){b=!1;break}y(Oe),d-=_.y,h+=_.y,d<0&&(s=Te,h-=d=-d),c&&(l=d*c,p+=(o.width-l)/2);break;case Ne:if(_.x<=0&&(p<=m||c&&(h<=f||g>=v))){b=!1;break}y(Ne),l-=_.x,p+=_.x,l<0&&(s=Be,p-=l=-l),c&&(d=l/c,h+=(o.height-d)/2);break;case Te:if(_.y>=0&&(g>=v||c&&(p<=m||u>=w))){b=!1;break}y(Te),(d+=_.y)<0&&(s=Oe,h-=d=-d),c&&(l=d*c,p+=(o.width-l)/2);break;case Le:if(c){if(_.y<=0&&(h<=f||u>=w)){b=!1;break}y(Oe),d-=_.y,h+=_.y,l=d*c}else y(Oe),y(Be),_.x>=0?u<w?l+=_.x:_.y<=0&&h<=f&&(b=!1):l+=_.x,_.y<=0?h>f&&(d-=_.y,h+=_.y):(d-=_.y,h+=_.y);l<0&&d<0?(s=ze,h-=d=-d,p-=l=-l):l<0?(s=Ie,p-=l=-l):d<0&&(s=We,h-=d=-d);break;case Ie:if(c){if(_.y<=0&&(h<=f||p<=m)){b=!1;break}y(Oe),d-=_.y,h+=_.y,l=d*c,p+=o.width-l}else y(Oe),y(Ne),_.x<=0?p>m?(l-=_.x,p+=_.x):_.y<=0&&h<=f&&(b=!1):(l-=_.x,p+=_.x),_.y<=0?h>f&&(d-=_.y,h+=_.y):(d-=_.y,h+=_.y);l<0&&d<0?(s=We,h-=d=-d,p-=l=-l):l<0?(s=Le,p-=l=-l):d<0&&(s=ze,h-=d=-d);break;case ze:if(c){if(_.x<=0&&(p<=m||g>=v)){b=!1;break}y(Ne),l-=_.x,p+=_.x,d=l/c}else y(Te),y(Ne),_.x<=0?p>m?(l-=_.x,p+=_.x):_.y>=0&&g>=v&&(b=!1):(l-=_.x,p+=_.x),_.y>=0?g<v&&(d+=_.y):d+=_.y;l<0&&d<0?(s=Le,h-=d=-d,p-=l=-l):l<0?(s=We,p-=l=-l):d<0&&(s=Ie,h-=d=-d);break;case We:if(c){if(_.x>=0&&(u>=w||g>=v)){b=!1;break}y(Be),d=(l+=_.x)/c}else y(Te),y(Be),_.x>=0?u<w?l+=_.x:_.y>=0&&g>=v&&(b=!1):l+=_.x,_.y>=0?g<v&&(d+=_.y):d+=_.y;l<0&&d<0?(s=Ie,h-=d=-d,p-=l=-l):l<0?(s=ze,p-=l=-l):d<0&&(s=Le,h-=d=-d);break;case Ae:this.move(_.x,_.y),b=!1;break;case Se:this.zoom(function(e){var t=we({},e),i=0;return Rt(e,(function(e,a){delete t[a],Rt(t,(function(t){var a=Math.abs(e.startX-t.startX),r=Math.abs(e.startY-t.startY),o=Math.abs(e.endX-t.endX),n=Math.abs(e.endY-t.endY),s=Math.sqrt(a*a+r*r),c=(Math.sqrt(o*o+n*n)-s)/s;Math.abs(c)>Math.abs(i)&&(i=c)}))})),i}(n),e),b=!1;break;case De:if(!_.x||!_.y){b=!1;break}t=Ut(this.cropper),p=x.startX-t.left,h=x.startY-t.top,l=o.minWidth,d=o.minHeight,_.x>0?s=_.y>0?We:Le:_.x<0&&(p-=l,s=_.y>0?ze:Ie),_.y<0&&(h-=d),this.cropped||(Nt(this.cropBox,Pe),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}b&&(o.width=l,o.height=d,o.left=p,o.top=h,this.action=s,this.renderCropBox()),Rt(n,(function(e){e.startX=e.endX,e.startY=e.endY}))}},ci={crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&Bt(this.dragBox,Ye),Nt(this.cropBox,Pe),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=kt({},this.initialImageData),this.canvasData=kt({},this.initialCanvasData),this.cropBoxData=kt({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(kt(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),Nt(this.dragBox,Ye),Bt(this.cropBox,Pe)),this},replace:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&e&&(this.isImg&&(this.element.src=e),t?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,Rt(this.previews,(function(t){t.getElementsByTagName("img")[0].src=e})))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,Nt(this.cropper,He)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,Bt(this.cropper,He)),this},destroy:function(){var e=this.element;return e[ke]?(e[ke]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.canvasData,a=i.left,r=i.top;return this.moveTo(bt(e)?e:a+Number(e),bt(t)?t:r+Number(t))},moveTo:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.canvasData,a=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.movable&&(wt(e)&&(i.left=e,a=!0),wt(t)&&(i.top=t,a=!0),a&&this.renderCanvas(!0)),this},zoom:function(e,t){var i=this.canvasData;return e=(e=Number(e))<0?1/(1-e):1+e,this.zoomTo(i.width*e/i.naturalWidth,null,t)},zoomTo:function(e,t,i){var a=this.options,r=this.canvasData,o=r.width,n=r.height,s=r.naturalWidth,c=r.naturalHeight;if((e=Number(e))>=0&&this.ready&&!this.disabled&&a.zoomable){var p=s*e,h=c*e;if(!1===Xt(this.element,pt,{ratio:e,oldRatio:o/s,originalEvent:i}))return this;if(i){var l=this.pointers,d=Ut(this.cropper),u=l&&Object.keys(l).length?function(e){var t=0,i=0,a=0;return Rt(e,(function(e){var r=e.startX,o=e.startY;t+=r,i+=o,a+=1})),{pageX:t/=a,pageY:i/=a}}(l):{pageX:i.pageX,pageY:i.pageY};r.left-=(p-o)*((u.pageX-d.left-r.left)/o),r.top-=(h-n)*((u.pageY-d.top-r.top)/n)}else yt(t)&&wt(t.x)&&wt(t.y)?(r.left-=(p-o)*((t.x-r.left)/o),r.top-=(h-n)*((t.y-r.top)/n)):(r.left-=(p-o)/2,r.top-=(h-n)/2);r.width=p,r.height=h,this.renderCanvas(!0)}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo:function(e){return wt(e=Number(e))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX:function(e){var t=this.imageData.scaleY;return this.scale(e,wt(t)?t:1)},scaleY:function(e){var t=this.imageData.scaleX;return this.scale(wt(t)?t:1,e)},scale:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.imageData,a=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.scalable&&(wt(e)&&(i.scaleX=e,a=!0),wt(t)&&(i.scaleY=t,a=!0),a&&this.renderCanvas(!0,!0)),this},getData:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.options,a=this.imageData,r=this.canvasData,o=this.cropBoxData;if(this.ready&&this.cropped){e={x:o.left-r.left,y:o.top-r.top,width:o.width,height:o.height};var n=a.width/a.naturalWidth;if(Rt(e,(function(t,i){e[i]=t/n})),t){var s=Math.round(e.y+e.height),c=Math.round(e.x+e.width);e.x=Math.round(e.x),e.y=Math.round(e.y),e.width=c-e.x,e.height=s-e.y}}else e={x:0,y:0,width:0,height:0};return i.rotatable&&(e.rotate=a.rotate||0),i.scalable&&(e.scaleX=a.scaleX||1,e.scaleY=a.scaleY||1),e},setData:function(e){var t=this.options,i=this.imageData,a=this.canvasData,r={};if(this.ready&&!this.disabled&&yt(e)){var o=!1;t.rotatable&&wt(e.rotate)&&e.rotate!==i.rotate&&(i.rotate=e.rotate,o=!0),t.scalable&&(wt(e.scaleX)&&e.scaleX!==i.scaleX&&(i.scaleX=e.scaleX,o=!0),wt(e.scaleY)&&e.scaleY!==i.scaleY&&(i.scaleY=e.scaleY,o=!0)),o&&this.renderCanvas(!0,!0);var n=i.width/i.naturalWidth;wt(e.x)&&(r.left=e.x*n+a.left),wt(e.y)&&(r.top=e.y*n+a.top),wt(e.width)&&(r.width=e.width*n),wt(e.height)&&(r.height=e.height*n),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?kt({},this.containerData):{}},getImageData:function(){return this.sized?kt({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,t={};return this.ready&&Rt(["left","top","width","height","naturalWidth","naturalHeight"],(function(i){t[i]=e[i]})),t},setCanvasData:function(e){var t=this.canvasData,i=t.aspectRatio;return this.ready&&!this.disabled&&yt(e)&&(wt(e.left)&&(t.left=e.left),wt(e.top)&&(t.top=e.top),wt(e.width)?(t.width=e.width,t.height=e.width/i):wt(e.height)&&(t.height=e.height,t.width=e.height*i),this.renderCanvas(!0)),this},getCropBoxData:function(){var e,t=this.cropBoxData;return this.ready&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(e){var t,i,a=this.cropBoxData,r=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&yt(e)&&(wt(e.left)&&(a.left=e.left),wt(e.top)&&(a.top=e.top),wt(e.width)&&e.width!==a.width&&(t=!0,a.width=e.width),wt(e.height)&&e.height!==a.height&&(i=!0,a.height=e.height),r&&(t?a.height=a.width/r:i&&(a.width=a.height*r)),this.renderCropBox()),this},getCroppedCanvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var t=this.canvasData,i=function(e,t,i,a){var r=t.aspectRatio,o=t.naturalWidth,n=t.naturalHeight,s=t.rotate,c=void 0===s?0:s,p=t.scaleX,h=void 0===p?1:p,l=t.scaleY,d=void 0===l?1:l,u=i.aspectRatio,g=i.naturalWidth,m=i.naturalHeight,f=a.fillColor,w=void 0===f?"transparent":f,v=a.imageSmoothingEnabled,b=void 0===v||v,x=a.imageSmoothingQuality,_=void 0===x?"low":x,y=a.maxWidth,C=void 0===y?1/0:y,E=a.maxHeight,M=void 0===E?1/0:E,R=a.minWidth,k=void 0===R?0:R,j=a.minHeight,D=void 0===j?0:j,A=document.createElement("canvas"),S=A.getContext("2d"),B=Kt({aspectRatio:u,width:C,height:M}),N=Kt({aspectRatio:u,width:k,height:D},"cover"),T=Math.min(B.width,Math.max(N.width,g)),O=Math.min(B.height,Math.max(N.height,m)),L=Kt({aspectRatio:r,width:C,height:M}),I=Kt({aspectRatio:r,width:k,height:D},"cover"),W=Math.min(L.width,Math.max(I.width,o)),z=Math.min(L.height,Math.max(I.height,n)),$=[-W/2,-z/2,W,z];return A.width=Dt(T),A.height=Dt(O),S.fillStyle=w,S.fillRect(0,0,T,O),S.save(),S.translate(T/2,O/2),S.rotate(c*Math.PI/180),S.scale(h,d),S.imageSmoothingEnabled=b,S.imageSmoothingQuality=_,S.drawImage.apply(S,[e].concat(_e($.map((function(e){return Math.floor(Dt(e))}))))),S.restore(),A}(this.image,this.imageData,t,e);if(!this.cropped)return i;var a=this.getData(),r=a.x,o=a.y,n=a.width,s=a.height,c=i.width/Math.floor(t.naturalWidth);1!==c&&(r*=c,o*=c,n*=c,s*=c);var p=n/s,h=Kt({aspectRatio:p,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),l=Kt({aspectRatio:p,width:e.minWidth||0,height:e.minHeight||0},"cover"),d=Kt({aspectRatio:p,width:e.width||(1!==c?i.width:n),height:e.height||(1!==c?i.height:s)}),u=d.width,g=d.height;u=Math.min(h.width,Math.max(l.width,u)),g=Math.min(h.height,Math.max(l.height,g));var m=document.createElement("canvas"),f=m.getContext("2d");m.width=Dt(u),m.height=Dt(g),f.fillStyle=e.fillColor||"transparent",f.fillRect(0,0,u,g);var w=e.imageSmoothingEnabled,v=void 0===w||w,b=e.imageSmoothingQuality;f.imageSmoothingEnabled=v,b&&(f.imageSmoothingQuality=b);var x,_,y,C,E,M,R=i.width,k=i.height,j=r,D=o;j<=-n||j>R?(j=0,x=0,y=0,E=0):j<=0?(y=-j,j=0,E=x=Math.min(R,n+j)):j<=R&&(y=0,E=x=Math.min(n,R-j)),x<=0||D<=-s||D>k?(D=0,_=0,C=0,M=0):D<=0?(C=-D,D=0,M=_=Math.min(k,s+D)):D<=k&&(C=0,M=_=Math.min(s,k-D));var A=[j,D,x,_];if(E>0&&M>0){var S=u/n;A.push(y*S,C*S,E*S,M*S)}return f.drawImage.apply(f,[i].concat(_e(A.map((function(e){return Math.floor(Dt(e))}))))),m},setAspectRatio:function(e){var t=this.options;return this.disabled||bt(e)||(t.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(e){var t=this.options,i=this.dragBox,a=this.face;if(this.ready&&!this.disabled){var r=e===Ge,o=t.movable&&e===Ze;e=r||o?e:Ke,t.dragMode=e,Wt(i,qe,e),Tt(i,$e,r),Tt(i,Fe,o),t.cropBoxMovable||(Wt(a,qe,e),Tt(a,$e,r),Tt(a,Fe,o))}return this}},pi=Ee.Cropper,hi=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t||!gt.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=kt({},mt,yt(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}var t,i,a;return t=e,a=[{key:"noConflict",value:function(){return window.Cropper=pi,e}},{key:"setDefaults",value:function(e){kt(mt,yt(e)&&e)}}],(i=[{key:"init",value:function(){var e,t=this.element,i=t.tagName.toLowerCase();if(!t[ke]){if(t[ke]=this,"img"===i){if(this.isImg=!0,e=t.getAttribute("src")||"",this.originalUrl=e,!e)return;e=t.src}else"canvas"===i&&window.HTMLCanvasElement&&(e=t.toDataURL());this.load(e)}}},{key:"load",value:function(e){var t=this;if(e){this.url=e,this.imageData={};var i=this.element,a=this.options;if(a.rotatable||a.scalable||(a.checkOrientation=!1),a.checkOrientation&&window.ArrayBuffer)if(dt.test(e))ut.test(e)?this.read((r=e.replace(Jt,""),o=atob(r),n=new ArrayBuffer(o.length),Rt(s=new Uint8Array(n),(function(e,t){s[t]=o.charCodeAt(t)})),n)):this.clone();else{var r,o,n,s,c=new XMLHttpRequest,p=this.clone.bind(this);this.reloading=!0,this.xhr=c,c.onabort=p,c.onerror=p,c.ontimeout=p,c.onprogress=function(){c.getResponseHeader("content-type")!==ht&&c.abort()},c.onload=function(){t.read(c.response)},c.onloadend=function(){t.reloading=!1,t.xhr=null},a.checkCrossOrigin&&qt(e)&&i.crossOrigin&&(e=Qt(e)),c.open("GET",e,!0),c.responseType="arraybuffer",c.withCredentials="use-credentials"===i.crossOrigin,c.send()}else this.clone()}}},{key:"read",value:function(e){var t=this.options,i=this.imageData,a=ei(e),r=0,o=1,n=1;if(a>1){this.url=function(e,t){for(var i=[],a=new Uint8Array(e);a.length>0;)i.push(Vt.apply(null,Mt(a.subarray(0,8192)))),a=a.subarray(8192);return"data:".concat(t,";base64,").concat(btoa(i.join("")))}(e,ht);var s=function(e){var t=0,i=1,a=1;switch(e){case 2:i=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90,a=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90}return{rotate:t,scaleX:i,scaleY:a}}(a);r=s.rotate,o=s.scaleX,n=s.scaleY}t.rotatable&&(i.rotate=r),t.scalable&&(i.scaleX=o,i.scaleY=n),this.clone()}},{key:"clone",value:function(){var e=this.element,t=this.url,i=e.crossOrigin,a=t;this.options.checkCrossOrigin&&qt(t)&&(i||(i="anonymous"),a=Qt(t)),this.crossOrigin=i,this.crossOriginUrl=a;var r=document.createElement("img");i&&(r.crossOrigin=i),r.src=a||t,r.alt=e.alt||"The image to crop",this.image=r,r.onload=this.start.bind(this),r.onerror=this.stop.bind(this),Bt(r,Xe),e.parentNode.insertBefore(r,e.nextSibling)}},{key:"start",value:function(){var e=this,t=this.image;t.onload=null,t.onerror=null,this.sizing=!0;var i=Ee.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(Ee.navigator.userAgent),a=function(t,i){kt(e.imageData,{naturalWidth:t,naturalHeight:i,aspectRatio:t/i}),e.initialImageData=kt({},e.imageData),e.sizing=!1,e.sized=!0,e.build()};if(!t.naturalWidth||i){var r=document.createElement("img"),o=document.body||document.documentElement;this.sizingImage=r,r.onload=function(){a(r.width,r.height),i||o.removeChild(r)},r.src=t.src,i||(r.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",o.appendChild(r))}else a(t.naturalWidth,t.naturalHeight)}},{key:"stop",value:function(){var e=this.image;e.onload=null,e.onerror=null,e.parentNode.removeChild(e),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var e=this.element,t=this.options,i=this.image,a=e.parentNode,r=document.createElement("div");r.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var o=r.querySelector(".".concat(ke,"-container")),n=o.querySelector(".".concat(ke,"-canvas")),s=o.querySelector(".".concat(ke,"-drag-box")),c=o.querySelector(".".concat(ke,"-crop-box")),p=c.querySelector(".".concat(ke,"-face"));this.container=a,this.cropper=o,this.canvas=n,this.dragBox=s,this.cropBox=c,this.viewBox=o.querySelector(".".concat(ke,"-view-box")),this.face=p,n.appendChild(i),Bt(e,Pe),a.insertBefore(o,e.nextSibling),this.isImg||Nt(i,Xe),this.initPreview(),this.bind(),t.initialAspectRatio=Math.max(0,t.initialAspectRatio)||NaN,t.aspectRatio=Math.max(0,t.aspectRatio)||NaN,t.viewMode=Math.max(0,Math.min(3,Math.round(t.viewMode)))||0,Bt(c,Pe),t.guides||Bt(c.getElementsByClassName("".concat(ke,"-dashed")),Pe),t.center||Bt(c.getElementsByClassName("".concat(ke,"-center")),Pe),t.background&&Bt(o,"".concat(ke,"-bg")),t.highlight||Bt(p,Ue),t.cropBoxMovable&&(Bt(p,Fe),Wt(p,qe,je)),t.cropBoxResizable||(Bt(c.getElementsByClassName("".concat(ke,"-line")),Pe),Bt(c.getElementsByClassName("".concat(ke,"-point")),Pe)),this.render(),this.ready=!0,this.setDragMode(t.dragMode),t.autoCrop&&this.crop(),this.setData(t.data),Ct(t.ready)&&Pt(e,nt,t.ready,{once:!0}),Xt(e,nt)}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),Nt(this.element,Pe))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}])&&be(t.prototype,i),a&&be(t,a),e}();kt(hi.prototype,ai,ri,oi,ni,si,ci),function(e){e.NE="ne",e.NW="nw",e.SE="se",e.SW="sw"}(ti||(ti={})),function(e){e.ArrowDown="ArrowDown",e.ArrowUp="ArrowUp",e.ArrowRight="ArrowRight",e.ArrowLeft="ArrowLeft"}(ii||(ii={}));const li=(e,t,i,a)=>{const r=i-125,o=a-185,n=e/t;let s,c;return e>t?(s=r,c=r/n,c>o&&(s=o*n,c=o)):(s=o*n,c=o,s>r&&(s=r,c=r/n)),{width:s,height:c}},di=(e,t,i,a,r,o)=>{if(t){const n={cropperObj:e,cropperAction:t,cropBoxData:i,width:r,height:o};switch(a){case ii.ArrowDown:(({cropperObj:e,cropperAction:t,cropBoxData:i,height:a})=>{switch(t){case ti.NW:case ti.NE:const t=i.height-5,r=t<0?i.height:5;e.setCropBoxData({top:i.top+r,left:i.left,height:t<0?0:t});break;case ti.SW:case ti.SE:e.setCropBoxData({top:i.top,left:i.left,height:i.height+5>a-i.top?a-i.top:i.height+5})}})(n);break;case ii.ArrowUp:(({cropperObj:e,cropperAction:t,cropBoxData:i})=>{switch(t){case ti.NW:case ti.NE:const t=i.top-5,a=t<0?i.top:5;e.setCropBoxData({top:t<0?0:t,left:i.left,height:i.height+a});break;case ti.SW:case ti.SE:e.setCropBoxData({top:i.top,left:i.left,height:i.height-5<0?0:i.height-5})}})(n);break;case ii.ArrowRight:(({cropperObj:e,cropperAction:t,cropBoxData:i,width:a})=>{switch(t){case ti.NW:case ti.SW:const t=i.width-5,r=t<0?i.width:5;e.setCropBoxData({top:i.top,left:i.left+r,width:t<0?0:t});break;case ti.NE:case ti.SE:e.setCropBoxData({top:i.top,left:i.left,width:i.width+5>a-i.left?a-i.left:i.width+5})}})(n);break;case ii.ArrowLeft:(({cropperObj:e,cropperAction:t,cropBoxData:i})=>{switch(t){case ti.NW:case ti.SW:const t=i.left-5,a=t<0?i.left:5;e.setCropBoxData({top:i.top,left:t<0?0:t,width:i.width+a});break;case ti.NE:case ti.SE:e.setCropBoxData({top:i.top,left:i.left,width:i.width-5<0?0:i.width-5})}})(n)}}},ui=(e,t,i)=>{const a=i.getCropBoxDataLabel(t);null==e||e.forEach((e=>{let t,r=!1;switch(e.dataset.cropperAction){case ti.NW:r=!0,t=i.nwPointAriaLabel+a;break;case ti.NE:r=!0,t=i.nePointAriaLabel+a;break;case ti.SE:r=!0,t=i.sePointAriaLabel+a;break;case ti.SW:r=!0,t=i.swPointAriaLabel+a}r&&t&&(null==e||e.setAttribute("tabindex","0"),null==e||e.setAttribute("aria-label",t))}))},gi=e=>{let t;if(e&&"cropBox"in e){t=e.cropBox.querySelectorAll(".cropper-point")}return t};o.injectInternalStyle("typescript/component_libraries/photos/src/preview-photo-editor/cropperjs-editor/index.module.out.css",(e=>'/*!\n * Cropper.js v1.5.12\n * https://fengyuanchen.github.io/cropperjs\n *\n * Copyright 2015-present Chen Fengyuan\n * Released under the MIT license\n *\n * Date: 2021-06-12T08:00:11.623Z\n */._cropperjs-editor-wrapper_12we9_11 .cropper-container{direction:ltr;font-size:0;line-height:0;position:relative;touch-action:none;-webkit-user-select:none;user-select:none}._cropperjs-editor-wrapper_12we9_11 .cropper-container img{image-orientation:0deg;display:block;height:100%;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;width:100%}._cropperjs-editor-wrapper_12we9_11 .cropper-canvas,._cropperjs-editor-wrapper_12we9_11 .cropper-crop-box,._cropperjs-editor-wrapper_12we9_11 .cropper-drag-box,._cropperjs-editor-wrapper_12we9_11 .cropper-modal,._cropperjs-editor-wrapper_12we9_11 .cropper-wrap-box{bottom:0;left:0;position:absolute;right:0;top:0}._cropperjs-editor-wrapper_12we9_11 .cropper-canvas,._cropperjs-editor-wrapper_12we9_11 .cropper-wrap-box{overflow:hidden}._cropperjs-editor-wrapper_12we9_11 .cropper-drag-box{background-color:#fff;opacity:0}._cropperjs-editor-wrapper_12we9_11 .cropper-modal{background-color:#000;opacity:.5}._cropperjs-editor-wrapper_12we9_11 .cropper-view-box{display:block;height:100%;outline:1px solid #fff;outline-color:#fff;overflow:hidden;width:100%}._cropperjs-editor-wrapper_12we9_11 .cropper-dashed{border:0 dashed #eee;display:block;opacity:.5;position:absolute}._cropperjs-editor-wrapper_12we9_11 .cropper-dashed.dashed-h{border-bottom-width:1px;border-top-width:1px;height:33.33333%;left:0;top:33.33333%;width:100%}._cropperjs-editor-wrapper_12we9_11 .cropper-dashed.dashed-v{border-left-width:1px;border-right-width:1px;height:100%;left:33.33333%;top:0;width:33.33333%}._cropperjs-editor-wrapper_12we9_11 .cropper-center{display:block;height:0;left:50%;opacity:.75;position:absolute;top:50%;width:0}._cropperjs-editor-wrapper_12we9_11 .cropper-center:after,._cropperjs-editor-wrapper_12we9_11 .cropper-center:before{background-color:#eee;content:" ";display:block;position:absolute}._cropperjs-editor-wrapper_12we9_11 .cropper-center:before{height:1px;left:-3px;top:0;width:7px}._cropperjs-editor-wrapper_12we9_11 .cropper-center:after{height:7px;left:0;top:-3px;width:1px}._cropperjs-editor-wrapper_12we9_11 .cropper-face,._cropperjs-editor-wrapper_12we9_11 .cropper-line,._cropperjs-editor-wrapper_12we9_11 .cropper-point{display:block;height:100%;opacity:.1;position:absolute;width:100%}._cropperjs-editor-wrapper_12we9_11 .cropper-face{background-color:#fff;left:0;top:0}._cropperjs-editor-wrapper_12we9_11 .cropper-line{background-color:#39f}._cropperjs-editor-wrapper_12we9_11 .cropper-line.line-e{cursor:ew-resize;right:-3px;top:0;width:5px}._cropperjs-editor-wrapper_12we9_11 .cropper-line.line-n{cursor:ns-resize;height:5px;left:0;top:-3px}._cropperjs-editor-wrapper_12we9_11 .cropper-line.line-w{cursor:ew-resize;left:-3px;top:0;width:5px}._cropperjs-editor-wrapper_12we9_11 .cropper-line.line-s{bottom:-3px;cursor:ns-resize;height:5px;left:0}._cropperjs-editor-wrapper_12we9_11 .cropper-point{background-color:#fff;height:5px;opacity:.75;width:5px}._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-e{cursor:ew-resize;margin-top:-3px;right:-3px;top:50%}._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-n{cursor:ns-resize;left:50%;margin-left:-3px;top:-3px}._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-w{cursor:ew-resize;left:-3px;margin-top:-3px;top:50%}._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-s{bottom:-3px;cursor:s-resize;left:50%;margin-left:-3px}._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-ne{cursor:nesw-resize;right:-3px;top:-3px}._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-nw{cursor:nwse-resize;left:-3px;top:-3px}._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-sw{bottom:-3px;cursor:nesw-resize;left:-3px}._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-se{bottom:-3px;cursor:nwse-resize;height:20px;opacity:1;right:-3px;width:20px}@media (min-width:768px){._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-se{height:15px;width:15px}}@media (min-width:992px){._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-se{height:10px;width:10px}}@media (min-width:1200px){._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-se{height:5px;opacity:.75;width:5px}}._cropperjs-editor-wrapper_12we9_11 .cropper-point.point-se:before{background-color:#39f;bottom:-50%;content:" ";display:block;height:200%;opacity:0;position:absolute;right:-50%;width:200%}._cropperjs-editor-wrapper_12we9_11 .cropper-invisible{opacity:0}._cropperjs-editor-wrapper_12we9_11 .cropper-bg{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC")}._cropperjs-editor-wrapper_12we9_11 .cropper-hide{display:block;height:0;position:absolute;width:0}._cropperjs-editor-wrapper_12we9_11 .cropper-hidden{display:none!important}._cropperjs-editor-wrapper_12we9_11 .cropper-move{cursor:move}._cropperjs-editor-wrapper_12we9_11 .cropper-crop{cursor:crosshair}._cropperjs-editor-wrapper_12we9_11 .cropper-disabled .cropper-drag-box,._cropperjs-editor-wrapper_12we9_11 .cropper-disabled .cropper-face,._cropperjs-editor-wrapper_12we9_11 .cropper-disabled .cropper-line,._cropperjs-editor-wrapper_12we9_11 .cropper-disabled .cropper-point{cursor:not-allowed}._cropperjs-editor-wrapper_12we9_11 img{height:auto;max-height:100%;max-width:100%;width:auto}._cropperjs-editor-wrapper_12we9_11{margin-bottom:3px}._cropperjs-editor-headless_12we9_317{display:none}._cropperjs-editor-hidden_12we9_321{visibility:hidden}._cropperjs-editor-wrapper_12we9_11 .cropper-point:focus{box-shadow:var(--boxshadow__focusring);height:7px;opacity:1;width:7px}'));const mi="_cropperjs-editor-wrapper_12we9_11",fi="_cropperjs-editor-headless_12we9_317",wi="_cropperjs-editor-hidden_12we9_321",vi=t.reactExports.forwardRef((({imageUrl:e,isHeadless:i=!1,className:a,onEditorReady:n,autoCrop:s=!1,windowWidth:c=window.innerWidth,windowHeight:p=window.innerHeight,fileName:h},l)=>{const[d,u]=t.reactExports.useState(),g=t.reactExports.useRef(null),m=t.reactExports.useRef(null),[f,w]=t.reactExports.useState(!1),v=function(){const e=r.useIntl();return{nwPointAriaLabel:e.formatMessage({id:"CGAn/r",defaultMessage:"North west crop box point"}),nePointAriaLabel:e.formatMessage({id:"SJCi5T",defaultMessage:"North east crop box point"}),sePointAriaLabel:e.formatMessage({id:"vNLrUZ",defaultMessage:"South east crop box point"}),swPointAriaLabel:e.formatMessage({id:"Gp2ooS",defaultMessage:"South west crop box point"}),getCropBoxDataLabel:t.reactExports.useCallback((t=>e.formatMessage({id:"aOOjQM",defaultMessage:", top: {top}, left: {left}, width: {width}, height: {height}"},{width:null==t?void 0:t.width,height:null==t?void 0:t.height,top:null==t?void 0:t.top,left:null==t?void 0:t.left})),[e])}}();t.reactExports.useImperativeHandle(l,(()=>d));const b=t.reactExports.useCallback((e=>{const t=e.target.dataset.cropperAction;if(d&&t){const{width:i,height:a}=d.getCanvasData(),r=d.getCropBoxData();di(d,t,r,e.key,i,a);const o=gi(d);ui(o,r,v)}}),[d,v.nePointAriaLabel]);t.reactExports.useEffect((()=>()=>{if(!i&&d&&"cropBox"in d){const e=d.cropBox;null==e||e.removeEventListener("keydown",b)}null==d||d.destroy()}),[d]),t.reactExports.useEffect((()=>{if(f){const e=null==d?void 0:d.getCropBoxData();if(!i&&d&&"cropBox"in d){const t=d.cropBox,i=gi(d);ui(i,e,v),null==t||t.addEventListener("keydown",b)}null==n||n()}}),[f,n]),t.reactExports.useEffect((()=>{d&&d.replace(e)}),[e]),t.reactExports.useEffect((()=>{if(g.current){const e=g.current,t=li(e.width,e.height,c,p),i=m.current;i&&(i.style.width=`${null==t?void 0:t.width}px`,i.style.height=`${null==t?void 0:t.height}px`)}}),[p,c]);const x=t.reactExports.useCallback((()=>{if(g.current){let e;const t=g.current,i=li(t.width,t.height,c,p),a=m.current;a&&(a.style.width=`${null==i?void 0:i.width}px`,a.style.height=`${null==i?void 0:i.height}px`),e=new hi(t,{viewMode:1,background:!1,zoomOnWheel:!1,center:!1,guides:!1,responsive:!0,autoCropArea:1,autoCrop:s,checkCrossOrigin:!1,checkOrientation:!1,ready:()=>{w(!0)}}),u(e)}}),[g,u,c,p]);return t.React$1.createElement("div",{className:o.cx({[fi]:i,[wi]:!f,[a||""]:!0}),"data-testid":"cropperjs-editor"},t.React$1.createElement("div",{ref:m,"data-testid":"cropperjs-editor-wrapper",className:mi},t.React$1.createElement("img",{"data-testid":"cropperjs-editor-image",ref:g,crossOrigin:"use-credentials",src:e,onLoad:d?void 0:x,alt:h})))}));const bi=t.React$1.memo(vi);bi.displayName="CropperjsEditorMemoized";const xi=({children:e,elementRef:i,onResize:a})=>{const r=t.reactExports.useRef(null);return t.reactExports.useEffect((()=>{const e=i.current,t=(o=e=>{window.requestAnimationFrame((()=>{if(!Array.isArray(e)||!e.length)return;const{height:t,width:i}=e[0].contentRect;a({height:t,width:i})}))},null===r.current&&(r.current=new s.index(o)),r.current);var o;return t.disconnect(),null!=e&&t.observe(e),()=>{null!=e&&t.unobserve(e)}}),[i,a]),t.React$1.createElement(t.React$1.Fragment,null,e)};xi.displayName="Resizer";o.injectInternalStyle("typescript/component_libraries/photos/src/preview-photo-editor/crop-image/index.module.out.css",(e=>"._crop-image_1491g_1{align-items:center;box-sizing:border-box;display:flex;flex-direction:column;height:100%;justify-content:space-around;left:0;padding:90px 90px 15px 35px;position:absolute;top:0;width:100%}._crop-image-controls_1491g_15{background-color:var(--color__core__primary);flex-grow:0;z-index:2}._crop-image-wrapper_1491g_21{align-items:center;display:flex;flex-grow:1}._crop-toolbar-title_1491g_27{color:var(--color__inverse__faint__text)}"));const _i=({className:e,children:i})=>t.React$1.createElement("div",{className:o.cx(c.toolbarRow,e)},i);_i.displayName="ToolbarRow",_i.displayName="ToolbarRow";const yi=({className:e,children:i})=>t.React$1.createElement("div",{className:o.cx(c.toolbarSection,e)},i);yi.displayName="ToolbarSection",yi.displayName="ToolbarSection";const Ci=({className:e,children:i})=>t.React$1.createElement("div",{className:o.cx(c.toolbar,e),role:"toolbar"},i);Ci.displayName="Toolbar",Ci.displayName="Toolbar";const Ei=({imageSrc:e,onSave:i,onSaveACopy:a,fileName:s,onClose:p,onEditorReady:h})=>{const{cropImageLabel:l,saveLabel:d,saveMenuAriaLabel:u,cancelLabel:g,replaceOriginalText:m,saveACopyText:f}=function(){const e=r.useIntl();return{cropImageLabel:e.formatMessage({id:"DiK2M8",defaultMessage:"Crop"}),saveLabel:e.formatMessage({id:"Qhrx1y",defaultMessage:"Save"}),cancelLabel:e.formatMessage({id:"ipSKIK",defaultMessage:"Cancel"}),saveMenuAriaLabel:e.formatMessage({id:"vovkiF",defaultMessage:"Expand save menu"}),saveACopyText:e.formatMessage({id:"XsjeK+",defaultMessage:"Save a copy"}),replaceOriginalText:e.formatMessage({id:"5iEduM",defaultMessage:"Replace original"})}}(),w=t.reactExports.useRef(null),v=t.reactExports.useRef(null),[b,x]=t.reactExports.useState(!1),_=t.reactExports.useCallback((()=>{w.current&&i(w.current)}),[w,i]),y=t.reactExports.useCallback((()=>{p()}),[p]),C=t.reactExports.useCallback((()=>{x(!0),h()}),[h,x]);return t.React$1.createElement("div",{className:"_crop-image_1491g_1"},t.React$1.createElement(xi,{elementRef:v,onResize:()=>{}},t.React$1.createElement("div",{className:"crop-image-editor-wrapper",ref:v},t.React$1.createElement(bi,{ref:w,imageUrl:e,onEditorReady:C,className:"_crop-image-wrapper_1491g_21",autoCrop:!0,windowWidth:window.innerWidth,windowHeight:window.innerHeight,fileName:s}))),t.React$1.createElement("div",{className:"_crop-image-controls_1491g_15"},b&&t.React$1.createElement(Ci,null,t.React$1.createElement(_i,{className:c.toolbarFilenameRow},t.React$1.createElement(n.Truncate,null,s)),t.React$1.createElement(_i,null,t.React$1.createElement(yi,null,t.React$1.createElement(o.Text,{className:"_crop-toolbar-title_1491g_27"},l)),t.React$1.createElement(yi,null,t.React$1.createElement(o.Button$1,{variant:"opacity",inverse:!0,onClick:y},g),t.React$1.createElement(o.SplitButton,{variant:"outline",inverse:!0,renderMenu:({buttonProps:e})=>t.React$1.createElement(o.Menu.Wrapper,{onSelection:e=>{var t;if("copy"===e){const e=null===(t=null==w?void 0:w.current)||void 0===t?void 0:t.getCroppedCanvas();e&&e.toBlob((t=>{t&&(null==a||a(t,e.width,e.height))}),void 0,1)}else"original"===e&&_()}},(({getTriggerProps:i,getContentProps:a})=>t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(o.Button$1,Object.assign({"aria-label":u},e,i())),t.React$1.createElement(o.Menu.Content,Object.assign({},a(),{placement:"bottom-end"}),t.React$1.createElement(o.Menu.Segment,null,t.React$1.createElement(o.Menu.ActionItem,{value:"copy"},f),t.React$1.createElement(o.Menu.ActionItem,{value:"original"},m)))))),onClick:_},d))))))};o.injectInternalStyle("typescript/component_libraries/photos/src/preview-photo-editor/crop-mode-modal/index.module.out.css",(e=>"._photo-crop-mode-modal_jlg4j_1{background:transparent;height:100%}._photo-crop-mode-loading_jlg4j_6{align-items:center;display:flex;height:100%;justify-content:center;left:0;position:absolute;top:0;width:100%}"));const Mi="_photo-crop-mode-modal_jlg4j_1",Ri="_photo-crop-mode-loading_jlg4j_6",ki=({open:e=!1,width:i,onClose:a,imageSrc:n,onSave:s,onSaveACopy:c,fileName:p,onEditorReady:h})=>{const[l,d]=t.reactExports.useState(!1),{loadingPhotoCropEditor:u}={loadingPhotoCropEditor:r.useIntl().formatMessage({id:"I3JXRk",defaultMessage:"Loading photo crop editor"})},g=t.reactExports.useCallback((()=>{d(!0),h()}),[h,d]),m=t.reactExports.useCallback((()=>{d(!1),a()}),[a,d]);return t.React$1.createElement(o.Modal$1,{open:e,isCentered:!0,onRequestClose:m,className:Mi,width:i},t.React$1.createElement(o.Modal$1.Body,{hasVerticalSpacing:!1},!l&&t.React$1.createElement("div",{className:Ri},t.React$1.createElement(o.Spinner,{"aria-valuetext":u,size:"standard"})),n&&t.React$1.createElement(Ei,{imageSrc:n,onSave:s,onSaveACopy:c,fileName:p,onClose:m,onEditorReady:g})))};ki.displayName="PhotoCropModeModal";const ji=({currentPath:e,fileName:r,imageUrl:o,fileId:n,onImageChanged:s,onCropMode:c,isCropMode:l,setIsCropMode:d,onSaveReplaceFile:u,onSaveACopy:g,imageExtension:m,onSelectRotate:f,onTTI:w,onRecordRotateSaveLatency:v,fetchFile:b})=>{t.reactExports.useEffect(w,[]);const[x,_]=t.reactExports.useState(!1),y=t.reactExports.useRef(null),C=t.reactExports.useRef(null),E=t.reactExports.useRef(null),[M,R]=t.reactExports.useState(o),[k,j]=t.reactExports.useState(0),[D,A]=t.reactExports.useState(!1),[S,B]=t.reactExports.useState(!1),[N,T]=t.reactExports.useState(),[O,L]=t.reactExports.useState(),[I,W]=t.reactExports.useState(),[,z]=t.reactExports.useState(),[$,H]=t.reactExports.useState(),[P,X]=t.reactExports.useState();t.reactExports.useEffect((()=>{var e;null===(e=E.current)||void 0===e||e.addEventListener("mouseenter",(()=>{B(!0)}),{once:!0})}),[E.current]),t.reactExports.useEffect((()=>{R(o),H(new Promise(((e,t)=>{W((()=>e)),z((()=>t))})))}),[o]),t.reactExports.useEffect((()=>{S&&n&&(e=>{i.__awaiter(void 0,void 0,void 0,(function*(){const t=yield b(e),i=p.getMimeType(m),a=new Blob([t],{type:i}),r=yield p.blobToDataUrl(a),o=yield h.retrieveExifWithoutOrientation(a);o instanceof ArrayBuffer&&X(o),"string"==typeof r&&(T(r),L(r))}))})(n)}),[S]);const U=t.reactExports.useCallback((()=>{null==I||I({exif:P})}),[I,P]),Y=t.reactExports.useCallback(((e,t,i)=>{const a=p.getMimeType(m),r=null==e?void 0:e.getCroppedCanvas().toDataURL(a);return r&&i&&i(r,t),r}),[p.getMimeType]),F=t.reactExports.useCallback(a.debounce((e=>i.__awaiter(void 0,void 0,void 0,(function*(){e&&(null==u||u(e,!1),j(0),A(!1))}))),3e3),[u]),q=t.reactExports.useCallback((()=>i.__awaiter(void 0,void 0,void 0,(function*(){const e=Date.now();if($){const{exif:t}=yield $;if(C&&C.current){const i=p.getMimeType(m);C.current.clear(),C.current.rotate(90);const a=C.current.getCroppedCanvas().toDataURL(i);T(a),C.current.getCroppedCanvas().toBlob((i=>{if(i){const a=t?h.copyExif(i,t):i;F(a),v(Date.now()-e)}}),i)}}}))),[F,C,m,$]),Q=t.reactExports.useCallback((()=>{var e;if(y.current){const t=Date.now();B(!0),q(),y.current.clear(),y.current.rotate(90);const{naturalWidth:i,naturalHeight:a}=null===(e=y.current)||void 0===e?void 0:e.getCanvasData();Y(y.current,{width:i,height:a},s),j((k+90)%360),A(!0),f((Date.now()-t).toString(10))}}),[s,q,f,B]),G=t.reactExports.useCallback((e=>{if(e){const{width:t,height:i}=null==e?void 0:e.getData(),a=Y(e,{width:t,height:i},s);R(a),L(a);const r=p.getMimeType(m),o=null==e?void 0:e.getCroppedCanvas();o&&o.toBlob((e=>{if(e){const t=h.copyExif(e,P);t&&(null==u||u(t,!0,o.width,o.height))}}),r)}c&&c(!1),d(!1)}),[y,Y,u,c,R,P]),Z=t.reactExports.useCallback((()=>{c&&c(!1),d(!1)}),[c,d]),K=t.reactExports.useCallback((()=>{c&&c(!0)}),[c]),V=t.reactExports.useCallback((()=>{d(!0),B(!0)}),[d,B]),J=t.reactExports.useCallback((()=>{_(!0)}),[_]);return M&&r&&e?t.React$1.createElement("div",{"data-testid":"crop-rotate-buttons",ref:E},t.React$1.createElement(ge,{onRotate:Q,disabled:!x,rotatedDegrees:k,isCalloutActive:D}),t.React$1.createElement(me,{onCrop:V}),t.React$1.createElement(bi,{ref:y,imageUrl:M,isHeadless:!0,onEditorReady:J,fileName:r}),O&&t.React$1.createElement(bi,{ref:C,imageUrl:O,isHeadless:!0,onEditorReady:U,fileName:r}),t.React$1.createElement(ki,{open:l,width:window.innerWidth,imageSrc:N,onSave:G,fileName:r,onClose:Z,onEditorReady:K,onSaveACopy:g})):null};function Di(e,t){if(!e||!t)return e;return e.split(",").map((e=>{const i=(e=e.trim()).split(" ");return 2===i.length&&(i[0]=t),i.join(" ")})).join(", ")}const Ai=({file:e,currentFile:a,onImageChanged:n,previewData:s,updatePreviewMetadata:c,user:d,logPreviewsAction:u,onPluginActive:g})=>{const[m,f]=t.reactExports.useState(!1),[w,v]=t.reactExports.useState(!1),[b,x]=t.reactExports.useState(),[_,y]=t.reactExports.useState(),[C,E]=t.reactExports.useState(),[M,R]=t.reactExports.useState(),k=o.useDispatch(),{replaceStrings:j,copyStrings:D}=function(){const e=r.useIntl(),i=t.reactExports.useCallback((()=>({snackbarSync:e.formatMessage({id:"wfLpA+",defaultMessage:"Saving..."}),snackbarComplete:e.formatMessage({id:"/xNtcz",defaultMessage:"Saved!"}),snackbarFailed:e.formatMessage({id:"bL9EOU",defaultMessage:"Saving failed."})})),[e]),a=t.reactExports.useCallback(((t,i)=>({snackbarSync:e.formatMessage({id:"zFrH0n",defaultMessage:"Saving as a copy..."}),snackbarComplete:e.formatMessage({id:"GjZXaF",defaultMessage:"Saved 1 item to <folderLink></folderLink>"},{path:i,folderLink:()=>p.folderLink(t,i)}),snackbarFailed:e.formatMessage({id:"bL9EOU",defaultMessage:"Saving failed."})})),[e]);return{replaceStrings:i,copyStrings:a}}(),A=t.reactExports.useRef(a),S=l.useCropRotateLogger();t.reactExports.useEffect((()=>{R(new o.DefaultUserApiV2Client(d))}),[d]),t.reactExports.useEffect((()=>{A.current=a,k(l.setCurrentFile(a))}),[a]);const B=t.reactExports.useCallback(((t,i,a)=>{if(t&&t.file.sj_id&&t.preview&&e.fqPath&&i){const r={file_id:e.fileId,revision_id:i,fq_path:e.fqPath,sjid:t.file.sj_id,preview:Object.assign({},t.preview)};a&&a.file_id===r.file_id&&(null==n||n({revision_id:A.current.revision_id},r)),A.current=Object.assign(Object.assign({},A.current),{revision_id:i})}}),[e,A,n,A]),N=t.reactExports.useCallback((e=>{S(l.CropRotateEvent.shownErrorEvent,void 0,e)}),[S]);return{isCropMode:m,setIsCropMode:f,fetchFileCallback:t.reactExports.useCallback((e=>i.__awaiter(void 0,void 0,void 0,(function*(){return h.fetchFile(M,e)}))),[M,h.fetchFile]),saveReplace:t.reactExports.useCallback(((e,t,r,o)=>i.__awaiter(void 0,void 0,void 0,(function*(){if(M){const i=Date.now();if(yield k(l.uploadImage(a,e,M,j(),B,N)),t){const e=Object.assign(Object.assign(Object.assign({loadingTime:(Date.now()-i).toString(10)},r&&{cropWidth:r.toString(10)}),o&&{cropHeight:o.toString(10)}),{cropMode:String(t)});S(l.CropRotateEvent.selectReplaceOriginalButton,e),u("crop_rotate_save",void 0,Object.assign({replace:"true"},e))}}}))),[M,k,a,j,B,S]),onSaveACopy:t.reactExports.useCallback(((e,t,i)=>{x(e),t&&i&&(y(t),E(i)),v(!0),S(l.CropRotateEvent.selectMakeACopy),u("crop_rotate_save",void 0,{replace:"false"})}),[S]),onSaveACopyCallback:t.reactExports.useCallback((e=>i.__awaiter(void 0,void 0,void 0,(function*(){if(b&&M){const t=Date.now();yield k(l.uploadCopyImage(e,b,M,D(d,e),N)),S(l.CropRotateEvent.selectSaveFromMakeACopy,{loadingTime:(Date.now()-t).toString(10),cropWidth:_?_.toString(10):void 0,cropHeight:C?C.toString(10):void 0})}v(!1),g&&g(!1),f(!1)}))),[b,M,k,D,S,v,g,f]),openSaveCopyModal:w,setOpenSaveCopyModal:v,onCloseWithoutSavingCallback:t.reactExports.useCallback((()=>{v(!1),u("crop_cancel",void 0)}),[v]),onImageChangedCallback:t.reactExports.useCallback(((t,i)=>{var a;if(e.sjId&&e.fqPath&&s&&"image"===(null===(a=s.content)||void 0===a?void 0:a[".tag"])&&t){const a=Object.assign(Object.assign({},s),{dimensions:i,content:Object.assign(Object.assign({},null==s?void 0:s.content),{full_size_src:t,default_src:t,thumbnail_url_tmpl:t,src_set:Di(null==s?void 0:s.content.src_set,t)})});c({file_id:e.fileId,sj_id:e.sjId,ns_id:e.nsId,url:e.url},a)}}),[e.fileId,e.fqPath,e.nsId,e.sjId,e.url,s,c]),onSelectRotateCallback:t.reactExports.useCallback((e=>{S(l.CropRotateEvent.selectRotate,{loadingTime:e}),u("rotate",void 0,e?{loadingTime:e}:void 0)}),[S]),onTTICallback:t.reactExports.useCallback((()=>{S(l.CropRotateEvent.shownCropRotateOptions)}),[S]),onRecordRotateSaveLatency:t.reactExports.useCallback((e=>{l.logDuration(l.AmpMetrics.ROTATION_SAVE_LATENCY,e)}),[l.logDuration])}};const Si=({onImageChanged:e,onPluginActive:i,currentFile:a,imageExtension:r,updatePreviewMetadata:n,user:s,context:c})=>{const h=o.useSelector(l.getFile),d=o.useSelector(l.getPreviewData),u=o.useSelector(l.getFullSizeImageUrl),{saveReplace:g,onSaveACopy:m,openSaveCopyModal:f,onSaveACopyCallback:w,onCloseWithoutSavingCallback:v,onImageChangedCallback:b,onSelectRotateCallback:x,onTTICallback:_,onRecordRotateSaveLatency:y,fetchFileCallback:C,isCropMode:E,setIsCropMode:M}=Ai({file:h,currentFile:a,onImageChanged:e,previewData:d,updatePreviewMetadata:n,user:s,logPreviewsAction:c.logUserAction,onPluginActive:i});return h.fqPath&&s?t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(ji,{key:a.file_id,currentPath:h.fqPath,fileName:h.name,imageUrl:u,fileId:a.file_id,onImageChanged:b,onCropMode:i,isCropMode:E,setIsCropMode:M,onSaveReplaceFile:g,onSaveACopy:m,imageExtension:r,onSelectRotate:x,onTTI:_,onRecordRotateSaveLatency:y,fetchFile:C}),f?t.React$1.createElement(p.SaveCopyModal,{fileName:h.name,activeUser:s,currentPath:h.fqPath,isModalOpen:f,onCloseWithoutSaving:v,onSaveACopy:w}):null):null};Si.displayName="CropRotateEditor";const Bi=({pluginId:e,onImageChanged:i,hideContentPane:a,context:r,getActiveFile:n,updatePreviewMetadata:s,fileExtension:c,user:p,previewData:h})=>{const{file:d}=n(),{previewType:u}=r.getPluginData(),g=l.useCropRotateLogger(),m=o.useSelector(l.getFile),f=o.useSelector(l.getPreviewData),w=o.useDispatch();t.reactExports.useEffect((()=>{var e;h&&h.content&&"full_size_src"in h.content&&!(null===(e=h.content.full_size_src)||void 0===e?void 0:e.startsWith("data:image"))&&w(l.updatePreviewData(h))}),[null==h?void 0:h.content]);const v=t.reactExports.useCallback((t=>{if(t){const t=Date.now();null==a||a(e);const i=(Date.now()-t).toString(10);g(l.CropRotateEvent.selectCrop,{loadingTime:i}),r.logUserAction("crop_start",void 0,{loadingTime:i})}else null==a||a(void 0)}),[a,g,e]);return"image"===u&&m&&f?t.React$1.createElement(Si,{user:p,currentFile:d,onImageChanged:i,onPluginActive:v,imageExtension:c,updatePreviewMetadata:s,context:r}):null};Bi.displayName="CropRotateButtons",Bi.displayName="CropRotateButtons",e.CropRotateButtons=Bi}));
//# sourceMappingURL=c_ui_preview_crop_and_rotate_crop_rotate_buttons.js-vflmvQ14X.map
