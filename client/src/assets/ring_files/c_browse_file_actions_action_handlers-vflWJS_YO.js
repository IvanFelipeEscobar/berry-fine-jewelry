define(["require","exports","./c_views_copy_link_mini_modal","./e_ui_page_files_router","./c_tslib","./c_downloads","./c_extensions_cloud_docs_compat","./c_browse_interface","./c_ui_async_overquota_modal_controller","./c_browse_actions","./c_data_action_creators_index","./c_file_viewer_async_controller","./c_cloud_docs_gdd_migration_gdd_ui_blocking","./c_plusplus_file_actions","./c_vault_constants","./c_sync_everything_hive_logger","./c_file_viewer_file_extension_extension_constants","./e_edison","./c_core_i18n","./c_gdd_migration_ui_utils","./c_components_modals_show_modal","./c_spectrum_modal_utility_modal","./c_ux_analytics_modal_tracking","./c_browser_cookies","./c_file_transfers_async_browse_entry_point_onboarding_modal_async","./c_starred_actions","./c_starred_constants","./c_starred_star","./c_files_view_files_view_logging","./c_sharing_browse_exports","./c_unity_features","./c_core_notify","./c_file_store_utils","./c_file_transfers_lib_urls","./c_browse_tts","./c_pap-events_navigation_navigate_to_edit"],(function(e,t,o,i,n,r,a,s,l,c,d,_,u,f,h,g,p,m,S,E,w,v,A,F,b,R,k,L,y,M,T,I,C,O,N,U){"use strict";const x=e=>m.React$1.createElement(E.ModalTemplate,Object.assign({open:!0},(({onClose:e,onLearnMore:t})=>({title:S.intl.formatMessage({id:"el417s",defaultMessage:"Can’t open this file"}),bodyText:S.intl.formatMessage({id:"1gEouT",defaultMessage:"To access this file, save it as a Microsoft file or Google shortcut. <button>Learn more</button>"},{button:e=>m.React$1.createElement(i.Button$1,{variant:"transparent",onClick:t},e)}),tertiaryActions:m.React$1.createElement(i.Button$1,{variant:"primary",onClick:e},E.Strings.OK),width:"standard",withCloseButton:E.Strings.CLOSE}))(e),{onRequestClose:e.onClose}));x.displayName="CannotOpenFileComponent";const P=new class{constructor(){this.setUrl=({path:e,qargs:t,expandedBlade:o,forceExpandRightRail:i})=>{this.reduxStore.dispatch(d.setUrl({path:e,qargs:t,expandedBlade:o,forceExpandRightRail:i}))},this.onRestore=(e,t,o)=>{i.restoreFiles({files:t,userId:e,onSuccess:()=>{i.notifyRestoreSuccess(t)},isSearchMode:o})},this.doRestoreFilesWithUnifiedTrashModal=({files:e})=>{const t=i.user$1(this.reduxStore.getState()),o=i.context(this.reduxStore.getState());i.showUnifiedTrashModal({userId:t.id,context:o,files:e,onRestore:(e,t)=>{this.onRestore(e,t,!1)}})},this.reduxStore=i.getStoreForBrowse()}reloadCurrentPath(){this.setUrl({path:i.path$1(this.reduxStore.getState()),qargs:{reload:!0}})}navigateToFileOrFolder({file:e,shouldFocusComment:t=!1,activeCommentThreadId:o,onFileViewerUnmount:n,fileViewOrigin:r=i.FileViewOriginType.BROWSE,skipFileViewerRouting:a=!1,performSpaRouting:s=!1,href:l,middleClick:c=!1}){var d;const _=i.experiments(this.reduxStore.getState()),p=i.getFileExt(e);if(i.isGoogleFileByExtension(p)&&u.isBlockedByGddMigration(_))return void i.Modal.showInstance(m.React$1.createElement(x,{onClose:i.Modal.close,onLearnMore:()=>i.open_tab(E.HELP_CENTER_ARTICLE_URL)}));const S=i.user$1(this.reduxStore.getState()),w=i.context(this.reduxStore.getState()),v=i.browsePostTTIExperiments(i.getStoreForBrowse().getState());if(e.isDeleted)this.doRestoreFilesWithUnifiedTrashModal({files:[e]});else{if(i.isSupportedLinkNodeClickAction(e.per_node_metadata))return void f.handleLinkNodeAction(e.per_node_metadata,(e=>{u.logProductAnalytics(S.id,"web","select",e,"files_main_bar")}));if(e.is_dir)if(e.type===i.FileTypes.VAULT_FOLDER)i.redirect(h.VAULT_URL);else if(i.isBackupFolderIcon(e)&&v.expEnableBackupWeb&&!i.isBackupBrowse()){const t=i.backupUrlForFqPath(e.fq_path);g.logEvent({event:"click_backup",page_source:"browse",action_surface:"file_list"}),i.open_tab(t)}else i.File.isNoAccessSharedFolder(e)?i.showNoAccess(S,e.fq_path,w):(i.isBackupBrowse()&&g.logEvent({page_source:"browse",action_surface:"file_list",event:(null===(d=e.per_node_metadata)||void 0===d?void 0:d.suppress_delete)?"click_system_folder":"click_folder"}),this.setUrl({path:e.fq_path}));else{const d=()=>{l&&c?i.open_tab(l):this.openPreviewForBrowseFile({file:e,shouldFocusComment:t,activeCommentThreadId:o,user:S,fileViewOrigin:r,onFileViewerUnmount:n,skipFileViewerRouting:a,performSpaRouting:s})},{preferredEditors:_}=i.browsePostTTIData(this.reduxStore.getState());!t&&_&&i.hasPreferredEditorSupport(e)?i.openInPreferredEditor(S,e,_,d,{fileViewOrigin:r}):d()}}}openPreviewForBrowseFile({file:e,shouldFocusComment:t,activeCommentThreadId:o,user:n,fileViewOrigin:r,onFileViewerUnmount:a,shouldFocusApproval:s,skipFileViewerRouting:l,performSpaRouting:c,editActivationParams:d}){const u=i.context(this.reduxStore.getState()),{isOverFreeQuota:f,hasExcludedNsIds:h}=i.browsePostTTIData(this.reduxStore.getState());let g=i.getIndexOfFile(e,this.reduxStore.getState());const m=g<0?[e]:i.sortedFilesWithFolderSizes(this.reduxStore.getState()).toArray();g<0?g=0:m[g]=e;if(i.browsePostTTIExperiments(i.getStoreForBrowse().getState()).expCloudDocsWebShortcutPreviews?e.is_cloud_doc&&!p.POINTER_CLOUD_DOC_EXTS.includes(e.ext):e.is_cloud_doc)i.openCloudDoc(e,n,i.WebBrowseSource);else{const a=l?()=>{const e=i.CompatLocation.getLocation(),t=new URLSearchParams(e.search);t.delete("preview"),i.CompatNavigate.navigateReplace(`${e.pathname}?${t.toString()}`)}:void 0,p="browse_previews";_.initializeAjaxPreviewTiming(p,!0),_.asyncOpenPreview({containerId:i.BROWSE_FILE_VIEWER_ELEMENT_ID,files:m,indexOfPreviewFile:g,shouldFocusComment:t,activeCommentThreadId:o,user:n,fileViewOrigin:r,browseContext:u,browseExceptions:{hasExcludedNsIds:h,isOverFreeQuota:f},shouldFocusApproval:s,skipFileViewerRouting:l,onCloseViewer:a,ajaxTimerName:p,editActivationParams:d}).then((()=>{if(c){const t=i.CompatLocation.getLocation(),o=new URLSearchParams(t.search);o.append("preview",i.getFilename(e)),i.CompatNavigate.navigate(`${t.pathname}?${o.toString()}`)}}))}}};function D({args:e,action_type:t,action_source:o,action_surface:n,extra:r}){var a;const{user:s,files:l,isSearchMode:c,source:d,viewType:_,isSidebar:u,resultList:f,requestId:h,hasMoreResults:g}=e,{num_files_selected:p,num_folders_selected:m}=i.countFilesAndFolders(l),S=e.actionSurface?e.actionSurface:n||(u?i.ActionSurfaceLogValue.RIGHT_SIDEBAR:i.ActionSurfaceLogValue.OVERFLOW_MENU),E=e.actionSource?e.actionSource:o,w=l.first();c?i.logResultAction(t,null!=f?f:i.immutableExports.List(),w,h,null!=g&&g,S,E,Object.assign(Object.assign({},r),{num_files_selected:p.toString(),num_folders_selected:m.toString(),right_sidebar_state:null!==(a=e.rightRailState)&&void 0!==a?a:null})):w instanceof i.FileSharedWithMe||i.logBrowseAction({uid:s.id,source:d,action:t,num_files_selected:p,num_folders_selected:m,view_type:_,result:w,action_surface:S,action_source:E,right_sidebar_state:e.rightRailState,extra:r})}function W(e){if(void 0!==e)switch(e){case i.ActionSurfaceLogValue.OVERFLOW_MENU:return"action_bar_overflow_menu";case i.ActionSurfaceLogValue.RIGHT_SIDEBAR:return"right_rail_share_menu";case i.ActionSurfaceLogValue.CENTER_PANE:return"center_pane";case i.ActionSurfaceLogValue.TOP_NAVIGATION:return"top_navigation";case i.ActionSurfaceLogValue.ACTION_BAR:return"action_bar";case i.ActionSurfaceLogValue.INLINE_ACTION_BAR:return"content_overflow_menu";case i.ActionSurfaceLogValue.FEATURE_GROWTH:return"feature_growth";case i.ActionSurfaceLogValue.RIGHT_CLICK_MENU:return"content_right_click";case i.ActionSurfaceLogValue.IN_FOLDER_ACTIVATION:return"in_folder_activation";case i.ActionSurfaceLogValue.CONTENT_TILE_ACTION_MENU:return"content_tile_action_menu";case i.ActionSurfaceLogValue.CONTENT_SUGGESTIONS:return"content_suggestions_menu";default:!function(e){throw new Error(`Unexpected value: ${e}`)}(e)}}class B extends m.React$1.Component{constructor(e){super(e),this.onClickCheckbox=()=>{this.setState({checkboxMarked:!this.state.checkboxMarked})},this.onRequestClose=()=>{this.setState({isModalOpen:!1}),i.dispatchModalClosed()},this.onRequestLock=()=>{this.props.onLock(),this.state.checkboxMarked&&this.props.onNeverShowAgain()},this.state={checkboxMarked:!1,isModalOpen:!0}}render(){const e=S.intl.formatMessage({id:"cRptek",defaultMessage:"Lock editing for this file?"}),t=S.defineMessage({id:"dBZbCY",defaultMessage:"Only you can make changes to <st>{path}</st> while editing is locked. Anyone else with access to the file can still view it."}),o=S.intl.formatMessage({id:"iR68zV",defaultMessage:"Lock"}),n=S.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),r=S.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),a=S.intl.formatMessage({id:"s0mqEc",defaultMessage:"Don’t ask me this again"});return m.React$1.createElement(v.UtilityModal,{title:e,primaryAction:o,onReady:i.dispatchModalOpened,onPrimaryAction:this.onRequestLock,secondaryAction:n,onRequestClose:this.onRequestClose,ariaLabel:e,open:this.state.isModalOpen,shouldFocusAfterRender:!0,link:r,onLink:()=>{i.open_tab("https://help.dropbox.com/files-folders/share/file-locking")}},m.React$1.createElement(A.UXAnalyticsModalTracking,{id:"file_lock_confirm_modal"}),S.intl.formatMessage(t,{st:e=>m.React$1.createElement("strong",null,e),path:this.props.filename}),m.React$1.createElement("div",{className:"checkbox-with-label"},m.React$1.createElement(i.Checkbox$1,{checked:this.state.checkboxMarked?"checked":"unchecked",onChange:this.onClickCheckbox,id:"accept-checkbox"}),m.React$1.createElement("label",{className:"checkbox-with-label-label",htmlFor:"accept-checkbox"},m.React$1.createElement("div",null,a))))}}B.displayName="FileLockConfirmModalBase";const V=i.requireCssWithComponent(B,["/static/metaserver/static/css/file_locking/file_locking_modal-vflDp2_5Q.css"]),q=({filename:e,onLock:t,onNeverShowAgain:o})=>m.React$1.createElement(V,{onLock:t,onNeverShowAgain:o,filename:e}),$=e=>()=>{e(),i.dispatchModalClosed()},H=({lockCreatedTime:e,lockholderName:t,onRequestUnlock:o})=>{const n=S.intl.formatMessage({id:"yd0RsA",defaultMessage:"Editing is locked for this file"}),r=S.defineMessage({id:"iRKebb",defaultMessage:"{lockholder_name} temporarily locked editing for this file {ago}. You can view it while it’s locked, or ask them to unlock it."}),a=S.intl.formatMessage({id:"PMI4xl",defaultMessage:"Ask to unlock"}),s=S.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),l=S.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),c=1e3*Number(e),d=i.agoFromDate(new Date(c),new Date);return m.React$1.createElement(v.UtilityModal,{title:n,primaryAction:a,onReady:i.dispatchModalOpened,onPrimaryAction:$(o),secondaryAction:s,onRequestClose:i.dispatchModalClosed,ariaLabel:n,open:!0,shouldFocusAfterRender:!0,link:l,onLink:()=>{i.open_tab("https://help.dropbox.com/files-folders/share/file-locking")}},m.React$1.createElement(A.UXAnalyticsModalTracking,{id:"file_lock_confirm_modal"}),S.intl.formatMessage(r,{lockholder_name:t,ago:d}))},G="do_not_show_lock_confirmation_dialog",j=365;function K(){return S.intl.formatMessage({id:"uGHYAs",defaultMessage:"Unlocked editing. Any one else with access can edit again."})}function z(e){return{entries:e.map((e=>({path:e.fq_path})))}}function Y(e){return e.result.then((t=>t.entries&&t.entries.length>0&&t.entries.every((e=>"success"===e[".tag"]))?(i.Snackbar.complete(e.onSuccessMsg(t),"file-lock-status"),Promise.resolve()):Promise.reject())).catch((()=>(i.Snackbar.fail(e.onFailMsg,"file-lock-status"),Promise.reject())))}function Q(e,t){const o=()=>{!function(e,t){n.__awaiter(this,void 0,void 0,(function*(){const o=(new i.UserApiV2Client).ns("files").rpc("lock_file_batch",z(t),{subjectUserId:e});yield Y({result:o,onSuccessMsg:e=>S.intl.formatMessage({id:"nv3jy/",defaultMessage:"Editing locked. Now only you can make changes."}),onFailMsg:S.intl.formatMessage({id:"MmwXT2",defaultMessage:"Locking editing failed."})})}))}(e,[t])},r=()=>{F.Cookies.create(G,"true",j)};"true"===F.Cookies.read(G)?o():w.showModal(q({filename:i.filename(t.fq_path),onLock:o,onNeverShowAgain:r}))}function X(e,t){void 0!==t.ts_locked&&void 0!==t.lockholder_name?w.showModal(H({lockCreatedTime:t.ts_locked,lockholderName:t.lockholder_name,onRequestUnlock:()=>{!function(e,t){n.__awaiter(this,void 0,void 0,(function*(){const o=i.File.getFilename(t[0]),n=t[0].lockholder_name,r=(new i.UserApiV2Client).ns("files").rpc("request_unlock_file_batch",z(t),{subjectUserId:e});yield Y({result:r,onSuccessMsg:e=>{const t=e.entries[0];return t.lock&&t.lock.content&&"unlocked"===t.lock.content[".tag"]?K():S.intl.formatMessage({id:"im3MR+",defaultMessage:"Asked {name} to unlock {filename}"},{filename:o,name:n})},onFailMsg:S.intl.formatMessage({id:"i/KiYl",defaultMessage:"Error asking {name} to unlock {filename}"},{filename:o,name:n})})}))}(e,[t])}})):i.Snackbar.fail(S.intl.formatMessage({id:"LDj5Eu",defaultMessage:"Could not ask to unlock. Please try again later."}),"file-lock-status")}function Z(e){D({args:e,action_type:i.WebUserActionLogEvent.REQUEST_FILES_CLICK});const{ns_id:t,ns_path:o}=e.files.first();i.redirect(`/requests?ns_id=${t}&path=${o}&referrer=web_browse_file_action`)}function J(e){D({args:e,action_type:i.WebUserActionLogEvent.RENAME});i.getStoreForFilesView().dispatch(i.setFileRename({file:e.files.first(),renameState:i.RenameState.PENDING_INPUT}))}function ee(e,t){N.logBrowseTTS("download_file"),D({args:e,action_type:i.WebUserActionLogEvent.DOWNLOAD});const{user:o,files:s}=e;!function({files:e,context:t,user:o,source:s,root_ns_id:l}){n.__awaiter(this,void 0,void 0,(function*(){if(1===e.count()&&!e.first().is_dir&&!i.isUnmountedBackupBrowse(o,l)){const t=e.first();return void a.downloadSingleFile({href:t.href,source:s,isFswm:t instanceof i.FileSharedWithMe,userId:o.id})}if(!t.blockHash)return;const n=t.currentFQPath,c=e.toArray().map((e=>e.fq_path));r.get_zip({fq_paths:c,subject_uid:o.id,block_hash:t.blockHash,parent_path:n,source:`${s}_zip`,root_ns_id:l})}))}({files:s,context:t,user:o,source:e.isSearchMode?"search":"browse",root_ns_id:i.isBackupBrowse()&&t.rootNSID?t.rootNSID:void 0}),i.UserSurvey.trackEvent("download_item","browse")}function te(e){D({args:e,action_type:i.WebUserActionLogEvent.ADD_COMMENT});const t=e.files.first();t instanceof i.FileSharedWithMe?i.redirect(t.href):e.isSearchMode?i.getStoreForSearch().dispatch(i.setPreviewFileId({previewFileId:t.file_id})):P.navigateToFileOrFolder({file:t,shouldFocusComment:!0})}function oe(e){D({args:e,action_type:i.WebUserActionLogEvent.RENAME_TEAM_FOLDER}),i.showContentManagerBridge(e.files.toArray(),"rename",i.Viewer.get_viewer().team_is_limited)}function ie(e){D({args:e,action_type:i.WebUserActionLogEvent.ARCHIVE}),i.showContentManagerBridge(e.files.toArray(),"archive",i.Viewer.get_viewer().team_is_limited)}function ne(e){D({args:e,action_type:i.WebUserActionLogEvent.LOCK_FILE}),Q(e.user.id,e.files.first())}function re(e){D({args:e,action_type:i.WebUserActionLogEvent.UNLOCK_FILE}),function(e,t){n.__awaiter(this,void 0,void 0,(function*(){const o=(new i.UserApiV2Client).ns("files").rpc("unlock_file_batch",z(t),{subjectUserId:e});yield Y({result:o,onSuccessMsg:e=>K(),onFailMsg:S.intl.formatMessage({id:"v/COiN",defaultMessage:"Unlocking editing failed."})})}))}(e.user.id,[e.files.first()])}function ae(e){D({args:e,action_type:i.WebUserActionLogEvent.REQUEST_UNLOCK_FILE}),X(e.user.id,e.files.first())}function se(e){var t,o;D({args:e,action_type:i.WebUserActionLogEvent.VERSIONS});const n=i.isBackupBrowse()&&(null===(t=e.context)||void 0===t?void 0:t.rootNSID)?{inside_backup:"true",ns_id:`${null===(o=e.context)||void 0===o?void 0:o.rootNSID}`,return_url:i.get_href()}:{},r=s.getFileHistoryUrl({fqPath:e.files.first().fq_path,userId:e.user.id},n);i.redirect(r)}function le(e){D({args:e,action_type:i.WebUserActionLogEvent.EVENTS}),i.redirect(`/events?ns=${e.files.first().target_ns}`)}function ce(e){D({args:e,action_type:i.WebUserActionLogEvent.CALCULATE_SIZE});const{files:t}=e;c.browseActions.fetchMultipleFolderSizes({files:t})}function de(t){return new Promise((function(t,o){e(["./c_sharing_content_manager"],t,o)})).then((({goToContentManagerForPath:e})=>{const o=t.files.first();e({containingFolder:o.is_dir?o.fq_path:i.parent_dir(o.fq_path)})}))}function _e(e,{snackbarWithShowButton:t}){D({args:e,action_type:i.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN});const o=i.getStoreForFolderOverview(),n=i.path$1(o.getState());o.dispatch(d.addContentReferences({folderFileId:d.folderOverviewFolderFileId(o.getState()),fileIds:e.files.toArray().map(i.fileToContentReferenceId),componentNamespace:i.BrowseFolderOverviewComponentNamespace,snackbarConfig:t?{onShow:()=>{c.browseActions.setUrl({path:n,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:i.filename(n,i.Viewer.get_root_name(e.user))}:void 0}))}function ue(t,o,{snackbarWithShowButton:n}){const{files:r,user:a}=t;(t=>{new Promise((function(t,o){e(["./c_folder_overview_pin_to_modal"],t,o)})).then((({FolderOverviewPinToModal:e})=>e.show(t)))})({user:a,path:o.currentFQPath,files:r.toArray(),onFolderSelected:e=>{D({args:t,action_type:i.WebUserActionLogEvent.FOLDER_OVERVIEW_PIN}),i.getStoreForFolderOverview().dispatch(d.addContentReferencesForPath({files:r.toArray(),path:e,currentPath:o.currentFQPath,snackbarConfig:n?{onShow:()=>{c.browseActions.setUrl({path:e,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:i.filename(e,i.Viewer.get_root_name(a))}:void 0}))},isCurrentPathReadOnly:!o.isCurrentPathWriteable()})}function fe(e,t){D({args:e,action_type:i.WebUserActionLogEvent.FOLDER_OVERVIEW_UNPIN});const o=i.getStoreForFolderOverview(),n=i.path$1(o.getState());o.dispatch(d.removeContentReferences({folderFileId:d.folderOverviewFolderFileId(o.getState()),fileIds:e.files.toArray().map(i.fileToContentReferenceId),componentNamespace:i.BrowseFolderOverviewComponentNamespace,snackbarConfig:t?{onShow:()=>{c.browseActions.setUrl({path:n,expandedBlade:"pinned_items",forceExpandRightRail:!0})},folderName:i.filename(n,i.Viewer.get_root_name(e.user))}:void 0}))}function he(e,t){N.logBrowseTTS("delete_file"),D({args:e,action_type:i.WebUserActionLogEvent.DELETE}),i.UserSurvey.trackEvent("delete_item","browse");const o=e.files.toArray(),n=o.some(i.File.isTeamSharedFolder),r=o.some((e=>e.read_only)),a=o.every((e=>e.isDeleted));if(!t.isCurrentPathWriteable()||n||r)n?I.Notify.error(S.intl.formatMessage({id:"AjarNz",defaultMessage:"Team folders can’t be deleted."})):I.Notify.warning(S.intl.formatMessage({id:"q5LxGC",defaultMessage:"You don’t have permission to delete files in this folder."}));else if(e.isSearchMode){const n=i.getStoreForSearch();a?n.dispatch(i.purgeFiles({files:o,user:e.user,context:t})):n.dispatch(y.deleteFiles({files:o}))}else a?c.browseActions.doPermanentDeleteWithModal(o):c.browseActions.doDeleteFilesWithModal({files:o})}function ge(e){D({args:e,action_type:i.WebUserActionLogEvent.DELETE_DEVICE_FOLDER});const t=e.files.map((e=>e.fq_path)).toArray();c.browseActions.openBackupDeleteDeviceFolderModal(t)}function pe(e,t){D({args:e,action_type:i.WebUserActionLogEvent.RESTORE});const o=e.files.toArray();if(e.isSearchMode){i.getStoreForSearch().dispatch(i.restoreFiles$1({files:o,user:e.user,context:t}))}else c.browseActions.doRestoreFilesWithUnifiedTrashModal({files:o})}function me(e,t){D({args:e,action_type:i.WebUserActionLogEvent.PERMANENT_DELETE});const o=e.files.toArray();if(e.isSearchMode){i.getStoreForSearch().dispatch(i.purgeFiles({files:o,user:e.user,context:t}))}else c.browseActions.doPermanentDeleteWithModal(o)}function Se(e){D({args:e,action_type:i.WebUserActionLogEvent.STAR}),we(e,!0)}function Ee(e){D({args:e,action_type:i.WebUserActionLogEvent.REMOVE_STAR}),we(e,!1)}function we(e,t){const o=e.files.first();i.getStoreForStarred().dispatch(i.updateStarredStatus({id:o.file_id,newStatus:t,itemName:i.itemNameFromStarrableItem(o),showSnackbar:!0}))}function ve(e,t){D({args:e,action_type:i.WebUserActionLogEvent.OPEN_EXTENSIONS,action_surface:t})}function Ae(e,t,o){D({args:e,action_type:i.WebUserActionLogEvent.EXTENSIONS_SELECTED,action_surface:t,extra:{extensions_option:o||"unknown"}})}function Fe(e){D({args:e,action_type:i.WebUserActionLogEvent.REWIND_CLICK});const t=i.browse_uri_for_fq_path(e.user,e.files.first().fq_path);t.setQuery({rewind:"true"}),i.replace_location(t.toString())}function be(e,t){const o=e.files.first().target_ns;o?(D({args:e,action_type:i.WebUserActionLogEvent.RE_ADD_SHARED_FOLDER_CLICK}),M.asyncMountSharedFolder({shared_folder_id:o,origin:i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,target_file:null,user:e.user})):D({args:e,action_type:i.WebUserActionLogEvent.RE_ADD_SHARED_FOLDER_CLICK,extra:{error:"No nsId found, no-op"}})}function Re(e){D({args:e,action_type:i.WebUserActionLogEvent.ADD_TO_TRANSFER});b.asyncShowBrowseEntryPointOnboardingModal({primaryActionOnClick:()=>{const t=e.files.toArray(),o=O.prepareFileIdsParam(t);i.Snackbar.sync(S.intl.formatMessage({id:"EmOY+w",defaultMessage:"Creating new transfer..."}),!1,"create-transfer");let n="browse";e.actionSurface&&(n=`browse_${e.actionSurface}`,e.actionSurface===i.ActionSurfaceLogValue.RIGHT_SIDEBAR&&1===t.length?n=`browse_${e.actionSurface}_single_file`:e.actionSurface===i.ActionSurfaceLogValue.RIGHT_SIDEBAR&&t.length>1&&(n=`browse_${e.actionSurface}_multi_file`)),i.redirect(O.createTransferUrlWithParams({referrer:n,fileids:o}))},userId:e.user.id})}function ke(e){const{files:t}=e,o=t.first(),{file_id:n}=o;i.logEvent(i.PAP_NavigateTo_Replay({actionElement:"open_in_menu",actionSurface:"browse_screen",destinationSurface:"replay_preview"})),i.unsafeRedirect(`https://replay.dropbox.com/project/creating/${n}?creationSource=dropbox_web`)}function Le(e){N.logBrowseTTS("open_in_new_tab");const{files:t,user:o}=e,n=t.first();let r;r=n.is_dir?i.browse_uri_for_fq_path(o,n.fq_path):i.preview_uri_for_fq_path(o,n.fq_path),window.open(r.toString(),"_blank")}function ye(e,t){N.logBrowseTTS("preview_dropbox");const{files:o,user:n,rightRailState:r,requestId:a,resultList:s,hasMoreResults:l}=e,c=o.first();if(e.isSearchMode){i.getStoreForSearch().dispatch(i.handleNavigateToFileOrFolder(c,{actionSource:t},s,a,null!=l&&l))}else{const{ns_id:o,sjid:a,file_id:s,fq_path:l,bytes:d,ext:_,request_id:u}=c;i.logOpenRow({uid:n.id,entity_type:c.is_dir?"folder":"file",source:"list_browse",view_type:e.viewType,file_nsid:o,file_sjid:a,file_id:s,file_name:i.filename(c.fq_path),file_path:l,file_size:d,file_type:c.type,file_extension:_,request_id:u,action_source:t,rightRailState:r}),t===i.ActionSourceValue.DETAILS_PANE_PREVIEW&&i.logBrowseAction({uid:n.id,num_files_selected:1,num_folders_selected:0,action:i.WebUserActionLogEvent.THUMBNAIL_OPEN_PREVIEW,action_surface:i.ActionSurfaceLogValue.RIGHT_SIDEBAR,right_sidebar_state:"opened"}),P.openPreviewForBrowseFile({file:c,shouldFocusComment:!1,user:n,fileViewOrigin:i.FileViewOriginType.BROWSE,onFileViewerUnmount:()=>{}})}}function Me(e,t,o,n=!0){var r,a;D({args:e,action_type:i.WebUserActionLogEvent.OPEN_DESKTOP});const s=e.files.first(),l=s?s.ns_id:null===(r=e.context)||void 0===r?void 0:r.currentNSID,c=s?s.ns_path:null===(a=e.context)||void 0===a?void 0:a.currentNSPath;T.UnityFeatures.open_file(l||null,c||"/",e.user.id,t,o,n)}function Te(e,t,o,i){N.logBrowseTTS("open_in_finder");Me(e,(e=>(t&&t(e),T.UnityFeatures.standard_open_file_handler(e))),(e=>{o&&o(e),T.UnityFeatures.standard_open_file_handler(!1)}),i)}function Ie(e,t,n,r,a){N.logBrowseTTS("copy_link"),D({args:e,action_type:i.WebUserActionLogEvent.SHARE_COPY_LINK});const s=e.isSearchMode?i.getStoreForSearch():i.getStoreForBrowse();o.CopyLinkMiniModal.show({user:e.user,file:e.files.first()||e.currentFolderInfo,setIsCreatingSharedLink:(t,o)=>{s.dispatch({type:e.isSearchMode?i.ActionTypes$2.SET_IS_CREATING_SHARED_LINK:i.ActionTypes$3.SET_IS_CREATING_SHARED_LINK,payload:{fileIdOrPath:o,isCreatingSharedLink:t}})},userActionSource:e.actionSource,anchorRef:t,onHoverLocked:n,onActionFlowComplete:r,userActionSurfaceLogValue:e.actionSurface,rightRailCollapsed:"collapsed"===e.rightRailState,isInUserLevelSharingSettings:"ON"===a})}function Ce(e){const{user:t,files:o}=e,n=o.map((e=>e.fq_path)).toArray();D({args:e,action_type:i.WebUserActionLogEvent.SHOW_IN_FOLDER}),l.handleShowInFolder({fqPaths:n,user:t})}function Oe(t,o){const{files:n,user:r}=t,a=n.first();return a&&C.isBrowseFile(a)&&r?".pdf"===a.ext&&o?(D({args:t,action_type:i.WebUserActionLogEvent.SELF_SIGN_ENTRY_POINT}),i.logEvent(U.PAP_NavigateTo_Edit({actionElement:W(t.actionSurface),actionSurface:"browse_screen",destinationSurface:"pdf_edit_signature_box"})),P.openPreviewForBrowseFile({file:a,shouldFocusComment:!1,user:r,fileViewOrigin:i.FileViewOriginType.BROWSE,onFileViewerUnmount:()=>{},editActivationParams:{source:"browse_overflow_menu_self_sign",highlight:"sign"}}),Promise.resolve()):new Promise((function(t,o){e(["./c_integrations_hellosign_deep_integration_launcher"],t,o)})).then((({getLauncher:e})=>{const n=e();return n.init({entryPoint:o?"file_hover_overflow_menu_self_sign":"file_hover_overflow_menu",file:a,user:r,source:o?"dropbox-file-hover-overflow-menu-send-for-self-sign":"dropbox-file-hover-overflow-menu-send-for-esign",selfSign:o}),D({args:t,action_type:o?i.WebUserActionLogEvent.SELF_SIGN_ENTRY_POINT:i.WebUserActionLogEvent.SEND_FOR_SIGNATURE}),i.logEvent(i.PAP_NavigateTo_Sign({actionElement:W(t.actionSurface),actionSurface:"browse_screen",destinationSurface:o?"dropbox_sign_edit":"dropbox_sign_recipient_email_input"})),n})).then((e=>(e.launch(),e))):Promise.resolve()}var Ne=Object.freeze({__proto__:null,handleAddToTransfer:Re,handleArchive:ie,handleBackupDeleteDeviceFolder:ge,handleBrowsePin:_e,handleBrowsePinTo:ue,handleCalculateFolderSize:ce,handleComment:te,handleDelete:he,handleDownload:ee,handleEvents:le,handleExtensionClick:Ae,handleExtensionDropdownOpen:ve,handleFileLock:ne,handleFileRequestUnlock:ae,handleFileUnlock:re,handleManageAsAdmin:de,handleOpenInDesktop:Te,handleOpenInDesktopWithoutStandardHandlers:Me,handleOpenInNewTab:Le,handlePermanentDelete:me,handlePreview:ye,handleReAdd:be,handleRename:J,handleRenameTeamFolder:oe,handleReplay:ke,handleRequestFiles:Z,handleRestore:pe,handleRewind:Fe,handleSendForSignature:Oe,handleShareCopyLink:Ie,handleShowInFolder:Ce,handleStar:Se,handleUnpin:fe,handleUnstar:Ee,handleVersions:se});t.action_handlers_esnext=Ne,t.browseNavigateActions=P,t.getActionElementForPAP=W,t.handleAddToTransfer=Re,t.handleArchive=ie,t.handleBackupDeleteDeviceFolder=ge,t.handleBrowsePin=_e,t.handleBrowsePinTo=ue,t.handleCalculateFolderSize=ce,t.handleComment=te,t.handleDelete=he,t.handleDownload=ee,t.handleEvents=le,t.handleExtensionClick=Ae,t.handleExtensionDropdownOpen=ve,t.handleFileLock=ne,t.handleFileRequestUnlock=ae,t.handleFileUnlock=re,t.handleManageAsAdmin=de,t.handleOpenInDesktop=Te,t.handleOpenInDesktopWithoutStandardHandlers=Me,t.handleOpenInNewTab=Le,t.handlePermanentDelete=me,t.handlePreview=ye,t.handleReAdd=be,t.handleRename=J,t.handleRenameTeamFolder=oe,t.handleReplay=ke,t.handleRequestFiles=Z,t.handleRestore=pe,t.handleRewind=Fe,t.handleSendForSignature=Oe,t.handleShareCopyLink=Ie,t.handleShowInFolder=Ce,t.handleStar=Se,t.handleUnpin=fe,t.handleUnstar=Ee,t.handleVersions=se,t.logUserEventOnFile=D}));
//# sourceMappingURL=c_browse_file_actions_action_handlers.js-vfl9aQ3jR.map
