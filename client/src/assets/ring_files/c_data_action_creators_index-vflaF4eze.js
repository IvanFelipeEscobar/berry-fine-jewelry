define(["require","exports","./c_tslib","./c_lodash-es_lodash","./e_ui_page_files_router","./c_apex-metrics_src_types","./c_files_view_file_actions_file_from_metadata","./c_history","./c_browse_crypto_subtle_digest","./c_core_i18n","./e_edison","./c_src_sink_index","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/web_experience_constants"],(function(e,t,o,a,i,s,n,r,d,l,c,p,u,f,_,m){"use strict";class h extends s.Message{constructor(e){super(),this.actionSource="",s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new h).fromBinary(e,t)}static fromJson(e,t){return(new h).fromJson(e,t)}static fromJsonString(e,t){return(new h).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(h,e,t)}}h.runtime=s.proto3,h.typeName="hql_events.WebBrowseSelectRow",h.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"action_source",kind:"scalar",T:9},{no:2,name:"hql_metadata",kind:"message",T:i.HQLMetadata}]));const S=l.intl.formatMessage({id:"A5Lqjf",defaultMessage:"Add a few details about this folder here."});l.intl.formatMessage({id:"ssdefa",defaultMessage:"Can’t save changes. Paste text elsewhere to save, then click Refresh."});const g=l.intl.formatMessage({id:"5dt0hu",defaultMessage:"Can’t save changes. Reload the page and try again."}),E=l.intl.formatMessage({id:"PM6K+P",defaultMessage:"Can’t save changes."});l.intl.formatMessage({id:"9C/lc5",defaultMessage:"Can’t @mention someone in your Personal Dropbox."});const T=l.intl.formatMessage({id:"+dhj1b",defaultMessage:"Can’t @mention someone in your member folder."}),v=l.intl.formatMessage({id:"b7//2e",defaultMessage:"You don’t have permission to share this folder."}),I=l.defineMessage({id:"mjXnuX",defaultMessage:"Pinned to {folderName}"}),y=l.defineMessage({id:"A1Fokf",defaultMessage:"Unpinned from {folderName}"});l.defineMessage({id:"Ww9LPX",defaultMessage:"Close"});const F=l.defineMessage({id:"8msMyU",defaultMessage:"Show"});l.intl.formatMessage({id:"HRXOjw",defaultMessage:"opt"}),l.intl.formatMessage({id:"RIxWSs",defaultMessage:"alt"}),l.intl.formatMessage({id:"FL9yea",defaultMessage:"ctrl"}),l.intl.formatMessage({id:"NWv/3R",defaultMessage:"⌘"});const A=l.intl.formatMessage({id:"Kud10T",defaultMessage:"Everyone in this folder can see notes, tasks, and pinned items"}),w=l.defineMessage({id:"xkXFjI",defaultMessage:"Hi {user_name}, I @mentioned you in this folder. Take a look."}),O=l.defineMessage({id:"YzaJIx",defaultMessage:"Hi {user_name}, I @mentioned you in the {folder_name} folder. Take a look."}),N=l.intl.formatMessage({id:"sl5Fj7",defaultMessage:"I @mentioned you in this folder. Take a look."}),R=l.defineMessage({id:"erm7J0",defaultMessage:"I @mentioned you in the {folder_name} folder. Take a look."}),L=[1,0,1],M=l.defineMessage({id:"kh62rs",defaultMessage:"Pin “{name}” to..."}),D=l.defineMessage({id:"oU0z79",defaultMessage:"Pin {num} items to..."}),b=l.defineMessage({id:"BGyZpk",defaultMessage:"You do not have permission to pin to {path}"}),C=l.defineMessage({id:"UD2+LM",defaultMessage:"Can't pin files or folders to a read-only folder"}),P=l.defineMessage({id:"PX5Hq1",defaultMessage:"Deleted {time_ago} by you"}),k=l.defineMessage({id:"7V5b6j",defaultMessage:"Deleted {time_ago} by {name}"}),U=l.defineMessage({id:"oA46AW",defaultMessage:"Updated {time_ago} by you"}),x=l.defineMessage({id:"MP7zas",defaultMessage:"Updated {time_ago} by {name}"}),B=l.defineMessage({id:"PHRYz8",defaultMessage:"Your changes weren’t saved because you and {user} are editing at the same time."}),q=l.intl.formatMessage({id:"tc/4YZ",defaultMessage:"Your changes weren’t saved because you are editing this description elsewhere."}),V=l.intl.formatMessage({id:"4aEgv5",defaultMessage:"Please wait until they’re done before making changes."}),$=l.intl.formatMessage({id:"oYSO1Z",defaultMessage:"Please save your other changes before making them here."}),j=l.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),G=[],H=e=>i.getStateAtNamespace(e,i.FOLDER_OVERVIEW_NAMESPACE_KEY)||i.defaultFolderOverviewState,W=e=>H(e).folderDataCache,z=e=>H(e).fileIdCache,Y=(e,t)=>z(e)[i.normalizePath(t.path)],J=e=>H(e).nsIdCache,K=(e,t)=>J(e)[i.normalizePath(t.path)],Q=e=>H(e).accountCache,Z=e=>H(e).componentDataCache,X=e=>e.BROWSE&&e.BROWSE.user||i.mkUser(e.SEARCH.user),ee=(e,t)=>Z(e)[t.componentNamespace],te=(e,t)=>{const o=Y(e,t);return W(e)[o]},oe=(e,t)=>{const o=te(e,t);return o?o.sharedFolderPath||t.path:void 0},ae=(e,t)=>{var o;const a=ie(e,t);return null!==(o=null==a?void 0:a.userId)&&void 0!==o?o:void 0},ie=(e,t)=>{const{descriptionLastModified:o}=te(e,t)||{};return o},se=i.createSelector(te,(e=>e?e.descriptionFormatVersion:void 0)),ne=i.createSelector(te,(e=>{if(e&&e.description)try{return JSON.parse(e.description)}catch(e){return}})),re=i.createSelector(te,(e=>{if(void 0!==e&&void 0!==e.contentReferences)return 0===e.contentReferences.length?G:i.convertContentReferencesToSortedFiles(e.contentReferences)})),de=i.createSelector(ne,i.isEmptyDescription),le=()=>i.createSelector(ee,(e=>{if(!e||0===e.requiredComponents.length)return!1;return 0===e.requiredComponents.filter((t=>!e.loadedComponents.includes(t))).length})),ce=()=>i.createSelector(ee,(e=>!!e&&e.hasFailedToLoad)),pe=()=>i.createSelector(Y,(e=>e)),ue=i.createSelector(X,i.convertDbxUserToIUser),fe=()=>i.createSelector(te,(e=>e?e.loggingFileId:void 0)),_e=()=>i.createSelector(re,(e=>e)),me=le(),he=ce(),Se=pe(),ge=fe(),Ee=_e(),Te=e=>Se(e,{path:i.path$1(e)}),ve=e=>Ee(e,{path:i.path$1(e)}),Ie=e=>i.browseLoadingState(e)===i.LoadingState.LOADED?i.sortedFiles(e).count():i.getBrowseState(e).paginatedTotalNumFiles,ye=i.createSelector(i.context,Ie,((e,t)=>e.isInsideVaultFolder&&null!=e.currentNSPath&&i.paths_are_equal(e.currentNSPath,"")&&0===t)),Fe=i.createSelector(i.context,Ie,i.experiments,((e,t,o)=>e.isInFamilySharedFolder&&null!=e.currentNSPath&&i.paths_are_equal(e.currentNSPath,"")&&0===t));var Ae=Object.freeze({__proto__:null,folderOverviewFolderFileId:Te,folderOverviewLoggingFileId:e=>ge(e,{path:i.path$1(e)}),folderOverviewPinnedItems:ve,hasFailedToLoad:e=>he(e,{componentNamespace:i.BrowseFolderOverviewComponentNamespace}),haveAllComponentsLoaded:e=>me(e,{componentNamespace:i.BrowseFolderOverviewComponentNamespace}),paginatedTotalNumFiles:Ie,shouldShowFamilyEmptyState:Fe,shouldShowVaultEmptyState:ye});const we=new i.UserApiV2Client;class Oe extends i.UserApiV2Client{constructor(e,t){super(t),this.user=e}_headers(e){return this.user.is_cdm_member&&this.user.is_team_admin&&this.user.team_member_id?Object.assign({[i.ApiV2HeaderNames.DropboxApiSelectAdmin]:this.user.team_member_id},super._headers(e)):super._headers(e)}}const Ne=(e,t)=>we.ns("files").rpc("get_description_batch",{file_ids:[t]},{subjectUserId:e}).then((e=>{if(!e||!e.items||1!==e.items.length)throw new Error("Unexpected response from get_description_batch");return e.items[0]})),Re=(e,t)=>we.ns("files").rpc("get_content_references_info",{file_id:t},{subjectUserId:e});class Le extends p.EventEmitter{constructor(){super(),this.setUpdateChannelForType=(e,t)=>{this.signedChannelStates[e]=new i.SignedChannelState(t.appId,t.uniqueId,t.revision,t.token),this.boltClient.update_states(a.values(this.signedChannelStates)),this.boltClient.start()},this.handleUpdate=e=>{const t=[];e.forEach((e=>{const o=a.findKey(this.signedChannelStates,{app_id:e.app_id,unique_id:e.unique_id});o&&!t.includes(o)&&(this.emit("update",{type:o}),t.push(o))}))},this.handleRefresh=()=>{this.boltClient.update_states(a.values(this.signedChannelStates))},this.boltClient=new i.BoltClient([],this.handleUpdate,this.handleRefresh),this.signedChannelStates={}}stop(){this.boltClient.unsubscribe()}}const Me=new Le,De=new i.HiveLogger;function be(e){return e.blocks.map((e=>e.text.length)).reduce(((e,t)=>e+t),0)}function Ce(e){let t=i.immutableExports.OrderedSet();return t=t.merge(e.blocks.map((e=>e.type)).filter((e=>"unstyled"!==e))),e.blocks.forEach((e=>e.inlineStyleRanges.forEach((e=>{t=t.add(e.style)})))),e.blocks.forEach((o=>o.entityRanges.forEach((o=>{t=t.add(e.entityMap[o.key].type)})))),t.toArray().sort()}const Pe=(e,t)=>{const o=W(t)[e];return o&&o.contentReferences||[]},ke=e=>{if(!e)return"";const t=i.sjclExports.hash.sha256.hash(e.toLowerCase());return i.sjclExports.codec.hex.fromBits(t)},Ue=e=>(e||"/").split("/").map(ke).join("/"),xe=e=>{const t=i.normalize(e).split("/");return ke(t.pop())},Be=({folderFileId:e,loggingFileId:t,action_surface:o,retrievalSource:a})=>{const s=i.getStoreForFolderOverview().getState(),n=function(e){const t=function(e){const t={all:0,checked:0};return e?(e.blocks.forEach((e=>{"task-block"===e.type&&(t.all+=1,e.data&&e.data.checked&&(t.checked+=1))})),t):t}(e);return{length:e?be(e):0,features:e?Ce(e):[],tasks:t.all,checkedTasks:t.checked}}(((e,t)=>{const o=W(t)[e];if(o&&o.descriptionDraft)try{return JSON.parse(o.descriptionDraft)}catch(e){return}})(e,s)),r=qe({folderFileId:e,loggingFileId:t,action_surface:o,retrievalSource:a});if(r)return Object.assign(Object.assign({},r),{length:n.length.toString(),formatting:JSON.stringify(n.features),tasks:n.tasks.toString(),checkedTasks:n.checkedTasks.toString(),pins:JSON.stringify(Pe(e,s).map((e=>({file_id:e.ns_path?e.file_id:e.ns_id,file_obj_id:e.file_id,resource:{resource_title:xe(e.fq_path),resource_type:e.is_dir?"SFJ_FOLDER":"SFJ_FILE",ns_id:`${e.ns_id}`,resource_path:Ue(e.fq_path),resource_namespace_path:Ue(e.ns_path)}}))))})},qe=({folderFileId:e,loggingFileId:t,action_surface:o,retrievalSource:a})=>{const s=i.getStoreForFolderOverview().getState(),n=((e,t)=>{const o=z(t);for(const t in o)if(o[t]===e)return t})(e,s);if(void 0===n)return;const{nsId:r,nsPath:d}=(l=J(s)[n])?{nsId:i.extractSharedFolderId(l),nsPath:i.extractSharedFolderPath(l)}:{};var l;return r?{resource_type:"SFJ_FOLDER",resource_title:xe(n),ns_id:r,resource_path:Ue(n),resource_namespace_path:Ue(d),file_id:(d?t:r)||null,file_obj_id:e,is_offline:"false",action_surface:o,retrieval_source:a}:void 0},Ve=(e,t,o,a={})=>{let s={user_id:t,event_name:e};o&&(s=Object.assign(Object.assign({},s),{file_nsid:o.ns_id,file_sjid:o.sjid,file_id:o.file_id,file_name:i.filename(o.fq_path),file_path:o.fq_path,file_extension:o.ext})),De.log(new i.WebUserActionRow(Object.assign(Object.assign({},s),{extra:Object.assign({},a)})))},$e=({folderFileId:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=X(a()).id;i.UserLocalStorage.clearOtherUsers([o]);const s=i.UserLocalStorage.get(o,`folder-overview-${e}`);s&&t(Ze({fileId:e,folderData:s}))})),je=({componentNamespace:e,component:t})=>({type:i.ActionTypes$5.ADD_LOADED_COMPONENT,payload:{componentNamespace:e,component:t}}),Ge=({componentNamespace:e,component:t})=>({type:i.ActionTypes$5.REMOVE_LOADED_COMPONENT,payload:{componentNamespace:e,component:t}}),He=({componentNamespace:e,hasFailedToLoad:t})=>({type:i.ActionTypes$5.SET_FAILED_TO_LOAD,payload:{componentNamespace:e,hasFailedToLoad:t}}),We=(e,t,o)=>{const{text:a,latest_revision_id:s,file_obj_id:n,bolt_channel_state:r,format_version:d,last_modified_time:l,last_modified_user:c}=e;if(!n)throw new Error("Unexpected response from Sprinkle");t(Ze({fileId:n,folderData:{description:a,descriptionBaseRevision:s||"",descriptionDraft:void 0,descriptionSaveState:i.DescriptionSaveState.IDLE,descriptionFormatVersion:d,descriptionBoltChannelState:r,descriptionLastUpdated:Date.now()}})),t(je({componentNamespace:o,component:"description"})),t(st({folderFileId:n,modifiedInfo:{timestamp:l,userId:c},field:"description"})),nt("description",r)},ze=(e,t,o,a)=>{const i=t.content_references||[],s=t.latest_revision_id,n=t.last_modified_time,r=t.last_modified_user;o(Ze({fileId:e,folderData:{contentReferences:i,contentReferencesRevision:s,contentReferencesBoltChannelState:t.bolt_channel_state,contentReferencesLastUpdated:Date.now()}})),o(st({folderFileId:e,modifiedInfo:{timestamp:n,userId:r},field:"contentReferences"})),o(je({componentNamespace:a,component:"content_references"})),nt("content_references",t.bolt_channel_state)},Ye=({folderFileId:e,componentNamespace:t})=>(a,i)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=X(i());try{const i=yield Re(o.id,e);ze(e,i,a,t)}catch(t){u.reportException({err:t,severity:f.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:e,isReload:!0}})}}));function Je(e){i.Snackbar.complete(l.intl.formatMessage({id:"sz+AhS",defaultMessage:"{count, plural, one{Pinned {count} item.} other{Pinned {count} items.}}"},{count:e}),"folder-overview-pin-current-folder")}const Ke=({folderName:e,onShow:t})=>{i.Snackbar.show(c.reactExports.createElement(i.Snackbar,{title:l.intl.formatMessage(I,{folderName:e}),timeoutDelayMs:5e3,actionButtonText:t?l.intl.formatMessage(F):void 0,closeButtonText:l.intl.formatMessage({id:"HBT96k",defaultMessage:"Close"}),onActionClick:t?()=>{i.Snackbar.close("folder-overview-pin"),t()}:void 0,id:"folder-overview-pin"}))},Qe=({folderFileId:e,fileIds:t,componentNamespace:a,snackbarConfig:i})=>(s,n)=>o.__awaiter(void 0,void 0,void 0,(function*(){if(null===t||0===t.length)return;const o=X(n()).id;try{yield((e,t,o)=>we.ns("files").rpc("add_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:o},{subjectUserId:e}))(o,e,t),i?Ke(i):Je(t.length),s(Ye({folderFileId:e,componentNamespace:a}))}catch(e){u.reportException({err:e,severity:f.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),Ze=({fileId:e,folderData:t})=>({type:i.ActionTypes$5.UPDATE_FOLDER_DATA_CACHE,payload:{fileId:e,folderData:t}}),Xe=({componentNamespace:e,requiredComponents:t})=>({type:i.ActionTypes$5.SET_REQUIRED_COMPONENTS,payload:{componentNamespace:e,requiredComponents:t}});function et(e){const t=e.description?l.intl.formatMessage({id:"BV1uZg",defaultMessage:"Folder overview changed."}):l.intl.formatMessage({id:"MLktc7",defaultMessage:"Folder overview added."});i.Snackbar.generic(t,"folder-overview-change")}const tt=e=>!!e&&(e.descriptionSaveState!==i.DescriptionSaveState.CONFLICT&&(e.descriptionSaveState!==i.DescriptionSaveState.SAVING&&i.hasUnsavedDescriptionDraft(e))),ot=({path:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){if(i.paths_are_equal(e,"/"))return;const o=i.normalizePath(e),s=J(a())[o];if(!s)return;const n=z(a())[o],r=X(a()).id,d=i.extractSharedFolderId(s);if(d)try{const e=yield(({userId:e,sharedFolderId:t})=>we.ns("files").rpc("get_metadata",{path:`ns:${t}`},{subjectUserId:e}).then((e=>e.is_shareable?e.path_display:void 0)))({userId:r,sharedFolderId:d});t(Ze({fileId:n,folderData:{sharedFolderPath:e}}))}catch(e){u.reportException({err:e,severity:f.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),at=({accountId:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=X(a());if(!e)return;if(e in Q(a()))return;if(e===o.account_id)return;const s=yield(({userId:e,accountId:t})=>we.ns("users").rpc("get_account",{account_id:t},{subjectUserId:e}))({userId:o.id,accountId:e});t({type:i.ActionTypes$5.UPDATE_ACCOUNT_CACHE,payload:{accountCache:{[e]:s}}})})),it=({path:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){if(i.paths_are_equal(e,"/"))return;if(i.paths_are_equal(i.context(a()).currentFQPath,e)&&!i.context(a()).currentNSPath)return;const o=i.normalizePath(e),s=z(a())[o],n=X(a()).id;try{const e=yield(({userId:e,path:t})=>we.ns("files").rpc("get_metadata",{path:t},{subjectUserId:e}).then((e=>e.id)))({userId:n,path:o});t(Ze({fileId:s,folderData:{loggingFileId:e}}))}catch(e){u.reportException({err:e,severity:f.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),st=({folderFileId:e,modifiedInfo:t,field:o})=>(a,i)=>{if(!t.timestamp||!t.userId)return;const s=W(i())[e];if(!s)return;const n="contentReferences"===o?"contentReferencesLastModified":"descriptionLastModified",r=s[n];(null==r?void 0:r.timestamp)&&t.timestamp<r.timestamp||(a(Ze({fileId:e,folderData:{[n]:t}})),a(at({accountId:t.userId})))},nt=(e,t)=>{if(void 0!==t)try{const{channel_id:o,revision:a,token:i}=t;if(void 0===o||void 0===a||void 0===i)return;const{unique_id:s,app_id:n}=o;if(void 0===s||void 0===n)return;Me.setUpdateChannelForType(e,{uniqueId:s,appId:n,token:i,revision:`${a}`})}catch(e){u.reportException({err:e,severity:f.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}},rt=({folderFileId:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=X(a()),{last_modified_time:i,last_modified_user:s}=yield Ne(o.id,e);t(st({folderFileId:e,modifiedInfo:{timestamp:i,userId:s},field:"description"}))})),dt=(e,t,o,a,i)=>o.latest_revision_id?(We(o,e,a),!0):(e(je({componentNamespace:a,component:"description"})),e(Ze({fileId:t,folderData:{descriptionBoltChannelState:o.bolt_channel_state,descriptionLastUpdated:i}})),nt("description",o.bolt_channel_state),!1),lt=(e,t,o,a,i,s)=>o.latest_revision_id?(ze(t,o,e,i),!0):(e(Ze({fileId:t,folderData:{contentReferences:[],contentReferencesBoltChannelState:o.bolt_channel_state,contentReferencesLastUpdated:s}})),e(je({componentNamespace:i,component:"content_references"})),!1),ct=()=>({});function pt(e){return{class:"navigation",action:"select",object:"content_tile",properties:e}}const ut="ON";function ft(e){return e===ut}var _t,mt;!function(e){e[e.MANUAL_CLASSIFICATION=0]="MANUAL_CLASSIFICATION",e[e.MANAGED_METADATA=1]="MANAGED_METADATA"}(_t||(_t={})),s.proto3.util.setEnumType(_t,"structured_tags.TemplateType",[{no:0,name:"MANUAL_CLASSIFICATION"},{no:1,name:"MANAGED_METADATA"}]),function(e){e[e.GREEN=0]="GREEN",e[e.BLUE=1]="BLUE",e[e.YELLOW=2]="YELLOW",e[e.RED=3]="RED",e[e.GRAY=4]="GRAY"}(mt||(mt={})),s.proto3.util.setEnumType(mt,"structured_tags.StructuredTagColor",[{no:0,name:"GREEN"},{no:1,name:"BLUE"},{no:2,name:"YELLOW"},{no:3,name:"RED"},{no:4,name:"GRAY"}]);class ht extends s.Message{constructor(e){super(),this.id=s.protoInt64.zero,this.name="",this.isDeleted=!1,this.description="",this.color=mt.GREEN,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new ht).fromBinary(e,t)}static fromJson(e,t){return(new ht).fromJson(e,t)}static fromJsonString(e,t){return(new ht).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(ht,e,t)}}ht.runtime=s.proto3,ht.typeName="structured_tags.StructuredTagsSelectionValue",ht.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"id",kind:"scalar",T:4},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"is_deleted",kind:"scalar",T:8},{no:5,name:"description",kind:"scalar",T:9},{no:6,name:"color",kind:"enum",T:s.proto3.getEnumType(mt)}]));class St extends s.Message{constructor(e){super(),this.values=[],s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new St).fromBinary(e,t)}static fromJson(e,t){return(new St).fromJson(e,t)}static fromJsonString(e,t){return(new St).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(St,e,t)}}St.runtime=s.proto3,St.typeName="structured_tags.StructuredTagsSelectionValues",St.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"values",kind:"message",T:ht,repeated:!0}]));class gt extends s.Message{constructor(e){super(),this.id=s.protoInt64.zero,this.name="",this.isDeleted=!1,this.values={case:void 0},s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new gt).fromBinary(e,t)}static fromJson(e,t){return(new gt).fromJson(e,t)}static fromJsonString(e,t){return(new gt).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(gt,e,t)}}gt.runtime=s.proto3,gt.typeName="structured_tags.StructuredTagsField",gt.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"id",kind:"scalar",T:4},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"is_deleted",kind:"scalar",T:8},{no:4,name:"selection_values",kind:"message",T:St,oneof:"values"}]));class Et extends s.Message{constructor(e){super(),this.id=s.protoInt64.zero,this.name="",this.isDeleted=!1,this.isActivated=!1,this.type=_t.MANUAL_CLASSIFICATION,this.fields=[],this.lastModifiedTime=s.protoInt64.zero,s.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new Et).fromBinary(e,t)}static fromJson(e,t){return(new Et).fromJson(e,t)}static fromJsonString(e,t){return(new Et).fromJsonString(e,t)}static equals(e,t){return s.proto3.util.equals(Et,e,t)}}Et.runtime=s.proto3,Et.typeName="structured_tags.StructuredTagsTemplate",Et.fields=s.proto3.util.newFieldList((()=>[{no:1,name:"id",kind:"scalar",T:4},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"is_deleted",kind:"scalar",T:8},{no:4,name:"is_activated",kind:"scalar",T:8},{no:5,name:"type",kind:"enum",T:s.proto3.getEnumType(_t)},{no:6,name:"fields",kind:"message",T:gt,repeated:!0},{no:7,name:"last_modified_time",kind:"scalar",T:4}]));const Tt=new class{getStructuredTagTemplates(){var e;return o.__awaiter(this,void 0,void 0,(function*(){const t=new i.DefaultUserApiV2Client(i.mustGetActiveUser());try{const o=yield t.ns("structured_tags").rpc("get_all_structured_tag_templates",{},{});return(null===(e=o.templates)||void 0===e?void 0:e.map((e=>vt(e))))||[]}catch(e){return[]}}))}getStructuredTagsForFiles(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=new i.DefaultUserApiV2Client(i.mustGetActiveUser());try{return(yield t.ns("structured_tags").rpc("get_structured_tags_by_content_ids",{content_ids:e.map(i.createContentIdFromFile)},{})).result||[]}catch(e){return[]}}))}createOrUpdateStructuredTagTemplate(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=new i.DefaultUserApiV2Client(i.mustGetActiveUser());try{const o=yield t.ns("structured_tags").rpc("create_or_update_structured_tag_template",{template:wt(e)},{});return o.template?vt(o.template):void 0}catch(e){return}}))}},vt=e=>new Et({id:s.protoInt64.parse(e.id),name:e.name,isActivated:e.is_activated,isDeleted:e.is_deleted,type:Ft(e.type),fields:e.fields.map((e=>It(e))),lastModifiedTime:s.protoInt64.parse(e.last_modified_time)}),It=e=>{const t=new gt({id:s.protoInt64.parse(e.id),name:e.name,isDeleted:e.is_deleted});return e.values&&"selection_values"===e.values[".tag"]&&(t.values={value:new St({values:e.values.values.map((e=>yt(e)))}),case:"selectionValues"}),t},yt=e=>new ht({id:s.protoInt64.parse(e.id),name:e.name,color:At(e.color),isDeleted:e.is_deleted,description:e.description}),Ft=e=>"manual_classification"===e[".tag"]?_t.MANUAL_CLASSIFICATION:_t.MANAGED_METADATA,At=e=>"green"===e[".tag"]?mt.GREEN:"blue"===e[".tag"]?mt.BLUE:"yellow"===e[".tag"]?mt.YELLOW:"red"===e[".tag"]?mt.RED:mt.GRAY,wt=e=>({id:Number(e.id),name:e.name,is_activated:e.isActivated,is_deleted:e.isDeleted,type:Rt(e.type),fields:e.fields.map((e=>Ot(e))),last_modified_time:Number(e.lastModifiedTime)}),Ot=e=>{const t={id:Number(e.id),name:e.name,is_deleted:e.isDeleted};return e.values&&"selectionValues"===e.values.case&&(t.values={".tag":"selection_values",values:e.values.value.values.map((e=>Nt(e)))}),t},Nt=e=>({id:Number(e.id),name:e.name,is_deleted:e.isDeleted,description:e.description,color:Lt(e.color)}),Rt=e=>e===_t.MANUAL_CLASSIFICATION?{".tag":"manual_classification"}:{".tag":"managed_metadata"},Lt=e=>{switch(Number(e)){case mt.GREEN:return{".tag":"green"};case mt.BLUE:return{".tag":"blue"};case mt.YELLOW:return{".tag":"yellow"};case mt.RED:return{".tag":"red"};case mt.GRAY:return{".tag":"gray"};default:return{".tag":"other"}}},Mt=e=>(e=>i.getStateAtNamespace(e,i.STRUCTURED_TAGS_NAMESPACE_KEY)||i.defaultStructuredTagState)(e).status,Dt=({files:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){"default"===Mt(a())&&t(((e,t)=>o.__awaiter(void 0,void 0,void 0,(function*(){e({type:i.ActionTypes$6.SET_STATUS,payload:{status:i.StructuredTagsNamespaceStatus.IS_LOADING}});const t=yield Tt.getStructuredTagTemplates();e({type:i.ActionTypes$6.SET_TEMPLATES,payload:{structuredTagTemplates:t}})}))));const s=(yield Tt.getStructuredTagsForFiles(e)).reduce(((e,{content_id:t,selected_tags:o})=>(e[i.getFileObjectNsIdAndPathKey({nsId:t.ns_id,nsPath:t.ns_path})]=o||[],e)),{});t({type:i.ActionTypes$6.SET_FILE_TO_STRUCTURED_TAGS_MAP,payload:{fileToTags:s}})})),bt=i.getStoreForSharedWith(),Ct=e=>({type:i.ActionTypes$3.POP_BOLT_IGNORE,payload:e}),Pt=({fqPathsToSelect:e})=>({type:i.ActionTypes$3.SELECT_FILES_BY_FQ_PATH,payload:{fqPathsToSelect:e}}),kt=({clipboard:e})=>({type:i.ActionTypes$3.SET_CLIPBOARD_FILES,payload:{clipboard:e}}),Ut=({context:e})=>({type:i.ActionTypes$3.SET_CONTEXT,payload:{context:e}}),xt=({currentFolderInfo:e})=>({type:i.ActionTypes$3.SET_CURRENT_FOLDER_INFO,payload:{currentFolderInfo:e}}),Bt=({fileJumpFilter:e})=>({type:i.ActionTypes$3.SET_FILE_JUMP_FILTER,payload:{fileJumpFilter:e}}),qt=({filePathsToSelectOnNextUpdate:e})=>({type:i.ActionTypes$3.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,payload:{filePathsToSelectOnNextUpdate:e}}),Vt=({loadingState:e,path:t})=>({type:i.ActionTypes$3.SET_LOADING_STATE,payload:{loadingState:e,path:t}}),$t=({mountPoints:e})=>({type:i.ActionTypes$3.SET_MOUNT_POINTS,payload:{mountPoints:e}}),jt=({newFolderCreationState:e})=>({type:i.ActionTypes$3.SET_NEW_FOLDER_CREATION_STATE,payload:{newFolderCreationState:e}}),Gt=({paginatedTotalNumFiles:e})=>({type:i.ActionTypes$3.SET_PAGINATED_TOTAL_NUM_FILES,payload:{paginatedTotalNumFiles:e}}),Ht=({path:e="",qargs:t,expandedBlade:o="info",forceExpandRightRail:s=!1})=>(n,d)=>{r.DBHistory.push_state(i.urlPrefix(d())+c.URI.encode_parts(e),a.omitBy(Object.assign(Object.assign({},a.pick(i.getQueryArgs(),["d"])),t),a.isUndefined)),n(Yt({skipLogging:!0})),n(Xt(o)),s&&n(Zt(!1))},Wt=({path:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){var o;t({type:i.ActionTypes$3.SET_PATH,payload:{path:e}});const s=i.backups(a()),n=yield d.hashString(e);if(n||u.reportException({err:new Error("hashString returned null"),tags:["browse"],severity:f.SEVERITY.NONCRITICAL}),t({type:i.ActionTypes$3.SET_VIEW_SCOPE,payload:{viewScope:n}}),e){const t=null===(o=null==s?void 0:s.find((t=>t.fqPath===e)))||void 0===o?void 0:o.displayName;document.title=i.isBackupBrowse()?l.intl.formatMessage({id:"IePl0Y",defaultMessage:"{folder_name} - Dropbox Backup"},{folder_name:i.filename_without_extension(i.filename(s?null!=t?t:e:"",l.intl.formatMessage({id:"UwzCW9",defaultMessage:"Backups"})))}):l.intl.formatMessage({id:"dbYCaa",defaultMessage:"{folder_name} - Dropbox"},{folder_name:i.filename(e,l.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"}))})}})),zt=({selection:e,actionSource:t,skipLogging:o})=>(a,s)=>{var n;if(!o){const o=s(),a=i.selection(o),{event:r,itemId:d}=i.makeSelectionEvent(a,e),l=i.selectFileByFullPath(o,{path:d}),c=i.selectViewType(s(),{instanceId:i.BROWSE_FILES_VIEW_ID});if("ON"===m.CONTENT_TILES&&(c===i.ViewType.Grid||c===i.ViewType.LargeGrid)){if("ON"===m.CONTENT_TILES_DISABLED_TILE){const t=i.selectFilesByFullPaths(o,{paths:e.selected,excludeNoAccessSharedFolders:!0});e=i.createSelection(t.map((e=>e.fq_path)),null!==(n=e.anchor)&&void 0!==n?n:"")}const s=e.selected.filter((e=>!a.selected.contains(e))),r=a.selected.filter((t=>!e.selected.contains(t))),d={actionElement:"content_tiles",actionSource:t};s.size>0&&i.logEvent(pt(Object.assign(Object.assign({},d),{selectType:"select"}))),r.size>0&&i.logEvent(pt(Object.assign(Object.assign({},d),{selectType:"deselect"})))}if(l){const{num_files_selected:a,num_folders_selected:s}=i.countFilesAndFolders(i.selectFilesForSelection(o,{selection:e}));r===i.WebUserActionLogEvent.SELECT_ROW&&i.logEvent$1(new h({actionSource:t})),i.logBrowseAction({uid:i.user$1(o).id,action:r,action_source:t,num_files_selected:a,num_folders_selected:s,view_type:c,result:l,extra:{entity_type:l.is_dir?"folder":"file"}})}}a({type:i.ActionTypes$3.SET_SELECTION,payload:{selection:e,actionSource:t}}),Qt(a,s,e)},Yt=({actionSource:e,skipLogging:t}={})=>zt({actionSource:e,skipLogging:t,selection:i.createSelection()}),Jt=({unsortedFiles:e})=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=i.user$1(a());t({type:i.ActionTypes$3.SET_UNSORTED_FILES,payload:{unsortedFiles:e}}),i.initializeStore(o,e.toArray())}));const Kt=({unsortedFiles:e})=>(t,o)=>{const a=i.filePathsToSelectOnNextUpdate(o()).toArray().map((e=>e.toLowerCase())),s=e.toArray().filter((e=>a.includes(e.fq_path.toLowerCase()))).map((e=>e.fq_path.toLowerCase())),n=a.filter((e=>!s.includes(e.toLowerCase())));0!==s.length&&(t(Pt({fqPathsToSelect:s})),t(qt({filePathsToSelectOnNextUpdate:i.immutableExports.Set(n)})))},Qt=(e,t,o)=>{if(!o||0===o.selected.count())return;const a=i.unsortedFiles(t()),s=null==a?void 0:a.filter((e=>o.selected.has(e.fq_path)&&!e.thumbnail_url_tmpl)),n=[];if(null==s||s.forEach((e=>{n.push({file_id:e.file_id,sj_id:e.sjid,ns_id:e.ns_id})})),n.length>0){const o=i.user$1(t()).id;e(i.loadPreviewThumbnails(n,o,i.BROWSE_FILES_VIEW_ID))}},Zt=e=>(t,o)=>{const a=i.user$1(o());t({type:i.ActionTypes$3.SET_RIGHTRAIL_IS_COLLAPSED,payload:{collapsed:e}}),i.setIsCollapsed(a.id,e)},Xt=e=>({type:i.ActionTypes$3.SET_EXPANDED_BLADE,payload:{expandedBlade:e}});t.CONFLICT_POPUP_BUTTON=j,t.CONFLICT_POPUP_CONTENT=V,t.CONFLICT_POPUP_CONTENT_YOU=$,t.CONFLICT_POPUP_TITLE=B,t.CONFLICT_POPUP_TITLE_YOU=q,t.DESCRIPTION_LAST_EDIT=x,t.DESCRIPTION_LAST_EDIT_EMPTY=k,t.DESCRIPTION_LAST_EDIT_EMPTY_YOU=P,t.DESCRIPTION_LAST_EDIT_YOU=U,t.DESCRIPTION_PLACEHOLDER_RIGHT_RAIL=S,t.DESCRIPTION_SAVE_DELAY_MS=3e3,t.ERROR_SHARE_MEMBER_FOLDER=T,t.ERROR_SHARE_NO_PERMISSION=v,t.FOLDER_OVERVIEW_EDITOR_EDITING=A,t.FolderOverviewSelectors=Ae,t.PIN_TO_MODAL_TITLE_MULTIPLE=D,t.PIN_TO_MODAL_TITLE_SINGLE=M,t.SHARING_MODAL_MESSAGE_PARENT_FOLDER=O,t.SHARING_MODAL_MESSAGE_PARENT_FOLDER_NO_NAME=R,t.SHARING_MODAL_MESSAGE_SAME_FOLDER=w,t.SHARING_MODAL_MESSAGE_SAME_FOLDER_NO_NAME=N,t.addContentReferences=Qe,t.addContentReferencesForPath=({path:e,files:t,currentPath:a,snackbarConfig:s})=>(n,r)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=X(r());try{yield((e,t,o)=>we.ns("files").rpc("add_content_references_to_path",{path:t,return_roots_as_ns_ids:!0,file_ids:o},{subjectUserId:e}))(o.id,e,t.map(i.fileToContentReferenceId)),s?Ke(s):a!==e?i.Snackbar.complete(l.intl.formatMessage({id:"Mflc9Z",defaultMessage:"{count, plural, one{Pinned {count} item to {folder}.} other{Pinned {count} items to {folder}.}}"},{count:t.length,folder:i.filename(e,i.Viewer.get_root_name(o))}),"folder-overview-pin"):Je(t.length);const d=z(r())[i.normalizePath(e)];d&&n(Ye({folderFileId:d,componentNamespace:"BROWSE"}))}catch(a){u.reportException({err:a,severity:f.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]});try{if("permission_denied"===a.error.status[".tag"]){const t=s?l.intl.formatMessage(C):l.intl.formatMessage(b,{path:i.filename(e,i.Viewer.get_root_name(o))});return void i.Snackbar.fail(t,"folder-overview-pin")}}catch(e){}i.Snackbar.fail(l.intl.formatMessage({id:"LYVKP8",defaultMessage:"{count, plural, one{Failed to pin {count} item to {folder}.} other{Failed to pin {count} items to {folder}.}}"},{count:t.length,folder:i.filename(e,i.Viewer.get_root_name(o))}),"folder-overview-pin")}})),t.addFileJumpKeyCode=({keyChar:e})=>(t,o)=>{const a=i.fileJumpFilter(o())+e.toLowerCase();t(Bt({fileJumpFilter:a}));let s=null;const n=i.fileJumpIndex(o());for(const{fqPath:e,filename:t}of n)if(t>=a){s=e;break}null!=s&&t(Pt({fqPathsToSelect:[s]}))},t.addFromGdrive=()=>({type:i.ActionTypes$3.ADD_FROM_GDRIVE}),t.addLoadedComponent=je,t.appInit=({props:e,user:t,viewer:o})=>a=>{a({type:i.ActionTypes$3.APP_INIT,payload:{props:e,user:t,viewer:o}}),a(i.loadScopedSortOrders({user:t,defaultSort:{sortField:i.SortField.FILENAME,sortDirection:i.SortDirection.ASCENDING}}))},t.appendFiles=({path:e,files:t,currentFolderInfo:o})=>(a,s)=>{if(!i.paths_are_equal(e,i.path$1(s())))return;if(i.selectedFilter(s())!==i.BrowseFilterType.NONE)return;const n=i.unsortedFiles(s()),r=n.size;let d=r;t.forEach((e=>{n.has(e.fq_path)||d++}));const l=n.merge(i.immutableExports.Map(t.map((e=>[e.fq_path,e]))));Jt({unsortedFiles:l})(a,s,ct),Kt({unsortedFiles:l})(a,s,ct),i.isFetchTagsOnBrowseEnabled(i.manualTaggingVariant$1(s()))&&(o=null!=o?o:i.getCurrentFolderInfo(s()),a(i.fetchTagsForFiles({user:i.user$1(s()),files:o?[...t,o]:[...t],override:0===r}))),i.user$1(s()).is_team&&ft(i.structuredTaggingVariant(s()))&&a(Dt({files:o?[...t,o]:[...t]})),bt.dispatch(i.pathLoaded({path:e})),l.size!==d&&u.reportException({err:new Error("appendFiles ended up with unexpected number of files."),tags:["browse_file_collections_mismatch"],severity:f.SEVERITY.NONCRITICAL,exc_extra:{previous_unsorted_files_size:r,incoming_files_size:t.length,expected_files_size:d,updated_unsorted_files_size:l.size,is_deleted_files_on:i.shouldShowDeletedFiles(s())}})},t.applyBoltUpdates=({path:t,updates:o})=>(s,n)=>{const{parent_changes:r}=o,d=i.user$1(n()),c=Date.now();if(new Promise((function(t,o){e(["./c_file_uploader_actions_adapter"],t,o)})).then((({ActionsAdapter:e})=>e.emit("boltUpdate",{ts:c}))),i.paths_are_equal(t,i.path$1(n()))){if(r&&r.change_to_fq_path)return((e,t)=>{switch(null!=t.change_type?t.change_type.toLowerCase():null){case"moved":i.Snackbar.complete(l.intl.formatMessage({id:"dte+6z",defaultMessage:"This folder has been moved"}),"browse-notification");break;case"renamed":i.Snackbar.complete(l.intl.formatMessage({id:"y/ubfn",defaultMessage:"This folder has been renamed to “{folder_name}”"},{folder_name:o(t.change_to_fq_path)}),"browse-notification");break;case"deleted":i.Snackbar.fail(l.intl.formatMessage({id:"MK7bBv",defaultMessage:"The folder “{folder_name}” has been deleted"},{folder_name:o(t.old_fq_path)}),"browse-notification")}function o(e){return a.escape(i.filename(e))}})(0,r),void Ht({path:r.change_to_fq_path})(s,n,ct);!function(e,t,o){const{mount_points:s}=o,n=i.path$1(t()),[r,d]=((e,t,o)=>{const i=e=>t===e;let s,n;return o&&o.find(i)?(n=o.find(i)||null,s=e[o.findKey(i)]||null):(n=null,s=a.find(e,i)||null),[n,s]})(s,n,i.mountPoints(t()));!r||d||i.isBackupBrowse()||i.Snackbar.complete(l.intl.formatMessage({id:"QB9ZqK",defaultMessage:"The folder was unshared."}),"browse-unshare");const c=((e,t,o)=>e&&!t?o:e&&t?i.paths_are_equal(e,t)?null:t:!e&&t?o:null)(r,d,n);if(c)return void e(Wt({path:c}));e($t({mountPoints:s}))}(s,n,o),function(e,t,o){const{added:a,moved:s,removed:n}=o,r=i.path$1(t());let d=i.unsortedFiles(t()),l=i.folderSizes(t()),c=d.size;const p={added:new Set([]),moved:new Set([]),removed:new Set([])};e(Ct(p)),d=d.withMutations((e=>{l=l.withMutations((t=>{const o=e=>i.paths_are_equal(i.parent_dir(e.fq_path),r),d=t=>{o(t)&&(e.set(t.fq_path,i.File.fromServerObject(t)),c+=1)},l=(o,a)=>{const i=e.get(o);if(i&&i.sjid>=a.sjid&&o===a.fq_path)return;e.remove(o),c-=1,d(a);const s=t.get(o);s&&(t.remove(o),t.set(a.fq_path,s))},p=o=>{e.remove(o),t.remove(o),c-=1};for(const t of a)e.has(t.fq_path)?l(t.fq_path,t):d(t);for(const[t,o]of s)e.has(t)?l(t,o):e.has(o.fq_path)?l(o.fq_path,o):d(o);for(const t of n){const o=e.find((e=>e.fq_path.toLowerCase()===t.toLowerCase()));o&&p(o.fq_path)}}))})),d.size!==c&&u.reportException({err:new Error("applyBoltUpdates ended up with unexpected number of items"),tags:["browse_file_collections_mismatch"],severity:f.SEVERITY.NONCRITICAL,exc_extra:{expected_unsorted_files_size:c,actual_unsorted_files_size:d.size,is_deleted_files_on:i.shouldShowDeletedFiles(t()),filesAdded:a,filesRemoved:n,filesMove:s}});d!==i.unsortedFiles(t())&&(Jt({unsortedFiles:d})(e,t,ct),bt.dispatch(i.filesChanged(r)));l!==i.folderSizes(t())&&e((({folderSizes:e})=>({type:i.ActionTypes$3.SET_FOLDER_SIZES,payload:{folderSizes:e}}))({folderSizes:l}));Kt({unsortedFiles:d})(e,t,ct)}(s,n,o),i.isTaggingEnabled(i.manualTaggingVariant$1(n()))&&function(e,t,o,a){if(0===o.moved.length)return;const s=[];for(const e of o.moved){const{fq_path:o}=e[1],a=i.selectFileByFullPath(t(),{path:o});void 0!==a&&s.push(a)}e(i.fetchTagsForFiles({user:a,files:s})),a.is_team&&ft(i.structuredTaggingVariant(t()))&&e(Dt({files:s}))}(s,n,o,d)}},t.areStructuredTagsEnabled=ft,t.clearSelection=Yt,t.completeFolderSizes=({fetchFolderSizeState:e})=>({type:i.ActionTypes$3.COMPLETE_FOLDER_SIZES,payload:{fetchFolderSizeState:e}}),t.createFolder=({pathName:e,folderName:t,user:a,checkFSWs:s,showShareModalOnSuccess:r,redirectOnSuccess:d,redirectOnCancel:l,selectCreatedFolder:c=!0,origin:p})=>(u,f)=>o.__awaiter(void 0,void 0,void 0,(function*(){u(jt({newFolderCreationState:i.NewFolderCreationState.SAVING_INPUT}));const o=yield n.createFolder({destination:e,name:t,user:a,checkFsw:s,origin:p,surface:"browse"});if(u(jt({newFolderCreationState:i.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),"success"===o.type){const e=n.folderFromFolderMetadata(o.folder);c&&u(Pt({fqPathsToSelect:[e.fq_path]})),d&&d(e.fq_path),r&&r(e,i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_NEW_FOLDER_MODAL)}else l&&l()})),t.descriptionAuthorSelector=ue,t.expandBlade=Xt,t.fetchDataForFolder=({path:e,nsId:t,componentNamespace:a,fetchContentReferences:s})=>(n,r)=>o.__awaiter(void 0,void 0,void 0,(function*(){let o,d=!1;const l=i.normalizePath(e),c=Date.now(),p=Z(r())[a];if(!p||0===p.requiredComponents.length){n(Xe({componentNamespace:a,requiredComponents:s?["content_references","description","draftjs"]:["description","draftjs"]}))}const f=[];try{const p=X(r()).id;o=z(r())[l];const u=o||J(r())[l]||t;if(!u)throw new Error("Unable to get file ID or NS ID for current folder");n(He({componentNamespace:a,hasFailedToLoad:!1}));let _=o?W(r())[o]:void 0;_&&_.descriptionLastUpdated&&c-_.descriptionLastUpdated<3e4?(d=!!_.descriptionBaseRevision,n(je({componentNamespace:a,component:"description"})),f.push(Promise.resolve(null))):(n(Ge({componentNamespace:a,component:"description"})),f.push(Ne(p,u))),_&&_.contentReferencesLastUpdated&&c-_.contentReferencesLastUpdated<3e4?(n(je({componentNamespace:a,component:"content_references"})),f.push(Promise.resolve(null))):s&&(n(Ge({componentNamespace:a,component:"content_references"})),f.push(Re(p,u)));const[m,h]=yield Promise.all(f);if(m&&(o=m.file_obj_id),!o)throw new Error("Did not get a file ID from the Sprinkle description payload");n({type:i.ActionTypes$5.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:{[i.normalizePath(e)]:o}}}),d=!!m&&dt(n,o,m,a,c),h&&lt(n,o,h,d,a,c),_=W(r())[o],_&&_.sharedFolderPath||n(ot({path:e})),_&&_.loggingFileId||n(it({path:e})),n($e({folderFileId:o}))}catch(t){u.reportException({err:t,severity:"non-critical",exc_extra:{path:e}}),n(He({componentNamespace:a,hasFailedToLoad:!0}))}})),t.fileRename=({file:e,newFile:t})=>({type:i.ActionTypes$6.FILE_RENAME,payload:{file:e,newFile:t}}),t.folderOverviewFolderFileId=Te,t.folderOverviewLiveUpdateManager=Me,t.folderOverviewPinnedItems=ve,t.getFolderAccess=({userId:e,sharedFolderId:t,accountId:o,accountEmail:a})=>we.ns("files").rpc("has_folder_access",{shared_folder_id:t,account_id:o,account_email:a},{subjectUserId:e}),t.handleAppCleanup=()=>({type:i.ActionTypes$3.HANDLE_APP_CLEANUP}),t.handlePrefetch=({path:e,content_references:t,description:a,componentNamespace:s,ts:n=Date.now()})=>r=>o.__awaiter(void 0,void 0,void 0,(function*(){try{const o=a||{},d=t||{},l=o.file_obj_id;if(!l)throw new Error("Did not get a file ID from the Odyssey prefetch payload");r({type:i.ActionTypes$5.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:{[i.normalizePath(e)]:l}}});const c=o&&dt(r,l,o,s,n);d&&lt(r,l,d,c,s,n)}catch(t){u.reportException({err:t,severity:"non-critical",exc_extra:{path:e}}),r(He({componentNamespace:s,hasFailedToLoad:!0}))}})),t.hideRewind=()=>({type:i.ActionTypes$3.HIDE_TIMELINE,payload:{}}),t.logFolderOverviewAction=Ve,t.makeDescriptionBaseRevisionSelector=()=>i.createSelector(te,(e=>e?e.descriptionBaseRevision:void 0)),t.makeDescriptionContentSelector=()=>i.createSelector(ne,(e=>e)),t.makeDescriptionFormatValidSelector=()=>i.createSelector(se,(e=>{if(!e)return!0;const t=e.split(".").map((e=>parseInt(e,10)));return!(t[0]>L[0])&&!(t[0]===L[0]&&t[1]>L[1])})),t.makeDescriptionHasFocusSelector=()=>i.createSelector(ee,(e=>!!e&&e.descriptionHasFocus)),t.makeDescriptionSaveStateSelector=()=>i.createSelector(te,(e=>e?e.descriptionSaveState:void 0)),t.makeDoesFolderOverviewExistSelector=()=>i.createSelector(te,(e=>!!e&&(!!e.descriptionBaseRevision||!!e.contentReferencesRevision))),t.makeFolderFileIdSelector=pe,t.makeFolderNsIdSelector=()=>i.createSelector(K,(e=>e)),t.makeHasFailedToLoadSelector=ce,t.makeHasUnsavedDescriptionDraftSelector=()=>i.createSelector(te,i.hasUnsavedDescriptionDraft),t.makeHaveAllComponentsLoadedSelector=le,t.makeIsFolderOverviewEmptySelector=()=>i.createSelector(de,re,((e,t)=>e&&!(t&&t.length))),t.makeLastModifiedTimeSelector=()=>i.createSelector(ie,(e=>{var t;return null!==(t=null==e?void 0:e.timestamp)&&void 0!==t?t:void 0})),t.makeLastModifiedUserIdSelector=()=>i.createSelector(ae,(e=>e)),t.makeLastModifiedUserSelector=()=>i.createSelector(ae,Q,((e,t)=>e?t[e]:void 0)),t.makeLoggingFileIdSelector=fe,t.makeOverviewResourceExtras=qe,t.makePinnedItemsSelector=_e,t.makeSharedFolderIdSelector=()=>i.createSelector(K,(e=>{if(e)return i.extractSharedFolderId(e)})),t.makeSharedFolderNameSelector=()=>i.createSelector(oe,(e=>e?i.filename(e):void 0)),t.makeSharedFolderPathSelector=()=>i.createSelector(oe,(e=>e)),t.paginatedTotalNumFiles=Ie,t.pasteFilesFromClipboard=({copyFiles:e,moveFiles:t})=>(o,a)=>{const s=a(),n=i.user$1(s),{files:r,action:d}=i.clipboard(a()),l=i.path$1(a());r.length<=0||("cut"===d?(i.paths_are_equal(i.parent_dir(r[0].fq_path),l)||t({user:n,files:r,newPath:"/"===l?"":l,checkFSWs:!0}),o(kt({clipboard:{files:[]}}))):e({user:n,newPath:"/"===l?"":l,filesPath:r,source:"browse",isPasteAction:!0}))},t.popBoltIgnore=Ct,t.pushBoltIgnore=e=>({type:i.ActionTypes$3.PUSH_BOLT_IGNORE,payload:e}),t.refreshPinnedItems=()=>(e,t)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=Te(t());e(Ye({folderFileId:o,componentNamespace:i.BrowseFolderOverviewComponentNamespace}))})),t.reloadContentReferences=Ye,t.reloadDescription=({folderFileId:e,componentNamespace:t})=>(a,i)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=X(i());try{const i=yield Ne(o.id,e);a(Ze({fileId:e,folderData:{descriptionBaseRevision:""}})),We(i,a,t)}catch(t){u.reportException({err:t,severity:f.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:e,isReload:!0}})}})),t.removeContentReferences=({folderFileId:e,fileIds:t,componentNamespace:a,snackbarConfig:s})=>(n,r)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=X(r()).id;try{yield((e,t,o)=>we.ns("files").rpc("remove_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:o},{subjectUserId:e}))(o,e,t),s?i.Snackbar.show(c.reactExports.createElement(i.Snackbar,{title:l.intl.formatMessage(y,{folderName:s.folderName}),variant:"complete",actionButtonText:l.intl.formatMessage({id:"GUtve/",defaultMessage:"Undo"}),closeButtonText:l.intl.formatMessage({id:"HBT96k",defaultMessage:"Close"}),onActionClick:()=>{i.Snackbar.close("folder-overview-unpin"),n(Qe({folderFileId:e,fileIds:t,componentNamespace:a,snackbarConfig:s}))},timeoutDelayMs:5e3,id:"folder-overview-unpin"})):i.Snackbar.generic(l.intl.formatMessage({id:"0bkx9E",defaultMessage:"{count, plural, one{Unpinned {count} item.} other{Unpinned {count} items.}}"},{count:t.length}),"folder-overview-unpin"),n(Ye({folderFileId:e,componentNamespace:a}))}catch(e){u.reportException({err:e,severity:f.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),t.requestFolderSizes=({fqPath:e})=>({type:i.ActionTypes$3.REQUEST_FOLDER_SIZES,payload:{fqPath:e}}),t.resetFileJumpFilter=()=>(e,t)=>{i.logKeyboardShortcutUsage({user_id:i.user$1(t()).id,keyboard_shortcut_type:"jump",view_type:i.selectViewType(t(),{instanceId:i.BROWSE_FILES_VIEW_ID})}),e(Bt({fileJumpFilter:""}))},t.saveDescriptionDraft=({folderFileId:e,componentNamespace:t})=>(a,s)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=X(s());try{const a=W(s())[e];if(!a||!tt(a))return;r({descriptionSaveState:i.DescriptionSaveState.SAVING});const n=yield((e,t,o,a,i)=>new Oe(e).ns("files").rpc("set_description",{file_id:t,current_revision_id:o,text:a,format_version:i},{subjectUserId:e.id}))(o,e,a.descriptionLatestRevision,a.descriptionDraft,L.join(".")),d=Z(s())[t];(null==d?void 0:d.descriptionHasFocus)||void 0===a.descriptionOpenedAtRevision||et(a);const{text:l,latest_revision_id:c,last_modified_time:p,last_modified_user:u}=n;r({description:l,descriptionSaveState:i.DescriptionSaveState.IDLE,descriptionLastModified:{timestamp:p,userId:u},descriptionBaseRevision:c,descriptionLatestRevision:c});const f="BROWSE"===t?i.ActionSurfaceLogValue.CENTER_PANE:i.ActionSurfaceLogValue.RIGHT_SIDEBAR,_="search-sidebar"===t?i.RetrievalSourceValue.SEARCH:i.RetrievalSourceValue.BROWSE;(({folderFileId:e,loggingFileId:t,action_surface:o,retrievalSource:a})=>{const s=i.getStoreForFolderOverview().getState();Ve(i.WebUserActionLogEvent.FOLDER_OVERVIEW_EDITED,X(s).id,null,Be({folderFileId:e,loggingFileId:t,action_surface:o,retrievalSource:a}))})({folderFileId:e,action_surface:f,retrievalSource:_,loggingFileId:a.loggingFileId})}catch(t){(n=t).error&&n.error.status&&"conflict"===n.error.status[".tag"]?(r({descriptionSaveState:i.DescriptionSaveState.CONFLICT,descriptionLastModified:{userId:void 0}}),a(rt({folderFileId:e}))):(e=>e.error&&e.error.status&&"bad_format_version"===e.error.status[".tag"])(t)?(i.Snackbar.fail(g,"folder-overview"),r({descriptionSaveState:i.DescriptionSaveState.ERROR})):(i.Snackbar.fail(E,"folder-overview"),r({descriptionSaveState:i.DescriptionSaveState.ERROR}))}var n;function r(t){a(Ze({fileId:e,folderData:t}))}})),t.selectFilesByFqPath=Pt,t.setAndStoreSortOrder=e=>(t,o)=>{const a=o(),s=i.user$1(a);i.logSortRecords({uid:s.id,sort_by:e.sortField,sort_direction:e.sortDirection,view_type:i.selectViewType(a,{instanceId:i.BROWSE_FILES_VIEW_ID})}),t(i.setSort({user:s,sort:e,viewScope:i.selectViewTypeScope$1(a,{instanceId:i.BROWSE_FILES_VIEW_ID}),updateGlobalScope:!0})),t((({sortOrder:e})=>({type:i.ActionTypes$3.SET_SORT_ORDER,payload:{sortOrder:e}}))({sortOrder:e}))},t.setBrowsePostTTIData=({browsePostTTIData:e})=>{const t=Object.assign({},e);return Object.keys(t).forEach((e=>{void 0===t[e]&&delete t[e]})),{type:i.ActionTypes$3.SET_BROWSE_POST_TTI_DATA,payload:{browsePostTTIData:t}}},t.setBrowsePostTTIExperiments=({browsePostTTIExperiments:e})=>({type:i.ActionTypes$3.SET_BROWSE_POST_TTI_EXPERIMENTS,payload:{browsePostTTIExperiments:e}}),t.setCanDisplayFolderSizes=({canDisplayFolderSizes:e})=>({type:i.ActionTypes$3.SET_CAN_DISPLAY_FOLDER_SIZES,payload:{canDisplayFolderSizes:e}}),t.setContext=Ut,t.setCreateMenuOpenRequest=e=>({type:i.ActionTypes$3.SET_CREATE_MENU_OPEN_REQUEST,payload:{createMenuOpenRequest:e}}),t.setCurrentFolderInfo=xt,t.setDescriptionHasFocus=({componentNamespace:e,descriptionHasFocus:t,folderFileId:o})=>(a,s)=>{const n=Z(s())[e];if(t&&n&&!n.descriptionHasFocus){const e=W(s())[o].descriptionBaseRevision;a(Ze({fileId:o,folderData:{descriptionLatestRevision:e,descriptionOpenedAtRevision:e}}))}else if(!t&&(null==n?void 0:n.descriptionHasFocus)){const e=W(s())[o];e&&(null==e?void 0:e.descriptionOpenedAtRevision)!==(null==e?void 0:e.descriptionLatestRevision)&&(et(e),a(Ze({fileId:o,folderData:{descriptionOpenedAtRevision:void 0}})))}a({type:i.ActionTypes$5.SET_DESCRIPTION_HAS_FOCUS,payload:{componentNamespace:e,descriptionHasFocus:t}})},t.setFilePathsToSelectOnNextUpdate=qt,t.setFilesToClipboard=({clipboard:e})=>t=>{const{files:o}=e;o.length&&(o.some((e=>e.isDeleted||e.is_unmounted))?i.Snackbar.fail(l.intl.formatMessage({id:"jdnaZR",defaultMessage:"Deleted files cannot be added to the clipboard"}),"browse-clipboard-copy"):o.some(i.File.isTeamSharedFolder)||o.some(i.File.isTeamMemberFolder)?i.Snackbar.fail(l.intl.formatMessage({id:"0Nkg/N",defaultMessage:"Team Folders cannot be added to the clipboard"}),"browse-clipboard-copy"):o.some(i.File.isFamilySharedFolder)?i.Snackbar.fail(l.intl.formatMessage({id:"KMcV0/",defaultMessage:"Family shared folders cannot be added to the clipboard"}),"browse-clipboard-copy"):o.some((e=>e.type===i.FileTypes.VAULT_FOLDER))?i.Snackbar.fail(l.intl.formatMessage({id:"La991r",defaultMessage:"{TRADEMARK_VAULT} cannot be added to the clipboard"},{TRADEMARK_VAULT:_.TRADEMARK_VAULT}),"browse-clipboard-copy"):(i.Snackbar.complete(l.intl.formatMessage({id:"BvUPS9",defaultMessage:"{count, plural, one{Added {count} item to clipboard.} other{Added {count} items to clipboard.}}"},{count:o.length}),"browse-clipboard-copy"),t(kt({clipboard:e}))))},t.setFilterTypes=e=>({type:i.ActionTypes$3.SET_FILTER_TYPES,payload:{filterTypes:i.immutableExports.Set(e)}}),t.setFilteredViewData=(e,t)=>(a,s)=>o.__awaiter(void 0,void 0,void 0,(function*(){const o=i.user$1(s()).id;if(e!==i.BrowseFilterType.NONE){a(Vt({loadingState:i.LoadingState.UPDATING_FILTERED_VIEW,path:t}));try{if(e===i.BrowseFilterType.STARRED){const e=function(e){const t=(e||[]).filter((e=>void 0!==e.file_info)).map((e=>{const t=e.file_info.fq_path,o=i.File.fromApiV2Object(e.file_info);return t?o:new i.File(Object.assign(Object.assign({},o),{fq_path:e.file_info.ns_path||"",icon:e.file_info.icon||""}))})).filter((e=>!!e.fq_path));return i.immutableExports.Map(t.map((e=>[e.fq_path,e])))}((yield i.fetchStarred(o)).paginated_file_info);Jt({unsortedFiles:e})(a,s,ct)}else if(e===i.BrowseFilterType.RECENTS){const e=function(e){if(!e)return i.immutableExports.Map([]);const t=e.filter((e=>void 0!==e.item&&"paginated_file_info"===e.item[".tag"])).map((e=>{const t=e.item,o=t.file_info.fq_path,a=i.File.fromApiV2Object(t.file_info);return o?a:new i.File(Object.assign(Object.assign({},a),{fq_path:t.file_info.ns_path||"",icon:t.file_info.icon||""}))})),o=e.filter((e=>e.item&&"legacy_paper_info"===e.item[".tag"])).map((e=>{const t=e.item;return i.File.fromRecentsV2LegacyPaper(t)})),a=t.concat(o).filter((e=>!!e.fq_path));return i.immutableExports.Map(a.map((e=>[e.fq_path,e])))}((yield i.fetchRecents(o,i.DEFAULT_RECENTS_LIMIT)).recent_items);Jt({unsortedFiles:e})(a,s,ct)}a(Vt({loadingState:i.LoadingState.LOADED,path:t}))}catch(e){a(Vt({loadingState:i.LoadingState.LOAD_ERROR,path:t}))}}})),t.setFolderMemberCounts=e=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const{contentId:o,userId:s}=e;let n;n=i.isInsideBackupFolder(a())?1:yield i.getFolderMemberCounts(o,s),t({type:i.ActionTypes$3.SET_FOLDER_MEMBER_COUNTS,payload:{value:n}})})),t.setFolderSizesPending=({fetchFolderSizesResp:e})=>({type:i.ActionTypes$3.SET_FOLDER_SIZES_PENDING,payload:{fetchFolderSizesResp:e}}),t.setHideFilesAndSidebar=({shouldHideFilesAndSidebar:e})=>({type:i.ActionTypes$3.SET_HIDE_FILES_AND_SIDEBAR,payload:{shouldHideFilesAndSidebar:e}}),t.setInlineOverflowMenuOpenRequest=e=>({type:i.ActionTypes$3.SET_INLINE_OVERFLOW_MENU_OPEN_REQUEST,payload:{inlineOverflowMenuOpenRequest:e}}),t.setIsFileViewerShown=({isShown:e})=>({type:i.ActionTypes$3.SET_IS_FILE_VIEWER_SHOWN,payload:{isShown:e}}),t.setIsRewindButtonEnabled=e=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const{path:o,userId:a,userSkuHasRewind:s}=e;if(!s)return void t({type:i.ActionTypes$3.SET_IS_REWIND_ENABLED,payload:{value:!0}});const n=yield i.isRewindButtonEnabled(o,a);t({type:i.ActionTypes$3.SET_IS_REWIND_ENABLED,payload:{value:!!n.can_rewind}})})),t.setLoadingState=Vt,t.setMountPoints=$t,t.setNewFolderCreationState=jt,t.setOverflowMenuCloseRequest=e=>({type:i.ActionTypes$3.SET_OVERFLOW_MENU_CLOSE_REQUEST,payload:{overflowMenuCloseRequest:e}}),t.setOverflowMenuCoordinates=e=>({type:i.ActionTypes$3.SET_OVERFLOW_MENU_COORDINATES,payload:{overflowMenuCoordinates:e}}),t.setOverflowMenuOpenRequest=e=>({type:i.ActionTypes$3.SET_OVERFLOW_MENU_OPEN_REQUEST,payload:{overflowMenuOpenRequest:e}}),t.setPaginatedTotalNumFiles=Gt,t.setPath=Wt,t.setPathData=({path:t,files:o,paginatedTotalNumFiles:a,context:s,currentFolderInfo:n})=>(r,d)=>{if(!i.paths_are_equal(t,i.path$1(d())))return;const l=i.immutableExports.Map(o.map((e=>[e.fq_path,e])));r(Ut({context:s})),r(xt({currentFolderInfo:n})),Jt({unsortedFiles:l})(r,d,ct),r(Gt({paginatedTotalNumFiles:a})),r(Yt({skipLogging:!0})),Kt({unsortedFiles:l})(r,d,ct),i.isFetchTagsOnBrowseEnabled(i.manualTaggingVariant$1(d()))&&r(i.fetchTagsForFiles({user:i.user$1(d()),files:n?[...o,n]:[...o],override:!0})),i.user$1(d()).is_team&&ft(i.structuredTaggingVariant(d()))&&r(Dt({files:n?[...o,n]:[...o]})),setTimeout((()=>{bt.dispatch(i.pathLoaded({path:t}));const o={path:t,hasPermissionToUploadToFolder:s.isCurrentPathWriteable(),isMovingIntoVault:s.isInsideVaultFolder};new Promise((function(t,o){e(["./c_data_slice"],t,o)})).then((function(e){return e.slice_esnext})).then((({uploadActionCreators:e})=>{r(e.setPath(o))}))}),1)},t.setRightRailIsCollapsed=Zt,t.setSelection=zt,t.setShouldShowDeletedFiles=({shouldShowDeletedFiles:e})=>({type:i.ActionTypes$3.SET_SHOULD_SHOW_DELETED_FILES,payload:{shouldShowDeletedFiles:e}}),t.setUnsortedFiles=Jt,t.setUrl=Ht,t.setViewType=e=>(t,o)=>{const a=o();t(i.setViewType({user:i.user$1(a),viewType:e,viewTypeScope:i.selectViewTypeScope(a),updateGlobalScope:!0}))},t.shouldShowFamilyEmptyState=Fe,t.shouldShowVaultEmptyState=ye,t.showRewind=()=>({type:i.ActionTypes$3.SHOW_TIMELINE,payload:{timestamp:(new Date).getTime()}}),t.toggleSpacesEntryPoint=({value:e})=>({type:i.ActionTypes$3.TOGGLE_SPACES_ENTRY_POINT,payload:{value:e}}),t.updateFolderDataCache=Ze,t.updateStarredView=e=>(t,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){if(i.unsortedFiles(a()).has(e.fq_path)){const o=i.unsortedFiles(a()).delete(e.fq_path);Jt({unsortedFiles:o})(t,a,ct)}})),t.user=X}));
//# sourceMappingURL=c_data_action_creators_index.js-vflpmiDU1.map
