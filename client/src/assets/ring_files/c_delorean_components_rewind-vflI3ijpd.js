define(["exports","./e_edison","./e_ui_page_files_router","./c_data_action_creators_index","./c_history","./c_browse","./c_core_i18n","./c_action_bar_file_actions","./c_spectrum_tertiary_link_tertiary_list","./c_lodash-es_lodash","./c_tslib","./c_dig-illustrations_spot_files-old-2","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_core_xhr","./c_csrf","./c_browser_cookies","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","./c_files_view_file_actions_file_from_metadata","./c_file_actions_strings","./c_browse_crypto_subtle_digest","./c_ux_analytics_dispatch_custom_event","./c_bug_reporting_routing","./c_pagelet_logger","./c_pagination_manager","./c_browse_actions","./c_action_bar_file_actions_logging","./c_files_view_file_actions_snackbars","./c_sync_everything_hive_logger","./c_pap-events_previews_rename_file","./c_sharing_async_share_modal_util","./c_flows_utils_async_modal_launchers","metaserver/static/js/modules/constants/global_file_upload","./c_browse_file_actions_action_handlers","./c_views_copy_link_mini_modal","./c_share_modal_evolution_utils_logging","./c_src_utils_logging","./c_components_sharing_spinner","./c_truncate_index","./c_clipboard_v3","./c_sharing_ui_util","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","./c_sharing_settings_utils_sharing_settings_util","./c_udcl_index","./c_downloads","metaserver/static/js/modules/core/langpack","./c_extensions_cloud_docs_compat","./c_integrations_data_selectors","./c_share_download_ui_api","./c_browse_interface","./c_ui_async_overquota_modal_controller","./c_file_viewer_async_controller","./c_file_viewer_logging_performance","./c_cloud_docs_gdd_migration_gdd_ui_blocking","./c_plusplus_file_actions","./c_vault_constants","./c_file_viewer_file_extension_extension_constants","./c_gdd_migration_ui_utils","./c_profile_services_profile_services_link","./c_profile_services_profile_services_constants","metaserver/static/js/modules/constants/login_and_register","./c_file_imports_gdrive_file_picker","./c_components_modals_show_modal","./c_spectrum_modal_utility_modal","./c_spectrum_icon_form_index","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_exenv_index","./c_ux_analytics_modal_tracking","./c_file_transfers_async_browse_entry_point_onboarding_modal_async","./c_starred_actions","./c_starred_constants","./c_starred_star","./c_common_uuid","./c_files_view_files_view_logging","./c_sharing_browse_exports","./c_unity_features","metaserver/static/js/modules/constants/unity","./c_file_store_utils","./c_file_transfers_lib_urls","./c_src_common_constants2","./c_browse_tts","./c_pap-events_navigation_navigate_to_edit","./c_file_uploader_upload_kit_provider","./c_file_uploader_utils","./c_pap-events_enums_file_type-utils","./c_base64","./c_upload_kit_lib_types","./c_file_uploader_result_type","./c_file_uploader_actions_adapter","./c_data_store","./c_data_slice","./c_upload_kit_scheduler_types","./c_upload_kit_uploader_context","./c_upload_kit_utils_path","./c_upload_kit_uploader_upload_abort_controller","./c_resize-observer-polyfill_dist_ResizeObserver","./c_src_simple-action-bar_inline_action_bar","./c_src_simple-action-bar_action_bar_types","./c_src_highlighted-truncated-string_em-string","./c_components_add-content-menu_index","./c_action_bar_action_bar_strings","./c_cloud_docs_create_api","./c_hive_schemas_web-modal-activity","./c_folder_dialog_async","./c_pap-events_navigation_select_create_menu","./c_spectrum_icon_partners_index","./c_flows_redux_store","./c_flows_redux_reducer","./c_flows_lib_api","./c_flows_logging_flows_loggers","./c_src_common_constants","./c_flows_constants","./c_capture_sdk_helpers","./c_capture_redux_selectors","./c_capture_async_recorder","./c_file_uploader_types","./c_flows_utils_exposure_logger","./c_file_actions_portable_select_destination","./c_naming_conventions_utils","./c_flows_redux_selectors","./c_modal_filters_view_tidy_filters","./c_components_item_truncation_container","./c_hooks_resize_observer","./c_form_row_index","./c_folder_dialog_folder_picker_dig","./c_table_columns_file_name_column","./c_src_table","./c_react-table_index","./c_src_icons_file_icon","./c_src_icons_file_icon_extensions","./c_combinations_index","./c_spectrum_icon_arrow_index","./c_keymaster","./c_breadcrumb_index","./c_flows_redux_actions","./c_components_loading_indicator","./c_sharing_share_modal_util","./c_account_email","./c_account_email_verify_reasons","./c_ui_modal_dig","./c_ui_input_dig","./c_pass_store","./c_core_types_preview_type","./c_file_viewer_utils","./c_core_logging_constants","./c_sharing_share_page_action_types","metaserver/static/js/modules/constants/python","./c_flux_base_store","./c_src_utils_clipboard","./c_hooks_lib_index","./c_components_icons_icon_dropdown_selected","./c_components_sharing_modal_banner","./c_es_src_dropbox","./c_typeahead_index","./c_sharing_ui_notifications_util","./c_deprecated_ajax_ajax_form_extract_errors","./c_sharing_confirmation_modals_reset_access_modal","./c_tabs_index","./c_sharing_content_manager","./c_spectrum_colorized_icon","./c_sharing_upsells_util","./c_ui_flag","./c_icon_folder_icon","./c_integrations_hellosign_deep_integration_constants","./c_docsend_analytics_add_on_data_apiUtils","./c_docsend_src_utils","./c_flux_store_listener","./c_ui_bubble_dropdown_v2","./c_ui_overlay","./c_raf_throttle","./c_components_auto-folder-setup-checkbox_index","./c_icon_file_icon","./c_ui_title_bubble","./c_avatar_initials_avatar","./c_avatar_size","./c_spectrum_avatar_avatar_initials","./c_prop-types_index","./c_spectrum_positioned_portal","./c_spectrum_dropdown_button","./c_integrations_profile_card_popover","./c_integrations_profile_card_tooltip","./c_src_text","./c_src_instrumentation_common_context","./c_src_instrumentation_constants","./c_src_instrumentation_function_wrapper","./c_spectrum_tooltip","./c_contacts_data_v2","./c_contacts_bloodhound","metaserver/static/js/modules/constants/contacts","./c_utils_contacts_tokenizer_contacts_tokenizer_util","./c_spectrum_culled_list","./c_spectrum_util_raf_throttle","./c_components_approval-forms_approval_checkbox_in_share","./c_flows_approval_approval_io_client","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments","./c_sharing_member_avatars","./c_ui_tooltip","./c_collections_utils_file","./c_onboarding_checklist_async_share_button_tooltip","./c_jquery","./c_Key","./c_growth_ui_send_app_link_form","./c_auth_authenticator","./c_security_crypto","./c_experiments_provider","./c_file_info_utils","./c_browse_selection_indicator","./c_capture_api","./c_browse_element_width","./c_spectrum_media_table_skeleton","./c_spectrum_media_table_media_cell","./c_spectrum_overflow_button","./c_icon_templates_actionable_index","./c_spectrum_dimensions","./c_spectrum_vertically_fixed","./c_campaigns_campaigns_element_id_enum","./c_files_view_keyboard_shortcuts","./c_action_bar_action_bar_constants","./c_ui_selectable_list","./c_filename_highlights","./c_src_highlighted-truncated-string_index","./c_files_view_file_thumbnail","./c_icon_file_folder_icon","./c_icon_shortcuts_icon","./c_tagging_components_tags_container","./c_sync_everything_utils_deep_link_utils","./c_core_custom_protocol","./c_web_util_errors","./c_react_query_api_helpers_queries_search_experiments","./c_extensions_split_share_button","./c_aspect_ratio_index","./c_src_common_file","./c_pap-events_filesystem_item_actions_unstar_file","./c_content_suggestions_suggest_nonempty","./c_ui_section_section_empty_text","./c_content_suggestions_suggested_file_card","./c_ui_section_header_tooltip","./c_ui_section_section_header","./c_api_v2_team_client","./c_error_boundary","./c_react-error-boundary","./c_file_actions_portable_copy","./c_ui_fileops_actions","./c_file_uploader_add_more_files_menu","./c_file_uploader_action_logger","./c_api_v2_redux_files","./c_right_rail_file_activity_file_activity_blade","./c_info_blade_content_metadata_image_metadata","./c_components_approval-forms_approval_metadata","./c_components_approval-forms_url_utils","./c_comments_component_pane","./c_comments_data_store","./c_src_right-rail_hooks","./c_components_approval-forms_gating_utils","./c_components_spacer_index","./c_components_utils_throttle-debounce","./c_spectrum_popover_popover_content","./c_components_section_tags_section_preview","./c_tagging_components_tags_search","./c_components_flows-icon-button_index","./c_workflow_builder_workflow_actions_action_ui_config","./c_ui_tree_view","./c_ui_hoc","./c_plugin_utils_tilingFunc","./c_plugin_utils_getImageDefaultSizes","./c_flows_version_change_log_section","./c_file_activity_component_file_activity_blade","./c_list_index","./c_file_activity_data_store","./c_trash_constants","./c_proto_edison_redirect_messages_pb","./c_hooks_use_stabilized_callback","./c_maestro_layout_search","./c_edison_ui_spa_chrome","./c_onboarding_checklist_constants","./c_security_csrf_hmac","./c_sync_everything_strings","./c_unity_check_file_cache","./c_flows_conversions_conversion_actions","./c_flows_conversions_convert","./c_flows_utils_browse_logger","./c_flows_flows_client","./c_growth_ui_teams_web_actions_logger_events","./c_sharing_wizard_async_wizard_modals","./c_file_actions_portable_move","./c_extensions_extensions_menu_component_v2","./c_extensions_extensions_utils","metaserver/static/js/modules/constants/payments","metaserver/static/js/modules/constants/reel","./c_pap-events_previews_select_share_menu","./c_shallow_equal","./c_flows_approval_approval_request_modal","./c_components_saver_modal_index","./c_collections_utils_file_identifier","./c_collections_utils_thumbnails","./c_collections_lib_survey","./c_conversions_actions_unzip"],(function(e,t,s,a,i,o,r,n,c,l,d,p,_,h,u,g,m,v,f,w,y,R,x,b,k,P,E,M,N,D,$,C,I,T,S,L,H,F,B,A,O,G,W,V,U,q,z,j,Q,X,J,Y,K,Z,ee,te,se,ae,ie,oe,re,ne,ce,le,de,pe,_e,he,ue,ge,me,ve,fe,we,ye,Re,xe,be,ke,Pe,Ee,Me,Ne,De,$e,Ce,Ie,Te,Se,Le,He,Fe,Be,Ae,Oe,Ge,We,Ve,Ue,qe,ze,je,Qe,Xe,Je,Ye,Ke,Ze,et,tt,st,at,it,ot,rt,nt,ct,lt,dt,pt,_t,ht,ut,gt,mt,vt,ft,wt,yt,Rt,xt,bt,kt,Pt,Et,Mt,Nt,Dt,$t,Ct,It,Tt,St,Lt,Ht,Ft,Bt,At,Ot,Gt,Wt,Vt,Ut,qt,zt,jt,Qt,Xt,Jt,Yt,Kt,Zt,es,ts,ss,as,is,os,rs,ns,cs,ls,ds,ps,_s,hs,us,gs,ms,vs,fs,ws,ys,Rs,xs,bs,ks,Ps,Es,Ms,Ns,Ds,$s,Cs,Is,Ts,Ss,Ls,Hs,Fs,Bs,As,Os,Gs,Ws,Vs,Us,qs,zs,js,Qs,Xs,Js,Ys,Ks,Zs,ea,ta,sa,aa,ia,oa,ra,na,ca,la,da,pa,_a,ha,ua,ga,ma,va,fa,wa,ya,Ra,xa,ba,ka,Pa,Ea,Ma,Na,Da,$a,Ca,Ia,Ta,Sa,La,Ha,Fa,Ba,Aa,Oa,Ga,Wa,Va,Ua,qa,za,ja,Qa,Xa,Ja,Ya,Ka,Za,ei,ti,si,ai,ii,oi,ri,ni,ci,li,di,pi,_i,hi,ui,gi,mi,vi,fi,wi,yi,Ri,xi,bi,ki,Pi,Ei,Mi,Ni,Di,$i,Ci,Ii,Ti,Si,Li,Hi,Fi,Bi,Ai,Oi,Gi,Wi,Vi,Ui,qi,zi,ji,Qi,Xi,Ji,Yi,Ki){"use strict";class Zi extends t.React$1.Component{constructor(){super(...arguments),this.onClick=()=>{this.props.clickClosePanel({closedByClick:!0})}}render(){return t.React$1.createElement("section",{className:"rewind-title"},t.React$1.createElement("div",{className:"rewind-title__header"},t.React$1.createElement("div",{className:"rewind-title__header-text"},t.React$1.createElement(s.Title,null,this.props.title)),t.React$1.createElement(s.Layer,{isPortaled:!1,_elevateByZ:1e4},t.React$1.createElement(s.Tooltip,{id:"tooltip-close",title:r.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),placement:"left"},t.React$1.createElement(s.IconButton,{className:"rewind-title__back","data-testid":"rewind-title-back",variant:"transparent",onClick:this.onClick},t.React$1.createElement(s.UIIcon,{"aria-label":r.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),src:s.CollapseRightLine}))))))}}Zi.displayName="DeloreanTitle";class eo extends t.React$1.Component{constructor(){super(...arguments),this.clickClosePanel=()=>{this.props.closePanel({closedByClick:!0})}}getTitle(){const{expFolderHistoryRollbacks:e,context:t}=this.props;return e?t.isCurrentlyInRoot?r.intl.formatMessage({id:"hiHRLr",defaultMessage:"Rewind Dropbox"}):r.intl.formatMessage({id:"eH7zsu",defaultMessage:"Rewind {folder}"},{folder:this.props.folderDisplayName}):r.intl.formatMessage({id:"BxyH89",defaultMessage:"Folder history"})}render(){return t.React$1.createElement(Zi,{title:this.getTitle(),clickClosePanel:this.clickClosePanel})}}eo.displayName="RewindTitle";class to extends t.React$1.Component{render(){return t.React$1.createElement(Zi,{title:r.intl.formatMessage({id:"BxyH89",defaultMessage:"Folder history"}),clickClosePanel:this.props.clickClosePanel})}}to.displayName="FolderHistoryTitle";const so=e=>{const{icon:a,text:i,link:o}=e;return t.React$1.createElement("div",{className:"restorations-education__other-option"},t.React$1.createElement(s.Link,{href:o,hasNoUnderline:!0,className:"restorations-education__link"},t.React$1.createElement("div",{className:"restorations-education__other-option__icon"},t.React$1.createElement(c.IconAction,{name:a})),t.React$1.createElement("div",null,i)))},ao=e=>{const{olderFileVersion:a,olderFolderVersion:i,deletedFile:o,user:c}=e;let l;if(n.shouldShowRewindsUpsell(c)){l=new t.URI({path:s.get_browse_root(c),query:{rewind:"true"}}).toString()}else l="https://help.dropbox.com/security/rewind";return t.React$1.createElement("div",{className:"restorations-education__other-options-container"},t.React$1.createElement("div",{className:"restorations-education__smaller-title"},t.React$1.createElement(s.Text,{isBold:!0},r.intl.formatMessage({id:"fVbjZ+",defaultMessage:"Don't want to rewind everything?"}))),t.React$1.createElement("div",{className:"restorations-education__other-options"},i&&t.React$1.createElement(so,{link:l,icon:"revert-folder",text:r.intl.formatMessage({id:"BpZmUk",defaultMessage:"Find an earlier version of a folder"})}),a&&t.React$1.createElement(so,{link:"/help/security/version-history-overview",icon:"view-version-history",text:r.intl.formatMessage({id:"vb45xv",defaultMessage:"Find an earlier version of a file"})}),o&&t.React$1.createElement(so,{link:"/deleted_files",icon:"delete",text:r.intl.formatMessage({id:"eLe6+W",defaultMessage:"Recover a deleted file"})})))},io=e=>{const{daysOfVersionHistory:a}=e;let i;return i=null==a?r.intl.formatMessage({id:"2xi5y3",defaultMessage:"Get your deleted files back, or delete them forever"}):r.intl.formatMessage({id:"Q4wsJE",defaultMessage:"{count, plural, one{Restore any file deleted in the last {count} day} other{Restore any file deleted in the last {count} days}}"},{count:a}),t.React$1.createElement("div",{className:"restorations-education__explanation-container"},t.React$1.createElement("div",{className:"restorations-education__title"},i),t.React$1.createElement("div",{className:"restorations-education__help"},t.React$1.createElement(s.Link,{href:"https://help.dropbox.com/security/recover-deleted-files-folders",hasNoUnderline:!0,className:"restorations-education__link"},r.intl.formatMessage({id:"9u9nEt",defaultMessage:"How to recover deleted files"})),t.React$1.createElement("div",{className:"restorations-education__df-help__image"},t.React$1.createElement(s.SpotIcon,{src:s.RestoreSpot}))))},oo=e=>{const{daysOfVersionHistory:a}=e;let i;return i=null==a?r.intl.formatMessage({id:"+d7V/q",defaultMessage:"Restore an older version of this file"}):r.intl.formatMessage({id:"YnH6gd",defaultMessage:"{count, plural, one{Restore any version from the past {count} day} other{Restore any version from the past {count} days}}"},{count:a}),t.React$1.createElement("div",{className:"restorations-education__explanation-container"},t.React$1.createElement("div",{className:"restorations-education__title"},i),t.React$1.createElement("div",{className:"restorations-education__help"},t.React$1.createElement(s.Link,{href:"https://help.dropbox.com/security/version-history-overview",hasNoUnderline:!0,className:"restorations-education__link"},r.intl.formatMessage({id:"rCUwSi",defaultMessage:"How version history works"})),t.React$1.createElement("div",{className:"restorations-education__help__image"},t.React$1.createElement(s.SpotIcon,{src:s.RestoreSpot}))))};s.requireCssWithComponent((e=>{const{daysOfVersionHistory:s,user:a}=e;return t.React$1.createElement("div",{className:"restorations-education",key:"restorations-education"},t.React$1.createElement(io,{daysOfVersionHistory:s}),t.React$1.createElement(ao,{olderFolderVersion:!0,olderFileVersion:!0,user:a}))}),["/static/metaserver/static/css/restorations-education-vflOmkIv9.css","/static/metaserver/static/css/dig-illustrations/index.web-vfl45hs-6.css"]);s.requireCssWithComponent((e=>{const{daysOfVersionHistory:s,user:a}=e;return t.React$1.createElement("div",{className:"restorations-education",key:"restorations-education"},t.React$1.createElement(oo,{daysOfVersionHistory:s}),t.React$1.createElement(ao,{olderFolderVersion:!0,deletedFile:!0,user:a}))}),["/static/metaserver/static/css/restorations-education-vflOmkIv9.css"]);const ro=s.requireCssWithComponent(ao,["/static/metaserver/static/css/restorations-education-vflOmkIv9.css"]);class no extends t.React$1.Component{constructor(){super(...arguments),this.logGoToHelpCenter=()=>{const{user:e,restoreId:t}=this.props;o.clickNUXHelp({user:e,restoreId:t})},this.onDismiss=()=>{const{user:e,restoreId:t}=this.props;o.clickNUXNext({user:e,restoreId:t}),this.props.dispatch(o.dismissNUXAction())}}render(){let e;const a=e=>t.React$1.createElement(s.Button$1,{className:"rewind-nux__help-center-button",variant:"transparent",onClick:this.logGoToHelpCenter,href:"https://help.dropbox.com/security/rewind"},e);if(this.props.versionHistoryLength){const t=Math.floor(this.props.versionHistoryLength/365);e=t>=1?r.intl.formatMessage({id:"8cC94q",defaultMessage:"Rewind your folder back to any time in the last {version_history_length, plural, one {# year} other {# years}}. <a>How Rewind works</a>"},{version_history_length:t,a:a}):r.intl.formatMessage({id:"KImBqp",defaultMessage:"Rewind your folder back to any time in the last {version_history_length} days. <a>How Rewind works</a>"},{version_history_length:this.props.versionHistoryLength,a:a})}else e=r.intl.formatMessage({id:"IBa7RM",defaultMessage:"Rewind your folder back to an earlier point in time. <a>How Rewind works</a>"},{a:a});return t.React$1.createElement("div",{className:"rewind-nux"},t.React$1.createElement("div",{className:"rewind-text"},t.React$1.createElement("div",{className:"rewind-text__image"},t.React$1.createElement("img",{alt:"",src:t.static_url("/static/metaserver/static/images/delorean/illo-folders@2x-vflmf44mp.png")})),t.React$1.createElement("div",{className:"rewind-text__title rewind-nux__title"},t.React$1.createElement(s.Title,{size:"small",isBold:!0},r.intl.formatMessage({id:"OdrdGa",defaultMessage:"Turn back the clock"}))),t.React$1.createElement("div",null,t.React$1.createElement(s.Text,{color:"faint"},e)),t.React$1.createElement(s.Button$1,{variant:"primary",className:"rewind-text__button",onClick:this.onDismiss},r.intl.formatMessage({id:"5LRbzr",defaultMessage:"Try Rewind"}))),t.React$1.createElement(ro,{deletedFile:!0,olderFileVersion:!0,user:this.props.user}))}}no.displayName="RewindNUX";class co{constructor(e){this.disposed=!1,this.shapes=[],this.animationTick=0,this.addLine=e=>(this.shapes.push(e),e),this.addSpline=e=>(this.shapes.push(e),e),this.addGradient=e=>(this.shapes.push(e),e),this.renderCanvas=()=>{if(window.requestAnimationFrame(this.renderCanvas),!this.invisible){this.context.save(),this.animationTick++,this.context.clearRect(0,0,this.width,this.height);for(const e of this.shapes)if(!e.invisible){if(this.context.save(),e.clip){const{topLeft:t,size:s}=e.clip;this.context.beginPath(),this.context.rect(t.x,t.y,s.x,s.y),this.context.clip()}this.renderShape(e),this.context.restore()}this.context.restore()}},this.renderShape=e=>"line"===e.type?this.renderLine(e):"spline"===e.type?this.renderSpline(e):"gradient"===e.type?this.renderGradient(e):o.assertNever(e),this.getColorValue=e=>"solid"===e.type?e.value:"pulse"===e.type?function(e,t,s){const a=parseInt(e.replace(/#/g,""),16),i=parseInt(t.replace(/#/g,""),16),o=a>>16,r=a>>8&255,n=255&a;return"#"+((1<<24)+(o+s*((i>>16)-o)<<16)+(r+s*((i>>8&255)-r)<<8)+(n+s*((255&i)-n))|0).toString(16).slice(1)}(e.start,e.end,(Math.sin(this.animationTick/20)+1)/2):o.assertNever(e),this.renderLine=e=>{if(this.context.beginPath(),this.context.strokeStyle=this.getColorValue(e.color),this.context.lineWidth=o.DEFAULT_GRAPH_LINE_WIDTH,e.dashed)if("pulsing"===e.dashed){const e=(Math.sin(this.animationTick/20)+1)/2*5;this.context.lineDashOffset=e,this.context.setLineDash([10-e,e])}else"solid"===e.dashed?this.context.setLineDash([4,4]):o.assertNever(e.dashed);this.context.moveTo(e.start.x,e.start.y),this.context.lineTo(e.end.x,e.end.y),this.context.stroke()},this.renderSpline=e=>{const t=o.DEFAULT_GRAPH_LINE_WIDTH;this.context.beginPath(),this.addGraphPathToContext(e.points,t),this.context.strokeStyle=this.getColorValue(e.color),this.context.lineWidth=t,this.context.stroke()},this.renderGradient=e=>{const t=o.DEFAULT_GRAPH_LINE_WIDTH;this.context.beginPath(),this.context.moveTo(0,this.height),this.addGraphPathToContext(e.points,t),this.context.lineTo(this.width,this.height),this.context.closePath(),this.context.clip();const s=this.context.createLinearGradient(0,0,0,this.height);!!window.MSInputMethodContext&&!!document.documentMode||(s.addColorStop(0,this.getColorValue(e.startColor)),s.addColorStop(1,this.getColorValue(e.endColor)),this.context.fillStyle=s,this.context.fillRect(0,0,this.width,this.height))},this.dispose=()=>{this.disposed=!0,this.shapes=[]};const{width:t,height:s,canvas:a,invisible:i}=e;this.canvas=a,this.context=a.getContext("2d"),this.width=t,this.height=s,this.invisible=i,this.context&&(this.context.translate(.5,.5),a.style.width=t+"px",a.style.height=s+"px",a.width=t*window.devicePixelRatio,a.height=s*window.devicePixelRatio,this.context.scale(window.devicePixelRatio,window.devicePixelRatio),window.requestAnimationFrame(this.renderCanvas))}addGraphPathToContext(e,t){const s=.5,a=[];e=[e[0],e[0],...e,e[e.length-1]];const i=l.maxBy(e,(e=>e.y)).y,o=l.minBy(e,(e=>e.y)).y+t;for(let t=2;t<e.length-2;t++)for(let r=0;r<=16;r++){const n=(e[t+1].x-e[t-1].x)*s,c=(e[t+2].x-e[t].x)*s,l=(e[t+1].y-e[t-1].y)*s,d=(e[t+2].y-e[t].y)*s,p=r/16,_=2*Math.pow(p,3)-3*Math.pow(p,2)+1,h=-2*Math.pow(p,3)+3*Math.pow(p,2),u=Math.pow(p,3)-2*Math.pow(p,2)+p,g=Math.pow(p,3)-Math.pow(p,2),m=_*e[t].x+h*e[t+1].x+u*n+g*c;let v=_*e[t].y+h*e[t+1].y+u*l+g*d;v>i&&(v=i),v<o&&(v=o),a.push({x:m,y:v})}for(let e=1;e<a.length;e++)this.context.lineTo(a[e].x,a[e].y)}}const lo=e=>{const{canNavigate:a,daysForward:i,loading:n,onNavigateOneWeekForward:c,disabled:l}=e;return a?t.React$1.createElement(s.Button$1,{"aria-label":r.intl.formatMessage({id:"rJUytN",defaultMessage:"Go forward one week"}),className:"rewind-graph-nav__btn",variant:"transparent",hasNoUnderline:!0,disabled:l,onClick:l?void 0:c},n&&t.React$1.createElement(s.Spinner,{size:"xsmall","aria-valuetext":"Loading"})," ",o.formatWithShortDateName(s.increment_date(new Date,0,0,1-i))," ›"):t.React$1.createElement(s.Button$1,{disabled:!0,variant:"transparent",hasNoUnderline:!0},r.intl.formatMessage({id:"JDRaFD",defaultMessage:"Today"}))},po=e=>{const{canNavigate:a,daysBackward:i,loading:n,onNavigateOneWeekBack:c,disabled:l}=e;return a?t.React$1.createElement(s.Button$1,{"aria-label":r.intl.formatMessage({id:"r409m+",defaultMessage:"Go back one week"}),className:"rewind-graph-nav__btn",variant:"transparent",hasNoUnderline:!0,disabled:l,onClick:l?void 0:c},"‹ ",o.formatWithShortDateName(s.increment_date(new Date,0,0,-i))," ",n&&t.React$1.createElement(s.Spinner,{size:"xsmall","aria-valuetext":"Loading"})):t.React$1.createElement("span",null," ")},_o=e=>{const a=[r.intl.formatMessage({id:"J5qhzs",defaultMessage:"Most activity"}),r.intl.formatMessage({id:"OJDO+R",defaultMessage:"Second most activity"}),r.intl.formatMessage({id:"PBtB8Z",defaultMessage:"Third most activity"}),r.intl.formatMessage({id:"v2wC3C",defaultMessage:"Fourth most activity"}),r.intl.formatMessage({id:"YwaMN9",defaultMessage:"Fifth most activity"}),r.intl.formatMessage({id:"NoSBXU",defaultMessage:"Sixth most activity"}),r.intl.formatMessage({id:"dTRuPR",defaultMessage:"Seventh most activity"})],i=e.data.slice().sort(((e,t)=>t.count-e.count)),o=[];let n=0;for(let e=0;e<i.length;e++)0!==e&&i[e].count!==i[e-1].count&&n++,0!==i[e].count?o.push({event:i[e],description:a[n]}):o.push({event:i[e],description:r.intl.formatMessage({id:"Kjxyo5",defaultMessage:"No activity"})});return t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement("div",null,r.intl.formatMessage({id:"JWIyED",defaultMessage:"Most active days this week"})),o.map((({event:a,description:i},o)=>t.React$1.createElement(s.Button$1,{key:`accessible-button-${o}`,variant:"transparent",className:"rewind-graph-nav__btn",onClick:()=>{e.onSelectDate(a.dateTsInMs,a.dateString)}},a.dateString,": ",i))))},ho="#1C3DA3",uo="rgba(0, 0, 0, 0.15)",go="rgba(178, 205, 255, 0.5)",mo="rgba(237, 244, 255, 0.5)",vo={start:"#eeeeee",end:"#B2CDFF",type:"pulse"},fo=e=>"before graph"!==e&&"after graph"!==e&&void 0!==e;class wo extends t.React$1.PureComponent{constructor(e){super(e),this.dateLines=[],this.createGraph=()=>{this.graph&&this.graph.dispose(),this.graph=new co({width:this.props.width,height:this.props.height,canvas:this.canvasRef,invisible:!this.props.hasData}),this.graph.addLine({type:"line",start:{x:0,y:this.props.height},end:{x:this.props.width,y:this.props.height},color:{value:uo,type:"solid"}}),this.graph.addLine({type:"line",start:{x:0,y:0},end:{x:this.props.width,y:0},color:{value:uo,type:"solid"}});const e=this.getNormalizedPoints(this.props.data);this.blueGradient=this.graph.addGradient({type:"gradient",points:e,startColor:{value:go,type:"solid"},endColor:{value:mo,type:"solid"}}),this.grayGradient=this.graph.addGradient({type:"gradient",points:e,startColor:{value:"rgba(253, 253, 253, 1.0)",type:"solid"},endColor:{value:"rgba(253, 253, 253, 1.0)",type:"solid"}}),this.dateLines=e.map((({x:e})=>this.graph.addLine({type:"line",start:{x:e,y:0},end:{x:e,y:this.props.height},color:{value:uo,type:"solid"},dashed:"solid"}))),this.blueSpline=this.graph.addSpline({type:"spline",points:e,color:{type:"solid",value:ho}}),this.graySpline=this.graph.addSpline({type:"spline",points:e,color:{type:"solid",value:uo}}),this.selectedLine=this.graph.addLine({type:"line",start:{x:0,y:0},end:{x:0,y:this.props.height},color:{type:"solid",value:ho},invisible:!0}),this.hoveredLine=this.graph.addLine({type:"line",start:{x:0,y:0},end:{x:0,y:this.props.height},color:{type:"solid",value:ho},dashed:"pulsing",invisible:!0})},this.createEmptyGraph=()=>{this.emptyGraph&&this.emptyGraph.dispose(),this.emptyGraph=new co({width:this.props.width,height:this.props.height,canvas:this.canvasRef,invisible:this.props.hasData}),this.emptyGraph.addLine({type:"line",start:{x:0,y:this.props.height},end:{x:this.props.width,y:this.props.height},color:{value:uo,type:"solid"}}),this.emptyGraph.addLine({type:"line",start:{x:0,y:0},end:{x:this.props.width,y:0},color:{value:uo,type:"solid"}})},this.updateGraph=()=>{const e=this.getSelectedPoint();if(!this.graph||!this.emptyGraph)return;if(this.graph.invisible=!this.props.hasData,this.emptyGraph.invisible=this.props.hasData,!this.props.hasData)return;const t=!this.state.isHovered&&void 0!==e&&"before graph"!==e&&"after graph"!==e;for(const s of this.dateLines)this.state.isHovered||void 0!==e?s.color={type:"solid",value:uo}:s.color=vo,s.invisible=t;const s=this.getSelectedPoint()||this.state.hoveredPoint;let a;a="after graph"===s?this.props.width:void 0===s||"before graph"===s?0:s.x;const i={topLeft:{x:0,y:0},size:{x:a,y:this.props.height}},o={topLeft:{x:a,y:0},size:{x:this.props.width,y:this.props.height}};this.blueGradient.clip=i,this.blueSpline.clip=i,this.grayGradient.clip=o,this.graySpline.clip=o;const r=this.state.hoveredPoint;this.hoveredLine.invisible=!r,r&&(this.hoveredLine.start.x=r.x,this.hoveredLine.end.x=r.x),this.selectedLine.invisible=!fo(e),e&&fo(e)&&(this.selectedLine.start.x=e.x,this.selectedLine.end.x=e.x)},this.updateRef=e=>{e&&(this.canvasRef=e,this.createGraph(),this.createEmptyGraph())},this.onMouseMove=e=>{const t=e.currentTarget.getBoundingClientRect(),s=e.clientX-t.left,a=l.minBy(this.getNormalizedPoints(this.props.data),(e=>Math.abs(e.x-s)));this.setState({hoveredPoint:a})},this.setDateRef=e=>{this.dateRef=e},this.onClick=()=>{this.state.hoveredPoint&&this.props.onSelectDate(this.state.hoveredPoint.event.dateTsInMs,this.state.hoveredPoint.event.dateString)},this.onMouseOver=()=>{this.setState({isHovered:!0}),this.props.onHover(!0)},this.onMouseOut=e=>{this.setState({isHovered:!1,hoveredPoint:void 0}),this.props.onHover(!1)},this.navigateOneWeekBack=()=>{this.props.onNavigateOneWeekBack()},this.navigateOneWeekForward=()=>{this.props.onNavigateOneWeekForward()},this.state={hoveredPoint:void 0,isHovered:!1}}UNSAFE_componentWillUpdate(e){const t=this.getNormalizedPoints(e.data);this.blueSpline.points=t,this.graySpline.points=t,this.blueGradient.points=t,this.grayGradient.points=t}getSelectedPoint(){const e=this.getNormalizedPoints(this.props.data);if(void 0===this.props.selectedPointMs)return;const t=this.getNormalizedPoints(this.props.data).find((e=>e.event.dateTsInMs===this.props.selectedPointMs));return t||(this.props.selectedPointMs<e[0].event.dateTsInMs?"before graph":this.props.selectedPointMs>e[e.length-1].event.dateTsInMs?"after graph":void 0)}getNormalizedPoints(e){const t=e.map(((e,t)=>({eventCount:e,x:t,y:e.count}))),s=l.minBy(t,(e=>e.x)).x;let a=l.maxBy(t,(e=>e.x)).x;const i=l.minBy(t,(e=>e.y)).y;let r=l.maxBy(t,(e=>e.y)).y;return 0===a&&(a=1),0===r&&(r=1),t.map((({x:e,y:t,eventCount:n})=>{const c=(t-i)/r;return{x:(e-s)/a*this.props.width,y:this.props.height-Math.max(o.GRAPH_BOTTOM_PADDING,c*this.props.height),event:n}}))}render(){const e=this.state.hoveredPoint?this.state.hoveredPoint.event.dateString:"";this.updateGraph();let a=0;return this.state.hoveredPoint&&(a=this.state.hoveredPoint.x-o.DATE_LABEL_WIDTH/2,a<0&&(a=0),a>this.props.width-o.DATE_LABEL_WIDTH&&(a=this.props.width-o.DATE_LABEL_WIDTH)),t.React$1.createElement("div",null,t.React$1.createElement("div",{style:{paddingLeft:`${a}px`}},this.props.hasData?t.React$1.createElement("div",{ref:this.setDateRef,className:"rewind-graph-date-label"},e):t.React$1.createElement("div",{className:"rewind-graph-date-label-spacer"})),t.React$1.createElement("canvas",{width:this.props.width,height:this.props.height,className:s.cx({"rewind-graph-canvas":!0,"no-data":!this.props.hasData}),ref:this.updateRef,onMouseMove:this.props.hasData?this.onMouseMove:void 0,onClick:this.props.hasData?this.onClick:void 0,onMouseOver:this.props.hasData?this.onMouseOver:void 0,onMouseOut:this.props.hasData?this.onMouseOut:void 0},t.React$1.createElement(_o,{data:this.props.data,onSelectDate:this.props.onSelectDate})),t.React$1.createElement("div",{className:"rewind-graph-nav"},t.React$1.createElement(po,{daysBackward:this.props.graphStartOffset,canNavigate:this.props.canNavigateBackward,onNavigateOneWeekBack:this.navigateOneWeekBack,loading:this.props.loadingPreviousWeek,disabled:this.props.loadingNextWeek||this.props.loadingPreviousWeek}),t.React$1.createElement(lo,{daysForward:this.props.graphEndOffset,canNavigate:this.props.canNavigateForward,onNavigateOneWeekForward:this.navigateOneWeekForward,loading:this.props.loadingNextWeek,disabled:this.props.loadingNextWeek||this.props.loadingPreviousWeek})))}}wo.displayName="RewindGraphComponent";class yo extends t.React$1.PureComponent{constructor(e){super(e),this.isContinueWidgetVisible=()=>"loaded"===this.props.page.contents.type&&void 0!==this.props.page.contents.selectedDateTsInMs,this.onSelectDate=(e,t)=>{const{user:s,restoreId:a}=this.props;this.props.dispatch({type:o.DeloreanActionType.setRewindPanelSelectedDate,selectedDateString:t,selectedDateTsInMs:e}),o.clickDayGraphDate({user:s,restoreId:a,selectedDateTsInMs:e})},this.onContinue=()=>{const{user:e,restoreId:t}=this.props,s=this.props.page;if("loaded"===s.contents.type&&s.contents.selectedDateString&&s.contents.selectedDateTsInMs){const{selectedDateString:a,selectedDateTsInMs:i}=s.contents;o.clickDayGraphNext({user:e,restoreId:t,selectedDateTsInMs:i}),this.props.dispatch({type:o.DeloreanActionType.changeRewindPageToActivityListPage,selectedDateTsInMs:i,selectedDateString:a})}},this.navigateOneWeekBack=()=>{this.props.dispatch(o.fetchEventCountsAction({user:this.props.user,fqpath:this.props.fqpath,startDaysBack:this.props.page.graphStartOffset+o.REWIND_GRAPH_DAY_STEP,endDaysBack:this.props.page.graphEndOffset+o.REWIND_GRAPH_DAY_STEP,graphPositionChange:"backward",rootNsId:this.props.rootNsId}))},this.navigateOneWeekForward=()=>{this.props.dispatch(o.fetchEventCountsAction({user:this.props.user,fqpath:this.props.fqpath,startDaysBack:this.props.page.graphStartOffset-o.REWIND_GRAPH_DAY_STEP,endDaysBack:this.props.page.graphEndOffset-o.REWIND_GRAPH_DAY_STEP,graphPositionChange:"forward",rootNsId:this.props.rootNsId}))},this.onHover=e=>{this.setState({isHovering:e})},this.startedLoadingTimestamp=Date.now(),this.state={isHovering:!1}}componentDidMount(){this.props.dispatch(o.fetchEventCountsAction({user:this.props.user,fqpath:this.props.fqpath,startDaysBack:this.props.page.graphStartOffset,endDaysBack:this.props.page.graphEndOffset,graphPositionChange:"none",rootNsId:this.props.rootNsId}))}componentDidUpdate(e){const{user:t,restoreId:s}=this.props,a=this.startedLoadingTimestamp;if("loaded"!==e.page.contents.type&&"loaded"===this.props.page.contents.type){const e=this.props.page.contents.namespaceCount;o.loadDayGraph({user:t,restoreId:s,startedLoadingTimestamp:a,namespaceCount:e})}"error"!==e.page.contents.type&&"error"===this.props.page.contents.type&&o.loadDayGraph({user:t,restoreId:s,startedLoadingTimestamp:a,namespaceCount:0,errorString:this.props.page.contents.errorString})}renderGraphSection(){if("initial-load"===this.props.page.contents.type)return t.React$1.createElement("div",{className:"rewind-graph-panel-container"},t.React$1.createElement("div",{className:"rewind-graph-panel-container__spinner"},t.React$1.createElement(s.Spinner,{size:"large","aria-valuetext":"Loading"})));if("error"===this.props.page.contents.type)return t.React$1.createElement("div",{className:"rewind-graph-panel-container"},t.React$1.createElement("div",{className:"folder-history-event-list__empty-text"},t.React$1.createElement(s.Text,{color:"faint"},this.props.page.contents.errorString," "),t.React$1.createElement(s.Link,{href:"#",variant:"monochromatic",onClick:o.onContactSupport},r.intl.formatMessage({id:"K2WP/Z",defaultMessage:"Contact support"}))));if("loaded"===this.props.page.contents.type){const{contents:{data:e},graphStartOffset:a,graphEndOffset:i}=this.props.page,n=e.slice(e.length-a,e.length-i),c=this.props.page.contents.data.length-1-(this.props.page.graphStartOffset-1),l=this.props.page.contents.data[c]&&!this.props.page.contents.data[c].outsideHistoryCutoff,d=this.props.page.graphEndOffset>0,p=this.props.page.contents.hasDataThisWeek;return t.React$1.createElement("div",{className:"rewind-graph-panel-container"},p?t.React$1.createElement("span",null):t.React$1.createElement("div",{className:"rewind-graph-no-activity"},t.React$1.createElement("div",{className:"rewind-graph-no-activity__text"},t.React$1.createElement(s.Text,{color:"faint"},r.intl.formatMessage({id:"/AeFJk",defaultMessage:"No activity for the selected week"})))),t.React$1.createElement("div",{className:s.cx({"rewind-graph-canvas-and-button":!0,"no-data":!p})},t.React$1.createElement(wo,{onSelectDate:this.onSelectDate,selectedPointMs:this.props.page.contents.selectedDateTsInMs,data:n,hasData:p,width:o.GRAPH_WIDTH,height:o.GRAPH_HEIGHT,onNavigateOneWeekBack:this.navigateOneWeekBack,onNavigateOneWeekForward:this.navigateOneWeekForward,canNavigateForward:d,canNavigateBackward:l,graphStartOffset:this.props.page.graphStartOffset,graphEndOffset:this.props.page.graphEndOffset,loadingNextWeek:this.props.page.contents.loadingNextWeek,loadingPreviousWeek:this.props.page.contents.loadingPreviousWeek,onHover:this.onHover})))}return o.assertNever(this.props.page.contents)}getGraphTitle(){if("loaded"===this.props.page.contents.type&&!this.props.page.contents.selectedDateTsInMs&&this.state.isHovering)return r.intl.formatMessage({id:"E6+0Aw",defaultMessage:"Right before a spike is a good place to start"});{const e=Math.floor(this.props.page.graphEndOffset/7);return 0===e?r.intl.formatMessage({id:"Ek+UwA",defaultMessage:"Activity: this week"}):1===e?r.intl.formatMessage({id:"UpWoGT",defaultMessage:"Activity: last week"}):r.intl.formatMessage({id:"b9LPyG",defaultMessage:"{count, plural, one{Activity: {count} weeks ago} other{Activity: {count} weeks ago}}"},{count:e})}}render(){return t.React$1.createElement("div",{className:"folder-history-ie11fix"},t.React$1.createElement("div",{className:"rewind-graph-panel"},t.React$1.createElement(o.RewindStepHeader,{currentStep:1,maxStep:o.NUM_REWIND_STEPS,instructions:r.intl.formatMessage({id:"eD6onG",defaultMessage:"Pick a day to get started"}),onGoBack:o.noop}),t.React$1.createElement("div",{className:"rewind-graph-desc"},t.React$1.createElement(s.Text,null,this.getGraphTitle())),this.renderGraphSection(),t.React$1.createElement(o.RewindContinueWidget,{onContinue:this.onContinue,visible:this.isContinueWidgetVisible(),text:r.intl.formatMessage({id:"pwmhyJ",defaultMessage:"Now, let’s zoom in"})})))}}yo.displayName="RewindGraphPage";const Ro=({name:e,displayDate:a,previousVersion:i})=>t.React$1.createElement("div",{className:s.cx({"rewind-folder-and-date":!0,"rewind-folder-and-date--previous-version":i})},t.React$1.createElement("div",{className:"rewind-folder-and-date__folder"},t.React$1.createElement(s.UIIcon,{src:s.FolderLine,size:"large"})),t.React$1.createElement("div",null,t.React$1.createElement("div",{className:"rewind-folder-and-date__name"},t.React$1.createElement(s.Text,{variant:"label",size:"small",isBold:!0},e)),t.React$1.createElement("div",{className:"rewind-folder-and-date__date"},t.React$1.createElement(s.Text,{variant:"label",size:"small",color:"faint"},a))));class xo extends t.React$1.Component{constructor(e){super(e),this.clickCancel=()=>{const{user:e,restoreId:t}=this.props;o.clickPreviewCancel({user:e,restoreId:t}),this.props.dispatch({type:o.DeloreanActionType.changeRewindPageFromConfirmationPageToGraphPage,previousPage:this.props.page})},this.clickSendBack=()=>d.__awaiter(this,void 0,void 0,(function*(){const{user:e,restoreId:a}=this.props;let i;o.clickPreviewId({user:e,restoreId:a});try{i=yield o.beginRewind({path:this.props.fqpath,targetTsMicroseconds:1e3*this.props.eventToRewindTo.timestamp,user:this.props.user,restorationsLoggingId:this.props.restoreId,rootNsId:this.props.rootNsId})}catch(e){const a=e&&e.error&&e.error[".tag"];if(a)if("insufficient_permissions"===a)s.Snackbar.show(t.React$1.createElement(s.Snackbar,{closeButtonText:r.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),title:r.intl.formatMessage({id:"MKEpc0",defaultMessage:"You do not have permissions to rewind this folder."}),variant:"fail"}));else{if("invalid_arguments"!==a&&"feature_not_allowed"!==a)throw e;s.Snackbar.show(t.React$1.createElement(s.Snackbar,{closeButtonText:r.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),title:r.intl.formatMessage({id:"6IKSeQ",defaultMessage:"We can’t rewind that. Try again, or contact support."}),variant:"fail"}))}return}this.props.dispatch({type:o.DeloreanActionType.changeRewindPageToRewindStarted,event:this.props.eventToRewindTo,rewindId:i.rewind.id})})),this.onGoBack=()=>{const{user:e,restoreId:t}=this.props;o.clickPreviewBack({user:e,restoreId:t}),this.props.dispatch({type:o.DeloreanActionType.goBackFromConfirmationPage})},this.goToHelp=()=>{const{user:e,restoreId:t}=this.props;o.clickPreviewHelp({user:e,restoreId:t}),s.unsafe_open_tab("http://www.dropbox.com/help/security/rewind")},this.getThirdPartyProvidersMessage=()=>{var e;const a=null===(e=this.props.thirdPartyProviders)||void 0===e?void 0:e.map((e=>r.intl.formatMessage(s.PROVIDER_MAP[e])));return a?t.React$1.createElement("div",{className:"rewind-confirmation-explanation"},1===a.length?t.React$1.createElement(s.Text,null,r.intl.formatMessage({id:"n4Mx31",defaultMessage:"If your {folderName} folder is backing up to {provider}, rewinding it in Dropbox will also change it in {provider}."},{folderName:s.getDisplayedFilename(this.props.folderName),provider:a[0]})):t.React$1.createElement(s.Text,null,r.intl.formatMessage({id:"UJ4blv",defaultMessage:"If your {folderName} folder is backing up to {providersPartOne} and {providersPartTwo}, rewinding it in Dropbox will also change it in {providersPartOne} and {providersPartTwo}."},{folderName:s.getDisplayedFilename(this.props.folderName),providersPartOne:a.slice(0,a.length-1).join(", "),providersPartTwo:a.slice(a.length-1).join("")}))):null},this.state={eventCountHigh:null}}componentDidMount(){o.loadConfirmationPage({eventToRewindTo:this.props.eventToRewindTo,eventCounts:this.props.eventCounts,graphPage:this.props.graphPage,user:this.props.user,restoreId:this.props.restoreId})}render(){return t.React$1.createElement("div",null,t.React$1.createElement(o.RewindStepHeader,{currentStep:3,maxStep:o.NUM_REWIND_STEPS,instructions:r.intl.formatMessage({id:"ZTkEWF",defaultMessage:"Start rewinding?"}),onGoBack:this.onGoBack}),t.React$1.createElement(Ro,{name:s.getDisplayedFilename(this.props.folderName),displayDate:r.intl.formatMessage({id:"VciIXA",defaultMessage:"Now"}),previousVersion:!0}),t.React$1.createElement("div",{className:"rewind-confirmation-change-count"},t.React$1.createElement("div",{className:"rewind-confirmation-change-count__arrow"},t.React$1.createElement("div",{className:"rewind-confirmation-change-count__arrow__vertical-line"}),t.React$1.createElement("div",{className:"rewind-confirmation-change-count__arrow__head"}))),t.React$1.createElement(Ro,{name:s.getDisplayedFilename(this.props.folderName),displayDate:this.props.eventToRewindTo.confirmationCardDate,previousVersion:!1}),t.React$1.createElement("div",{className:"rewind-confirmation-explanation"},t.React$1.createElement(s.Text,null,r.intl.formatMessage({id:"74EU+T",defaultMessage:"Your files and folders will look like they did before {date} at {time}."},{date:this.props.eventToRewindTo.formattedDate,time:this.props.eventToRewindTo.timeAgo})," "),t.React$1.createElement(s.Link,{href:"#",variant:"monochromatic",onClick:this.goToHelp},r.intl.formatMessage({id:"qLPTw+",defaultMessage:"How Rewind works"})," ")),this.getThirdPartyProvidersMessage(),t.React$1.createElement("div",{className:"rewind-confirmation-buttons"},t.React$1.createElement(s.Button$1,{variant:"primary",className:"rewind-confirmation-buttons__button",onClick:this.clickSendBack},r.intl.formatMessage({id:"rF8YNu",defaultMessage:"Rewind"})),t.React$1.createElement(s.Button$1,{variant:"transparent",onClick:this.clickCancel,className:"cancel"},r.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))))}}xo.displayName="RewindConfirmationPage";class bo extends t.React$1.Component{constructor(){super(...arguments),this.clickContactSupport=()=>{s.open_tab("https://www.dropbox.com/support")},this.navigateToHelp=e=>{const{user:t,restoreId:a}=this.props;o.clickHelp({user:t,restoreId:a,helpStep:e}),s.unsafe_open_tab("https://help.dropbox.com/security/rewind#after")},this.goToHelpProgressPage=()=>{this.navigateToHelp(o.DeloreanPage.progress)},this.goToHelpCompletionPage=()=>{this.navigateToHelp(o.DeloreanPage.completion)}}showSuccess(e){const{user:t,restoreId:s}=this.props;this.props.dispatch({type:o.DeloreanActionType.setRewindComplete}),o.loadCompletionSuccess({user:t,restoreId:s,startTs:e})}showFailure(e){const{user:a,restoreId:i}=this.props;o.loadCompletionFailure({user:a,restoreId:i,startTs:e}),s.Snackbar.show(t.React$1.createElement(s.Snackbar,{closeButtonText:r.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),actionButtonText:r.intl.formatMessage({id:"SDLkWB",defaultMessage:"Contact us"}),onActionClick:this.clickContactSupport,title:r.intl.formatMessage({id:"EKgeAS",defaultMessage:"Couldn’t rewind this folder. Try again or let us help"}),variant:"fail"})),this.props.closePanel({closedByClick:!1})}componentDidMount(){const{user:e,restoreId:t}=this.props,s=Date.now();this.props.dispatch({type:o.DeloreanActionType.setRewindInProgress}),o.loadProgress({user:e,restoreId:t});const a=setInterval((()=>d.__awaiter(this,void 0,void 0,(function*(){const e=yield o.getRewindStatus({id:this.props.page.rewindId,user:this.props.user});"successful"===e.status[".tag"]&&(clearInterval(a),this.showSuccess(s)),"failed"===e.status[".tag"]&&(clearInterval(a),this.showFailure(s))}))),o.LOADING_PAGE_POLLING_LENGTH_MS)}render(){return this.props.rewindState===o.RewindState.Done?t.React$1.createElement(Po,{page:this.props.page,goToHelpCompletionPage:this.goToHelpCompletionPage}):this.props.rewindState===o.RewindState.InProgress?t.React$1.createElement(ko,{page:this.props.page,goToHelpProgressPage:this.goToHelpProgressPage,folderName:this.props.folderName}):o.assertNever(this.props.rewindState)}}bo.displayName="RewindStarted";const ko=e=>t.React$1.createElement("div",{className:"rewind-text"},t.React$1.createElement("div",{className:"rewind-interstitial-holder"},t.React$1.createElement(s.Interstitial,{onComplete:()=>{},in:!0,isIndeterminate:!0})),t.React$1.createElement("div",{className:"rewind-confirmation-header"},t.React$1.createElement(s.Title,{size:"small",isBold:!0},r.intl.formatMessage({id:"on0Nju",defaultMessage:"Rewinding to an earlier time…"},{folder_name:e.folderName}))),t.React$1.createElement("div",{className:"rewind-confirmation-text"},t.React$1.createElement("div",null,t.React$1.createElement(s.Text,{color:"faint"},r.intl.formatMessage({id:"bDOcv2",defaultMessage:"Everything will soon be like it was before {date} at {time}. Don’t make any changes here until it’s done."},{date:e.page.selectedEvent.formattedDate,time:e.page.selectedEvent.timeAgo}))),t.React$1.createElement(s.Link,{href:"#",variant:"monochromatic",onClick:e.goToHelpProgressPage},r.intl.formatMessage({id:"sGoZLi",defaultMessage:"What to do after rewinding"})))),Po=e=>t.React$1.createElement("div",{className:"rewind-text"},t.React$1.createElement(s.Image$1,{className:"rewind-finished-img",src:t.static_url("/static/metaserver/static/images/delorean/illo-rewind-complete@1x-vflVS_j1t.png"),alt:""}),t.React$1.createElement("div",{className:"rewind-confirmation-header"},t.React$1.createElement(s.Title,{size:"small",isBold:!0},r.intl.formatMessage({id:"zJta6Y",defaultMessage:"Welcome back to {date} at {time}"},{date:e.page.selectedEvent.formattedDate,time:e.page.selectedEvent.timeAgo}))),t.React$1.createElement("div",{className:"rewind-confirmation-text"},t.React$1.createElement(s.Text,{color:"faint"},r.intl.formatMessage({id:"vXeDf5",defaultMessage:"You can use dropbox.com now, but wait for your devices to finish syncing. If anything doesn’t look like you expected, <options>learn more about your options</options>"},{div:e=>t.React$1.createElement("div",null,e),options:a=>t.React$1.createElement(s.Link,{href:"#",variant:"monochromatic",onClick:e.goToHelpCompletionPage},a)}))));class Eo extends t.React$1.PureComponent{constructor(){super(...arguments),this.onClick=()=>{o.clickUpsell({user:this.props.user,restoreId:this.props.restoreId}),s.open_tab("https://www.dropbox.com/plus?_tk=rewind_panel_upgrade")},this.goToHelpCenter=()=>{o.clickUpsellHelp({user:this.props.user,restoreId:this.props.restoreId}),s.open_tab("https://help.dropbox.com/security/rewind")}}render(){return t.React$1.createElement("div",{className:"rewind-upsell"},t.React$1.createElement("div",{className:"rewind-text"},t.React$1.createElement("div",{className:"rewind-upsell__image"},t.React$1.createElement(p.FilesOld2Spot,null)),t.React$1.createElement("div",{className:"rewind-text__title rewind-upsell__title"},t.React$1.createElement(s.Title,{size:"small",isBold:!0},r.intl.formatMessage({id:"UjNP9a",defaultMessage:"Rewind to a previous time"}))),t.React$1.createElement("div",null,t.React$1.createElement(s.Text,{color:"faint"},r.intl.formatMessage({id:"W3Vpv5",defaultMessage:"When a lot goes wrong, Dropbox Rewind can help you undo it all. That way you can get back to the way things were."}))),t.React$1.createElement(s.Button$1,{variant:"primary",className:"rewind-upsell__button",onClick:this.onClick},r.intl.formatMessage({id:"PJ4sk8",defaultMessage:"Get Rewind"})),t.React$1.createElement(s.Button$1,{variant:"transparent",onClick:this.goToHelpCenter},r.intl.formatMessage({id:"ySR8HJ",defaultMessage:"How Rewind works"}))))}}Eo.displayName="RewindUpsellPage";const Mo=e=>{const a=s.useSelector(s.currentBackup);switch(e.data.page){case o.RewindFlowPage.notVisible:return null;case o.RewindFlowPage.NUXPage:return t.React$1.createElement(no,{versionHistoryLength:e.userVersionHistoryLength,user:e.user,restoreId:e.restorationsLoggingId,dispatch:e.dispatch});case o.RewindFlowPage.confirmationPage:return(s=>{var i,o;if(s.eventAboveDivider){const{browseContext:r,graphPage:n}=e;let c,l;return(null==r?void 0:r.currentMountPoint)&&(l=null===(i=null==a?void 0:a.thirdPartyProviders)||void 0===i?void 0:i[r.currentMountPoint]),c="loaded"===n.contents.type?n.contents.data:[],t.React$1.createElement(xo,{user:e.user,fqpath:e.fqpath,eventToRewindTo:s.eventAboveDivider,folderName:e.folderName,dispatch:e.dispatch,page:s,graphPage:e.graphPage,restoreId:e.restorationsLoggingId,eventCounts:c,rootNsId:null!==(o=e.browseContext.rootNSID)&&void 0!==o?o:void 0,thirdPartyProviders:l})}return null})(e.data);case o.RewindFlowPage.graphPage:return i=e.data,t.React$1.createElement(yo,{user:e.user,fqpath:e.fqpath,page:i,dispatch:e.dispatch,events:e.events,restoreId:e.restorationsLoggingId,rootNsId:null!==(r=e.browseContext.rootNSID)&&void 0!==r?r:void 0});case o.RewindFlowPage.activityListPage:return(s=>{var a;return t.React$1.createElement(o.RewindActivityListPage,{dispatch:e.dispatch,user:e.user,fqpath:e.fqpath,events:e.events,selectedDateTsInMs:s.selectedDateTsInMs,restoreId:e.restorationsLoggingId,isForRewindFlow:!0,isInitialLoad:e.isInitialLoad,rootNsId:null!==(a=e.browseContext.rootNSID)&&void 0!==a?a:void 0})})(e.data);case o.RewindFlowPage.startedPage:return(s=>t.React$1.createElement(bo,{user:e.user,folderName:e.folderName,page:s,dispatch:e.dispatch,rewindState:s.rewindState,restoreId:e.restorationsLoggingId,closePanel:e.closePanel}))(e.data);case o.RewindFlowPage.upsellPage:return e.data,t.React$1.createElement(Eo,{user:e.user,restoreId:e.restorationsLoggingId})}var i,r};Mo.displayName="Rewind";class No extends t.React$1.Component{constructor(e){super(e),this.propsUpdated(Object.assign(Object.assign({},e),{isVisible:!1}))}componentDidUpdate(e,t){this.propsUpdated(e)}propsUpdated(e){const{isVisible:t,currentFQPath:a,nextFQPath:i}=this.props,o=t&&!e.isVisible,r=!t&&e.isVisible,n=s.normalize(a)!==s.normalize(i);(o||t&&n)&&this.props.onOpenPanel(),r&&this.props.onClosePanel()}render(){return null}}No.displayName="PanelOpenListener";class Do extends t.React$1.Component{constructor(e){super(e),this.closeDrawer=({closedByClick:e=!1})=>{const{activePage:t,allPageData:s,user:a}=this.props,{restoreId:r}=this.state;this.props.closePanel(),e&&!this.haveLoggedCloseReason&&(o.exitDrawer({reason:o.DeloreanCloseReason.click_close,activePage:t,allPageData:s,restoreId:r,user:a}),this.haveLoggedCloseReason=!0),i.DBHistory.remove_query_param(o.REWIND_QUERY_PARAM)},this.onOpenPanel=()=>{const{user:e,browseContext:t,clickBrowseButtonTimestampMs:s,fromDesktopClient:a}=this.props,{restoreId:i}=this.state;this.initialize(),s&&(this.props.expFolderHistoryRollbacks?o.loadNUX({browseContext:t,user:e,restoreId:i,clickBrowseButtonTimestampMs:s,fromDesktopClient:a}):n.shouldShowRewindsUpsell(e)&&o.loadUpsell({browseContext:t,user:e,restoreId:i,clickBrowseButtonTimestampMs:s,fromDesktopClient:a}))},this.onClosePanel=()=>{const{activePage:e,allPageData:t,user:a}=this.props,{restoreId:r}=this.state;this.haveLoggedCloseReason||(o.exitDrawer({reason:i.DBHistory.get_url().startsWith("/home")?o.DeloreanCloseReason.browse_folder:o.DeloreanCloseReason.page_exit,activePage:e,allPageData:t,restoreId:r,user:a}),this.haveLoggedCloseReason=!0),this.setState({restoreId:s.RestorationStepsLogger.generate_restore_id(a.id)})},this.initialize=()=>{const{user:e,expFolderHistoryRollbacks:t}=this.props,s=t;this.haveLoggedCloseReason=!1,this.props.dispatch(o.initializeDeloreanAction({fqPath:this.props.browseContext.currentFQPath,user:this.props.user,openToRewind:s})),o.openActivityList({user:e,restoreId:this.state.restoreId}),this.props.dispatch(o.fetchEventsAction({user:this.props.user,fqpath:this.props.browseContext.currentFQPath,direction:o.PaginationDirection.past,timestampInSeconds:0,onlyRewindableEvents:!1,opTypeFilters:[],clearEventList:!1})),n.shouldShowRewindsUpsell(e)&&!this.props.expFolderHistoryRollbacks&&this.props.dispatch({type:o.DeloreanActionType.changeRewindPageToUpsell})},this.onClickOnEvent=()=>{const{user:e}=this.props,{restoreId:t}=this.state;o.clickOnActivityList({user:e,restoreId:t})},this.showMoreFuture=e=>{this.props.dispatch(o.showMoreAction({user:this.props.user,fqpath:this.props.browseContext.currentFQPath,futureCursor:e,direction:o.PaginationDirection.future,isForRewindFlow:!1,rootNsId:this.props.browseContext.rootNSID||void 0}))},this.showMorePast=e=>{this.props.dispatch(o.showMoreAction({user:this.props.user,fqpath:this.props.browseContext.currentFQPath,pastCursor:e,direction:o.PaginationDirection.past,isForRewindFlow:!1,rootNsId:this.props.browseContext.rootNSID||void 0}))},this.updateActiveTabId=e=>{"View"===e?this.props.dispatch({type:o.DeloreanActionType.changeRewindPageToNone}):this.props.dispatch({type:o.DeloreanActionType.changeRewindPageToNUXOrDayResolution})},this.state={restoreId:s.RestorationStepsLogger.generate_restore_id(e.user.id)},this.haveLoggedCloseReason=!0}componentDidMount(){window.addEventListener("beforeunload",(e=>{const{activePage:t,allPageData:s,user:a}=this.props,{restoreId:i}=this.state;this.props.isVisible&&!this.haveLoggedCloseReason&&(o.exitDrawer({reason:o.DeloreanCloseReason.page_exit,activePage:t,allPageData:s,restoreId:i,user:a}),this.haveLoggedCloseReason=!0)}))}renderContent(){return this.props.activePage===o.RewindFlowPage.notVisible||!n.shouldShowRewindsUpsell(this.props.user)&&!this.props.expFolderHistoryRollbacks?t.React$1.createElement(o.FolderHistory,{onClickEvent:this.onClickOnEvent,events:this.props.events,isForARewind:!1,isInitialLoad:this.props.isInitialLoad,onShowMoreFuture:this.showMoreFuture,onShowMorePast:this.showMorePast,selectedDateTsInMs:void 0}):this.props.activePage===o.RewindFlowPage.graphPage||this.props.activePage===o.RewindFlowPage.NUXPage||this.props.activePage===o.RewindFlowPage.activityListPage||this.props.activePage===o.RewindFlowPage.confirmationPage?t.React$1.createElement(Mo,{events:this.props.events,isInitialLoad:this.props.isInitialLoad,fqpath:this.props.fqpath,folderName:this.props.browseContext.getNameOfTargetFolder(),user:this.props.user,dispatch:this.props.dispatch,data:this.props.allPageData[this.props.activePage],graphPage:this.props.allPageData.graphPage,browseContext:this.props.browseContext,restorationsLoggingId:this.state.restoreId,closePanel:this.closeDrawer,userVersionHistoryLength:this.props.userVersionHistoryLength}):this.props.activePage===o.RewindFlowPage.startedPage?t.React$1.createElement(bo,{page:this.props.allPageData.startedPage,folderName:this.props.browseContext.getNameOfTargetFolder(),user:this.props.user,dispatch:this.props.dispatch,rewindState:this.props.allPageData.startedPage.rewindState,restoreId:this.state.restoreId,closePanel:this.closeDrawer}):this.props.activePage===o.RewindFlowPage.upsellPage?t.React$1.createElement(Eo,{user:this.props.user,restoreId:this.state.restoreId}):o.assertNever(this.props.activePage)}render(){const e=s.cx({delorean:!0,"delorean--visible":this.props.isVisible,"delorean--hidden":!this.props.isVisible});return t.React$1.createElement("div",{"aria-hidden":this.props.isVisible?"false":"true",className:e},t.React$1.createElement("div",{className:"rewind-header-wrapper"},t.React$1.createElement(eo,{folderDisplayName:s.getDisplayedFilename(this.props.folderDisplayName),expFolderHistoryRollbacks:this.props.expFolderHistoryRollbacks,closePanel:this.closeDrawer,context:this.props.browseContext})),this.props.isVisible&&this.renderContent(),t.React$1.createElement(No,{onOpenPanel:this.onOpenPanel,onClosePanel:this.onClosePanel,isVisible:this.props.isVisible,currentFQPath:this.props.fqpath,nextFQPath:this.props.browseContext.currentFQPath}))}}Do.displayName="DeloreanInnerUnconnected";const $o=s.connect((function(e){return{hasDismissedNUX:o.getHasDismissedNUX(e),isInitialLoad:o.getIsInitialLoad(e),events:o.getEvents(e),folderDisplayName:o.getFolderDisplayName(e),activePage:o.getActivePage(e),allPageData:o.getAllPageData(e),fqpath:o.getFQPath(e)}}))(Do),Co=s.requireCssWithComponent($o,["/static/metaserver/static/css/delorean/delorean-vflhckSBA.css"]),Io=o.getDeloreanStore();class To extends t.React$1.Component{render(){return t.React$1.createElement(s.Provider,{store:Io},t.React$1.createElement(Co,{fromDesktopClient:this.props.fromDesktopClient,userVersionHistoryLength:this.props.userVersionHistoryLength,user:this.props.user,closePanel:this.props.close,browseContext:this.props.browseContext,isVisible:this.props.isVisible,expFolderHistoryRollbacks:this.props.expFolderHistoryRollbacks,clickBrowseButtonTimestampMs:this.props.clickBrowseButtonTimestampMs}))}}To.displayName="RewindPanel";const So=({isRewindVisible:e})=>{const i=s.useDispatch(),o=s.getQueryArgs().activity||s.getQueryArgs().rewind;return t.reactExports.useEffect((()=>{o&&!e&&i(a.showRewind()),!o&&e&&i(a.hideRewind())}),[o,i,e]),null},Lo=({userId:e,folderHistoryRollbacks:i})=>{const o=s.useSelector(s.path$1),r=s.useDispatch();return t.reactExports.useEffect((()=>{r(a.setIsRewindButtonEnabled({path:o,userId:e,userSkuHasRewind:i}))}),[o,r,e,i]),null};e.BrowseRewind=({userVersionHistoryLength:e})=>{const i=s.useDispatch(),o=s.mustGetActiveUser(),r=s.useSelector(s.clickRewindTimestamp),n=s.useSelector(s.isRewindVisible),c=s.useSelector(s.context),l=s.useSelector(s.enableFolderHistoryRollbacks);return So({isRewindVisible:n}),Lo({userId:o.id,folderHistoryRollbacks:l}),n?t.React$1.createElement(To,{clickBrowseButtonTimestampMs:r,user:o,fromDesktopClient:"true"===s.getQueryArgs().from_desktop_client,browseContext:c,close:()=>i(a.hideRewind()),isVisible:n,expFolderHistoryRollbacks:l||!1,userVersionHistoryLength:e}):null}}));
//# sourceMappingURL=c_delorean_components_rewind.js-vflnjOQUC.map
