define(["exports","./c_lodash-es_lodash","./e_edison","./c_ux_analytics_dispatch_custom_event","./e_ui_page_files_router"],(function(t,e,s,a,i){"use strict";let n=null;const r={initUrl(t){n=t},dispatchHistoryChange(t){s.assert(null!==n,"spaChangesToUxa needs an initial URL");const e=n;n=t;const i={detail:{previousUrl:e,url:n}};a.dispatchCustomEvent("historyChange",i)},reset(){n=null}},o=function(){const t=function(){return i.getUrl()},a=(t,e)=>(null==e&&(e=void 0),String(s.URI.parse(t).setQuery(e))),n=function(e=t()){return i.deconstructUrl(e)},l={},c={};let _=t(),u=null,h="";const d=function(t){return h+"/"+t.substring(h.length).split("/")[1]},p=function(t){const e=n(_),s=d(e.path);if(s in t){const a=e.path.substr(s.length+1);t[s].map((t=>t(a,e.qargs)))}},f=()=>p(l),g=()=>p(c),y=function(t,e,s){if(s[t]){const a=s[t].indexOf(e);s[t].splice(a,1)}},m=function(t,e){d(t)!==d(e)&&g()},b=function(){const e=t();e!==_&&(m(_,e),_=e,f(),x())};function x(){const t=window.location.origin+o.get_url();r.dispatchHistoryChange(t)}return r.initUrl(i.get_href()),{init(){u||(_=t(),u=setInterval(b,50))},_add_callback(t,e,a){this.init(),s.assert("string"==typeof t,"DBHistory prefix is not a string"),s.assert(0===t.indexOf("/"),"DBHistory prefix must be absolute"),s.assert(-1===t.substring(h.length).indexOf("/",1),"multi-component prefixes arent supported"),a[t]||(a[t]=[]),a[t].push(e)},add_callback(t,e,s=!1){this._add_callback(t,e,l),s||f()},remove_callback(t,e){y(t,e,l)},remove_exit_callback(t,e){y(t,e,c)},add_exit_callback(t,e){this._add_callback(t,e,c)},fire_callbacks(){f()},fire_exit_callbacks(){g()},_build_url_for_state_change:(t,e)=>(s.assert("string"==typeof t,"DBHistory path is not a string"),s.assert(0===t.indexOf("/"),"DBHistory path must be relative"),s.assert(-1===t.indexOf("//"),"DBHistory path contains //"),a(t,e)),_pre_state_change:t=>t!==_&&(m(_,t),!0),_post_state_change(e=!0){_=t(),e&&f()},replace_state(t,s,a){void 0===a&&(a={}),a=e.defaults(a,{immediatelyRestoreState:!0});const n=this._build_url_for_state_change(t,s);if(this._pre_state_change(n)){if(i.shouldUseReactRouter())i.CompatNavigate.navigateReplace(n);else{if(!window.history.replaceState)return;i.startNavigation(),window.history.replaceState(null,null,n)}this._post_state_change(a.immediatelyRestoreState),x()}},push_state(t,a,n){null==n&&(n={}),n=e.defaults(n,{immediatelyRestoreState:!0}),s.assert(-1===t.indexOf("?"),"DBHistory path contains ?"),s.assert(-1===t.indexOf("#"),"DBHistory path contains #");const r=this._build_url_for_state_change(t,a);this._pre_state_change(r)&&(i.shouldUseReactRouter()?i.CompatNavigate.navigate(r):(i.startNavigation(),window.history.pushState(null,null,r)),this._post_state_change(n.immediatelyRestoreState),x())},update_query_param(t,e){const s=this.deconstruct_url();s.qargs[t]=e,this.replace_state(s.path,s.qargs)},remove_query_param(t){const e=this.deconstruct_url();delete e.qargs[t],this.replace_state(e.path,e.qargs)},reset(){[l,c].forEach((t=>{Object.keys(t).forEach((e=>{t[e].forEach((s=>{y(e,s,t)}))}))})),_=t(),u=null,h=""},get_url:t,get_uri:function(){const e=s.URI.parse(t());return e.setPath(s.URI.encode_parts(e.getPath())),e},construct_url:a,deconstruct_url:n,set_base_prefix:t=>{h=t}}}();t.DBHistory=o}));
//# sourceMappingURL=c_history.js-vfl6WDOEa.map
