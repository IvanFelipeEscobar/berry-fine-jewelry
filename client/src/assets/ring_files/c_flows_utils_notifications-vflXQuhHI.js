define(["exports","./e_edison","./c_core_i18n","./c_flows_utils_browse_logger","./c_tslib","./c_flows_lib_api","./c_flows_hooks_workflow_builder_hooks","./c_apex-metrics_src_types","./c_lodash-es_lodash","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","./e_ui_page_files_router","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_core_xhr","./c_csrf","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","./c_src_common_constants","./c_flows_logging_flows_loggers","./c_data_action_creators_index","./c_files_view_file_actions_file_from_metadata","./c_file_actions_strings","./c_history","./c_ux_analytics_dispatch_custom_event","./c_browse_crypto_subtle_digest","./c_flows_redux_selectors","./c_flows_constants","./c_flows_redux_reducer","./c_workflow_builder_workflow_actions_action_ui_config","./c_truncate_index","./c_form_row_index","./c_ui_tree_view","./c_icon_folder_icon","./c_components_spacer_index","./c_naming_conventions_utils","./c_tagging_components_tags_container","./c_components_item_truncation_container","./c_hooks_resize_observer","./c_resize-observer-polyfill_dist_ResizeObserver","./c_tagging_components_tags_search","./c_typeahead_index","./c_modal_filters_view_tidy_filters","./c_folder_dialog_folder_picker_dig","./c_table_columns_file_name_column","./c_src_table","./c_react-table_index","./c_src_icons_file_icon","./c_src_icons_file_icon_extensions","./c_combinations_index","./c_spectrum_icon_arrow_index","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_keymaster","./c_browse_interface","./c_breadcrumb_index","./c_flows_redux_actions","./c_flows_redux_store","./c_ui_hoc","./c_plugin_utils_tilingFunc","./c_plugin_utils_getImageDefaultSizes"],(function(e,t,s,a,n,o,c,i,l,r,_,u,d,f,g,m,p,h,b,v,x,w,k,j,y,M,S,L,q,C,F,P,O,B,E,z,N,T,I,U,A,R,D,G,K,X,$,J,Q,V,Y,H,W,Z,ee,te,se,ae,ne,oe,ce,ie,le,re,_e,ue,de,fe,ge,me,pe,he,be,ve,xe,we,ke,je,ye){"use strict";const Me=32;function Se({creates:e,moves:t}){return n.__awaiter(this,void 0,void 0,(function*(){const{closeLabel:n,undoProgressLabel:c,undoSuccessLabel:i,undoFailLabel:l}={closeLabel:s.intl.formatMessage({id:"xB3cXP",defaultMessage:"Close"}),undoProgressLabel:e=>s.intl.formatMessage({id:"CdBI55",defaultMessage:"Undoing {count, plural, one {# change} other {# changes}}..."},{count:e}),undoSuccessLabel:e=>s.intl.formatMessage({id:"k+8Dk9",defaultMessage:"{count, plural, one {# change} other {# changes}} undone."},{count:e}),undoFailLabel:s.intl.formatMessage({id:"026V5B",defaultMessage:"Couldn't undo some changes."})},r=e.length+t.length;a.updateSnackbar({variant:"sync",title:c(r)});try{for(let s=0;s<r;s+=Me){const a=s+Me,n=t.slice(s,a),c=e.slice(Math.max(0,s-t.length),Math.max(0,a-t.length));yield o.undoActions(c,n)}a.updateSnackbar({variant:"complete",title:i(r),closeButtonText:n})}catch(e){a.updateSnackbar({variant:"fail",title:l,closeButtonText:n})}}))}const Le=e=>{var t,s;return null!==(s=null===(t=e.template)||void 0===t?void 0:t.join(","))&&void 0!==s?s:e.action_type},qe=e=>{var t;if("list_directory"===(null===(t=e.template)||void 0===t?void 0:t[0])&&e.seq_index>0){const[,...t]=e.template;return Object.assign(Object.assign({},e),{template:t,seq_index:e.seq_index-1})}return e};function Ce(e,t,s,n){const o=e.filter((e=>"start"===e.status)),c=e.filter((e=>"success"===e.status)),i=e.filter((e=>"fail"===e.status)),{undoLabel:l}=Pe(),r=t.notifications;if(!r)return;const _=()=>{if(!r.allowUndo)return{};const e=function(e){const t=e.filter((e=>!!e.created_fq_path)).map((e=>({created_fq_path:e.created_fq_path}))),s=e.filter((e=>!!e.input_fq_path&&!!e.moved_fq_path)).map((e=>({input_fq_path:e.input_fq_path,moved_fq_path:e.moved_fq_path})));return{creates:t,moves:s,length:t.length+s.length}}(c);return e.length>0?{actionButtonText:l,onActionClick:()=>{s(),Se(e).then((()=>{if(n){const t=e.creates.map((e=>e.created_fq_path)).filter((e=>void 0!==e));n(t)}}))}}:{}};o.length?a.updateSnackbar({variant:"sync",title:r.inProgress(c.length,e.length)}):c.length===e.length?a.updateSnackbar(Object.assign({variant:"complete",title:r.success(c.length),onCloseClick:s},_())):i.length===e.length?a.updateSnackbar({variant:"fail",title:r.fail(i.length),onCloseClick:s}):a.updateSnackbar(Object.assign({variant:"complete",title:`${r.success(c.length)} ${r.fail(i.length)}`,onCloseClick:s},_()))}function Fe(e,t){const s=Math.max(...e.filter((e=>"start"!==e.status)).map((e=>e.seq_index))),n=e[0].template.length,o=e.filter((e=>"start"===e.status)),c=e.filter((e=>"success"===e.status&&e.seq_index===s)),i=e.filter((e=>"fail"===e.status)),{genericInProgressLabel:l,genericSuccessLabel:r,genericPartialSuccessLabel:_,genericFailLabel:u,genericFailShortLabel:d}=Pe();if(o.length)return void a.updateSnackbar({variant:"sync",title:l});const f=[];c.length&&f.push(s===n-1?r(c.length):_(c.length,s)),i.length&&f.push(f.length?d(i.length):u(i.length)),a.updateSnackbar({variant:i.length===e.length?"fail":"complete",title:f.join(" "),onCloseClick:t})}function Pe(){return{undoLabel:s.intl.formatMessage({id:"T3e7p+",defaultMessage:"Undo"}),genericInProgressLabel:s.intl.formatMessage({id:"z9caOT",defaultMessage:"Running your workflow..."}),genericSuccessLabel:e=>s.intl.formatMessage({id:"GKRi8G",defaultMessage:"{numFiles, plural, one {# file} other {# files}} successfully processed through your workflow."},{numFiles:e}),genericPartialSuccessLabel:(e,t)=>s.intl.formatMessage({id:"5Xqmt+",defaultMessage:"{numFiles, plural, one {# file} other {# files}} processed through step {stepNumber} of your workflow."},{numFiles:e,stepNumber:t+1}),genericFailLabel:e=>s.intl.formatMessage({id:"qBnJKQ",defaultMessage:"{numFiles, plural, one {# file} other {# files}} failed to be processed through your workflow."},{numFiles:e}),genericFailShortLabel:e=>s.intl.formatMessage({id:"0aYwb/",defaultMessage:"{numFiles, plural, one {# file} other {# files}} failed."},{numFiles:e})}}e.handleMultiStepNotification=Fe,e.handleSingleStepNotification=Ce,e.preprocessPayload=qe,e.useFlowsNotifications=function(e){const[s,a]=t.reactExports.useState([]),{uiConfig:n}=c.useActionUiConfig(),o=t.reactExports.useCallback((e=>{a((t=>[...t,qe(e)]))}),[]),i=t.reactExports.useCallback((()=>a([])),[]),l=t.reactExports.useCallback((t=>{const s=n.find((e=>e.type===t[0].action_type));(null==s?void 0:s.notifications)&&Ce(t,s,i,e)}),[n,i]),r=t.reactExports.useCallback((e=>{Fe(e,i)}),[i]);return t.reactExports.useEffect((()=>{if(!s.length)return;const e=s[s.length-1],t=Le(e),a=Object.values(s.filter((e=>Le(e)===t)).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.revkey]:t})),{}));e.template&&e.template.length>1?r(a):l(a)}),[s,i,n,r,l]),{handlePayload:o,clearPayloads:i}}}));
//# sourceMappingURL=c_flows_utils_notifications.js-vfls7Kid-.map
