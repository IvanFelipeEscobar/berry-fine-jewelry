define(["exports","./e_edison","./e_core_exception","./c_apex-metrics_src_types","./e_ui_page_files_router"],(function(e,t,i,n,s){"use strict";class r extends n.Message{constructor(e){super(),this.tealiumEnabled=!1,this.tealiumEnv="",this.tealiumProfile="",this.privacyConsentEnabled=!1,n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new r).fromBinary(e,t)}static fromJson(e,t){return(new r).fromJson(e,t)}static fromJsonString(e,t){return(new r).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(r,e,t)}}r.runtime=n.proto3,r.typeName="marketing_tracker.Config",r.fields=n.proto3.util.newFieldList((()=>[{no:3,name:"tealium_enabled",kind:"scalar",T:8},{no:4,name:"tealium_env",kind:"scalar",T:9},{no:5,name:"tealium_profile",kind:"scalar",T:9},{no:6,name:"default_marketing_data",kind:"message",T:n.Struct},{no:7,name:"privacy_consent_enabled",kind:"scalar",T:8}]));class a extends n.Message{constructor(e){super(),this.src="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new a).fromBinary(e,t)}static fromJson(e,t){return(new a).fromJson(e,t)}static fromJsonString(e,t){return(new a).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(a,e,t)}}a.runtime=n.proto3,a.typeName="marketing_tracker.MarketingTrackerData",a.fields=n.proto3.util.newFieldList((()=>[{no:1,name:"src",kind:"scalar",T:9},{no:2,name:"config",kind:"message",T:r},{no:3,name:"data_layer",kind:"message",T:n.Struct}]));var o;e.EventTypeEnum=void 0,(o=e.EventTypeEnum||(e.EventTypeEnum={})).Link="link",o.View="view";class c{constructor(i){if(this.el=null,this.ready=!1,this.readyTimeout=null,this.resetForTesting=()=>{this.el=null,this.ready=!1,this.readyTimeout=null},this.push=({src:i,dataLayer:n,config:r,eventType:a})=>{const o=Object.assign(Object.assign({},n),{_config:r||{},_eventType:a||e.EventTypeEnum.Link});t.assert(!!i,"MarketingTracker.push requires src"),this.ready?this.el&&this.el.contentWindow&&this.el.contentWindow.postMessage(o,this.args.marketingUri):(this.el||(this.el=this.load(i),this.src=i,r&&(this.config=r),this.readyTimeout=setTimeout((()=>{this.args.onException({err:new Error("Timed-out while waiting for marketing_tracker iframe load event"),severity:"non-critical"})}),3e4)),this.el.addEventListener("load",(()=>{null!==this.readyTimeout&&(clearTimeout(this.readyTimeout),this.readyTimeout=null),this.el&&this.el.contentWindow?(this.ready=!0,this.el.contentWindow.postMessage(o,this.args.marketingUri),s.registerLogToMarketingTrackerFunction((t=>{this.pushWithDefaults(t,e.EventTypeEnum.Link)}),this.args.inclusionMethod)):this.args.onException({err:new Error("Could not find contentWindow on marketing_tracker iframe element"),severity:"non-critical"})})))},this.load=e=>{const t=document.createElement("iframe");return t.style.display="none",t.hidden=!0,t.src=e,t.setAttribute("sandbox","allow-scripts allow-same-origin"),document.body.appendChild(t),t},this.pushWithDefaults=(e,t)=>{const{config:i,src:n}=this;if(i){const s={config:i,dataLayer:Object.assign(Object.assign({},this.config.default_marketing_data),e),src:n,eventType:t};this.push(s)}else this.args.onReportStack("MarketingTracker.pushWithDefaults requires config, which is undefined. This probably           means there is no MarketingTracker instance on the page.")},this.pushEvent=(e,t,i)=>{const n=Object.assign({event:e,tealium_event:e},i);this.pushWithDefaults(n,t)},this.tryPushEvent=(t,i,n)=>{const{config:s,src:r}=this,a={event:t,tealium_event:t};if(n=n||{},s){const t={config:s,dataLayer:Object.assign(Object.assign(Object.assign({},this.config.default_marketing_data),a),n),src:r,eventType:i||e.EventTypeEnum.Link};this.push(t)}},c.instance)return c.instance;this.args=i,c.instance=this}}const l=new c({marketingUri:"https://marketing.dropbox.com",onException:i.reportException,onReportStack:i.reportStack,inclusionMethod:s.InclusionMethod.BASE});e.MARKETING_LOGIN_EVENT="user_login",e.MARKETING_REGISTER_EVENT="user_register",e.MarketingTracker=l,e.getGAEventData=function(e,t,i,n){const s={ga_eventaction:t,ga_eventCategory:e};return i&&(s.ga_eventLabel=i),n&&(s.ga_eventValue=n),s},e.getGAViewData=function(e,i,n){const s={};return t.assert(!n||n.startsWith("/virtual"),"virtual pageview page should start with virtual"),e&&(s.title=e),i&&(s.ga_pageview_location=i),n&&(s.ga_pageview_page=n),s}}));
//# sourceMappingURL=c_marketing_tracker.js-vflBNuW5S.map
