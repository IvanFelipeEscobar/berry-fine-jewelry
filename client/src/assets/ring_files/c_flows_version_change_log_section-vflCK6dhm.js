define(["require","exports","./e_edison","./e_ui_page_files_router","./c_core_i18n","./c_components_spacer_index","./c_form_row_index","./c_src_common_constants","./c_tslib","./c_flows_approval_approval_io_client","./c_apex-metrics_src_types","./c_lodash-es_lodash","metaserver/static/js/modules/constants/files_spa","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_core_xhr","./c_csrf","./c_browser_cookies","./c_src_sink_index","./c_core_browser_detection","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","metaserver/static/js/modules/core/langpack","./c_typeahead_index","./c_contacts_data_v2","./c_contacts_bloodhound","metaserver/static/js/modules/constants/contacts","./c_profile_services_profile_services_link","./c_profile_services_profile_services_constants","metaserver/static/js/modules/constants/login_and_register","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments"],(function(e,t,o,a,s,n,i,r,c,l,d,g,u,_,v,m,f,p,S,w,h,E,N,L,x,y,C,j,I,M,b,V,F,P,R,k,A,$,T,U,O,B,D,G,H,Y,z,J,q){"use strict";const Q=({utcTsInSeconds:e,lastModifiedAccountId:t,actorAccountId:n,chanegLog:i,lastModifiedDisplayName:r})=>{const{getChangeLogLastEditEmptyYou:c,getChangeLogLastEditEmpty:l,getChangeLogLastEditYou:d,getChangeLogLastEdit:g}=function(){const e=s.useIntl();return{getChangeLogLastEditEmptyYou:t=>e.formatMessage({id:"NE+Q9p",defaultMessage:"Deleted {time_ago} by you"},{time_ago:t}),getChangeLogLastEditEmpty:(t,o)=>e.formatMessage({id:"9Su1jP",defaultMessage:"Deleted {time_ago} by {name}"},{time_ago:t,name:o}),getChangeLogLastEditYou:t=>e.formatMessage({id:"di1Nt/",defaultMessage:"Updated {time_ago} by you"},{time_ago:t}),getChangeLogLastEdit:(t,o)=>e.formatMessage({id:"RvVNS+",defaultMessage:"Updated {time_ago} by {name}"},{time_ago:t,name:o})}}(),u=s.useIntl();return o.React$1.createElement(a.Text,{size:"small",color:"faint"},(()=>{const o=((e,t=!0)=>a.timeSince(u,e,{displayLocation:"label",displayContext:t?"standalone":"sentence-middle"}))(1e3*e,!1);return i?t==n?d(o):g(o,r):t==n?c(o):l(o,r)})())};Q.displayName="ChangeLogLastEdit";a.injectInternalStyle("typescript/component_libraries/flows/src/components/change-log-section/index.module.out.css",(e=>"._version-change-log-section_1dn6j_1{display:flex;flex-direction:column;padding-top:20px}._version-change-log-section__text_1dn6j_7{overflow-wrap:break-word}._version-change-log-section__new-badge_1dn6j_11{margin-left:4px}"));const Z="_version-change-log-section_1dn6j_1",W="_version-change-log-section__text_1dn6j_7",K="_version-change-log-section__new-badge_1dn6j_11",X=({changeLog:e,onSubmit:t,actorAccountId:c,onFocusEditor:l})=>{const{changeLogPlaceholder:d,title:g,textAreaArialLabel:u,newBadge:_}=function(){const e=s.useIntl();return{changeLogPlaceholder:e.formatMessage({id:"bdH2FW",defaultMessage:"Comment on changes to this version"}),title:e.formatMessage({id:"9wusT9",defaultMessage:"Version notes"}),textAreaArialLabel:e.formatMessage({id:"JJHGYJ",defaultMessage:"The input area of the version note"}),newBadge:e.formatMessage({id:"1wc7dy",defaultMessage:"New"})}}(),[v,m]=o.reactExports.useState(!1),[f,p]=o.reactExports.useState(null),S=o.reactExports.useRef(null);o.reactExports.useEffect((()=>{var t,o,a;if(v&&(null===(t=S.current)||void 0===t||t.focus(),null==e?void 0:e.text)){const t=null===(o=null==e?void 0:e.text)||void 0===o?void 0:o.length;null===(a=S.current)||void 0===a||a.setSelectionRange(t,t)}}),[v]);const w=()=>{l(),m(!0)};if(!e)return null;const{text:h,last_modified_user:E,last_modified_ts_in_seconds:N,last_modified_user_display_name:L}=e;return o.React$1.createElement("div",{className:Z},o.React$1.createElement(a.Text,{isBold:!0,size:"small"},g,o.React$1.createElement(a.AccessoryBadge,{className:K},_)),o.React$1.createElement(n.Spacer,null),v?o.React$1.createElement(o.React$1.Fragment,null,o.React$1.createElement(a.TextArea,{value:null!=f?f:null==e?void 0:e.text,rows:1,"aria-label":u,resizable:"auto",onChange:e=>{e.currentTarget.value.length<=r.CHANGE_LOG_SIZE_LIMIT&&p(e.currentTarget.value)},onBlur:()=>{null!=f&&f!=(null==e?void 0:e.text)&&(t(f),p(null)),m(!1)},ref:S}),o.React$1.createElement(i.FormHelperText,{alignRight:!0},null!==(j=null!==(y=null==f?void 0:f.length)&&void 0!==y?y:null===(C=null==e?void 0:e.text)||void 0===C?void 0:C.length)&&void 0!==j?j:0,"/",r.CHANGE_LOG_SIZE_LIMIT)):null!=h&&o.React$1.createElement(o.React$1.Fragment,null,(x=h,o.React$1.createElement(a.Text,{className:W,size:"small",color:x?"standard":"faint",onClick:w},x||d)),o.React$1.createElement(n.Spacer,null),E&&N&&h&&o.React$1.createElement(Q,{utcTsInSeconds:N,lastModifiedAccountId:E,actorAccountId:c,chanegLog:h,lastModifiedDisplayName:null!=L?L:""})));var x,y,C,j};X.displayName="ChangeLogSection";const ee=(()=>{let t;return{getOrLoadPapEvents:()=>c.__awaiter(void 0,void 0,void 0,(function*(){return t||(t=yield new Promise((function(t,o){e(["./c_flows_logging_version_logging_events"],t,o)}))),t}))}})(),te="version_modal",oe="version_note_section",ae="flows-version-control-snackbar",se=({fileId:e,user:t,previewSurface:n})=>{const{versionNoteChanged:i,versionNoteCanNotSave:r}=function(){const e=s.useIntl();return{versionNoteChanged:e.formatMessage({id:"Buh8fs",defaultMessage:"File version notes changed."}),versionNoteCanNotSave:e.formatMessage({id:"4QU8UF",defaultMessage:"Couldn't save your change."})}}(),[d,g]=o.reactExports.useState();o.reactExports.useEffect((()=>{(function(e,t){const o={file_id:e};return(new a.UserApiV2Client).ns("flows").rpc("version/get",o,{subjectUserId:t})})(e,t.id).then((e=>{var t;g(null===(t=e.version)||void 0===t?void 0:t.change_log)}))}),[e]);const u={logSaveNewVersionClick:(e,t,o)=>c.__awaiter(void 0,void 0,void 0,(function*(){const s=yield ee.getOrLoadPapEvents();a.logEvent(s.Select_SaveNewVersionButton({actionSurface:e,fileId:t,previewsSurface:o?l.getPreviewsSurfaceFromString(o):void 0}))})),logSaveNewVersionModalShown:(e,t)=>c.__awaiter(void 0,void 0,void 0,(function*(){const o=yield ee.getOrLoadPapEvents();a.logEvent(o.Shown_SaveNewVersionModal({actionSurface:te,fileId:e,previewsSurface:t?l.getPreviewsSurfaceFromString(t):void 0}))})),logSaveNewVersionNoteFill:(e,t)=>c.__awaiter(void 0,void 0,void 0,(function*(){const o=yield ee.getOrLoadPapEvents();a.logEvent(o.Fill_SaveNewVersionNoteInput({actionSurface:te,fileId:e,previewsSurface:t?l.getPreviewsSurfaceFromString(t):void 0}))})),logSaveNewVersionModalSaveClick:(e,t,o,s)=>c.__awaiter(void 0,void 0,void 0,(function*(){const n=yield ee.getOrLoadPapEvents();a.logEvent(n.Select_SaveNewVersionModalSaveButton({actionSurface:te,fileId:e,previewsSurface:s?l.getPreviewsSurfaceFromString(s):void 0,versionNameChanged:t,versionNoteFilled:o}))})),logVersionNoteUpdateClick:(e,t)=>c.__awaiter(void 0,void 0,void 0,(function*(){const o=yield ee.getOrLoadPapEvents();a.logEvent(o.Select_UpdateVersionNote({actionSurface:oe,fileId:e,previewsSurface:t?l.getPreviewsSurfaceFromString(t):void 0}))})),logVersionNoteSectionClick:(e,t)=>c.__awaiter(void 0,void 0,void 0,(function*(){const o=yield ee.getOrLoadPapEvents();a.logEvent(o.Select_VersionNoteSection({actionSurface:oe,fileId:e,previewsSurface:t?l.getPreviewsSurfaceFromString(t):void 0}))})),logSaveNewVersionSucceed:(e,t,o,s)=>c.__awaiter(void 0,void 0,void 0,(function*(){const n=yield ee.getOrLoadPapEvents();a.logEvent(n.Succeed_SaveNewVersion({actionSurface:te,fileId:e,previewsSurface:s?l.getPreviewsSurfaceFromString(s):void 0,versionNameChanged:t,versionNoteFilled:o}))})),logVersionNoteUpdateSucceed:(e,t)=>c.__awaiter(void 0,void 0,void 0,(function*(){const o=yield ee.getOrLoadPapEvents();a.logEvent(o.Succeed_UpdateVersionNote({actionSurface:oe,fileId:e,previewsSurface:t?l.getPreviewsSurfaceFromString(t):void 0}))})),logVersionFilenameChange:(e,t)=>c.__awaiter(void 0,void 0,void 0,(function*(){const o=yield ee.getOrLoadPapEvents();a.logEvent(o.Change_SaveNewVersionFilenameInput({actionSurface:te,fileId:e,previewsSurface:t?l.getPreviewsSurfaceFromString(t):void 0}))}))};return o.React$1.createElement(X,{actorAccountId:t.account_id,onSubmit:o=>{u.logVersionNoteUpdateClick(e,n),g({text:o,last_modified_user:t.account_id,last_modified_ts_in_seconds:(new Date).getTime()/1e3}),function(e,t,o){const s={file_id:e,change_log:t};return(new a.UserApiV2Client).ns("flows").rpc("version/update",s,{subjectUserId:o})}(e,o,t.id).then((t=>{var o;(null===(o=t.version)||void 0===o?void 0:o.change_log)&&g(t.version.change_log),u.logVersionNoteUpdateSucceed(e,n),a.Snackbar.complete(i,ae)})).catch((()=>{a.Snackbar.fail(r,ae)}))},changeLog:d,onFocusEditor:()=>{u.logVersionNoteSectionClick(e,n)}})};se.displayName="ChangeLogSection",t.ChangeLogSection=se}));
//# sourceMappingURL=c_flows_version_change_log_section.js-vflKNRMyT.map
