define(["exports","./e_core_exception","./c_tslib","./c_src_sink_index","./e_ui_page_files_router","./c_lodash-es_lodash","./c_core_exception_info"],(function(t,e,n,r,i,s,a){"use strict";class o{constructor(t){this.category="udcl-measures_restricted",this.measure_id=t.id,this.name=t.name,this.platform="web",this.start_time_ms=t.start_time_ms,this.end_time_ms=t.start_time_ms+t.duration_ms,this.duration_ms=t.duration_ms,this.extra=t.extra,Object.seal(this)}}const c=new i.HiveLogger,u="udcl",l="mark",d="measure",m=":";function _(t,...e){return[u,...e,t].join(m)}function f(t,...e){const n=_("",...e);return 0===t.indexOf(n)?t.slice(n.length):t}function h(t,...e){return"string"==typeof t?_(t,...e):t}function v(t){return t.entryType===d}const g="udcl";var p;!function(t){t.TTS="tts"}(p||(p={}));const y="web",T="time_to_resolution",w=[function(t,n){if(!v(n))return;const r=f(n.name,d);c.log(new o({id:t,name:r,start_time_ms:n.startTime,duration_ms:n.duration,extra:(i=n.detail,s.isPlainObject(i)?s.mapValues(i,(t=>{try{return"string"==typeof t?t:JSON.stringify(t)}catch(t){return e.reportStack("udcl.normalizeJson: value could not be serialized",{severity:a.SEVERITY.NONCRITICAL,exc_extra:{error:t.message}}),"[unserializable value]"}})):{})}));var i},function(t,e){let n;const r=JSON.stringify(e.detail),i={id:t,name:f(e.name,d),detail:r};n=e instanceof window.PerformanceMeasure?Object.assign(Object.assign({type:"measure"},i),{start_time_ms:e.startTime,duration_ms:e.duration}):Object.assign(Object.assign({type:"event"},i),{measure_id:void 0,timestamp:e.startTime});I.push(n)},function(t,e){var n,i;if(!v(e)||!function(t){var e,n;const r=f(t.name,d),i=null!==(n=null===(e=t.detail)||void 0===e?void 0:e.jtbd)&&void 0!==n?n:"";return Object.values(p).includes(r)&&(s=i,"string"==typeof s&&s.length>0);var s}(e))return;const s=f(e.name,d),a=null!==(i=String(null===(n=e.detail)||void 0===n?void 0:n.jtbd))&&void 0!==i?i:"",o=e.duration,c=function(t){var e;return null!==(e=b[t])&&void 0!==e?e:"unknown"}(s),l=a.replace(/[^-0-9a-zA-Z._]/g,"_"),m=[y,l,T].join("/");r.getMetricsReporter().createStats({ns:u,name:m},{resolution:c}).record(o)}],b={[p.TTS]:"success"},I=new class{constructor(t,e=3e4){this.storage=i.LocalStorage,this.flush=()=>{var t;const e=null!==(t=this.storage.get(g))&&void 0!==t?t:[];this.storage.delete(g),e.length>0&&this.onFlush(e)},this.push=(...t)=>{var e;const n=null!==(e=this.storage.get(g))&&void 0!==e?e:[];this.storage.set(g,n.concat(t))},this.cleanup=()=>{window.clearInterval(this.interval)},this.onFlush=t,this.interval=window.setInterval(this.flush,e)}}((function(t){return n.__awaiter(this,void 0,void 0,(function*(){try{yield function(t,e){const n=e.map((t=>Object.assign(Object.assign({},t),{tags:void 0}))),r=n.filter((t=>"event"===t.type)),i=n.filter((t=>"measure"===t.type));return t.ns("udcl").rpc("log_timing",{events:r,measures:i},{})}(O,t)}catch(e){I.push(...t)}}))})),O=new i.NoAuthApiV2Client;function j(t,e){window.RUNNING_IN_REACTSERVER||w.forEach((n=>n(t,e)))}t.mark=function(t,{startTime:e=performance.now()}={}){const n=_(t,l);performance.mark(n,{startTime:e})},t.measure=function(t,{start:n,end:r,detail:s}){const o=i.UUID.v4(),c=_(t,d),u=h(n,l),m=h(r,l);try{j(o,performance.measure(c,{start:u,end:m,detail:s}))}catch(t){e.reportException({err:t,severity:a.SEVERITY.NONCRITICAL})}return o},t.track=function(t,{startTime:n=performance.now(),detail:r}={}){const s=i.UUID.v4(),o=_(t,"track");try{j(s,performance.mark(o,{startTime:n,detail:r}))}catch(t){e.reportException({err:t,severity:a.SEVERITY.NONCRITICAL})}return s}}));
//# sourceMappingURL=c_udcl_index.js-vfldFUmuY.map
