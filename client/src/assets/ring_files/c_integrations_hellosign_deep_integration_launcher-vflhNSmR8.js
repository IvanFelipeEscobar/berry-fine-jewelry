define(["require","exports","./c_tslib","./e_edison","./c_core_notify","./e_ui_page_files_router","./e_core_exception","./c_src_instrumentation_function_wrapper","./c_src_instrumentation_constants","./c_core_i18n","./c_table_index","./c_spectrum_icon_form_index","./c_src_text","metaserver/static/js/modules/constants/page_load","./c_core_browser_detection","metaserver/static/js/modules/core/langpack","./c_core_exception_info","./c_lodash-es_lodash","./c_dropins_sdk_refactor_src_v2_entry","./c_profile_services_profile_services_link","./c_profile_services_profile_services_constants","./c_base64","./c_account_email_verify_reasons","./c_integrations_hellosign_deep_integration_constants","./c_apex-metrics_src_types","metaserver/static/js/modules/constants/files_spa","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","metaserver/static/js/modules/constants/request","./c_core_xhr","./c_csrf","./c_browser_cookies","./c_src_sink_index","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","metaserver/static/js/modules/constants/login_and_register"],(function(e,t,n,i,s,a,r,o,c,l,g,d,h,u,m,p,f,_,E,R,S,v,I,b,y,T,C,w,N,x,$,P,k,A,O,M,D,U,F,L,H,W,q,B,j,z,V,G){"use strict";function Q(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var K=Q(p);class Y{constructor(e=document.body,t=document,n=window){this.show=()=>{this.anchor.contains(this.container)||this.anchor.appendChild(this.container),this.container.hidden=!1},this.hide=()=>{this.container.hidden=!0},this.reset=()=>{this.anchor.removeChild(this.container),this.container=this.createContainer()},this.renderContent=e=>{i.reactDomExports.render(e,this.container)},this.hideOverflow=()=>{this.windowObj.scrollTo(0,0),this.documentEl.documentElement.classList.add("hs-int-hellosign-overflow-hide")},this.removeHideOverflow=()=>{this.documentEl.documentElement.classList.remove("hs-int-hellosign-overflow-hide")},this.createContainer=()=>{const e=document.createElement("div");return e.className="hs-int-full-screen-container",e.hidden=!0,e},this.container=this.createContainer(),this.anchor=e,this.documentEl=t,this.windowObj=n,s.require_css("/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css")}}const X={nextButton:l.intl.formatMessage({id:"6752Ag",defaultMessage:"Next"}),addSignerButton:l.intl.formatMessage({id:"oXwe58",defaultMessage:"Add signer"}),selfSignButton:l.intl.formatMessage({id:"/dgTxh",defaultMessage:"I’m the only signer"}),subTitle:l.intl.formatMessage({id:"H+e+Nv",defaultMessage:"Who needs to sign"}),emailOptedInStatement:l.intl.formatMessage({id:"uzC4BU",defaultMessage:"Send me Dropbox Sign updates."}),emailErrorMessage:l.intl.formatMessage({id:"sUFO8F",defaultMessage:"A valid email is required"}),nameErrorMessage:l.intl.formatMessage({id:"QKJ1Bh",defaultMessage:"A valid name is required"}),nameHeader:l.intl.formatMessage({id:"uHIr29",defaultMessage:"Name"}),emailHeader:l.intl.formatMessage({id:"POr9LO",defaultMessage:"Email"})};var Z;!function(e){e.EMAIL="email",e.NAME="name"}(Z||(Z={}));const J=a.requireCssWithComponent((({onAcceptTos:e,onStart:t,logEvent:n,fileName:s,onClose:r,optInRequired:d,userHasSeenModal:h,onContinueWithoutTos:u})=>{const[m,p]=i.React$1.useState(!1),f=i.React$1.useRef(1),[_,E]=i.React$1.useState([{email:"",name:""}]),[R,S]=i.React$1.useState(!1),[v,I]=i.React$1.useState(!1),b=i.React$1.useRef(new Set),y=i.React$1.useRef(new Set),[T,C]=i.React$1.useState(new Set),[w,N]=i.React$1.useState(new Set),x=o.functionWrapperProvider(n,c.InstrFeatureType.TosWithRecipientsInfo);i.React$1.useEffect((()=>{a.ProEventsLogger.log("bt_tos_modal_with_recipients_info_shown")}),[]);const $=()=>{O(!1)&&(t(),h?u(_):e(!d||v,_))},P=i.React$1.createRef(),k=()=>I((e=>!e)),A=e=>{const t=e.trim();if(t){const e=t.split("@");if(2!==e.length)return!1;{const[t,n]=e,i=/^[\x00-\x7f]*$/,s=/^[\w!#$%&'*+\-\/=?^`{|}~.]+$/,a=new RegExp("^([a-z0-9][a-z0-9\\-]*\\.)+([a-z]+|xn--[a-z0-9\\-]+)$","i");return!!s.test(t)&&!(!n||i.test(n)&&!a.test(n))}}return!1},O=e=>{if(R)return!0;let t=!0,n=!0;for(const i in _){const s=_[i].email,a=_[i].name;s&&(t=!1,A(s)?b.current.has(i)&&b.current.delete(i):(n=!1,e||(b.current=b.current.add(i))),a||(n=!1,e||(y.current=y.current.add(i)))),a&&(t=!1,a.trim()?y.current.has(i)&&y.current.delete(i):(n=!1,e||(y.current=y.current.add(i))),s||(e||(b.current=b.current.add(i)),n=!1)),a||s||(b.current.has(i)&&b.current.delete(i),y.current.has(i)&&y.current.delete(i))}t&&(y.current=y.current.add("0"),b.current=b.current.add("0"));const i=new Set(b.current);C(i);const s=new Set(y.current);return N(s),!t&&n},M=o.onClickWrapper(x,c.InstrActionType.AcceptTOS,$),D=o.onClickWrapper(x,c.InstrActionType.ContinueWithSignersModal,$),U=o.onClickWrapper(x,c.InstrActionType.CancelFlow,r),F=o.onClickWrapper(x,c.InstrActionType.ViewTerms,(()=>{})),L=o.onClickWrapper(x,c.InstrActionType.ViewPrivacyPolicy,(()=>{})),H=o.onClickWrapper(x,c.InstrActionType.AddSigner,(()=>{if(19===f.current)return;f.current+=1;const e=_.slice();e.push({email:"",name:""}),E(e)})),W=o.onClickWrapper(x,c.InstrActionType.ToggleSelfSign,(()=>{f.current=1,S((e=>!e));E([{email:"",name:""}]),b.current=new Set,y.current=new Set,C(b.current),N(y.current)}),{extra:{is_self_sign:R?"OFF":"ON"}}),q=l.defineMessage({id:"Yzyn1+",defaultMessage:"I agree to the Dropbox Sign <term>Terms</term> and <policy>Privacy Policy</policy>. We’ll create a Dropbox Sign account with your Dropbox email address if you don’t have one, or link your existing one if you do. Your accounts will be linked across platforms."}),B=l.intl.formatMessage(l.defineMessage({id:"7KWXXT",defaultMessage:"I understand this is the legal representation of the signature."})),j=l.intl.formatMessage(q,{term:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/terms",target:"_blank",rel:"noreferrer noopener",onClick:F},e),policy:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/privacy",target:"_blank",rel:"noreferrer noopener",onClick:L},e)}),z=()=>{p((e=>!e)),a.ProEventsLogger.log("toggle_tos_checkbox")},V=l.intl.formatMessage(q,{term:e=>e,policy:e=>e}),G=i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement("div",{className:"hs-int-tos-redesign-file-icon-and-file-name"},i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(a.FileIcon,{path:s,"aria-label":s,role:"img",variant:"small",className:"hs-int-tos-redesign-file-icon"}),i.React$1.createElement(a.Text,{variant:"label",size:"standard",isBold:!0,className:"hs-int-tos-redesign-file-name"},s))),i.React$1.createElement(a.IconButton,{"aria-label":"close",className:"hs-int-tos-redesign-header-close-button",onClick:()=>{U(),p(!1),f.current=1;E([{email:"",name:""}]),S(!1),I(!1),b.current=new Set,y.current=new Set,C(b.current),N(y.current)},variant:"transparent",size:"small"},i.React$1.createElement(a.UIIcon,{src:a.CloseLine}))),Q=e=>i.React$1.createElement("div",{className:"hs-int-tos-redesign-error-message"},i.React$1.createElement(a.Text,{color:"error"},i.React$1.createElement(a.UIIcon,{src:a.WarningLine,size:"standard"})),i.React$1.createElement("div",{style:{width:5}}),i.React$1.createElement(a.Text,{color:"error"},e)),K=i.React$1.useCallback(((e,t)=>!R&&(t===Z.EMAIL?T.has(String(_.indexOf(e))):t===Z.NAME&&w.has(String(_.indexOf(e))))),[T,w,_]),Y=i.React$1.createElement("div",{className:"hs-int-tos-redesign-main-content-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-container"},i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-header-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-header"},i.React$1.createElement(a.Title,{size:"large",className:"hs-int-tos-redesign-recipients-info-header"},X.subTitle),i.React$1.createElement(a.Text,{color:"faint"},l.intl.formatMessage({id:"CIydf/",defaultMessage:"Step 1 of 3"}))),i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-head-button"},i.React$1.createElement(a.Button$1,{variant:"transparent",onClick:W,withIconLeft:R?i.React$1.createElement(a.UIIcon,{src:a.CheckmarkLine,role:"presentation","data-uxa-log":"bt_tos_with_recipients_info_toggle_self_sign"}):null},X.selfSignButton))),i.React$1.createElement(g.Table,{className:"hs-int-tos-redesign-recipients-table",hasDividers:!1,spacing:"standard",verticalAlign:"top",style:{margin:-15}},i.React$1.createElement(g.Table.Body,null,_.map((e=>i.React$1.createElement(g.Table.Row,{key:_.indexOf(e)},i.React$1.createElement(g.Table.Cell,{width:"50%"},i.React$1.createElement(a.Text,{isBold:!0,color:R?"disabled":"standard"},X.nameHeader),i.React$1.createElement("div",{style:{height:10}}),i.React$1.createElement(a.TextInput,{wrapperProps:K(e,Z.NAME)?{className:"hs-int-tos-redesign-recipients-table-input--red"}:void 0,"aria-label":"recipient-name-input",onChange:t=>((e,t)=>{const n=_.slice();n[t].name=e,E(n),O(!0)})(t.target.value,_.indexOf(e)),value:e.name,placeholder:X.nameHeader,ref:P,disabled:R}),K(e,Z.NAME)?Q(X.nameErrorMessage):null),i.React$1.createElement(g.Table.Cell,{width:"50%"},i.React$1.createElement(a.Text,{isBold:!0,color:R?"disabled":"standard"},X.emailHeader),i.React$1.createElement("div",{style:{height:10}}),i.React$1.createElement(a.TextInput,{wrapperProps:K(e,Z.EMAIL)?{className:"hs-int-tos-redesign-recipients-table-input--red"}:void 0,"aria-label":"recipient-email-input",onChange:t=>((e,t)=>{const n=_.slice();n[t].email=e,E(n),O(!0)})(t.target.value,_.indexOf(e)),placeholder:X.emailHeader,value:e.email,ref:P,disabled:R}),K(e,Z.EMAIL)?Q(X.emailErrorMessage):null),i.React$1.createElement(g.Table.Cell,{width:"fill-container",className:K(e,Z.NAME)||K(e,Z.EMAIL)?"hs-int-tos-redesign-recipients-table-delete-button--middle":"hs-int-tos-redesign-recipients-table-delete-button--bottom"},i.React$1.createElement(a.IconButton,{"aria-label":"delete",className:"hs-int-tos-redesign-recipients-info-delete-button",onClick:()=>(e=>{if(f.current>1){f.current-=1;const t=_.slice();t.splice(e,1),E(t),b.current.has(String(e))&&b.current.delete(String(e));const n=new Set(b.current);for(const t of n)if(Number(t)>e){const e=Number(t)-1;b.current.delete(t),b.current.add(String(e))}C(b.current),y.current.has(String(e))&&y.current.delete(String(e));const i=new Set(y.current);for(const t of i)if(Number(t)>e){y.current.delete(t);const e=Number(t)-1;y.current.add(String(e))}N(y.current)}})(_.indexOf(e)),variant:"transparent",disabled:0===_.indexOf(e)&&1===_.length},i.React$1.createElement(a.UIIcon,{src:a.DeleteLine,className:0===_.indexOf(e)&&1===_.length?"":"hs-int-tos-redesign-recipients-info-delete-button-icon"}))))))))),i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-button-section"},i.React$1.createElement(a.Button$1,{variant:"outline",size:"large",onClick:H,disabled:R||19===f.current,"data-uxa-log":"bt_tos_with_recipients_info_add_signer"},X.addSignerButton))),i.React$1.createElement("div",{className:"hs-int-tos-redesign-checkbox"},h?null:i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement("div",{className:"hs-int-tos-redesign-terms-checkbox"},i.React$1.createElement(a.Checkbox,{onChange:z,checked:m,"aria-label":V,className:"hs-int-tos-redesign-checkbox-square"}),i.React$1.createElement(a.Text,{size:"small"},j," ",i.React$1.createElement("br",null)," ",B)),d&&!h?i.React$1.createElement("div",{className:"hs-int-tos-redesign-email-promotion-checkbox"},i.React$1.createElement(a.Checkbox,{onChange:k,checked:v,"aria-label":X.emailOptedInStatement,className:"hs-int-tos-redesign-checkbox-square"}),i.React$1.createElement(a.Text,{size:"small"},X.emailOptedInStatement)):null)));return i.React$1.createElement("div",{className:"hs-int-tos-redesign-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-header-container"},G),i.React$1.createElement("div",{className:"hs-int-tos-redesign-scrollable-content-container"},Y),i.React$1.createElement("div",{className:"hs-int-tos-redesign-main-content-footer-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-action-button"},i.React$1.createElement(a.Button$1,{onClick:h?D:M,title:X.nextButton,variant:"primary",disabled:!m&&!h,className:"hs-int-tos-accept-button","data-uxa-log":"bt_tos_with_recipients_info_next_button"},X.nextButton))))}),["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]),ee={nextButton:l.intl.formatMessage({id:"6752Ag",defaultMessage:"Next"}),subTitle:l.intl.formatMessage({id:"L94peq",defaultMessage:"Agree to Dropbox Sign Terms"}),emailOptedInStatement:l.intl.formatMessage({id:"uzC4BU",defaultMessage:"Send me Dropbox Sign updates."})},te=a.requireCssWithComponent((({onAcceptTos:e,onStart:t,logEvent:n,fileName:s,onClose:r,optInRequired:g,userHasSeenModal:d,onContinueWithoutTos:h})=>{const[u,m]=i.React$1.useState(!1),[p,f]=i.React$1.useState(!1),_=o.functionWrapperProvider(n,c.InstrFeatureType.TosWithRecipientsInfo);i.React$1.useEffect((()=>{a.ProEventsLogger.log("bt_tos_modal_self_sign_shown")}),[]);const E=()=>{t(),d?h():e(!g||p)},R=()=>f((e=>!e)),S=o.onClickWrapper(_,c.InstrActionType.AcceptTOS,E),v=o.onClickWrapper(_,c.InstrActionType.ContinueWithSignersModal,E),I=o.onClickWrapper(_,c.InstrActionType.CancelFlow,r),b=o.onClickWrapper(_,c.InstrActionType.ViewTerms,(()=>{})),y=o.onClickWrapper(_,c.InstrActionType.ViewPrivacyPolicy,(()=>{})),T=l.defineMessage({id:"pAaV0h",defaultMessage:"I agree to the <term>Dropbox Sign Terms</term>. Learn about how we use and protect your data in our <policy>Privacy Policy</policy>. We’ll create a Dropbox Sign account with your Dropbox email address, or link to your existing account."}),C=l.intl.formatMessage(l.defineMessage({id:"7KWXXT",defaultMessage:"I understand this is the legal representation of the signature."})),w=l.intl.formatMessage(T,{term:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/terms",target:"_blank",rel:"noreferrer noopener",onClick:b},e),policy:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/privacy",target:"_blank",rel:"noreferrer noopener",onClick:y},e)}),N=()=>{m((e=>!e)),a.ProEventsLogger.log("toggle_tos_checkbox")},x=l.intl.formatMessage(T,{term:e=>e,policy:e=>e}),$=i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(a.Title,{size:"large",className:"hs-int-tos-redesign-self-sign-header"},ee.subTitle),i.React$1.createElement(a.IconButton,{"aria-label":"close",className:"hs-int-tos-redesign-header-close-button",onClick:()=>{I(),m(!1)},variant:"transparent",size:"small"},i.React$1.createElement(a.UIIcon,{src:a.CloseLine}))),P=i.React$1.createElement("div",{className:"hs-int-tos-redesign-main-content-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-recipients-info-container"},i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement("div",{className:"hs-int-tos-redesign-self-sign-content-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-self-sign-sub-header"},i.React$1.createElement(a.Text,{color:"faint"},l.intl.formatMessage({id:"CIydf/",defaultMessage:"Step 1 of 3"})))),i.React$1.createElement("div",{className:"hs-int-tos-redesign-self-sign-file-icon-and-file-name"},i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(a.FileIcon,{path:s,"aria-label":s,role:"img",variant:"small",className:"hs-int-tos-redesign-self-sign-file-icon"}),i.React$1.createElement(a.Text,{variant:"label",size:"standard",isBold:!0,className:"hs-int-tos-redesign-self-sign-file-name"},s))))),i.React$1.createElement("div",{className:"hs-int-tos-redesign-checkbox"},d?null:i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement("div",{className:"hs-int-tos-redesign-terms-checkbox"},i.React$1.createElement(a.Checkbox,{onChange:N,checked:u,"aria-label":x,className:"hs-int-tos-redesign-checkbox-square"}),i.React$1.createElement(a.Text,{size:"small"},w," ",i.React$1.createElement("br",null),i.React$1.createElement("br",null)," ",C)),g&&!d?i.React$1.createElement("div",{className:"hs-int-tos-redesign-email-promotion-checkbox"},i.React$1.createElement(a.Checkbox,{onChange:R,checked:p,"aria-label":ee.emailOptedInStatement,className:"hs-int-tos-redesign-checkbox-square"}),i.React$1.createElement(a.Text,{size:"small"},ee.emailOptedInStatement)):null)));return i.React$1.createElement("div",{className:"hs-int-tos-redesign-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-self-sign-header-container"},$),i.React$1.createElement("div",{className:"hs-int-tos-redesign-content-container"},P),i.React$1.createElement("div",{className:"hs-int-tos-redesign-main-content-footer-container"},i.React$1.createElement("div",{className:"hs-int-tos-redesign-action-button"},i.React$1.createElement(a.Button$1,{onClick:d?v:S,title:ee.nextButton,variant:"primary",disabled:!u&&!d,className:"hs-int-tos-accept-button","data-uxa-log":"bt_tos_with_recipients_info_next_button"},ee.nextButton))))}),["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]),ne=({color:e})=>{const t="sapphire"===e?"#0d2484":"white";return i.React$1.createElement("svg",{width:"48",height:"40",viewBox:"0 0 48 40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i.React$1.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.7061 14.9679L0 7.51017L11.7888 0L23.5682 7.5045L35.3483 0L47.1366 7.51017L35.4305 14.9677L47.1368 22.4256L35.3481 29.9359L23.5683 22.4313L11.7886 29.9359L0 22.4256L11.7061 14.9679ZM23.5682 7.51584L35.2656 14.9679L23.5683 22.4199L11.871 14.9677L23.5682 7.51584ZM23.6531 39.9351L11.8644 32.4247L23.6531 24.9153L35.4419 32.4247L23.6531 39.9351Z",fill:t}))};function ie(){switch(u.PAGE_LOCALE||"en_US"){case"da_DK":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-da_DK-vflev2nla.gif");case"de":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-de-vflmTVCdO.gif");case"en_GB":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-en_GB-vflmA_g94.gif");case"es":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-es-vfllHw0PM.gif");case"es_ES":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-es_ES-vflRmKQl4.gif");case"fr":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-fr-vflqcThGf.gif");case"id":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-id-vflT5Hn2D.gif");case"it":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-it-vflOYD-0N.gif");case"ja":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ja-vfliiIOOL.gif");case"ko":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ko-vflSPFPmr.gif");case"ms":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ms-vfli8wwVt.gif");case"nb_NO":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-nb_NO-vflcDuOCP.gif");case"nl_NL":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-nl_NL-vflPQqelQ.gif");case"pl":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-pl-vflwp4_NJ.gif");case"pt_BR":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-pt_BR-vflm25c60.gif");case"ru":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ru-vfl6KsI3f.gif");case"sv_SE":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-sv_SE-vflPSZhlS.gif");case"th_TH":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-th_TH-vflI-EUYa.gif");case"uk_UA":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-uk_UA-vflCSYd-h.gif");case"zh_CN":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-zh_CN-vfldFx8CJ.gif");case"zh_TW":return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-zh_TW-vflbjmtiv.gif");default:return i.static_url("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-vfl5F6roQ.gif")}}ne.displayName="DropboxLogo";const se={agree:l.intl.formatMessage({id:"k2WBHu",defaultMessage:"Agree"}),cancel:l.intl.formatMessage({id:"fCZlT5",defaultMessage:"Cancel"}),chooseFile:l.intl.formatMessage({id:"SvnKud",defaultMessage:"Choose a File"})};var ae;!function(e){e.AcceptPage="accept_page",e.ChooseFilePage="choose_file_page"}(ae||(ae={}));const re=({primaryButtonText:e,onClickPrimaryButton:t,primaryButtonDisabled:n,secondaryButtonText:s,onClickSecondaryButton:r,leftColumnContent:o,rightColumnContent:c,onClose:g,blueSide:h})=>{const u=l.intl.formatMessage({id:"9yYWu+",defaultMessage:"Close"}),m=s&&r?i.React$1.createElement(a.Button$1,{onClick:r,title:s,variant:"opacity"},s):null,p=i.React$1.createElement("div",{className:"hs-int-tos-container-right-col-action-buttons"},m,i.React$1.createElement("div",{style:{width:10}}),i.React$1.createElement(a.Button$1,{onClick:t,title:e,variant:"primary",disabled:n,className:"hs-int-tos-accept-button"},e)),[f,_]="left"===h?["hs-int-tos-container-left-col-blue","hs-int-tos-container-right-col"]:["hs-int-tos-container-left-col","hs-int-tos-container-right-col-blue"];return i.React$1.createElement("div",{className:"hs-int-tos-container"},i.React$1.createElement("div",{className:f},i.React$1.createElement("div",{className:"hs-int-tos-container-left-col-logo"},i.React$1.createElement(ne,{color:"left"===h?"white":"sapphire"})),i.React$1.createElement("div",{className:"hs-int-tos-container-left-col-content"},o),"left"===h?null:p),i.React$1.createElement("div",{className:_},i.React$1.createElement("div",{className:"hs-int-tos-container-right-col-close-wrapper"},i.React$1.createElement("div",{className:"hs-int-tos-container-right-col-close"},i.React$1.createElement(a.Button$1,{onClick:g,title:u,variant:"transparent",hasNoUnderline:!0},i.React$1.createElement(d.IconForm,{name:"cancel"})))),i.React$1.createElement("div",{className:"hs-int-tos-container-right-col-content"},c),"left"===h?p:null))};re.displayName="TermsOfServiceContainer";const oe=a.requireCssWithComponent((({onAcceptTos:e,onClose:t,onStart:n,onChooseFile:s,chooseFileRequired:r,logEvent:g,optInRequired:d,pageNum:u})=>{const[p,f]=i.React$1.useState(u||1),[_,E]=i.React$1.useState(!1),[R,S]=i.React$1.useState(!1),v=o.functionWrapperProvider(g,c.InstrFeatureType.HelloSignDeepIntegrationTOS),I=({title:e,subTitle:t,textColor:n})=>i.React$1.createElement("div",null,i.React$1.createElement("div",{className:"hs-int-tos-container-left-col-title"},i.React$1.createElement(h.Text,{fontWeight:"medium",color:n,size:"xxxlarge",className:"left-col-title-text"},e)),i.React$1.createElement("div",{className:"hs-int-tos-container-left-col-subtitle"},i.React$1.createElement(h.Text,{color:n,size:"large",className:"left-col-subtitle-text"},t))),b=()=>{const e=ae.ChooseFilePage,n=o.onClickWrapper(v,c.InstrActionType.ChooseFile,s,{extra:{tos_page_name:e}}),[a,r]=[se.chooseFile,n],g=i.React$1.createElement(i.React$1.Fragment,null,i.React$1.createElement(I,{title:l.intl.formatMessage({id:"AzuKe2",defaultMessage:"Simple, secure eSignatures"}),subTitle:l.intl.formatMessage({id:"bBvwr6",defaultMessage:"Send, sign and store your most important documents - all in Dropbox"}),textColor:"text"}),i.React$1.createElement("ol",{className:"hs-int-tos-info-page-right-col-intro"},[l.intl.formatMessage({id:"hRdISa",defaultMessage:"<bold>Simply add signers</bold> by email address to send out for signature requests."},{bold:(...e)=>i.React$1.createElement(h.Text,{color:"text",size:"small",fontWeight:"medium"},e)}),l.intl.formatMessage({id:"LTJsAc",defaultMessage:"<bold>Easily prep your document</bold> by placing fields to specify the sections that needs to be signed, dated and more."},{bold:(...e)=>i.React$1.createElement(h.Text,{color:"text",size:"small",fontWeight:"medium"},e)}),l.intl.formatMessage({id:"swViYV",defaultMessage:"<bold>Choose your Dropbox folder</bold> for your signed copy to be automatically saved and safely stored."},{bold:(...e)=>i.React$1.createElement(h.Text,{color:"text",size:"small",fontWeight:"medium"},e)})].map(((e,t)=>i.React$1.createElement(h.Text,{color:"text",size:"small",key:t},i.React$1.createElement("li",null,0!==t?i.React$1.createElement("div",{style:{height:16}}):null,e)))))),d=l.intl.formatMessage({id:"tp+m7M",defaultMessage:"Dropbox Sign Deep Integration"}),u=i.React$1.createElement("div",{className:"hs-int-tos-info-page-right-col"},i.React$1.createElement("img",{src:ie(),alt:d,className:"hs-int-tos-info-page-right-col-media"}));return i.React$1.createElement(re,{primaryButtonText:a,onClickPrimaryButton:r,leftColumnContent:g,rightColumnContent:u,onClose:t,blueSide:"right"})};if(1===p)return(()=>{const s=ae.AcceptPage,g=o.onClickWrapper(v,c.InstrActionType.AcceptTOS,(()=>{r?f((e=>e+1)):n(),e(!d||R)}),{extra:{tos_page_name:s}}),u=o.onClickWrapper(v,c.InstrActionType.CancelFlow,t,{extra:{tos_page_name:s}}),m=o.onClickWrapper(v,c.InstrActionType.ViewTerms,(()=>{}),{extra:{tos_page_name:s}}),p=o.onClickWrapper(v,c.InstrActionType.ViewPrivacyPolicy,(()=>{}),{extra:{tos_page_name:s}}),b=i.React$1.createElement(I,{title:l.intl.formatMessage({id:"7httnm",defaultMessage:"Get documents signed with Dropbox Sign"}),subTitle:l.intl.formatMessage({id:"4Wcb1b",defaultMessage:"Dropbox Sign lets you request signatures or sign documents right from Dropbox."}),textColor:"text-inverted"}),y=l.defineMessage({id:"4DXKsB",defaultMessage:"I agree to the Dropbox Sign <term>Terms</term> and <policy>Privacy Policy</policy>."}),T=l.intl.formatMessage(y,{term:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/terms",target:"_blank",rel:"noreferrer noopener",onClick:m},e),policy:e=>i.React$1.createElement("a",{href:"https://www.hellosign.com/privacy",target:"_blank",rel:"noreferrer noopener",onClick:p},e)}),C=l.intl.formatMessage(y,{term:e=>e,policy:e=>e}),w=l.intl.formatMessage({id:"uzC4BU",defaultMessage:"Send me Dropbox Sign updates."}),N=i.React$1.createElement("div",{className:"hs-int-tos-accept-page-right-col-content"},i.React$1.createElement(h.Text,{color:"text",size:"large"},l.intl.formatMessage({id:"B9nvoc",defaultMessage:"We’ll create a Dropbox Sign account for you automatically."}),i.React$1.createElement("br",null),i.React$1.createElement("br",null),l.intl.formatMessage({id:"eL77jo",defaultMessage:"If you already have a Dropbox Sign account, we’ll link it to your Dropbox account if the email address for both are the same."})),i.React$1.createElement("div",{className:"hs-int-tos-accept-page-right-col-tos-content"},i.React$1.createElement(h.Text,{color:"text",size:"large"},l.intl.formatMessage({id:"HDZWlz",defaultMessage:"Click Agree to:"})),i.React$1.createElement("ul",{className:"hs-int-tos-accept-page-right-col-tos-content-list"},i.React$1.createElement("li",{className:"hs-int-tos-accept-page-right-col-tos-content-list-item"},i.React$1.createElement(h.Text,{color:"text",size:"large"},l.intl.formatMessage({id:"d0qVW8",defaultMessage:"Give Dropbox Sign full access to your Dropbox account."}))),i.React$1.createElement("li",{className:"hs-int-tos-accept-page-right-col-tos-content-list-item"},i.React$1.createElement(h.Text,{color:"text",size:"large"},l.intl.formatMessage({id:"TwhAg2",defaultMessage:"Give Dropbox full access to your Dropbox Sign account."}))))),i.React$1.createElement("div",{className:"hs-int-tos-accept-page-right-col-checkbox"},i.React$1.createElement(a.Checkbox,{onChange:()=>E((e=>!e)),checked:_,"aria-label":C,className:"hs-int-tos-accept-page-right-col-checkbox-square"}),i.React$1.createElement("div",{style:{width:10}}),i.React$1.createElement(h.Text,{color:"text",size:"medium"},T)),d?i.React$1.createElement("div",{className:"hs-int-tos-accept-page-right-col-email-promotion-checkbox"},i.React$1.createElement(a.Checkbox,{onChange:()=>S((e=>!e)),checked:R,"aria-label":w,className:"hs-int-tos-accept-page-right-col-email-promotion-checkbox-square"}),i.React$1.createElement("div",{style:{width:10}}),i.React$1.createElement(h.Text,{color:"text",size:"medium"},w)):null);return i.React$1.createElement(re,{primaryButtonText:se.agree,onClickPrimaryButton:g,primaryButtonDisabled:!_,secondaryButtonText:se.cancel,onClickSecondaryButton:u,leftColumnContent:b,rightColumnContent:N,onClose:u,blueSide:"left"})})();if(2===p)return r?m.safari||m.mozilla?b():(s(),null):b();throw`wrong page number in TOS page: ${p}`}),["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]),ce=a.requireCssWithComponent((({title:e,body:t,buttonName:n,learnMoreLink:s,onClose:r})=>{const[o,c]=i.reactExports.useState(!0),g=()=>{c((e=>!e)),r()},d=l.intl.formatMessage({id:"zcHXrL",defaultMessage:"Learn more"});return i.reactExports.createElement(a.Modal$1,{className:"hs-int-safari-unspported-modal",open:o,width:"small",isCentered:!0,withCloseButton:"Close",onRequestClose:g},i.reactExports.createElement(a.Modal$1.Header,{hasBottomSpacing:"title-standard"},i.reactExports.createElement(a.Title,null,e)),i.reactExports.createElement(a.Modal$1.Body,{hasVerticalSpacing:!1},t),i.reactExports.createElement(a.Modal$1.Footer,null,i.reactExports.createElement(a.Button$1,{variant:"transparent",onClick:()=>{a.open_tab(s)}},d),i.reactExports.createElement("div",{style:{display:"none"}},i.reactExports.createElement(a.Button$1,{variant:"opacity"},"Button")),i.reactExports.createElement(a.Button$1,{variant:"primary",onClick:g},n)))}),["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]),le=e=>{var{dimming:t,centeredContent:s}=e,a=n.__rest(e,["dimming","centeredContent"]);const r=["hs-int-dimmer-background",s?"hs-int-dimmer-background-centered":""],o={};return void 0!==t&&(o.backgroundColor="rgba(0, 0, 0, 0.5)"),i.React$1.createElement("div",{className:r.join(" "),style:o},a.children)};le.displayName="Background";const ge=a.requireCssWithComponent(le,["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]);var de,he,ue;!function(e){e.APP_CONFIGURE="hellosign:configure",e.APP_ERROR="hellosign:error",e.APP_INITIALIZE="hellosign:initialize",e.DEEP_INTEGRATION_FINISHED="hellosign:deepIntegrationFinished",e.USER_CANCEL_REQUEST="hellosign:userCancelRequest",e.USER_CREATE_TEMPLATE="hellosign:userCreateTemplate",e.USER_DECLINE_REQUEST="hellosign:userDeclineRequest",e.USER_FINISH_REQUEST="hellosign:userFinishRequest",e.USER_PREP_SEND_EDITOR_CONTINUE="hellosign:userPrepSendEditorContinue",e.USER_PREP_SEND_LOG="hellosign:userPrepSendLog",e.USER_REASSIGN_REQUEST="hellosign:userReassignRequest",e.USER_SEND_REQUEST="hellosign:userSendRequest",e.USER_SIGN_REQUEST="hellosign:userSignRequest",e.USER_PREP_SEND_EDITOR_DELETE_DOC="hellosign:userPrepSendEditorDeleteDoc",e.VERIFY_DOMAIN_REQUEST="hellosign:verifyDomainRequest",e.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS="hellosign:deepIntegrationWaitingForRecipients"}(de||(de={})),function(e){e.RECIPIENTS_PAGE="recipients",e.EDITOR_PAGE="place-fields",e.SAVE_BACK_LOCATION_SELECTION="dropin",e.REVIEW="review",e.FINAL_LOADING="deep-integration-save-back-loading"}(he||(he={})),function(e){e.DEEP_INTEGRATION_SEND_RECIPIENTS="dropbox:deepIntegrationSendRecipients"}(ue||(ue={}));const me=e=>"object"==typeof e&&"string"==typeof e.type&&(void 0===e.payload||"object"==typeof e.payload),pe=e=>!!me(e)&&!(e.type!==de.VERIFY_DOMAIN_REQUEST||!e.payload||"string"!=typeof e.payload.token),fe={[de.APP_CONFIGURE]:e=>!!me(e)&&e.type===de.APP_CONFIGURE,[de.APP_ERROR]:e=>!!me(e)&&e.type===de.APP_ERROR,[de.APP_INITIALIZE]:e=>!!me(e)&&e.type===de.APP_INITIALIZE,[de.DEEP_INTEGRATION_FINISHED]:e=>!!me(e)&&!(e.type!==de.DEEP_INTEGRATION_FINISHED||!e.payload||"string"!=typeof e.payload.filePath),[de.USER_CANCEL_REQUEST]:e=>!!me(e)&&e.type===de.USER_CANCEL_REQUEST,[de.USER_CREATE_TEMPLATE]:e=>!!me(e)&&e.type===de.USER_CREATE_TEMPLATE,[de.USER_DECLINE_REQUEST]:e=>!!me(e)&&e.type===de.USER_DECLINE_REQUEST,[de.USER_FINISH_REQUEST]:e=>!!me(e)&&e.type===de.USER_FINISH_REQUEST,[de.USER_PREP_SEND_EDITOR_CONTINUE]:e=>!!me(e)&&e.type===de.USER_PREP_SEND_EDITOR_CONTINUE,[de.USER_PREP_SEND_LOG]:e=>!!me(e)&&e.type===de.USER_PREP_SEND_LOG,[de.USER_REASSIGN_REQUEST]:e=>!!me(e)&&e.type===de.USER_REASSIGN_REQUEST,[de.USER_SEND_REQUEST]:e=>!!me(e)&&e.type===de.USER_SEND_REQUEST,[de.USER_SIGN_REQUEST]:e=>!!me(e)&&e.type===de.USER_SIGN_REQUEST,[de.USER_PREP_SEND_EDITOR_DELETE_DOC]:e=>!!me(e)&&e.type===de.USER_PREP_SEND_EDITOR_DELETE_DOC,[de.VERIFY_DOMAIN_REQUEST]:pe,[de.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS]:e=>!!me(e)&&e.type===de.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS},_e=()=>{},Ee={[de.APP_CONFIGURE]:_e,[de.APP_ERROR]:_e,[de.APP_INITIALIZE]:_e,[de.DEEP_INTEGRATION_FINISHED]:_e,[de.USER_CANCEL_REQUEST]:_e,[de.USER_CREATE_TEMPLATE]:_e,[de.USER_DECLINE_REQUEST]:_e,[de.USER_FINISH_REQUEST]:_e,[de.USER_PREP_SEND_EDITOR_CONTINUE]:_e,[de.USER_PREP_SEND_LOG]:_e,[de.USER_REASSIGN_REQUEST]:_e,[de.USER_SEND_REQUEST]:_e,[de.USER_SIGN_REQUEST]:_e,[de.USER_PREP_SEND_EDITOR_DELETE_DOC]:_e,[de.VERIFY_DOMAIN_REQUEST]:_e,[de.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS]:_e};class Re{constructor(e,t,n={},i){this.startListening=()=>{window&&window.addEventListener("message",this.onMessageHandler)},this.stopListening=()=>{window&&window.removeEventListener("message",this.onMessageHandler)},this.onMessageHandler=e=>{if(!this.canHandleMessage(e))return;const t=e.data;if(!me(t))return void this.unknownMessageHandler("unknown",JSON.stringify(t));if(!(0,fe[t.type])(t))return void this.unknownMessageHandler(t.type,JSON.stringify(t));const n=this.externalHandlers[t.type];if(!n)throw`couldn't find messageHandler for message type ${t.type}`;pe(t)&&this.respondVerifyDomainRequest(t),n(t)},this.respondVerifyDomainRequest=e=>{this.allowedSource&&this.allowedSource.postMessage({type:"hellosign:verifyDomainResponse",payload:{token:e.payload.token}},this.allowedOrigin)},this.sendRecipients=e=>{this.allowedSource&&this.allowedSource.postMessage({type:ue.DEEP_INTEGRATION_SEND_RECIPIENTS,payload:e},this.allowedOrigin)},this.canHandleMessage=e=>e.origin===this.allowedOrigin&&e.source===this.allowedSource,this.allowedOrigin=e,this.allowedSource=t,this.externalHandlers=Object.assign(Object.assign({},Ee),n),this.unknownMessageHandler=i}static new(e,t,n={},i){return new Re(e,t,n,i)}}class Se extends i.React$1.Component{constructor(e){super(e),this.setIframeRef=e=>{this.iframeRef=e,this.iframeRef.onload=()=>{this.setState({appInitialized:!0})}},this.getMessageHandlers=()=>({[de.APP_INITIALIZE]:this.handleAppInitializedMessage,[de.DEEP_INTEGRATION_FINISHED]:this.props.onComplete,[de.USER_CREATE_TEMPLATE]:this.props.onComplete,[de.USER_SEND_REQUEST]:this.props.onComplete,[de.USER_CANCEL_REQUEST]:this.props.onClose,[de.USER_PREP_SEND_LOG]:this.props.onLog,[de.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS]:this.handleWaitingForRecipientsMessage}),this.handleWaitingForRecipientsMessage=()=>{if(!this.props.recipientInfo){const e=new Error("No Recipient info provided but was requested by iframe");throw r.reportException({err:e,severity:f.SEVERITY.CRITICAL,tags:["hellosign_deepintegration","better-together"]}),e}this.channel.sendRecipients(this.props.recipientInfo)},this.handleUnknownMessage=(e,t)=>{console.log(e),console.log(t)},this.handleAppInitializedMessage=()=>{this.setState({appInitialized:!0}),this.props.linkHelloSign()},this.getEditorDomain=()=>{const{url:e}=this.props,t=e.getAuthority();return`${e.getScheme()}://${t}`},this.state={appInitialized:!1}}componentDidMount(){this.channel=Re.new(this.getEditorDomain(),this.iframeRef.contentWindow,this.getMessageHandlers(),this.handleUnknownMessage),this.channel.startListening()}componentWillUnmount(){this.channel.stopListening()}render(){const{url:e}=this.props,t=i.React$1.createElement(l.IntlProvider,{defaultLocale:"en-US",locale:l.localeToBcp47LangTag(u.PAGE_LOCALE),messages:K},i.React$1.createElement("div",{className:"hs-int-hellosign-loading"},i.React$1.createElement(a.Spinner,{className:"hs-int-hellosign-spinner","aria-valuetext":"Loading large",size:"large"}),i.React$1.createElement("div",{className:"hs-int-hellosign-loading-copy"},i.React$1.createElement(a.Title,{size:"standard"},i.React$1.createElement(l.FormattedMessage,{id:"JZpfYr",defaultMessage:"Preparing document..."})))));return i.React$1.createElement("div",{className:"hs-int-hellosign-page"},!this.state.appInitialized&&t,i.React$1.createElement("iframe",{ref:this.setIframeRef,className:"hs-int-hellosign-page-iframe",src:e.toString()}))}}Se.displayName="HelloSign";const ve=a.requireCssWithComponent(Se,["/static/metaserver/static/css/integrations/hellosign_deep_integration-vflaq8BKC.css"]),Ie=()=>{const e=a.getActiveUser();return e?new a.DefaultUserApiV2Client(e):new a.NoAuthApiV2Client};class be{constructor(t){this.optInRequired=!1,this.init=e=>{let t=e.apiV2Client||this.config.apiV2Client;void 0===e.apiV2Client&&e.user&&e.user!==this.config.user&&(t=new a.DefaultUserApiV2Client(e.user)),this.config.selfSign=!1,this.config=Object.assign(Object.assign(Object.assign({},this.config),e),{apiV2Client:t}),this.recipientInfo=void 0,this.refreshUserSettings(),this.refreshCheckSkipTos(),this.refreshFeatureVariant()},this.launch=()=>{if(!this.readyToLaunch()||!this.sendForSignatureEnabled)throw this.config.logEvent({event_name:c.InstrEventType.Failure,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:c.InstrActionType.Start,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),new Error("launcher isn't ready to launch. Make sure you have correctly initialized it.");return this.config.logEvent({event_name:c.InstrEventType.SelectAction,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({action:c.InstrActionType.Start,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}),m.msie?(this.config.logEvent({event_name:c.InstrEventType.ActionTaken,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:c.InstrActionType.MSIEUnsupported,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),this.showUnsupportedBrowserSnackbar(),Promise.resolve()):Promise.all([this.sendForSignatureEnabled,this.safariFixDisabled]).then((([e,t])=>{if(!e)return this.config.logEvent({event_name:c.InstrEventType.ActionTaken,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:c.InstrActionType.FeatureDisabled,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),void this.showTeamDisabledSnackbar();if(this.config.container.show(),m.safari){if(void 0===t)throw"safariFixDisabled is not loaded.";const{variant:e}=t;if("ON"!==e)return this.config.logEvent({event_name:c.InstrEventType.ActionTaken,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:c.InstrActionType.SafariUnsupported,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),void this.showSafariUnsupportedModal()}return this.tosAccepted.then((e=>n.__awaiter(this,void 0,void 0,(function*(){const{canSkipTos:t,emailUnverified:n}=yield this.checkCanSkipTos();n?this.showVerifyEmailDialog():e||t?!m.safari&&!m.mozilla||this.config.hasOwnProperty("file")?yield this.showHelloSignPage():this.showTosChooseFilePage():yield this.showTosAcceptTermsPage()})))).catch((e=>{console.log(e),this.reset(),this.config.logEvent({event_name:c.InstrEventType.Failure,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({action:c.InstrActionType.Start,entry_point:this.config.entryPoint,error:e},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})})}))}))},this.hideOverflow=()=>{this.config.hasOwnProperty("file")||this.config.container.hideOverflow()},this.removeHideOverflow=()=>{this.config.hasOwnProperty("file")||this.config.container.removeHideOverflow()},this.show=()=>{this.hideOverflow(),this.config.container.show()},this.hide=()=>{this.removeHideOverflow(),this.config.container.hide()},this.resetWhenCancelled=e=>{if(e.payload&&e.payload.path)switch(e.payload.path){case he.RECIPIENTS_PAGE:a.UserSurvey.trackEvent("hs_exit_who_needs_to_sign_screen","hellosign_deep_integration");break;case he.EDITOR_PAGE:a.UserSurvey.trackEvent("hs_exit_editor","hellosign_deep_integration");break;case he.REVIEW:a.UserSurvey.trackEvent("hs_exit_final_send_for_sig_screen","hellosign_deep_integration")}return this.reset()},this.reset=()=>(this.config.container.reset(),this.config.templateRoute=void 0,this.removeHideOverflow(),this.recipientInfo=void 0,this.refreshCheckSkipTos(),this.refreshUserSettings()),this.showTosChooseFilePage=()=>n.__awaiter(this,void 0,void 0,(function*(){this.hideOverflow(),this.config.container.renderContent(i.React$1.createElement(ge,{dimming:!0,centeredContent:!0},i.React$1.createElement(oe,{onAcceptTos:this.acceptTosInUserSettings,onClose:this.hide,onStart:this.showHelloSignPage,onChooseFile:this.showHelloSignPage,chooseFileRequired:void 0===this.config.file,logEvent:this.config.logEvent,optInRequired:this.optInRequired,pageNum:2})))})),this.showTosAcceptTermsPage=()=>n.__awaiter(this,void 0,void 0,(function*(){const e=this.showHelloSignPage;this.hideOverflow();const t=this.config.file;if(this.config.templateFlow||!t||this.config.selfSign)if(t&&this.config.selfSign){const n=(null==t?void 0:t.fq_path)?String(null==t?void 0:t.fq_path.split("/").slice(-1)):"";this.config.container.renderContent(i.React$1.createElement(ge,{dimming:!0,centeredContent:!0},i.React$1.createElement(te,{onAcceptTos:this.acceptTosInUserSettings,onContinueWithoutTos:this.updateRecipientsInfo,onStart:e,onClose:this.hide,logEvent:this.config.logEvent,fileName:n,optInRequired:this.optInRequired,userHasSeenModal:!1})))}else this.config.container.renderContent(i.React$1.createElement(ge,{dimming:!0,centeredContent:!0},i.React$1.createElement(oe,{onAcceptTos:this.acceptTosInUserSettings,onClose:this.hide,onStart:e,onChooseFile:e,chooseFileRequired:void 0===this.config.file,logEvent:this.config.logEvent,optInRequired:this.optInRequired})));else{const n=(null==t?void 0:t.fq_path)?String(null==t?void 0:t.fq_path.split("/").slice(-1)):"";this.config.container.renderContent(i.React$1.createElement(ge,{dimming:!0,centeredContent:!0},i.React$1.createElement(J,{onAcceptTos:this.acceptTosInUserSettings,onContinueWithoutTos:this.updateRecipientsInfo,onStart:e,onClose:this.hide,logEvent:this.config.logEvent,fileName:n,optInRequired:this.optInRequired,userHasSeenModal:!1})))}})),this.showVerifyEmailDialog=()=>n.__awaiter(this,void 0,void 0,(function*(){return new Promise((function(t,n){e(["./c_account_email"],t,n)})).then((function(e){return e.email_esnext})).then((({EmailVerification:e})=>{const t=this.config.user||a.getActiveUser();e.get_for_user(t).show_resend_verify_modal((()=>{}),I.EmailVerificationReasons.SIGN_DOCUMENTS,(()=>this.reset()),{hideChangeEmail:!0})}))})),this.showSafariUnsupportedModal=()=>{const e=l.intl.formatMessage({id:"WC+meb",defaultMessage:"Couldn’t start signature request"}),t=l.intl.formatMessage({id:"vxnAb7",defaultMessage:"This feature isn’t available on Safari, but will be soon. Please try on a different browser."}),n=l.intl.formatMessage({id:"WAQpuN",defaultMessage:"Close"});this.hideOverflow(),this.config.container.renderContent(i.React$1.createElement(ge,{dimming:!0,centeredContent:!0},i.React$1.createElement(ce,{title:e,body:t,buttonName:n,learnMoreLink:"https://help.dropbox.com/installs-integrations/third-party/hellosign#sign",onClose:this.reset})))},this.showFileChooser=e=>new Promise(((t,n)=>{const i={success:function(e){e.length&&t(e[0]),t(void 0)},cancel:function(){t(void 0)},linkType:"direct",multiselect:!1,extensions:b.HELLOSIGN_SUPPORTED_EXTENSIONS,folderselect:!1,initialNavigationPath:e};E.Dropbox.choose(i)})),this.showHelloSignPage=()=>n.__awaiter(this,void 0,void 0,(function*(){const{fileId:e,filePath:t}=yield this.getFileIdAndPath();if(!e)return;let n;this.hideOverflow(),m.safari&&(n=yield this.getDBXAuthLink());const s=yield this.getHelloSignUrl(e,t,n,this.allowEmailOptedIn),a=yield this.getVariant(this.signaturesTabOnShareVariant),r=yield this.getVariant(this.signaturesHubVariant);this.config.container.renderContent(i.React$1.createElement(ge,{centeredContent:!0},i.React$1.createElement(ve,{onClose:this.resetWhenCancelled,onComplete:e=>this.handleDeepIntegrationDone(e,a,r),onLog:this.handleLog,recipientInfo:this.getRecipientsPayload(),url:s,linkHelloSign:this.linkHelloSignIfNecessary})))})),this.getRecipientsPayload=()=>{let e;return this.config.selfSign?e={selfSign:this.config.selfSign,signers:[],recipientReassignment:!1,recipientOrder:!1}:this.recipientInfo&&(e=this.recipientInfo),e},this.dbxCollectedRecipientInfo=()=>!!this.config.selfSign||!!this.recipientInfo,this.showTeamDisabledSnackbar=()=>{this.showFailSnackbar(l.intl.formatMessage({id:"7NLYW8",defaultMessage:"The HelloSign integration has been disabled by your admin."}),l.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}))},this.showSendForSignatureSuccessSnackbar=(e,t,n)=>{if(n.payload.isDocToTemplateEnabled){const e=new i.URI;e.setPath("/signatures");const t=n.payload.signatureRequestId;return t&&e.updateQuery({request:t,"doc-to-template":"1"}),void a.redirect(e)}switch(this.config.entryPoint){case"landing_page":return void a.redirect("/hellosign/home");case"share_page_signature_tab_default":case"share_page_signature_tab_empty_state":return void a.redirect("/share/signatures");case"file_preview_actionbar_dropdown":case"file_preview_workflows_tab":case"share_menu":return void a.redirect("/signatures");default:if(this.config.entryPoint.startsWith("signature_hub"))return void a.redirect("/signatures")}switch(this.config.source){case"signature-hub":case"dropbox-file-hover-overflow-menu-send-for-esign":case"file_context_menu_mac":case"file_context_menu_win":case"file_context_menu_linux":return void a.redirect("/signatures")}const s=this.config.user;if(!s)throw new Error("User is missing in the config.");const o={name:"track_status",icon:a.SignatureLine,onClick:function(n){const i=["rich_snackbar_click","track_signature_status",e].join("_");let s;a.ProEventsLogger.log(i,{action:"rich_snackbar_click",variant:e}),"V1"===e?s="/hellosign/home":"V2"===e?s="/share/signatures":"V1"===t||"V2"===t?s="/signatures":(r.reportException({err:new Error(`Unexpected click for feature ${c.InstrFeatureType.SignaturesTabOnShare}with variant ${e}`),severity:f.SEVERITY.NONCRITICAL,tags:["rich_snackbar","product-growth"]}),s="/hellosign/home");s+="?_tk=post_signature_send_snackbar",a.redirect(s)},text:l.intl.formatMessage({id:"6B08Qw",defaultMessage:"Track status"})},g={clickHandlerArgs:{userId:s.id,filePath:""},actions:[o],actionBarAlignment:"left"},d=l.intl.formatMessage({id:"h7GFOm",defaultMessage:"File shared for signature"});a.Snackbar.show(i.React$1.createElement(a.Snackbar,{id:"track_status_snackbar",title:d,variant:"complete",richSnackbarProps:g,timeoutDelayMs:1e4}))},this.showUnsupportedBrowserSnackbar=()=>{this.showFailSnackbar(l.intl.formatMessage({id:"Cl3pwT",defaultMessage:"This feature isn’t available on Internet Explorer. Please try on a different browser."}),l.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}))},this.showFailSnackbar=(e,t)=>{a.Snackbar.show(i.React$1.createElement(a.Snackbar,{variant:"fail",timeoutDelayMs:1e4,title:e,closeButtonText:t}))},this.showRedirectSnackbar=()=>{a.Snackbar.show(i.React$1.createElement(a.Snackbar,{variant:"complete",timeoutDelayMs:1e4,title:l.intl.formatMessage({id:"rdpIKz",defaultMessage:"Redirecting you to the file preview."})}))},this.linkHelloSignIfNecessary=()=>n.__awaiter(this,void 0,void 0,(function*(){(yield this.isHelloSignProfileServiceLinked())?this.config.logEvent({event_name:c.InstrEventType.ActionTaken,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({action:c.InstrActionType.Start,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}):yield this.linkHelloSign()})),this.getDBXAuthLink=()=>n.__awaiter(this,void 0,void 0,(function*(){if(!this.config.user)throw"launcher isn't ready to launch. Make sure you have correctly initialized it.";if(yield this.isHelloSignProfileServiceLinked())return;const e=new R.ProfileServicesLinkingHandler,t=yield e.auth_service_with_user_promise(S.ProfileServicesConstants.HELLOSIGN,this.config.user.id,null,"link_contacts",R.AuthWindowOption.HIDDEN_IFRAME,void 0,void 0,void 0,void 0,!0);return(null==t?void 0:t.dbx_auth)||void 0})),this.linkHelloSign=()=>n.__awaiter(this,void 0,void 0,(function*(){if(!this.config.user)throw"launcher isn't ready to launch. Make sure you have correctly initialized it.";const e=new R.ProfileServicesLinkingHandler;this.config.logEvent({event_name:c.InstrEventType.ServiceConnectionFlowStart,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}),yield e.auth_service_with_user_promise(S.ProfileServicesConstants.HELLOSIGN,this.config.user.id,null,"link_contacts",R.AuthWindowOption.HIDDEN_IFRAME).then((({success:e})=>{e?console.log("HelloSign OAuth succeeded"):console.log("HelloSign OAuth failed")})).catch((e=>{console.log(e)})).finally((()=>{this.config.logEvent({event_name:c.InstrEventType.ServiceConnectionFlowEnd,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})})}))})),this.isHelloSignProfileServiceLinked=()=>this.config.apiV2Client.ns("profile_services").rpc("list_linked_services",void 0,{}).then((e=>e.linked_services.filter((e=>"hellosign"===e.service_type[".tag"]&&"is_connected"===e.connection_state[".tag"])).length>0)),this.getHelloSignUrl=(e,t,s,r)=>n.__awaiter(this,void 0,void 0,(function*(){var n;const o=yield this.helloSignEnvironment;if(!o)throw"launcher has not been initialized, please call init() first";const{user:c,templateFlow:l,templateRoute:g}=this.config;if(!c)throw"launcher has not been initialized with a valid user, please set a user in init() first";s&&(s=v.encode(s));let d=new i.URI;return d.setScheme("https"),d.setAuthority(o.domain),d.setPath("/dropbox/embedded"),d.updateQuery({client_id:o.client_id,user:c.account_id,role:c.role,file_id:e,file_path:t,dbx_auth:s,email_optin:"boolean"==typeof r?String(r):void 0,utm_source:null!==(n=this.config.utmSource)&&void 0!==n?n:"dropbox-deep-integration",dbx_locale:u.PAGE_LOCALE,di_hs_home:"1",rpbhp:String(this.dbxCollectedRecipientInfo())}),this.isOnDevbox()&&d.updateQuery({parent_url:a.get_origin()}),l&&(d.updateQuery({template:"1"}),g&&(g.startsWith("http")?(d=i.URI.parse(g),d.updateQuery({client_id:o.client_id,parent_url:window.location.href,js_version:"2.0"})):d.setPath(g))),d})),this.isOnDevbox=()=>/^https:\/\/.*\.dev\.corp\.dropbox\.com$/.test(a.get_origin()),this.getFileIdAndPath=()=>n.__awaiter(this,void 0,void 0,(function*(){let e=this.config.file;if(!e){!m.safari&&!m.mozilla&&this.hide();const t=yield this.showFileChooser(this.config.fileChooserInitialNavigationPath);if(!t)return{};!m.safari&&!m.mozilla&&this.show(),e={file_id:t.id}}return e?e.fq_path?{fileId:e.file_id,filePath:e.fq_path.split("/").slice(0,-1).join("/")}:{fileId:e.file_id}:{}})),this.readyToLaunch=()=>!("unknown"===this.config.entryPoint||void 0===this.tosAccepted||!this.config.user),this.refreshUserSettings=()=>{const e=this.config.apiV2Client.ns("integrations").rpc("get_user_settings",{},{});return this.config.logEvent({event_name:c.InstrEventType.APITrace,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({api_name:"get_user_settings",entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),e.then((e=>{var t;this.optInRequired=!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.opt_in_required)})),this.tosAccepted=e.then((e=>{var t;return!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.tos_accepted)})),this.helloSignEnvironment=e.then((e=>e.hellosign_environment)),this.sendForSignatureEnabled=e.then((e=>{var t;return!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.send_for_signature_enabled)})),this.userSawSignersModal=e.then((e=>{var t;return!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.user_saw_signers_modal)})),Promise.all([this.tosAccepted,this.helloSignEnvironment,this.sendForSignatureEnabled,this.userSawSignersModal])},this.refreshCheckSkipTos=()=>{this.canSkipTosRequest=this.config.apiV2Client.ns("hellosign").rpc("ensure_dropbox_managed_link",{is_deep_integration:!0},{})},this.refreshFeatureVariant=()=>{const e=this.config.apiV2Client.ns("integrations").rpc("are_features_available",{features:[{feature:c.InstrFeatureType.HelloSignDeepIntegrationSafariFixDisabled},{feature:c.InstrFeatureType.SignaturesTabOnShare},{feature:c.InstrFeatureType.SignaturesHub}]},{});return this.config.logEvent({event_name:c.InstrEventType.APITrace,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({api_name:"are_features_available",entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),this.safariFixDisabled=e.then((e=>e.features[0])),this.signaturesTabOnShareVariant=e.then((e=>e.features[1])),this.signaturesHubVariant=e.then((e=>e.features[2])),Promise.all([this.safariFixDisabled,this.signaturesTabOnShareVariant,this.signaturesHubVariant])},this.acceptTosInUserSettings=(e,t)=>{t?this.config.apiV2Client.ns("integrations").rpc("set_user_settings",{hellosign_settings:{tos_accepted:!0,user_saw_signers_modal:!0}},{}).then((()=>{this.tosAccepted=Promise.resolve(!0),this.userSawSignersModal=Promise.resolve(!0)})):this.config.apiV2Client.ns("integrations").rpc("set_user_settings",{hellosign_settings:{tos_accepted:!0}},{}).then((()=>{this.tosAccepted=Promise.resolve(!0)})),this.config.logEvent({event_name:c.InstrEventType.APITrace,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({api_name:"set_user_settings",entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),this.allowEmailOptedIn=e,this.updateRecipientsInfo(t)},this.updateRecipientsInfo=e=>{const t=null==e?void 0:e.filter((e=>!!e.name));if(t&&t.length>0){const e={selfSign:!1,signers:t,recipientReassignment:!1,recipientOrder:!1};this.recipientInfo=e}else t&&0===t.length&&(this.config.selfSign=!0)},this.getFileExtensionForLog=e=>{if(!e)return"file_not_selected";try{let t;return e.filename?t=a.file_extension(e.filename):e.fq_path&&(t=a.file_extension(a.filename(e.fq_path))),t?b.HELLOSIGN_SUPPORTED_EXTENSIONS.includes("."+t)?t:"not_in_loggable_allowlist":"file_name_unknown"}catch(e){return"error_getting_filename"}},this.handleDeepIntegrationDone=(e,t,n)=>{var s,r,o,l;if(e&&e.payload&&"contract_management_send_for_signature"===this.config.entryPoint)return this.config.logEvent({event_name:c.InstrEventType.UpdateFile,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}),e.type===de.DEEP_INTEGRATION_FINISHED&&(null===(r=(s=this.config).afterComplete)||void 0===r||r.call(s,e.payload)),void this.reset();if(this.logSignaturesTabOnShareExposure(c.InstrFeatureType.SignaturesTabOnShare,t),e&&e.payload){const s=Object.assign(Object.assign(Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),e.type!==de.USER_CREATE_TEMPLATE&&e.payload.signatureRequestId?{signature_request_id:e.payload.signatureRequestId}:{}),{file_extension:this.getFileExtensionForLog(this.config.file),self_sign:e.payload.isSelfSign,template_guid:e.payload.template_guid});switch(this.config.logEvent({event_name:c.InstrEventType.UpdateFile,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:s}),null===(l=(o=this.config).afterComplete)||void 0===l||l.call(o,e.payload),e.type){case de.USER_SEND_REQUEST:this.config.logEvent({event_name:c.InstrEventType.UseTemplateComplete,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:s});break;case de.USER_CREATE_TEMPLATE:this.config.logEvent({event_name:c.InstrEventType.CreateOrEditTemplateComplete,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:s});break;case de.DEEP_INTEGRATION_FINISHED:default:let e=c.InstrEventType.SendForSignatureComplete;s.self_sign&&(e=c.InstrEventType.SelfSignComplete),this.config.logEvent({event_name:e,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:s})}const r=e.payload.filePath,g=e.payload.isDocToTemplateEnabled;if((this.isSignaturesTabOnShareExpOn(t)||this.isSignaturesHubOn(n))&&e.type===de.DEEP_INTEGRATION_FINISHED)this.showSendForSignatureSuccessSnackbar(t,n,e);else if(!["signature_hub_create_template","signature_hub_use_template","signature_hub_edit_template","signature_hub_delete_template","signature_hub_empty_template_tab_create_template","signature_hub_snackbar_use_template"].includes(this.config.entryPoint))if(this.showRedirectSnackbar(),this.config.entryPoint.startsWith("signature_hub"))a.redirect(i.URI.parse("/signatures").toString());else if(r&&r.includes("/hellosign/home")){const e=i.URI.parse(r);e.updateQuery({new:"1"}),g&&e.updateQuery({"doc-to-template":"1"}),a.redirect(e.toString())}else if(e.type===de.USER_CREATE_TEMPLATE){const t=e.payload.template_guid,n=i.URI.parse("/hellosign/templates");t&&n.updateQuery({guid:t,"use-template-modal":"1"}),a.redirect(n.toString())}else if(e.type===de.USER_SEND_REQUEST){const t=i.URI.parse("/hellosign/home"),n=e.payload.signatureRequestId;n&&t.updateQuery({request:n}),g&&t.updateQuery({"doc-to-template":"1"}),a.redirect(t.toString())}else a.redirect(new i.URI({path:`/preview${r}`}).toString())}this.config.entryPoint.startsWith("signature_hub")||this.reset()},this.checkCanSkipTos=()=>n.__awaiter(this,void 0,void 0,(function*(){var e;let t=!1,n=!1;try{yield this.canSkipTosRequest,t=!0}catch(t){"unverified_email"===(null===(e=t.error)||void 0===e?void 0:e[".tag"])&&(n=!0)}return{canSkipTos:t,emailUnverified:n}})),this.getVariant=e=>n.__awaiter(this,void 0,void 0,(function*(){if(!e)return!1;const t=yield e;if(void 0===t)return!1;const{available:n,variant:i}=t;return"available"===n[".tag"]&&void 0!==i&&"OFF"!==i&&i})),this.config=t,E.Dropbox.init({appKey:"dropbox",productKey:"hellosign"})}handleLog(e){var t;this.config.logEvent({event_name:c.InstrActionType.PrepSendLog,feature_name:c.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign(Object.assign({entry_point:this.config.entryPoint},null!==(t=null==e?void 0:e.payload)&&void 0!==t?t:{}),this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})})}isSignaturesTabOnShareExpOn(e){return"V1"===e||"V2"===e}isSignaturesHubOn(e){return"V1"===e||"V2"===e}logSignaturesTabOnShareExposure(e,t){if(this.isSignaturesTabOnShareExpOn(t)){const n={stormcrowVariantInfo:{feature:e,variant:t}};a.getGatingClientSingleton().logExposure(n)}}}const ye=_.memoize((()=>{const e={entryPoint:"unknown",container:new Y,apiV2Client:Ie(),logEvent:a.createIntegrationsActionsLogger().logEvent,user:a.getActiveUser()};return new be(e)}));t.getLauncher=ye}));
//# sourceMappingURL=c_integrations_hellosign_deep_integration_launcher.js-vflKWPHXw.map
