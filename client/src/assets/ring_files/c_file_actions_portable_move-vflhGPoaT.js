define(["exports","./c_tslib","./c_src_sink_index","./c_apex-metrics_src_types","./c_files_view_file_actions_file_from_metadata","./c_ui_fileops_actions","./c_action_bar_file_actions_logging","./c_lodash-es_lodash","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","./c_core_browser_detection","./c_file_actions_strings","./e_ui_page_files_router","./e_edison","metaserver/static/js/modules/constants/files_spa","./c_core_i18n","metaserver/static/js/modules/core/langpack","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_core_xhr","./c_csrf","./c_browser_cookies","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","./c_data_action_creators_index","./c_history","./c_ux_analytics_dispatch_custom_event","./c_browse_crypto_subtle_digest","./c_sharing_async_share_modal_util"],(function(e,t,s,a,c,r,n,o,i,_,m,d,l,u,v,g,h,S,p,b,j,A,f,E,I,L,C,M,y,N,P,O,F,w,T,x,D,k,U,z,B,q){"use strict";function Q(e){return{class:"previews",action:"move",object:"file",properties:e}}e.portableMove=({newPath:e,currentFQPath:o,filesPath:i,source:_,user:m,extraForLogging:d},l={})=>t.__awaiter(void 0,void 0,void 0,(function*(){const t=i.reduce(((e,t)=>e+(t.is_dir?0:1)),0),u=i.reduce(((e,t)=>e+(t.is_dir?1:0)),0),v=s.getMetricsReporter(),g={surface:_,batchSizeBucket:c.bucketForBatchSize(i.length),contentType:c.batchContentType(i)},h={totalLatency:v.createStats({ns:c.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/latency_total_ms"},g),averageLatency:v.createStats({ns:c.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/latency_average_ms"},g),completed:v.createStats({ns:c.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/completed"},g),started:v.createCounter({ns:c.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/started"},g),succeeded:v.createCounter({ns:c.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/status"},Object.assign(Object.assign({},g),{status:"success"}))};let S;const p=l.onUndo;h.started.increment(1),h.started.record(),S=n.startFileActionLogging(Q,Object.assign({actionSurface:_,numFiles:t,numFolders:u},d)),r.moveFiles({user:m,files:i,path:"browse"===_?o:void 0,onSuccess:(e,t)=>{var s;if(S){const e=S.success(t);h.totalLatency.recordDuration(e,a.TimeUnit.MILLISECONDS),h.averageLatency.recordDuration(e/i.length,a.TimeUnit.MILLISECONDS),h.completed.record(1),h.succeeded.increment(1),h.succeeded.record()}null===(s=l.onSuccess)||void 0===s||s.call(l,e)},onUndo:p,onError:e=>{var t;if(S){const t=S.failed(e);h.totalLatency.recordDuration(t,a.TimeUnit.MILLISECONDS),h.averageLatency.recordDuration(t/i.length,a.TimeUnit.MILLISECONDS),"internal_error"!==e&&h.completed.record(0);const s=v.createCounter({ns:c.FILE_ACTIONS_AMP_NAMESPACE,name:"move/batch/status"},Object.assign(Object.assign({},g),{status:e}));s.increment(1),s.record()}null===(t=l.onError)||void 0===t||t.call(l)},newPath:e,checkFSWs:!0,actionId:S.actionId})}))}));
//# sourceMappingURL=c_file_actions_portable_move.js-vflncrHvq.map
