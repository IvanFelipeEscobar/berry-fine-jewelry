define(["exports","./e_edison","./e_ui_page_files_router","./c_action_plugins_open_in_action_hooks","./c_file_store_utils","./c_core_browser_detection","./c_tslib","./c_truncate_index","./c_capture_redux_selectors","./c_capture_sdk_helpers","./c_core_i18n","./c_file_viewer_sdk_file_viewer_file_viewer","./c_capture_hooks","./c_apex-metrics_src_types","./c_lodash-es_lodash","metaserver/static/js/modules/constants/files_spa","./e_core_exception","./c_core_exception_info","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/constants/request","metaserver/static/js/modules/constants/env","metaserver/static/js/modules/constants/viewer","metaserver/static/js/modules/constants/auth","./c_core_xhr","./c_csrf","./c_browser_cookies","./c_src_sink_index","metaserver/static/js/modules/constants/time","metaserver/static/js/modules/constants/ajax_strings","./c_core_notify","metaserver/static/js/modules/constants/locales","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/campaigns_orchestration","metaserver/static/js/modules/constants/maestro_nav_strings","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/search","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/sharing","metaserver/static/js/modules/constants/undo_strings","./c_file_actions_strings","./c_files_view_file_actions_snackbars","./c_core_types_preview_type","./c_pap-events_enums_file_type-utils","./c_core_data_preview_key","./c_extensions_cloud_docs_compat","./c_integrations_data_selectors","./c_downloads","metaserver/static/js/modules/core/langpack","./c_share_download_ui_api","./c_portable_delete_snackbars","./c_action_bar_action_bar_strings","./c_portable_delete_strings","./c_file_viewer_file_viewer_components","./c_core_data_utils","./c_core_logging_constants","./c_file_viewer_logging_performance","./c_file_viewer_file_extension_extension_constants","./c_src_simple-action-bar_action_bar_types","./c_api_v2_redux_files","./c_resize-observer-polyfill_dist_ResizeObserver","./c_file_viewer_toolbar","./c_breadcrumb_index","./c_history","./c_ux_analytics_dispatch_custom_event","./c_file_viewer_sdk_file_viewer_experiments","metaserver/static/js/modules/constants/file_viewer_configuration","metaserver/static/js/modules/constants/file_viewer_feature_experiments","metaserver/static/js/modules/constants/file_viewer_flows_experiments","./c_auth_login_or_register_types","./c_form_row_index","./c_ui_tree_view","./c_icon_folder_icon","./c_sharing_ui_notifications_util","./c_src_utils_logging","./c_account_email_verify_reasons","./c_account_email","./c_ui_modal_dig","./c_ui_input_dig","./c_file_viewer_utils","./c_loggers_device_type","./c_common_logging_uxa","./c_share_modal_evolution_utils_logging","./c_dig-illustrations_spot_file-folders","./c_pass_store","./c_sharing_share_page_action_types","metaserver/static/js/modules/constants/python","./c_flux_base_store","./c_sharing_ui_util","./c_contacts_contact_token_state","./c_icon_icon_helper","./c_sharing_gating_util","./c_sharing_settings_utils_sharing_settings_util","./c_preview_audio_video_video_editing_utils","./c_components_approval-forms_url_utils","./c_capture_api","./c_pap-events_previews_rename_file","./c_pap-events_filesystem_item_actions_unstar_file","./c_pap-events_navigation_navigate_to_edit","./c_pap-events_previews_crop_rotate_select_rotate","./c_src_preview-photo-editor_types","./c_pap-events_previews_create_folder","./c_keymaster","./c_bug_reporting_routing","./c_clipboard_v3","metaserver/static/js/modules/constants/publish","./c_file_viewer_data_store","./c_previews_data_actions","./c_file_viewer_mobile_web","./c_flows_flows_client","./c_docsend_src_utils","./c_components_approval-forms_approval_metadata","./c_contacts_data_v2","./c_contacts_bloodhound","metaserver/static/js/modules/constants/contacts","./c_profile_services_profile_services_link","./c_profile_services_profile_services_constants","metaserver/static/js/modules/constants/login_and_register","./c_flows_approval_approval_io_client","./c_typeahead_index","./c_src_common_format_bytes","./c_info_blade_content_metadata_image_metadata","./c_src_simple-action-bar_inline_action_bar","./c_src_highlighted-truncated-string_em-string","./c_extensions_split_share_button","./c_team_discovery_data_utils","./c_spectrum_avatar_avatar_initials","./c_spectrum_positioned_portal","./c_growth_ui_teams_web_actions_logger_events","./c_teams_let_members_invite_non_admin_invite_modal","./c_contacts_tokenizer_v2","./c_integrations_profile_card_tooltip","./c_src_text","./c_spectrum_colorized_icon","./c_icon_templates_stateless_index","./c_spectrum_svg_icon_bundle","./c_src_instrumentation_common_context","./c_src_instrumentation_constants","./c_src_instrumentation_function_wrapper","./c_preview_audio_video_video_editing_strings","./c_file_viewer_toolbar_v2_toolbar_holder","./c_campaigns_campaigns_element_id_enum","./c_flows_constants","./c_src_components_action-bar-strings","./c_integrations_hellosign_deep_integration_constants","./c_ui_hoc"],(function(e,t,a,i,o,s,r,_,n,c,l,d,u,p,m,v,g,f,h,b,x,w,E,y,R,k,M,$,C,V,I,j,S,U,T,N,A,B,O,z,D,F,L,P,Q,G,H,W,Z,q,J,K,X,Y,ee,te,ae,ie,oe,se,re,_e,ne,ce,le,de,ue,pe,me,ve,ge,fe,he,be,xe,we,Ee,ye,Re,ke,Me,$e,Ce,Ve,Ie,je,Se,Ue,Te,Ne,Ae,Be,Oe,ze,De,Fe,Le,Pe,Qe,Ge,He,We,Ze,qe,Je,Ke,Xe,Ye,et,tt,at,it,ot,st,rt,_t,nt,ct,lt,dt,ut,pt,mt,vt,gt,ft,ht,bt,xt,wt,Et,yt,Rt,kt,Mt,$t,Ct,Vt,It,jt,St,Ut,Tt,Nt,At){"use strict";const Bt=["ai","psd","sketch","xd"],Ot=["pdf"],zt=["ppt","pptx","key"],Dt=["numbers","ods","xls","xlsm","xlsx"],Ft=["doc","docx","odt","pages","rtf","txt"],Lt=[...Ot,...Dt,...Ft,...zt,...Bt],Pt=e=>!!e&&Lt.includes(e);a.injectInternalStyle("metaserver/static/js/file_viewer/sdk_file_viewer/action_plugins/voice_over_plugin/face_bubble.module.out.css",(e=>"._container_4ad74_1{bottom:50px;height:168px;left:50px;position:absolute;width:168px;z-index:1}._bubble_4ad74_10{height:128px;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:128px}._bubble_4ad74_10:hover ._image_4ad74_19{opacity:50%}._bubble_4ad74_10:hover button{display:block}._image_4ad74_19{border-radius:50%;height:100%;width:100%}._button_4ad74_33{border-radius:100px;color:var(--color__standard__text);display:none;left:50%;max-width:101px;position:absolute;top:50%;transform:translate(-50%,-50%)}._button_4ad74_33,._button_4ad74_33:hover{background:var(--color__inverse__core__primary)}._close_4ad74_49{border-radius:100px;display:none;opacity:70%;position:absolute;right:8px;top:8px}._tooltip-title_4ad74_58{min-width:224px}._tooltip-body_4ad74_62{display:block;margin:12px 0 16px}._tooltip-button-container_4ad74_67{display:flex;justify-content:flex-end}._tooltip-cta_4ad74_72{color:var(--color__standard__text);margin-left:8px}._tooltip-cta_4ad74_72,._tooltip-cta_4ad74_72:hover{background:var(--color__inverse__core__primary)}@keyframes _outer-highlight_4ad74_120{0%{height:143px;width:143px}33%{height:158px;width:158px}66%{height:163px;width:163px}to{height:143px;width:143px}}@keyframes _inner-highlight_4ad74_132{0%{height:128px;width:128px}33%{height:128px;width:128px}66%{height:145px;width:145px}to{height:128px;width:128px}}._outer-highlight-bubble_4ad74_120{animation-iteration-count:infinite;animation-name:_outer-highlight_4ad74_120;background:var(--color__attention__background--faint)}._inner-highlight-bubble_4ad74_132,._outer-highlight-bubble_4ad74_120{animation-duration:1.5s;border-radius:50%;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}._inner-highlight-bubble_4ad74_132{animation-iteration-count:infinite;animation-name:_inner-highlight_4ad74_132;background:var(--color__attention__background)}"));const Qt="_container_4ad74_1",Gt="_bubble_4ad74_10",Ht="_image_4ad74_19",Wt="_button_4ad74_33",Zt="_close_4ad74_49",qt="_tooltip-title_4ad74_58",Jt="_tooltip-body_4ad74_62",Kt="_tooltip-button-container_4ad74_67",Xt="_tooltip-cta_4ad74_72",Yt="_outer-highlight-bubble_4ad74_120",ea="_inner-highlight-bubble_4ad74_132",ta=t.static_url("/static/metaserver/static/js/capture/assets/sdk_face_bubble_default-vflB1fqho.gif"),aa="CAPTURE_VOICE_OVERS_HAS_DISMISSED_FACE_BUBBLE",ia="CAPTURE_VOICE_OVERS_HAS_DISMISSED_FACE_BUBBLE_TOOLTIP",oa=({experimentVariant:e,file:i,logUserAction:s,onDismissBubble:u,user:p})=>{var m;const v=t.reactExports.useRef(null),g=a.useDispatch(),f=t.reactExports.useMemo((()=>o.getExtension(i)),[i]),h=a.useSelector(n.getRecorderState),[b,x]=t.reactExports.useState(!1),[w,E]=t.reactExports.useState(!1),y=t.reactExports.useMemo((()=>(e=>Bt.includes(e)?{body:l.intl.formatMessage({id:"jiz+Qn",defaultMessage:"Use video to give an overview of your design concept, share recent changes, or address feedback."}),title:l.intl.formatMessage({id:"QQzHR3",defaultMessage:"Attach a video to explain your design"})}:Ot.includes(e)?{body:l.intl.formatMessage({id:"o5MmUS",defaultMessage:"Use video to give an overview of your file or provide context for forms, invoices, and agreements."}),title:l.intl.formatMessage({id:"0NaONo",defaultMessage:"Attach a video to explain your file"})}:zt.includes(e)?{body:l.intl.formatMessage({id:"DLuC4i",defaultMessage:"Use video to give an overview of your presentation, share helpful context, or add a human touch."}),title:l.intl.formatMessage({id:"wSW0RB",defaultMessage:"Attach a video to explain your slides"})}:Dt.includes(e)?{body:l.intl.formatMessage({id:"Hl+aj9",defaultMessage:"Use video to give an overview of your spreadsheet, highlight key metrics, or share next steps."}),title:l.intl.formatMessage({id:"0P696I",defaultMessage:"Attach a video to explain your data"})}:Ft.includes(e)?{body:l.intl.formatMessage({id:"t8ng5o",defaultMessage:"Use video to give an overview of your document, share helpful context, or explain key ideas."}),title:l.intl.formatMessage({id:"0NaONo",defaultMessage:"Attach a video to explain your file"})}:{body:l.intl.formatMessage({id:"IpTfVi",defaultMessage:"Use video to give an overview of your file, share helpful context, or explain key ideas."}),title:l.intl.formatMessage({id:"0NaONo",defaultMessage:"Attach a video to explain your file"})})(f)),[f]),R=t.reactExports.useCallback((t=>{s(t,"capture_voice_over_face_bubble",{experimentVariant:e,hasAvatar:(!!p.photo_url).toString(),extension:f})}),[e,f,s,p]);t.reactExports.useEffect((()=>{r.__awaiter(void 0,void 0,void 0,(function*(){const e=yield a.getUserMetadata([aa,ia],p.id),t=!e[aa]&&Lt.includes(f);x(t),E(!e[ia]),t&&R("capture_voice_over_face_bubble_shown")}))}),[f,R,p]),t.reactExports.useEffect((()=>{h.active&&(x(!1),E(!1))}),[h]);const k=()=>r.__awaiter(void 0,void 0,void 0,(function*(){x(!1),E(!1),yield c.handleSafariWorkaround(),g(d.triggerVoiceover(!0))}));return b?t.React$1.createElement("div",{className:Qt},t.React$1.createElement("div",{className:Yt}),t.React$1.createElement("div",{className:ea}),t.React$1.createElement("div",{className:Gt},t.React$1.createElement("img",{alt:"",className:Ht,ref:v,src:null!==(m=p.photo_url)&&void 0!==m?m:ta}),t.React$1.createElement(a.Button$1,{className:Wt,onClick:()=>{R("capture_voice_over_face_bubble_record_click"),k()},size:"small",variant:"borderless"},t.React$1.createElement(_.Truncate,{maxWidth:77,tooltipControlProps:{placement:"top"}},l.intl.formatMessage({id:"0CQfT/",defaultMessage:"Record video"}))),t.React$1.createElement(a.IconButton,{className:Zt,inverse:!0,onClick:()=>{x(!1),E(!1),R("capture_voice_over_face_bubble_dismiss_click"),u(),a.setUserMetadata({[aa]:!0,[ia]:!0},p.id)},size:"small",variant:"filled"},t.React$1.createElement(a.UIIcon,{"aria-label":l.intl.formatMessage({id:"uNoaUx",defaultMessage:"Close"}),src:a.CloseLine})),t.React$1.createElement(a.Tooltip.Control,{auto:!0,open:w,placement:"right",triggerRef:v,variant:"rich"},t.React$1.createElement(a.Title,{className:qt,inverse:!0,size:"medium"},y.title),t.React$1.createElement(a.Text,{className:Jt,color:"standard",inverse:!0},y.body),t.React$1.createElement("div",{className:Kt},t.React$1.createElement(a.Button$1,{onClick:()=>{E(!1),R("capture_voice_over_face_bubble_tooltip_dismiss_click"),a.setUserMetadata({[ia]:!0},p.id)},inverse:!0,variant:"opacity"},l.intl.formatMessage({id:"uNoaUx",defaultMessage:"Close"})),t.React$1.createElement(a.Button$1,{className:Xt,onClick:()=>{R("capture_voice_over_face_bubble_tooltip_record_click"),k()},variant:"borderless"},l.intl.formatMessage({id:"0CQfT/",defaultMessage:"Record video"})))))):null};a.injectInternalStyle("metaserver/static/js/file_viewer/sdk_file_viewer/action_plugins/voice_over_plugin/play_video_button.module.out.css",(e=>"._captureViewVideoDropdownFooterWrapper_95ofo_1{background-color:var(--color__attention__background--faint)}._captureViewVideoDropdownFooter_95ofo_1{display:flex;width:300px}._captureViewVideoButtonTooltip_95ofo_10{align-items:center;display:flex}"));const sa="_captureViewVideoButtonTooltip_95ofo_10";function ra({file:e,logUserAction:i,hideIcons:s,experimentVariant:r}){const _=t.React$1.useRef(null),n=a.useDispatch(),c=a.useSelector(d.getShowPostCreationTooltip),u=l.useIntl();t.React$1.useEffect((()=>{i("capture_view_video_action_shown","file_preview_actionbar_dropdown",{experimentVariant:r,extension:o.getExtension(e)})}),[r,e,i]);return t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(a.Button$1,{variant:"opacity",withIconLeft:s?null:t.React$1.createElement(a.UIIcon,{src:a.VideoLine,role:"presentation"}),ref:_,"data-uxa-log":"view_video_actionbar_button","data-testid":"view-video-menu-button","data-campaigns-element-id":"view-video-on-preview",onClick:()=>{c&&n(d.setShowPostCreationTooltip(!1)),n(d.openCaptureFileVoiceover())}},u.formatMessage({id:"HQGi3z",defaultMessage:"Play video"})),t.React$1.createElement(a.Tooltip.Control,{triggerRef:_,placement:"bottom",open:c},t.React$1.createElement("div",{className:sa},t.React$1.createElement(a.Text,{inverse:!0},u.formatMessage({id:"H/EiWQ",defaultMessage:"Open the video for this file at any time"})),t.React$1.createElement(a.IconButton,{inverse:!0,variant:"borderless",onClick:()=>n(d.setShowPostCreationTooltip(!1))},t.React$1.createElement(a.UIIcon,{src:a.CloseLine})))))}a.injectInternalStyle("metaserver/static/js/file_viewer/sdk_file_viewer/action_plugins/voice_over_plugin/record_video_button.module.out.css",(e=>"._tooltip-body_12863_1{align-items:center;display:flex}._tooltip-text_12863_6{width:225px}"));const _a="_tooltip-body_12863_1",na="_tooltip-text_12863_6";function ca({file:e,user:i,logUserAction:s,hideIcons:_,experimentVariant:u,onCloseTooltip:p,showTooltip:m}){const v=t.reactExports.useRef(null),g=a.useDispatch(),f=a.useSelector(n.getRecorderState),h=l.useIntl();t.React$1.useEffect((()=>{s("capture_record_video_action_shown","file_preview_actionbar_dropdown",{experimentVariant:u,extension:o.getExtension(e)})}),[u,e,s]);const b=t=>{s("capture_record_video_with_camera_failure","file_preview_actionbar_dropdown",{reason:t,experimentVariant:u,extension:o.getExtension(e)})};return t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(a.Button$1,{variant:"opacity",withIconLeft:_?null:t.React$1.createElement(a.UIIcon,{src:a.VideoLine,role:"presentation"}),id:"capture-record-video-menu-button","data-uxa-log":"record_video_on_previews_click","data-testid":"record-video-menu-button","data-campaigns-element-id":"record-video-on-preview",disabled:null==f?void 0:f.active,onClick:()=>r.__awaiter(this,void 0,void 0,(function*(){s(`capture_record_video_with_camera_${"click"}`,"file_preview_actionbar_dropdown",{experimentVariant:u,extension:o.getExtension(e)}),i?Pt(o.getExtension(e))?(yield c.handleSafariWorkaround(),g(d.triggerVoiceover(!0))):b("invalid_file"):b("invalid_user")})),ref:v},h.formatMessage({id:"kruZZo",defaultMessage:"Record video"})),t.React$1.createElement(a.Tooltip.Control,{open:m,placement:"bottom","max-width":"300",triggerRef:v},t.React$1.createElement("div",{className:_a},t.React$1.createElement(a.Text,{className:na,color:"standard",inverse:!0,size:"small"},h.formatMessage({id:"5GGxzT",defaultMessage:"Record a video for your file at any time"})),t.React$1.createElement(a.IconButton,{inverse:!0,onClick:p,size:"small",variant:"borderless"},t.React$1.createElement(a.UIIcon,{"aria-label":h.formatMessage({id:"uNoaUx",defaultMessage:"Close"}),src:a.CloseLine})))))}const la=({file:e,hideIcons:a,logUserAction:i,recordExperimentVariant:o,user:r,viewExperimentVariant:_})=>{const n=u.useCaptureAccess(r),c=d.useIsFileOwner(r,e),{shortLabel:l}=d.useCaptureForFile(r,e,i),[p,m]=t.reactExports.useState(!1),[v,g]=t.reactExports.useState(!0);t.reactExports.useEffect((()=>{g(!1)}),[]);const f=t.reactExports.useCallback((()=>{m(!0)}),[m]),h=t.reactExports.useCallback((()=>{m(!1)}),[m]),b=t.reactExports.useMemo((()=>"OFF"!==_&&l),[l,_]),x=t.reactExports.useMemo((()=>["V1","V2"].includes(o)&&!s.safari&&n&&c&&!l&&!s.is_supported_mobile_browser()),[n,c,o,l]);return b?t.React$1.createElement(ra,{file:e,logUserAction:i,hideIcons:a,experimentVariant:o}):x?t.React$1.createElement(t.React$1.Fragment,null,t.React$1.createElement(ca,{file:e,user:r,logUserAction:i,hideIcons:a,experimentVariant:o,onCloseTooltip:h,showTooltip:p}),t.React$1.createElement(oa,{experimentVariant:o,file:e,logUserAction:i,onDismissBubble:f,user:r})):!v||null!==n&&null!==c?null:t.React$1.createElement("div",{style:{width:"140px"}})};e.logRecordVideoButtonExposure=function(e){a.getGatingClientSingleton().logExposure({stormcrowVariantInfo:{feature:"capture_sdk_integration_voice_overs_v2",variant:e}})},e.logViewCaptureVideoButtonExposure=function(e){a.getGatingClientSingleton().logExposure({stormcrowVariantInfo:{feature:"capture_sdk_integration_voice_overs_view_button",variant:e}})},e.makeVoiceOverEntrypoint=(e,s,r,_,n)=>({actionDefinitions:()=>(e=>{const c=o.getExtension(e.file);return{atTopLevelIfSpace:Pt(c)?[{renderButton:i=>{const o=e.file,c=a.getStoreForCapture();return t.React$1.createElement(a.Provider,{store:c},t.React$1.createElement(la,{file:o,hideIcons:i,logUserAction:n.logUserAction,recordExperimentVariant:r,user:s,viewExperimentVariant:_}))},id:i.VOICE_OVER_PLUGIN_ID}]:[]}})(e())})}));
//# sourceMappingURL=c_action_plugins_voice_over_plugin.js-vfl-3aKGt.map
